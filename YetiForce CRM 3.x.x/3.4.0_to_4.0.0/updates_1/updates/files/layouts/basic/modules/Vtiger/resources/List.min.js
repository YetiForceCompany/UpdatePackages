
jQuery.Class("Vtiger_List_Js",{listInstance:false,getRelatedModulesContainer:false,massEditPreSave:"Vtiger.MassEdit.PreSave",getInstance:function(){if(Vtiger_List_Js.listInstance==false){var c=app.getModuleName();var e=app.getParentModuleName();if(e=="Settings"){var b=e+"_"+c+"_List_Js";if(typeof window[b]=="undefined"){b=c+"_List_Js"}var d=e+"_Vtiger_List_Js";if(typeof window[d]=="undefined"){d="Vtiger_List_Js"}}else{b=c+"_List_Js";d="Vtiger_List_Js"}if(typeof window[b]!="undefined"){var a=new window[b]()}else{var a=new window[d]()}Vtiger_List_Js.listInstance=a;return a}return Vtiger_List_Js.listInstance},triggerSendEmail:function(f){var d=Vtiger_List_Js.getInstance();var c=d.checkListRecordSelected();if(c!=true){var b=d.readSelectedIds(true);var e=d.readExcludedIds(true);var a=d.getDefaultParams();delete a.parent;a.module=app.getModuleName();a.view="SendMailModal";a.selected_ids=b;a.excluded_ids=e;a.cvid=d.getCurrentCvId();if(f){jQuery.extend(a,f)}AppConnector.request(a).then(function(g){app.showModalWindow(g,function(h){h.find('[name="saveButton"]').click(function(i){if(h.find("form").validationEngine("validate")){jQuery.extend(a,{field:h.find("#field").val(),template:h.find("#template").val(),action:"Mail",mode:"sendMails",});delete a.view;AppConnector.request(a).then(function(j){if(j.result==true){app.hideModalWindow()}},function(k,j){app.hideModalWindow()})}})})})}else{d.noRecordSelectedAlert()}},triggerSendSms:function(e,b){var c=Vtiger_List_Js.getInstance();var a=c.checkListRecordSelected();if(a!=true){var d=jQuery.progressIndicator();Vtiger_Index_Js.checkMailConfig().then(function(f){d.progressIndicator({mode:"hide"});if(f==true){Vtiger_List_Js.triggerMassAction(e)}else{alert(app.vtranslate("JS_SMS_SERVER_CONFIGURATION"))}})}else{c.noRecordSelectedAlert()}},triggerTransferOwnership:function(f){var d=this;var c=Vtiger_List_Js.getInstance();var a=c.checkListRecordSelected();if(a!=true){var e=jQuery.progressIndicator();d.getRelatedModulesContainer=false;var b={type:"POST",url:f,dataType:"html",data:{}};AppConnector.request(b).then(function(g){e.progressIndicator({mode:"hide"});if(g){var h=function(i){var j=app.validationEngineOptions;j.onValidationComplete=function(l,k){if(k){d.transferOwnershipSave(l)}return false};jQuery("#changeOwner").validationEngine(app.validationEngineOptions)};app.showModalWindow(g,function(j){var i=d.getRelatedModuleContainer();app.changeSelectElementView(i,"select2");if(typeof h=="function"){h(j)}})}})}else{c.noRecordSelectedAlert()}},triggerQuickExportToExcel:function(g){var j="index.php";var m=this;var b=Vtiger_List_Js.getInstance();var f=b.checkListRecordSelected();if(f!=true){var i=jQuery.progressIndicator();var k=b.readSelectedIds(true);var l=b.readExcludedIds(true);var c=b.getCurrentCvId();var e={viewname:c,selected_ids:k,excluded_ids:l};var a=b.getListSearchInstance().getAlphabetSearchValue();e.search_params=JSON.stringify(b.getListSearchInstance().getListSearchParams());if((typeof a!="undefined")&&(a.length>0)){e.search_key=b.getListSearchInstance().getAlphabetSearchField();e.search_value=a;e.operator="s"}var h={type:"POST",url:j,dataType:"application/x-msexcel",data:e};var d=$('<form method="POST" action="'+j+'">');d.append($("<input />",{name:"module",value:g}));d.append($("<input />",{name:"action",value:"QuickExport"}));d.append($("<input />",{name:"mode",value:"ExportToExcel"}));if(typeof csrfMagicName!=="undefined"){d.append($("<input />",{name:csrfMagicName,value:csrfMagicToken}))}$.each(h.data,function(o,n){d.append($("<input />",{name:o,value:n}))});$("body").append(d);d.submit();Vtiger_Helper_Js.showMessage({text:app.vtranslate("JS_STARTED_GENERATING_FILE"),type:"info"});i.progressIndicator({mode:"hide"})}else{b.noRecordSelectedAlert()}},transferOwnershipSave:function(d){var c=Vtiger_List_Js.getInstance();var b=c.readSelectedIds(true);var f=c.readExcludedIds(true);var a=c.getCurrentCvId();var h=jQuery("#transferOwnerId").val();var e=jQuery("#related_modules").val();var g={module:app.getModuleName(),action:"TransferOwnership",viewname:a,selected_ids:b,excluded_ids:f,transferOwnerId:h,related_modules:e};AppConnector.request(g).then(function(i){if(i.success){app.hideModalWindow();var j={title:app.vtranslate("JS_MESSAGE"),text:app.vtranslate("JS_RECORDS_TRANSFERRED_SUCCESSFULLY"),animation:"show",type:"info"};Vtiger_Helper_Js.showPnotify(j);c.getListViewRecords();Vtiger_List_Js.clearList()}})},getRelatedModuleContainer:function(){if(this.getRelatedModulesContainer==false){this.getRelatedModulesContainer=jQuery("#related_modules")}return this.getRelatedModulesContainer},massDeleteRecords:function(e,a){var g=Vtiger_List_Js.getInstance();if(typeof a!="undefined"){g=a}var d=g.checkListRecordSelected();if(d!=true){var c=g.readSelectedIds(true);var h=g.readExcludedIds(true);var b=g.getCurrentCvId();var f=app.vtranslate("LBL_MASS_DELETE_CONFIRMATION");Vtiger_Helper_Js.showConfirmationBox({message:f}).then(function(m){var l=e+"&viewname="+b+"&selected_ids="+c+"&excluded_ids="+h;var i=Vtiger_List_Js.getInstance();if(i.getListSearchInstance()){var j=i.getListSearchInstance().getAlphabetSearchValue();l+="&search_params="+JSON.stringify(i.getListSearchInstance().getListSearchParams());if((typeof j!="undefined")&&(j.length>0)){l+="&search_key="+i.getListSearchInstance().getAlphabetSearchField();l+="&search_value="+j;l+="&operator=s"}}var n=app.vtranslate("JS_RECORDS_ARE_GETTING_DELETED");var k=jQuery.progressIndicator({message:n,position:"html",blockInfo:{enabled:true}});AppConnector.request(l).then(function(o){k.progressIndicator({mode:"hide"});g.postMassDeleteRecords();if(o.error){var p={text:app.vtranslate(o.error.message),title:app.vtranslate("JS_LBL_PERMISSION")};Vtiger_Helper_Js.showPnotify(p)}},function(o){console.log("Error: "+o)})},function(i,j){Vtiger_List_Js.clearList()})}else{g.noRecordSelectedAlert()}},deleteRecord:function(b){var a=jQuery.Deferred();var d=Vtiger_List_Js.getInstance();var c=app.vtranslate("LBL_DELETE_CONFIRMATION");Vtiger_Helper_Js.showConfirmationBox({message:c}).then(function(i){var g=app.getModuleName();var f={module:g,action:"DeleteAjax",record:b,parent:app.getParentModuleName()};var j=app.vtranslate("JS_RECORD_GETTING_DELETED");var h=jQuery.progressIndicator({message:j,position:"html",blockInfo:{enabled:true}});AppConnector.request(f).then(function(o){h.progressIndicator({mode:"hide"});if(o.success){var m=$(".pagination");var k=m.data("totalCount");if(k!=""){k--;m.data("totalCount",k)}var q=jQuery("#orderBy").val();var n=jQuery("#sortOrder").val();var e=parseInt($("#pageNumber").val());if($("#noOfEntries").val()==1&&e!=1){e--}var l={viewname:o.result.viewname,orderby:q,sortorder:n,page:e,};jQuery("#recordsCount").val("");jQuery("#totalPageCount").text("");d.getListViewRecords(l).then(function(){d.updatePagination(e);a.resolve()})}else{var p={text:app.vtranslate(o.error.message),title:app.vtranslate("JS_LBL_PERMISSION")};Vtiger_Helper_Js.showPnotify(p)}},function(e,k){})},function(e,f){});return a.promise()},triggerMassAction:function(l,g,j,k){if(typeof j=="undefined"){j=function(){return true}}if(typeof j=="object"){k=j;j=function(){return true}}var b=Vtiger_List_Js.getInstance();var e=b.checkListRecordSelected();if(e!=true){var i=jQuery.progressIndicator();var m=b.readSelectedIds(true);var n=b.readExcludedIds(true);var c=b.getCurrentCvId();var d={viewname:c,selected_ids:m,excluded_ids:n};var h=Vtiger_List_Js.getInstance();if(h.getListSearchInstance()){var a=h.getListSearchInstance().getAlphabetSearchValue();d.search_params=JSON.stringify(h.getListSearchInstance().getListSearchParams());if((typeof a!="undefined")&&(a.length>0)){d.search_key=h.getListSearchInstance().getAlphabetSearchField();d.search_value=a;d.operator="s"}}var f={type:"POST",url:l,dataType:"html",data:d};if(typeof k=="undefined"){k={}}var k=jQuery.extend({"text-align":"left"},k);AppConnector.request(f).then(function(p){i.progressIndicator({mode:"hide"});if(p){var o=j(p);if(!o){return}app.showModalWindow(p,function(q){if(typeof g=="function"){g(q)}},k)}},function(o,p){i.progressIndicator({mode:"hide"})})}else{b.noRecordSelectedAlert()}},triggerMassEdit:function(b){var a=this.getSelectedRecordCount();if(a>jQuery("#listMaxEntriesMassEdit").val()){var c={title:app.vtranslate("JS_MESSAGE"),text:app.vtranslate("JS_MASS_EDIT_LIMIT"),animation:"show",type:"error"};Vtiger_Helper_Js.showPnotify(c);return}Vtiger_List_Js.triggerMassAction(b,function(e){var d=e.find("#massEdit");d.validationEngine(app.validationEngineOptions);var f=Vtiger_List_Js.getInstance();f.inactiveFieldsValidation(d);f.registerEventForTabClick(d);var g=Vtiger_Edit_Js.getInstance();g.registerBasicEvents(d);f.postMassEdit(e);f.registerSlimScrollMassEdit()},{width:"65%"})},getSelectedRecordCount:function(){var e;var d=Vtiger_List_Js.getInstance();var b=d.getCurrentCvId();var a=jQuery("#selectedIds").data(b+"Selectedids");if(a!=undefined){if(a!="all"){e=a.length}else{var c=jQuery("#excludedIds").data(b+"Excludedids").length;var f=jQuery("#recordsCount").val();e=f-c}}return e},triggerExportAction:function(f){var e=Vtiger_List_Js.getInstance();var c=e.readSelectedIds(true);var h=e.readExcludedIds(true);var b=e.getCurrentCvId();var a=jQuery("#pageNumber").val();if("undefined"===typeof b){f+="&selected_ids="+c+"&excluded_ids="+h+"&page="+a}else{f+="&selected_ids="+c+"&excluded_ids="+h+"&viewname="+b+"&page="+a}var d=Vtiger_List_Js.getInstance();if(d.getListSearchInstance()){var g=d.getListSearchInstance().getAlphabetSearchValue();f+="&search_params="+JSON.stringify(d.getListSearchInstance().getListSearchParams());if((typeof g!="undefined")&&(g.length>0)){f+="&search_key="+d.getListSearchInstance().getAlphabetSearchField();f+="&search_value="+g;f+="&operator=s"}}window.location.href=f},clearList:function(){jQuery("#deSelectAllMsg").trigger("click");jQuery("#selectAllMsgDiv").hide()},showDuplicateSearchForm:function(a){var b=jQuery.progressIndicator();app.showModalWindow("",a,function(){b.progressIndicator({mode:"hide"});Vtiger_List_Js.registerDuplicateSearchButtonEvent()})},registerDuplicateSearchButtonEvent:function(){jQuery("#fieldList").on("change",function(c){var b=jQuery(c.currentTarget).val();var a=jQuery("#findDuplicate").find('button[type="submit"]');if(b!=null){a.attr("disabled",false)}else{a.attr("disabled",true)}})},triggerListSearch:function(){var a=Vtiger_List_Js.getInstance();var b=a.getListViewContentContainer();b.find('[data-trigger="listSearch"]').trigger("click")},getSelectedRecordsParams:function(d,h){var e=Vtiger_List_Js.getInstance();if(d==false||e.checkListRecordSelected()!=true){var c=e.readSelectedIds(true);var g=e.readExcludedIds(true);var b=e.getCurrentCvId();var a={viewname:b,selected_ids:c,excluded_ids:g};var f=e.getListSearchInstance().getAlphabetSearchValue();a.search_params=JSON.stringify(e.getListSearchInstance().getListSearchParams());if((typeof f!="undefined")&&(f.length>0)){a.search_key=e.getListSearchInstance().getAlphabetSearchField();a.search_value=f;a.operator="s"}return a}else{e.noRecordSelectedAlert()}return false},triggerGenerateRecords:function(a){var b=Vtiger_List_Js.getSelectedRecordsParams();if(b===false){return false}var d={};jQuery.extend(d,b);a+="&"+jQuery.param(d);var c=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});app.showModalWindow(null,a,function(){c.progressIndicator({mode:"hide"})})},showMap:function(){var b=Vtiger_List_Js.getSelectedRecordsParams(false);var a="index.php?module=OpenStreetMap&view=MapModal&srcModule="+app.getModuleName();app.showModalWindow(null,a,function(c){var d=new OpenStreetMap_Map_Js();d.setSelectedParams(b);d.registerModalView(c)})},triggerReviewChanges:function(a){var f=Vtiger_List_Js.getInstance();var d=f.checkListRecordSelected();if(d!=true){var c=f.readSelectedIds(true);var g=f.readExcludedIds(true);var b=f.getCurrentCvId();var e=app.vtranslate("JS_MASS_REVIEWING_CHANGES_CONFIRMATION");Vtiger_Helper_Js.showConfirmationBox({message:e}).then(function(k){var h=a+"&viewname="+b+"&selected_ids="+c+"&excluded_ids="+g;if(f.getListSearchInstance()){var i=f.getListSearchInstance().getAlphabetSearchValue();h+="&search_params="+JSON.stringify(f.getListSearchInstance().getListSearchParams());if((typeof i!="undefined")&&(i.length>0)){h+="&search_key="+f.getListSearchInstance().getAlphabetSearchField();h+="&search_value="+i;h+="&operator=s"}}var l=app.vtranslate("JS_LOADING_PLEASE_WAIT");var j=jQuery.progressIndicator({message:l,position:"html",blockInfo:{enabled:true}});AppConnector.request(h).then(function(m){j.progressIndicator({mode:"hide"});if(m.result){var n={text:m.result,type:"info"};Vtiger_Helper_Js.showPnotify(n)}else{f.getListViewRecords()}},function(m,n){app.errorLog(m,n)})},function(h,i){Vtiger_List_Js.clearList()})}else{f.noRecordSelectedAlert()}}},{listViewContainer:false,listViewTopMenuContainer:false,listViewContentContainer:false,filterBlock:false,filterSelectElement:false,listSearchInstance:false,noEventsListSearch:true,getListSearchInstance:function(a){if(a!=undefined){this.noEventsListSearch=a}if(this.listSearchInstance==false&&(this.getListViewContainer().find(".searchField").length||this.getListViewContainer().find(".picklistSearchField").length)){this.listSearchInstance=YetiForce_ListSearch_Js.getInstance(this.getListViewContainer(),this.noEventsListSearch)}return this.listSearchInstance},getListViewContainer:function(){if(this.listViewContainer==false){this.listViewContainer=jQuery("div.listViewPageDiv")}return this.listViewContainer},getListViewTopMenuContainer:function(){if(this.listViewTopMenuContainer==false){this.listViewTopMenuContainer=jQuery(".listViewTopMenuDiv")}return this.listViewTopMenuContainer},getListViewContentContainer:function(){if(this.listViewContentContainer==false){this.listViewContentContainer=jQuery(".listViewContentDiv")}return this.listViewContentContainer},getFilterBlock:function(){if(this.filterBlock==false){var a=this.getFilterSelectElement();if(a.length<=0){this.filterBlock=jQuery()}else{if(a.is("select")){this.filterBlock=a.data("select2").$dropdown}}}return this.filterBlock},getFilterSelectElement:function(){if(this.filterSelectElement==false){this.filterSelectElement=jQuery("#customFilter")}return this.filterSelectElement},getDefaultParams:function(){var h=jQuery("#pageNumber").val();var d=app.getModuleName();var i=app.getParentModuleName();var b=this.getCurrentCvId();var g=jQuery("#orderBy").val();var c=jQuery("#sortOrder").val();var e={module:d,parent:i,page:h,view:"List",viewname:b,orderby:g,sortorder:c};var f=this.getListSearchInstance();if(f!==false){var a=this.getListSearchInstance().getAlphabetSearchValue();e.search_params=JSON.stringify(this.getListSearchInstance().getListSearchParams(true));if((typeof a!="undefined")&&(a.length>0)){e.search_key=this.getListSearchInstance().getAlphabetSearchField();e.search_value=a;e.operator="s"}}return e},getListViewRecords:function(b){var a=jQuery.Deferred();if(typeof b=="undefined"){b={}}var d=this;var e=jQuery(".listViewLoadingMsg").text();var f=jQuery.progressIndicator({message:e,position:"html",blockInfo:{enabled:true}});var c=this.getDefaultParams();var b=jQuery.extend(c,b);AppConnector.requestPjax(b).then(function(j){f.progressIndicator({mode:"hide"});var k=jQuery("#listViewContents");var i=d.getListSearchInstance();k.html(j);app.showSelect2ElementView(k.find("select.select2"));d.registerListViewSpecialOptiopn();app.changeSelectElementView(k);app.showPopoverElementView(k.find(".popoverTooltip"));jQuery("body").trigger(jQuery.Event("LoadRecordList.PostLoad"),j);if(i!==false){i.registerBasicEvents()}Vtiger_Index_Js.registerMailButtons(k);Vtiger_Helper_Js.showHorizontalTopScrollBar();var g=d.readSelectedIds();if(g!=""){if(g=="all"){jQuery(".listViewEntriesCheckBox").each(function(l,m){jQuery(this).attr("checked",true).closest("tr").addClass("highlightBackgroundColor")});jQuery("#deSelectAllMsgDiv").show();var h=d.readExcludedIds();if(h!=""){jQuery("#listViewEntriesMainCheckBox").attr("checked",false);jQuery(".listViewEntriesCheckBox").each(function(l,m){if(jQuery.inArray(jQuery(m).val(),h)!=-1){jQuery(m).attr("checked",false).closest("tr").removeClass("highlightBackgroundColor")}})}}else{jQuery(".listViewEntriesCheckBox").each(function(l,m){if(jQuery.inArray(jQuery(m).val(),g)!=-1){jQuery(this).attr("checked",true).closest("tr").addClass("highlightBackgroundColor")}})}d.checkSelectAll()}d.calculatePages().then(function(l){a.resolve(l);app.notifyPostAjaxReady()});d.registerUnreviewedCountEvent()},function(h,g){a.reject(h,g)});return a.promise()},calculatePages:function(){var b=jQuery.Deferred();var c=jQuery("#totalPageCount");var a=c.text();if(a==""){var d=jQuery("#totalCount").val();if(d!=""){var e=jQuery("#pageLimit").val();if(e=="0"){e=1}pageCount=Math.ceil(d/e);if(pageCount==0){pageCount=1}c.text(pageCount);b.resolve();return b.promise()}b.resolve()}else{b.resolve()}return b.promise()},noRecordSelectedAlert:function(){return alert(app.vtranslate("JS_PLEASE_SELECT_ONE_RECORD"))},massActionSave:function(b,c){if(typeof c=="undefined"){c=false}var a=jQuery.Deferred();if(c){var f=jQuery.Event(Vtiger_List_Js.massEditPreSave);b.trigger(f);if(f.isDefaultPrevented()){b.find('[name="saveButton"]').removeAttr("disabled");a.reject();return a.promise()}b.find('[id^="selectRow"]').each(function(g,h){h=jQuery(h);if(!h.prop("checked")){h.closest(".rowElements").find(".fieldValue [name]").each(function(i,j){j=jQuery(j);j.attr("data-element-name",j.attr("name")).removeAttr("name")})}})}var e=b.serializeFormData();var d=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});AppConnector.request(e).then(function(g){d.progressIndicator({mode:"hide"});app.hideModalWindow();if(!(g.result)){var h={text:app.vtranslate("JS_MASS_EDIT_NOT_SUCCESSFUL"),type:"info"};Vtiger_Helper_Js.showPnotify(h)}a.resolve(g)},function(g,h){app.hideModalWindow();app.errorLog(g,h);a.reject(g,h)});return a.promise()},checkSelectAll:function(){var a=true;jQuery(".listViewEntriesCheckBox").each(function(b,c){if(jQuery(c).is(":checked")){a=true}else{a=false;return false}});if(a==true){jQuery("#listViewEntriesMainCheckBox").attr("checked",true)}else{jQuery("#listViewEntriesMainCheckBox").attr("checked",false)}},getRecordsCount:function(){var c=jQuery.Deferred();var e=jQuery("#recordsCount").val();if(e!=""){c.resolve(e)}else{var g="";var b=this.getCurrentCvId();var d=app.getModuleName();var f=app.getParentModuleName();var a={module:d,parent:f,view:"ListAjax",viewname:b,mode:"getRecordsCount"};var h=this.getListSearchInstance().getAlphabetSearchValue();a.search_params=JSON.stringify(this.getListSearchInstance().getListSearchParams());if((typeof h!="undefined")&&(h.length>0)){a.search_key=this.getListSearchInstance().getAlphabetSearchField();a.search_value=h;a.operator="s"}AppConnector.request(a).then(function(j){var i=JSON.parse(j);jQuery("#recordsCount").val(i.result["count"]);g=i.result["count"];c.resolve(g)},function(i,j){})}return c.promise()},getSelectOptionFromChosenOption:function(c){var d=c.attr("id");var b=d.split("-");var a="";if(b.length>0){a=b[b.length-1]}else{return false}return jQuery("#filterOptionId_"+a)},readSelectedIds:function(e){var b=this.getCurrentCvId();var f=jQuery("#selectedIds");var c=b+"Selectedids";var d=f.data();if(!(c in d)){var a=new Array();this.writeSelectedIds(a)}else{a=d[c]}if(e==true){if(typeof a=="object"){return JSON.stringify(a)}}return a},readExcludedIds:function(e){var a=this.getCurrentCvId();var d=jQuery("#excludedIds");var b=a+"Excludedids";var f=d.data();if(!(b in f)){var c=new Array();this.writeExcludedIds(c)}else{c=f[b]}if(e==true){if(typeof c=="object"){return JSON.stringify(c)}}return c},writeSelectedIds:function(b){var a=this.getCurrentCvId();jQuery("#selectedIds").data(a+"Selectedids",b)},writeExcludedIds:function(b){var a=this.getCurrentCvId();jQuery("#excludedIds").data(a+"Excludedids",b)},getCurrentCvId:function(){return jQuery("#customFilter").find("option:selected").data("id")},getAlphabetSearchField:function(){return jQuery("#alphabetSearchKey").val()},getAlphabetSearchValue:function(){return jQuery("#alphabetValue").val()},checkListRecordSelected:function(){var a=this.readSelectedIds();if(typeof a=="object"&&a.length<=0){return true}return false},inactiveFieldValidation:function(g){g.validationEngine("hide");var e=g.closest("form");var d=e.data("jqv").InvalidFields;var a=[g.get(0)];var h=g.attr("data-validation-engine");g.attr("data-invalid-validation-engine",h?h:"validate[]");g.removeAttr("data-validation-engine");if(g.is("select")&&g.hasClass("chzn-select")){var f=app.getChosenElementFromSelect(g);f.validationEngine("hide");a.push(f.get(0))}for(var c in a){var b=jQuery.inArray(a[c],d);if(b!="-1"){d.splice(b,1)}}},activeFieldValidation:function(a){var b=a.attr("data-invalid-validation-engine");a.attr("data-validation-engine",b?b:"validate[]");a.removeAttr("data-invalid-validation-engine")},postMassEdit:function(a){var b=this;var c=Vtiger_Edit_Js.getInstance();a.find(".selectRow").on("change",function(i){var f=jQuery(i.currentTarget);var j=f.closest(".rowElements").find(".fieldValue");var g=j.find("[data-validation-engine],[data-invalid-validation-engine]");var d=g.data("fieldinfo");if(f.prop("checked")){b.activeFieldValidation(g)}else{b.inactiveFieldValidation(g)}if(d!==undefined&&d.type==="reference"){var h=c.getMappingRelatedField(d.name,c.getReferencedModuleName(j),a);$.each(h,function(e,k){var l=a.find('[id="selectRow'+e+'"]');if(l.length&&l.prop("disabled")){l.prop("disabled",false);l.trigger("click");l.prop("disabled",true)}})}});a.find("form").on("submit",function(g){g.preventDefault();var f=jQuery(g.currentTarget);if(!f.find('input[id^="selectRow"]:checked').length){Vtiger_Helper_Js.showPnotify(app.vtranslate("NONE_OF_THE_FIELD_VALUES_ARE_CHANGED_IN_MASS_EDIT"));return}var d=f.data("jqv").InvalidFields;if(d.length==0){f.find('[name="saveButton"]').prop("disabled",true)}else{return}b.massActionSave(f,true).then(function(e){b.getListViewRecords();Vtiger_List_Js.clearList()},function(e,h){app.errorLog(e,h)})})},registerPageNavigationEvents:function(){var a=jQuery.Deferred();var b=this;jQuery("#listViewNextPageButton").on("click",function(i){if($(this).hasClass("disabled")){return}var c=jQuery("#pageLimit").val();var l=jQuery("#noOfEntries").val();if(l==c){var j=jQuery("#orderBy").val();var f=jQuery("#sortOrder").val();var d=b.getCurrentCvId();var g={orderby:j,sortorder:f,viewname:d};var k=jQuery("#pageNumber").val();var h=parseInt(parseFloat(k))+1;jQuery("#pageNumber").val(h);jQuery("#pageToJump").val(h);b.getListViewRecords(g).then(function(e){b.updatePagination(h);a.resolve()},function(m,e){a.reject(m,e)})}return a.promise()});jQuery("#listViewPreviousPageButton").on("click",function(){var f=jQuery.Deferred();var c=jQuery("#pageNumber").val();if(c>1){var i=jQuery("#orderBy").val();var g=jQuery("#sortOrder").val();var e=b.getCurrentCvId();var d={orderby:i,sortorder:g,viewname:e};var h=parseInt(parseFloat(c))-1;jQuery("#pageNumber").val(h);jQuery("#pageToJump").val(h);b.getListViewRecords(d).then(function(j){b.updatePagination(h);f.resolve()},function(k,j){f.reject(k,j)})}});jQuery(".pageNumber").on("click",function(){var g=$(this).hasClass("disabled");if(g){return false}var c=$(this).data("id");var i=jQuery("#orderBy").val();var f=jQuery("#sortOrder").val();var e=b.getCurrentCvId();var d={orderby:i,sortorder:f,viewname:e,page:c};var h=parseInt(parseFloat(c))-1;jQuery("#pageNumber").val(h);jQuery("#pageToJump").val(h);b.getListViewRecords(d).then(function(j){b.updatePagination(c)},function(k,j){})});$("#totalCountBtn").on("click",function(){app.hidePopover(jQuery(this));var c={title:app.vtranslate("JS_LBL_PERMISSION"),text:app.vtranslate("JS_GET_PAGINATION_INFO"),type:"info",animation:"show"};Vtiger_Helper_Js.showMessage(c);var d=b.getDefaultParams();d.totalCount=-1;d.view="Pagination";d.mode="getPagination";AppConnector.request(d).then(function(e){jQuery(".paginationDiv").html(e);b.registerPageNavigationEvents()})});jQuery("#listViewPageJump").on("click",function(j){if(typeof Vtiger_WholeNumberGreaterThanZero_Validator_Js.invokeValidation(jQuery("#pageToJump"))!="undefined"){var d=jQuery("#pageNumber").val();jQuery("#pageToJump").val(d)}jQuery("#pageToJump").validationEngine("hideAll");var g=jQuery("#totalPageCount");var c=g.text();if(c==""){var h=jQuery("#totalCount");var i=h.val();if(i!=""){var f=jQuery("#pageLimit").val();if(f=="0"){f=1}pageCount=Math.ceil(i/f);if(pageCount==0){pageCount=1}g.text(pageCount);return}g.progressIndicator({});b.getPageCount().then(function(k){var e=k.result["page"];h.val(k.result["numberOfRecords"]);if(e==0){e=1}g.text(e);g.progressIndicator({mode:"hide"})})}});jQuery("#listViewPageJumpDropDown").on("click","li",function(c){c.stopImmediatePropagation()}).on("keypress","#pageToJump",function(k){if(k.which==13){k.stopImmediatePropagation();var h=jQuery(k.currentTarget);var g=Vtiger_WholeNumberGreaterThanZero_Validator_Js.invokeValidation(h);if(typeof g!="undefined"){h.validationEngine("showPrompt",g,"","topLeft",true)}else{h.validationEngine("hideAll");var f=jQuery("#pageNumber");var c=f.val();var i=parseInt(jQuery(k.currentTarget).val());var j=parseInt(jQuery("#totalPageCount").text());if(i>j){var l=app.vtranslate("JS_PAGE_NOT_EXIST");h.validationEngine("showPrompt",l,"","topLeft",true);return}if(i==c){var m=app.vtranslate("JS_YOU_ARE_IN_PAGE_NUMBER")+" "+i;var d={text:m,type:"info"};Vtiger_Helper_Js.showMessage(d);return}f.val(i);b.getListViewRecords().then(function(e){b.updatePagination(i);h.closest(".btn-group ").removeClass("open")},function(n,e){})}return false}})},getPageCount:function(){var b=jQuery.Deferred();var a=this.getPageJumpParams();AppConnector.request(a).then(function(d){var c;if(typeof d!="object"){c=JSON.parse(d)}else{c=d}b.resolve(c)},function(c,d){});return b.promise()},getPageJumpParams:function(){var a=this.getDefaultParams();a.view="ListAjax";a.mode="getPageCount";return a},updatePagination:function(a){a=typeof a!=="undefined"?a:1;var c=this;var b=c.getCurrentCvId();var f={};f.module=app.getModuleName();if("Settings"==app.getParentModuleName()){f.parent="Settings"}f.view="Pagination";f.viewname=b;f.page=a;f.mode="getPagination";f.sourceModule=jQuery("#moduleFilter").val();f.totalCount=$(".pagination").data("totalCount");var e=this.getListSearchInstance();if(e!==false){var d=e.getAlphabetSearchValue();f.search_params=JSON.stringify(this.getListSearchInstance().getListSearchParams());if((typeof d!="undefined")&&(d.length>0)){f.search_key=this.getListSearchInstance().getAlphabetSearchField();f.search_value=d;f.operator="s"}}f.noOfEntries=jQuery("#noOfEntries").val();AppConnector.request(f).then(function(g){jQuery(".paginationDiv").html(g);c.registerPageNavigationEvents()})},registerChangeCustomFilterEvent:function(){var a=this;this.getFilterSelectElement().on("change",function(d){var e=jQuery(d.currentTarget);var b=e.find(":selected");app.setMainParams("pageNumber","1");app.setMainParams("pageToJump","1");app.setMainParams("orderBy",b.data("orderby"));app.setMainParams("sortOrder",b.data("sortorder"));var c={viewname:jQuery(this).val(),search_key:a.getAlphabetSearchField(),search_value:"",search_params:""};jQuery("#recordsCount").val("");jQuery("#totalPageCount").text("");$(".pagination").data("totalCount",0);a.getListViewRecords(c).then(function(){a.breadCrumbsFilter(b.text());a.ListViewPostOperation();a.updatePagination(1)});d.stopPropagation()})},breadCrumbsFilter:function(d){var a=jQuery(".breadcrumbsContainer .breadcrumbsLinks");var b=a.last("span");var c=b.find(".breadCrumbsFilter");if(c.length&&d!=undefined){c.text(" ["+app.vtranslate("JS_FILTER")+": "+d+"]")}else{if(c.length<1){d=(d==undefined)?this.getFilterSelectElement().find(":selected").text():d;if(b.hasClass("breadCrumbsFilter")){b.text(": "+d)}else{a.append('<span class="font-small breadCrumbsFilter hideToHistory"> ['+app.vtranslate("JS_FILTER")+": "+d+"]</span>")}}}},ListViewPostOperation:function(){return true},registerMainCheckBoxClickEvent:function(){var a=this.getListViewContainer();var b=this;a.on("click","#listViewEntriesMainCheckBox",function(){var c=b.readSelectedIds();var e=b.readExcludedIds();if(jQuery("#listViewEntriesMainCheckBox").is(":checked")){var d=b.getRecordsCount();d.then(function(f){jQuery("#totalRecordsCount").text(f);if(jQuery("#deSelectAllMsgDiv").css("display")=="none"){jQuery("#selectAllMsgDiv").show()}});jQuery(".listViewEntriesCheckBox").each(function(f,g){jQuery(this).attr("checked",true).closest("tr").addClass("highlightBackgroundColor");if(c=="all"){if((jQuery.inArray(jQuery(g).val(),e))!=-1){e.splice(jQuery.inArray(jQuery(g).val(),e),1)}}else{if((jQuery.inArray(jQuery(g).val(),c))==-1){c.push(jQuery(g).val())}}})}else{jQuery("#selectAllMsgDiv").hide();jQuery(".listViewEntriesCheckBox").each(function(f,g){jQuery(this).attr("checked",false).closest("tr").removeClass("highlightBackgroundColor");if(c=="all"){e.push(jQuery(g).val());c="all"}else{c.splice(jQuery.inArray(jQuery(g).val(),c),1)}})}b.writeSelectedIds(c);b.writeExcludedIds(e)})},registerCheckBoxClickEvent:function(){var a=this.getListViewContainer();var b=this;a.delegate(".listViewEntriesCheckBox","click",function(g){var c=b.readSelectedIds();var f=b.readExcludedIds();var d=jQuery(g.currentTarget);if(d.is(":checked")){d.closest("tr").addClass("highlightBackgroundColor");if(c=="all"){f.splice(jQuery.inArray(d.val(),f),1)}else{if((jQuery.inArray(d.val(),c))==-1){c.push(d.val())}}}else{d.closest("tr").removeClass("highlightBackgroundColor");if(c=="all"){f.push(d.val());c="all"}else{c.splice(jQuery.inArray(d.val(),c),1)}}b.checkSelectAll();b.writeSelectedIds(c);b.writeExcludedIds(f)})},registerSelectAllClickEvent:function(){var a=this.getListViewContainer();var b=this;a.delegate("#selectAllMsg","click",function(){jQuery("#selectAllMsgDiv").hide();jQuery("#deSelectAllMsgDiv").show();jQuery("#listViewEntriesMainCheckBox").attr("checked",true);jQuery(".listViewEntriesCheckBox").each(function(c,d){jQuery(this).attr("checked",true).closest("tr").addClass("highlightBackgroundColor")});b.writeSelectedIds("all")})},registerDeselectAllClickEvent:function(){var a=this.getListViewContainer();var b=this;a.delegate("#deSelectAllMsg","click",function(){jQuery("#deSelectAllMsgDiv").hide();jQuery("#listViewEntriesMainCheckBox").attr("checked",false);jQuery(".listViewEntriesCheckBox").each(function(e,f){jQuery(this).attr("checked",false).closest("tr").removeClass("highlightBackgroundColor")});var d=new Array();var c=new Array();b.writeSelectedIds(c);b.writeExcludedIds(d)})},registerHeadersClickEvent:function(){var a=this.getListViewContainer();var b=this;a.on("click",".listViewHeaderValues",function(g){var h=jQuery(g.currentTarget).data("columnname");var c=jQuery(g.currentTarget).data("nextsortorderval");if(typeof c==="undefined"){return}var f=b.getCurrentCvId();var d={orderby:h,sortorder:c,viewname:f};b.getListViewRecords(d)})},registerCreateFilterClickEvent:function(c){var b=this;b.getFilterSelectElement().data("select2").close();var a=jQuery(c.currentTarget);var d=a.find("#createFilter");var e=d.data("createurl");Vtiger_CustomView_Js.loadFilterView(e)},registerDuplicateFilterClickEvent:function(){var a=this;var b=this.getFilterBlock();if(b!=false){b.on("mouseup","li span.duplicateFilter",function(d){a.getFilterSelectElement().data("select2").close();var f=jQuery(d.currentTarget).closest(".select2-results__option");var c=a.getSelectOptionFromChosenOption(f);var e=c.data("duplicateurl");Vtiger_CustomView_Js.loadFilterView(e);d.stopPropagation()})}},registerEditFilterClickEvent:function(){var a=this;var b=this.getFilterBlock();if(b!=false){b.on("mouseup","li span.editFilter",function(d){a.getFilterSelectElement().data("select2").close();var f=jQuery(d.currentTarget).closest(".select2-results__option");var c=a.getSelectOptionFromChosenOption(f);var e=c.data("editurl");Vtiger_CustomView_Js.loadFilterView(e);d.stopPropagation()})}},registerDeleteFilterClickEvent:function(){var a=this;var b=this.getFilterBlock();if(b!=false){b.on("mouseup","li span.deleteFilter",function(d){a.getFilterSelectElement().data("select2").close();var e=jQuery(d.currentTarget).closest(".select2-results__option");var c=app.vtranslate("JS_LBL_ARE_YOU_SURE_YOU_WANT_TO_DELETE_FILTER");Vtiger_Helper_Js.showConfirmationBox({message:c}).then(function(j){var g=a.getSelectOptionFromChosenOption(e);var i=g.data("deleteurl");var f="<form action="+i+' method="POST">';if(typeof csrfMagicName!=="undefined"){f+='<input type = "hidden" name ="'+csrfMagicName+"\"  value='"+csrfMagicToken+"'>"}f+="</form>";var h=jQuery(f);h.appendTo("body").submit()},function(f,g){});d.stopPropagation()})}},registerApproveFilterClickEvent:function(){var a=this;var b=this.getFilterBlock();if(b!=false){b.on("mouseup","li span.approveFilter",function(g){a.getFilterSelectElement().data("select2").close();var h=jQuery(g.currentTarget).closest(".select2-results__option");var d=a.getSelectOptionFromChosenOption(h);var f=d.data("approveurl");var c="<form action="+f+' method="POST">';if(typeof csrfMagicName!=="undefined"){c+='<input type = "hidden" name ="'+csrfMagicName+"\"  value='"+csrfMagicToken+"'>"}c+="</form>";var e=jQuery(c);e.appendTo("body").submit();g.stopPropagation()})}},registerDenyFilterClickEvent:function(){var a=this;var b=this.getFilterBlock();if(b!=false){b.on("mouseup","li span.denyFilter",function(e){a.getFilterSelectElement().data("select2").close();var f=jQuery(e.currentTarget);var c=a.getSelectOptionFromChosenOption(f);var d=c.data("denyurl");window.location.href=d;e.stopPropagation()})}},registerCustomFilterOptionsHoverEvent:function(){var b=this;var c=this.getListViewTopMenuContainer();var a=this.getFilterBlock();if(a!=false){a.on("hover",'li.select2-results__option[role="treeitem"]',function(e){var f=jQuery(e.currentTarget);var d=f.find(".filterActionImgs");if(f.hasClass("group-result")){return}if(e.type==="mouseenter"){if(d.length>0){d.show()}else{b.performFilterImageActions(f)}}else{d.hide()}})}},performFilterImageActions:function(f){jQuery(".filterActionImages").clone(true,true).removeClass("filterActionImages").addClass("filterActionImgs").appendTo(f).removeClass("hide");var a=this.getSelectOptionFromChosenOption(f);var c=a.data("deletable");if(c!="1"){f.find(".deleteFilter").remove()}var b=a.data("editable");if(b!="1"){f.find(".editFilter").remove()}var e=a.data("pending");if(e!="1"){f.find(".approveFilter").remove()}var d=a.data("public");if(d!="1"){f.find(".denyFilter").remove()}if($("#createFilter").length==0){f.find(".duplicateFilter").remove()}},registerRowClickEvent:function(){var b=this;var a=this.getListViewContentContainer();a.on("click",".listViewEntries",function(d){if(jQuery(d.target).closest("div").hasClass("actions")){return}if(jQuery(d.target).closest("a").hasClass("noLinkBtn")){return}if(jQuery(d.target,jQuery(d.currentTarget)).is("td:first-child")){return}if(jQuery(d.target).is('input[type="checkbox"]')){return}if($.contains(jQuery(d.currentTarget).find("td:last-child").get(0),d.target)){return}var c=jQuery(d.currentTarget);var f=c.data("recordurl");if(typeof f=="undefined"){return}window.location.href=f})},registerDeleteRecordClickEvent:function(){var b=this;var a=this.getListViewContentContainer();a.on("click",".deleteRecordButton",function(f){var d=jQuery(f.currentTarget);var c=d.closest("tr").data("id");Vtiger_List_Js.deleteRecord(c);f.stopPropagation()})},registerEmailFieldClickEvent:function(){var a=this.getListViewContentContainer();a.on("click",".emailField",function(b){b.stopPropagation()})},registerPhoneFieldClickEvent:function(){var a=this.getListViewContentContainer();a.on("click",".phoneField",function(b){b.stopPropagation()})},registerUrlFieldClickEvent:function(){var a=this.getListViewContentContainer();a.on("click",".urlField",function(b){b.stopPropagation()})},inactiveFieldsValidation:function(e){var d=jQuery("#massEditFieldsNameList").data("value");for(var g in d){var b=d[g];var c=e.find('[name="'+b.name+'"]');if(b.type=="reference"){c=e.find('[name="'+b.name+'_display"]')}else{if(b.type=="multipicklist"||b.type=="sharedOwner"){c=e.find('[name="'+b.name+'[]"]')}}if(c.length==0){continue}var a=c.data();var f="validate[]";if("validationEngine" in a){f=a.validationEngine;delete a.validationEngine}c.attr("data-invalid-validation-engine",f);c.removeAttr("data-validation-engine")}},registerEventForTabClick:function(b){var a=b.find(".massEditTabs");a.on("click",'a[data-toggle="tab"]',function(d){b.validationEngine("validate");var c=b.data("jqv").InvalidFields;if(c.length>0){d.stopPropagation()}})},registerSlimScrollMassEdit:function(){app.showScrollBar(jQuery('div[name="massEditContent"]'),{height:"100%"})},registerMassActionSubmitEvent:function(){var a=this;jQuery("body").on("submit","#massSave",function(g){var f=jQuery(g.currentTarget);var c=f.find("#commentcontent");var b=c.val();if(b==""){var d=app.vtranslate("JS_LBL_COMMENT_VALUE_CANT_BE_EMPTY");c.validationEngine("showPrompt",d,"error","bottomLeft",true);g.preventDefault();return}c.validationEngine("hide");jQuery(f).find("[name=saveButton]").attr("disabled","disabled");a.massActionSave(f).then(function(e){Vtiger_List_Js.clearList()});g.preventDefault()})},changeCustomFilterElementView:function(){var c=this;var a=this.getFilterSelectElement();if(a.length>0&&a.is("select")){app.showSelect2ElementView(a,{templateSelection:function(e){var d=jQuery("<span></span>");d.append(jQuery(jQuery(".filterImage").clone().get(0)).show());d.append(e.text);return d},customSortOptGroup:true,closeOnSelect:true});var b=a.data("select2");jQuery(".filterActionsDiv").appendTo(b.$dropdown.find(".select2-dropdown:last")).removeClass("hide").on("click",function(d){c.registerCreateFilterClickEvent(d)})}},registerFeaturedElementsEvent:function(){var a=this;var b=this.getListViewTopMenuContainer();b.on("click",".featuredLabel",function(d){var c=jQuery(this).data("cvid");a.getFilterSelectElement().val(c).trigger("change")})},triggerDisplayTypeEvent:function(){var a=app.cacheGet("widthType","narrowWidthType");if(a){var b=jQuery(".listViewEntriesTable").find("td,th");b.attr("class",a)}},registerEventForTotalRecordsCount:function(){var a=this;jQuery(".totalNumberOfRecords").on("click",function(d){var b=jQuery(d.currentTarget);var c=jQuery("#totalCount");var f=c.val();b.addClass("hide");b.parent().progressIndicator({});if(f==""){a.getPageCount().then(function(e){f=e.result["numberOfRecords"];c.val(f);a.showPagingInfo()})}else{a.showPagingInfo()}b.parent().progressIndicator({mode:"hide"})})},showPagingInfo:function(){var c=jQuery("#totalCount").val();var e=jQuery(".pageNumbersText");var d=e.text();var b=d+" ("+c+")";var a=parseInt(jQuery("#noOfEntries").val());if(a!=0){jQuery(".pageNumbersText").html(b)}else{jQuery(".pageNumbersText").html("")}},registerUnreviewedCountEvent:function(){var e=this;var d=[];var a=this.getListViewContentContainer();var c=a.find(".unreviewed").length;a.find("tr.listViewEntries").each(function(){var f=jQuery(this).data("id");if(f){d.push(f)}});if(!d||c<1){return}var b={action:"ChangesReviewedOn",mode:"getUnreviewed",module:"ModTracker",sourceModule:app.getModuleName(),recordsId:d};AppConnector.request(b).then(function(f){var g=f.result;$.each(g,function(i,h){if(h.a>0){a.find('tr[data-id="'+i+'"] .unreviewed .badge.all').text(h.a)}if(h.m>0){a.find('tr[data-id="'+i+'"] .unreviewed .badge.mail').text(h.m)}});Vtiger_Helper_Js.showHorizontalTopScrollBar()})},registerEvents:function(){this.breadCrumbsFilter();this.registerRowClickEvent();this.registerPageNavigationEvents();this.registerMainCheckBoxClickEvent();this.registerCheckBoxClickEvent();this.registerSelectAllClickEvent();this.registerDeselectAllClickEvent();this.registerDeleteRecordClickEvent();this.registerHeadersClickEvent();this.registerMassActionSubmitEvent();this.changeCustomFilterElementView();this.registerChangeCustomFilterEvent();this.registerDuplicateFilterClickEvent();this.registerEditFilterClickEvent();this.registerDeleteFilterClickEvent();this.registerApproveFilterClickEvent();this.registerDenyFilterClickEvent();this.registerCustomFilterOptionsHoverEvent();this.registerEmailFieldClickEvent();this.registerPhoneFieldClickEvent();Vtiger_Helper_Js.showHorizontalTopScrollBar();this.registerUrlFieldClickEvent();this.registerEventForTotalRecordsCount();var a=this.getListViewContentContainer();a.find("#listViewEntriesMainCheckBox,.listViewEntriesCheckBox").prop("checked",false);this.getListSearchInstance(false);this.registerListViewSpecialOptiopn();this.registerFeaturedElementsEvent();this.registerUnreviewedCountEvent();Vtiger_Index_Js.registerMailButtons(a)},registerListViewSpecialOptiopn:function(){var b=this;var c=this.getListViewContentContainer();var a=c.find(".listViewEntriesTable #searchInSubcategories");a.on("change",function(g){var d=jQuery('.listSearchContributor[name="'+a.data("columnname")+'"]');var f=d.val();if(f){b.getListSearchInstance().triggerListSearch()}})},postMassDeleteRecords:function(){var a=jQuery.Deferred();var c=Vtiger_List_Js.getInstance();app.hideModalWindow();var b=app.getModuleName();c.getListViewRecords().then(function(d){jQuery("#recordsCount").val("");jQuery("#totalPageCount").text("");jQuery("#deSelectAllMsg").trigger("click");c.calculatePages().then(function(){c.updatePagination()});a.resolve()});jQuery("#recordsCount").val("");return a.promise()},});