'use strict';

$.Class('Settings_Vtiger_Index_Js',{showMessage:function showMessage(customParams){var params={type:'success',title:app.vtranslate('JS_MESSAGE')};'undefined'!=typeof customParams&&(params=$.extend(params,customParams)),Vtiger_Helper_Js.showPnotify(params);},selectIcon:function selectIcon(){var _this=this,aDeferred=$.Deferred();return app.showModalWindow({id:'iconsModal',url:'index.php?module=Vtiger&view=IconsModal&parent=Settings',cb:function cb(container){_this.registerIconsSelect(container),container.find('[name="saveButton"]').on('click',function(){aDeferred.resolve({type:container.find('#iconType').val(),name:container.find('#iconName').val()}),app.hideModalWindow(container,'iconsModal');});}}),aDeferred.promise()},registerIconsSelect:function registerIconsSelect(container){var params={module:app.getModuleName(),parent:app.getParentModuleName(),action:'Icons'};AppConnector.request(params).done(function(_ref){var result=_ref.result,id=0,data=Object.keys(result).map(function(){var resultData=result[id];return {id:id++,text:resultData.name,type:resultData.type,url:resultData.path}});App.Fields.Picklist.showLazySelect(container.find('#iconsList'),{lazyElements:50,data:data,selectParams:{templateSelection:function templateSelection(data){return data.id?(container.find('.iconName').text(data.text),container.find('#iconName').val(data.text),container.find('#iconType').val(data.type),'icon'===data.type)?(container.find('.iconExample').html('<span class="'+data.text+'" aria-hidden="true"></span>'),$('<span class="'+data.text+'" aria-hidden="true"></span><span> - '+data.text+'</span>')):('image'===data.type&&(container.find('.iconName').text(data.text),container.find('#iconName').val(data.text),container.find('.iconExample').html('<img width="24px" src="'+data.url+'"/>')),data.text):data.text},templateResult:function templateResult(data){if(data.loading)return data.text;var option;return 'icon'===data.type?option=$('<span class="'+data.text+'" aria-hidden="true"></span><span> - '+data.text+'</span>'):'image'===data.type&&(option=$('<img width="24px" src="'+data.url+'" title="'+data.text+'" /><span> - '+data.text+'</span>')),option},closeOnSelect:!0}});});},showWarnings:function showWarnings(){$('li[data-mode="systemWarnings"] a').click();},showSecurity:function showSecurity(){app.openUrl('index.php?module=Log&parent='+app.getParentModuleName()+'&view=Index&type=access_for_admin');}},{registerDeleteShortCutEvent:function registerDeleteShortCutEvent(){var _this2=this,shortcutsContainer=0<arguments.length&&arguments[0]!==void 0?arguments[0]:$('.js-shortcuts');shortcutsContainer.on('click','.unpin',function(e){e.preventDefault();var actionEle=$(e.currentTarget),closestBlock=actionEle.closest('.js-shortcut'),fieldId=actionEle.data('id'),shortcutBlockActionUrl=closestBlock.data('actionurl'),progressIndicatorElement=$.progressIndicator({blockInfo:{enabled:!0}});AppConnector.request(shortcutBlockActionUrl+'&pin=false').done(function(data){if('OK'==data.result.SUCCESS){closestBlock.remove();var shortCutActionEle=$('#'+fieldId+'_menuItem'),imagePath=shortCutActionEle.data('pinimageurl');shortCutActionEle.attr('src',imagePath).data('action','pin'),_this2.updateShortcutsStorage(shortcutsContainer),progressIndicatorElement.progressIndicator({mode:'hide'});var params={title:app.vtranslate('JS_MESSAGE'),text:app.vtranslate('JS_SUCCESSFULLY_UNPINNED'),type:'info'};Vtiger_Helper_Js.showPnotify(params);}});});},registerPinShortCutEvent:function registerPinShortCutEvent(element){var _this3=this,id=element.data('id'),progressIndicatorElement=$.progressIndicator({blockInfo:{enabled:!0}});AppConnector.request('index.php?module=Vtiger&parent=Settings&action=Basic&mode=updateFieldPinnedStatus&pin=true&fieldid='+id).done(function(data){'OK'==data.result.SUCCESS&&AppConnector.request({fieldid:id,mode:'getSettingsShortCutBlock',module:'Vtiger',parent:'Settings',view:'IndexAjax'}).done(function(data){var shortcutsContainer=$('.js-shortcuts');$(data).appendTo(shortcutsContainer),_this3.updateShortcutsStorage(shortcutsContainer),progressIndicatorElement.progressIndicator({mode:'hide'}),Settings_Vtiger_Index_Js.showMessage({text:app.vtranslate('JS_SUCCESSFULLY_PINNED')});});});},registerWidgetsEvents:function registerWidgetsEvents(){var widgets=$('div.widgetContainer');widgets.on('shown.bs.collapse',function(e){var widgetContainer=$(e.currentTarget),quickWidgetHeader=widgetContainer.closest('.quickWidget').find('.quickWidgetHeader'),imageEle=quickWidgetHeader.find('.imageElement'),imagePath=imageEle.data('downimage');imageEle.attr('src',imagePath);}),widgets.on('hidden.bs.collapse',function(e){var widgetContainer=$(e.currentTarget),quickWidgetHeader=widgetContainer.closest('.quickWidget').find('.quickWidgetHeader'),imageEle=quickWidgetHeader.find('.imageElement'),imagePath=imageEle.data('rightimage');imageEle.attr('src',imagePath);});},registerAddShortcutDragDropEvent:function registerAddShortcutDragDropEvent(){var elements=$('.js-menu__item .js-menu__link--draggable'),self=this;elements.draggable({containment:'#page',appendTo:'body',helper:'clone',start:function start(e,ui){$(ui.helper).addClass('ui-draggable-menuShortcut bg-warning');},zIndex:99999});var shortcutsContainer=$('.js-shortcuts');shortcutsContainer.droppable({activeClass:'ui-state-default',hoverClass:'ui-state-hover',accept:'.js-menu__item .js-menu__link--draggable',drop:function drop(event,ui){var url=ui.draggable.attr('href'),isExist=!1;if($('.js-shortcuts [id^="shortcut"]').each(function(){var shortCutUrl=$(this).data('url');if(shortCutUrl==url)return void(isExist=!0)}),isExist){var params={title:app.vtranslate('JS_MESSAGE'),text:app.vtranslate('JS_SHORTCUT_ALREADY_ADDED'),type:'info'};Vtiger_Helper_Js.showPnotify(params);}else self.registerPinShortCutEvent(ui.draggable.parent());}}),shortcutsContainer.sortable({handle:'.js-drag-handler',stop:function stop(){self.updateShortcutsStorage(shortcutsContainer);}}),Quasar.plugins.LocalStorage.has('yf-settings-shortcuts')&&this.alignShortcuts(shortcutsContainer);},alignShortcuts:function alignShortcuts(container){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,item,_iterator=Quasar.plugins.LocalStorage.getItem('yf-settings-shortcuts')[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0)item=_step.value,container.append(container.find('#'+item));}catch(err){_didIteratorError=!0,_iteratorError=err;}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return();}finally{if(_didIteratorError)throw _iteratorError}}},updateShortcutsStorage:function updateShortcutsStorage(container){Quasar.plugins.LocalStorage.set('yf-settings-shortcuts',container.sortable('toArray'));},registerCollapsiblePanels:function registerCollapsiblePanels(){var _this4=this,panels=this.container.find('.js-collapse');Quasar.plugins.LocalStorage.has('yf-settings-panels')?this.setPanels(panels):(panels.collapse('show'),Quasar.plugins.LocalStorage.set('yf-settings-panels',{"marketplace-collapse":'shown',"system-monitoring-collapse":'shown',"my-shortcuts-collapse":'shown'})),panels.on('hidden.bs.collapse shown.bs.collapse',function(e){_this4.updatePanelsStorage(e.target.id,e.type);});},updatePanelsStorage:function updatePanelsStorage(id,type){var panelsStorage=Quasar.plugins.LocalStorage.getItem('yf-settings-panels');panelsStorage[id]=type,Quasar.plugins.LocalStorage.set('yf-settings-panels',panelsStorage);},setPanels:function setPanels(panels){var panelsStorage=Quasar.plugins.LocalStorage.getItem('yf-settings-panels');panels.each(function(i,item){'shown'===panelsStorage[item.id]&&$(item).collapse('show');});},loadEditorElement:function loadEditorElement(){new App.Fields.Text.Editor($('.js-editor'),{});},registerSaveIssues:function registerSaveIssues(){var container=$('.addIssuesModal');container.validationEngine(app.validationEngineOptions);var title=$('#titleIssues'),CKEditorInstance=CKEDITOR.instances.bodyIssues,thisInstance=this,saveBtn=container.find('.saveIssues');saveBtn.on('click',function(){if(container.validationEngine('validate')){var body=CKEditorInstance.document.getBody().getHtml(),params={module:'Github',parent:app.getParentModuleName(),action:'SaveIssuesAjax',title:title.val(),body:body};AppConnector.request(params).done(function(data){if(app.hideModalWindow(),thisInstance.reloadContent(),!0==data.result.success){var params={title:app.vtranslate('JS_LBL_PERMISSION'),text:app.vtranslate('JS_ADDED_ISSUE_COMPLETE'),type:'success'};Vtiger_Helper_Js.showMessage(params);}});}}),$('[name="confirmRegulations"]').on('click',function(){var currentTarget=$(this);currentTarget.is(':checked')?saveBtn.removeAttr('disabled'):saveBtn.attr('disabled','disabled');});},reloadContent:function reloadContent(){$('.js-tabs li .active').trigger('click');},registerTabEvents:function registerTabEvents(){var thisInstance=this;$('.js-tabs li').on('click',function(){thisInstance.loadContent($(this).data('mode'),!1,$(this).data('params'));});},registerWarningsAlert:function registerWarningsAlert(){var alertsContainer=$('#systemWarningAletrs');alertsContainer.length&&app.showModalWindow(alertsContainer,function(){alertsContainer.find('.warning').first().removeClass('d-none'),alertsContainer.find('.warning .btn').on('click',function(){var params,btn=$(this),save=!0;if(btn.hasClass('ajaxBtn')){if(btn.data('params')===void 0){var form=btn.closest('form');form.hasClass('validateForm')&&!form.validationEngine('validate')&&(save=!1),params=btn.closest('form').serializeArray().reduce(function(obj,item){return obj[item.name]=item.value,obj},{});}else params=btn.data('params');save&&AppConnector.request({module:app.getModuleName(),parent:app.getParentModuleName(),action:'SystemWarnings',mode:'update',id:btn.closest('.warning').data('id'),params:params}).done(function(data){data.result.result?Vtiger_Helper_Js.showMessage({text:data.result.message,type:'success'}):Vtiger_Helper_Js.showMessage({text:data.result.message,type:'error'});});}btn.hasClass('cancel')&&AppConnector.request({module:app.getModuleName(),parent:app.getParentModuleName(),action:'SystemWarnings',mode:'cancel'}),save&&(alertsContainer.find('.warning').first().remove(),alertsContainer.find('.warning').length?alertsContainer.find('.warning').first().removeClass('d-none'):app.hideModalWindow(alertsContainer));}),alertsContainer.find('.input-group-addon input[type="checkbox"]').on('click',function(){var btn=$(this),group=btn.closest('.input-group');this.checked?group.find('input[type="text"]').attr('disabled',!1):group.find('input[type="text"]').attr('disabled',!0);});});},getSelectedFolders:function getSelectedFolders(){var selected=[];return $.each($('#jstreeContainer').jstree('get_selected',!0),function(index,value){selected.push(value.original.subPath);}),selected},loadContent:function loadContent(mode,page,modeParams){var thisInstance=this,container=$('.indexContainer'),state=container.find('.js-switch--state'),author=container.find('.js-switch--author'),params={mode:mode,module:app.getModuleName(),parent:app.getParentModuleName(),view:app.getViewName()};page&&(params.page=page),modeParams&&(params.params=modeParams),params.state=state.last().is(':checked')?'closed':'open',params.author=author.first().is(':checked');var progressIndicatorElement=$.progressIndicator({position:'html',blockInfo:{enabled:!0,elementToBlock:container}});AppConnector.request(params).done(function(data){progressIndicatorElement.progressIndicator({mode:'hide'}),container.html(data),thisInstance.registerEventsLoadContent(thisInstance,mode,container);});},registerEventsLoadContent:function registerEventsLoadContent(thisInstance,mode){'index'==mode&&(thisInstance.registerWidgetsEvents(),thisInstance.registerDeleteShortCutEvent(),thisInstance.registerAddShortcutDragDropEvent(),thisInstance.registerWarningsAlert());},registerEvents:function registerEvents(){this.container=$('.js-dashboard-container'),this.registerTabEvents(),this.reloadContent(),this.registerWarningsAlert(),this.registerDeleteShortCutEvent(),this.registerAddShortcutDragDropEvent(),this.registerCollapsiblePanels(),new window.Settings_YetiForce_Shop_Js().registerEvents();}});
//# sourceMappingURL=Index.min.js.map
