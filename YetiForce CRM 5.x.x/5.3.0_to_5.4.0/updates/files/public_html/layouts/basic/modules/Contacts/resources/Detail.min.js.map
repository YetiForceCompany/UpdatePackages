{"version":3,"file":"Detail.min.js","sources":["Detail.js"],"sourcesContent":["/*+***********************************************************************************\n * The contents of this file are subject to the vtiger CRM Public License Version 1.0\n * (\"License\"); You may not use this file except in compliance with the License\n * The Original Code is:  vtiger CRM Open Source\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n *************************************************************************************/\n'use strict';\n\nVtiger_Detail_Js(\n\t'Contacts_Detail_Js',\n\t{},\n\t{\n\t\thierarchyResponseCache: {},\n\t\t/**\n\t\t * Function to register recordpresave event\n\t\t */\n\t\tregisterRecordPreSaveEvent: function (form) {\n\t\t\tvar primaryEmailField = jQuery('[name=\"email\"]');\n\t\t\tif (typeof form === 'undefined') {\n\t\t\t\tform = this.getForm();\n\t\t\t}\n\n\t\t\tform.on(this.fieldPreSave, '[name=\"portal\"]', function (e, data) {\n\t\t\t\tvar portalField = jQuery(e.currentTarget);\n\n\t\t\t\tvar primaryEmailValue = primaryEmailField.val();\n\t\t\t\tvar isAlertAlreadyShown = jQuery('.ui-pnotify').length;\n\n\t\t\t\tif (portalField.is(':checked')) {\n\t\t\t\t\tif (primaryEmailField.length == 0) {\n\t\t\t\t\t\tif (isAlertAlreadyShown <= 0) {\n\t\t\t\t\t\t\tVtiger_Helper_Js.showPnotify(\n\t\t\t\t\t\t\t\tapp.vtranslate('JS_PRIMARY_EMAIL_FIELD_DOES_NOT_EXISTS')\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t}\n\t\t\t\t\tif (primaryEmailValue == '') {\n\t\t\t\t\t\tif (isAlertAlreadyShown <= 0) {\n\t\t\t\t\t\t\tVtiger_Helper_Js.showPnotify(\n\t\t\t\t\t\t\t\tapp.vtranslate('JS_PLEASE_ENTER_PRIMARY_EMAIL_VALUE_TO_ENABLE_PORTAL_USER')\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Function to get response from hierarchy\n\t\t * @param {array} params\n\t\t * @returns {*|jQuery}\n\t\t */\n\t\tgetHierarchyResponseData: function (params) {\n\t\t\tlet thisInstance = this,\n\t\t\t\taDeferred = jQuery.Deferred();\n\n\t\t\tif (!$.isEmptyObject(thisInstance.hierarchyResponseCache)) {\n\t\t\t\taDeferred.resolve(thisInstance.hierarchyResponseCache);\n\t\t\t} else {\n\t\t\t\tAppConnector.request(params).then(function (data) {\n\t\t\t\t\tthisInstance.hierarchyResponseCache = data;\n\t\t\t\t\taDeferred.resolve(thisInstance.hierarchyResponseCache);\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn aDeferred.promise();\n\t\t},\n\t\t/**\n\t\t * function to display the hierarchy response data\n\t\t * @param {array} data\n\t\t */\n\t\tdisplayHierarchyResponseData: function (data) {\n\t\t\tlet callbackFunction = function () {\n\t\t\t\tapp.showScrollBar(jQuery('#hierarchyScroll'), {\n\t\t\t\t\theight: '300px',\n\t\t\t\t\trailVisible: true,\n\t\t\t\t\tsize: '6px'\n\t\t\t\t});\n\t\t\t};\n\t\t\tapp.showModalWindow(data, function () {\n\t\t\t\tif (typeof callbackFunction == 'function' && $('#hierarchyScroll').height() > 300) {\n\t\t\t\t\tcallbackFunction();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Registers read count of hierarchy if it is possoble\n\t\t */\n\t\tregisterHierarchyRecordCount: function () {\n\t\t\tlet hierarchyButton = $('.js-detail-hierarchy'),\n\t\t\t\tparams = {\n\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\taction: 'RelationAjax',\n\t\t\t\t\trecord: app.getRecordId(),\n\t\t\t\t\tmode: 'getHierarchyCount'\n\t\t\t\t};\n\t\t\tif (hierarchyButton.length) {\n\t\t\t\tAppConnector.request(params).then(function (response) {\n\t\t\t\t\tif (response.success) {\n\t\t\t\t\t\t$('.hierarchy .badge').html(response.result);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Shows hierarchy\n\t\t */\n\t\tregisterShowHierarchy: function () {\n\t\t\tlet thisInstance = this,\n\t\t\t\thierarchyButton = $('.detailViewTitle'),\n\t\t\t\tparams = {\n\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\tview: 'Hierarchy',\n\t\t\t\t\trecord: app.getRecordId()\n\t\t\t\t};\n\t\t\thierarchyButton.on('click', '.js-detail-hierarchy', function () {\n\t\t\t\tlet progressIndicatorElement = $.progressIndicator({\n\t\t\t\t\tposition: 'html',\n\t\t\t\t\tblockInfo: {\n\t\t\t\t\t\tenabled: true\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthisInstance.getHierarchyResponseData(params).then(function (data) {\n\t\t\t\t\tthisInstance.displayHierarchyResponseData(data);\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Function which will register all the events\n\t\t */\n\t\tregisterEvents: function () {\n\t\t\tvar form = this.getForm();\n\t\t\tthis._super();\n\t\t\tthis.registerHierarchyRecordCount();\n\t\t\tthis.registerShowHierarchy();\n\t\t\tthis.registerRecordPreSaveEvent(form);\n\t\t}\n\t}\n);\n"],"names":["Vtiger_Detail_Js","hierarchyResponseCache","registerRecordPreSaveEvent","form","jQuery","getForm","on","fieldPreSave","e","currentTarget","primaryEmailValue","primaryEmailField","val","isAlertAlreadyShown","length","portalField","is","Vtiger_Helper_Js","showPnotify","app","vtranslate","preventDefault","getHierarchyResponseData","params","aDeferred","Deferred","isEmptyObject","thisInstance","AppConnector","request","then","data","resolve","promise","displayHierarchyResponseData","showScrollBar","height","railVisible","size","showModalWindow","callbackFunction","registerHierarchyRecordCount","$","module","getModuleName","action","record","getRecordId","mode","hierarchyButton","response","success","html","result","registerShowHierarchy","view","progressIndicator","position","blockInfo","enabled","progressIndicatorElement","registerEvents","_super"],"mappings":"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"}