'use strict';

Vtiger_Edit_Js('OSSTimeControl_Edit_Js',{},{registerGenerateTCFieldTimeAndCost:function registerGenerateTCFieldTimeAndCost(){var thisInstance=this;$('input[name="sum_time"]').attr('readonly','readonly').css('width','80px');var form=thisInstance.getForm(),sumeTime=thisInstance.differenceDays(form),hours=(Math.ceil(100*(sumeTime/36e5))/100).toFixed(2);jQuery('input[name="sum_time"]').val(hours),jQuery('.dateField').on('change',function(){return sumeTime=thisInstance.differenceDays(form),'Error'!=sumeTime&&void(hours=(Math.ceil(100*(sumeTime/36e5))/100).toFixed(2),jQuery('input[name="sum_time"]').val(hours))}),jQuery('.clockPicker').on('change',function(){return sumeTime=thisInstance.differenceDays(form),'Error'!=sumeTime&&void(hours=(Math.round(100*(sumeTime/36e5))/100).toFixed(2),jQuery('input[name="sum_time"]').val(hours))});},differenceDays:function differenceDays(container){var firstDate=container.find('input[name="date_start"]'),firstDateFormat=firstDate.data('date-format'),firstDateValue=firstDate.val(),secondDate=container.find('input[name="due_date"]'),secondDateFormat=secondDate.data('date-format'),secondDateValue=secondDate.val(),firstTime=container.find('input[name="time_start"]'),secondTime=container.find('input[name="time_end"]'),firstTimeValue=firstTime.val(),secondTimeValue=secondTime.val();try{var firstDateInstance=Vtiger_Helper_Js.getDateInstance(firstDateValue+' '+firstTimeValue,firstDateFormat),secondDateInstance=Vtiger_Helper_Js.getDateInstance(secondDateValue+' '+secondTimeValue,secondDateFormat),timeBetweenDates=secondDateInstance-firstDateInstance;if(0<=timeBetweenDates)return timeBetweenDates}catch(err){return 'Error'}return 'Error'},/**
		 * Function to register recordpresave event
		 */registerRecordPreSaveEvent:function registerRecordPreSaveEvent(){var thisInstance=this,form=$('.recordEditView[name="QuickCreate"]');0==form.length&&(form=this.getForm()),form.on(Vtiger_Edit_Js.recordPreSave,function(){var sumeTime2=thisInstance.differenceDays(form);if('Error'==sumeTime2){var parametres={text:app.vtranslate('JS_DATE_SHOULD_BE_GREATER_THAN'),type:'error'};return Vtiger_Helper_Js.showPnotify(parametres),!1}return app.getMainParams('disallowLongerThan24Hours')&&(sumeTime2=sumeTime2/1e3/60/60,24<sumeTime2)?(Vtiger_Helper_Js.showPnotify({text:app.vtranslate('JS_DATE_NOT_SHOULD_BE_GREATER_THAN_24H'),type:'error'}),!1):void form.submit()});},registerGenerateTCFromHelpDesk:function registerGenerateTCFromHelpDesk(){var thisInstance=this,sourceDesk=jQuery('input[name="sourceRecord"]').val(),moduleName=jQuery('input[name="sourceModule"]').val();if('undefined'!=typeof sourceDesk){var params={};params.data={module:'OSSTimeControl',action:'GetTCInfo',id:sourceDesk,sourceModule:moduleName},params.async=!1,params.dataType='json',AppConnector.request(params).done(function(data){var response=data.result;if(response.success){var sourceD=response.sourceData;'HelpDesk'==moduleName?('contact_id'in sourceD&&(jQuery('[name="contactid"]').val(sourceD.contact_id),jQuery('[name="contactid_display"]').val(thisInstance.replaceAll(sourceD.contact_label,'&oacute;','\xF3')).prop('readonly',!0)),'parent_id'in sourceD&&(jQuery('[name="accountid"]').val(sourceD.parent_id),jQuery('[name="accountid_display"]').val(thisInstance.replaceAll(sourceD.account_label,'&oacute;','\xF3')).prop('readonly',!0))):'Project'==moduleName&&('contact_label'in sourceD&&(jQuery('[name="contactid"]').val(sourceD.contact_id),jQuery('[name="contactid_display"]').val(thisInstance.replaceAll(sourceD.contact_label,'&oacute;','\xF3')).prop('readonly',!0)),'account_label'in sourceD&&(jQuery('[name="accountid"]').val(sourceD.linktoaccountscontacts),jQuery('[name="accountid_display"]').val(thisInstance.replaceAll(sourceD.account_label,'&oacute;','\xF3')).prop('readonly',!0)));}else {var params={text:app.vtranslate('message'),type:'error'};Vtiger_Helper_Js.showPnotify(params);}}).fail(function(){Vtiger_Helper_Js.showPnotify({text:app.vtranslate('JS_ERROR_CONNECTING'),type:'error'});});}},escapeRegExp:function escapeRegExp(string){return string.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,'\\$1')},replaceAll:function replaceAll(string,find,replace){var thisInstance=this;return string=string.replace(new RegExp(thisInstance.escapeRegExp('&Oacute;'),'g'),'\xD3'),string.replace(new RegExp(thisInstance.escapeRegExp(find),'g'),replace)},registerBasicEvents:function registerBasicEvents(container){this._super(container),this.registerRecordPreSaveEvent(container);},registerEvents:function registerEvents(){this._super(),this.registerGenerateTCFieldTimeAndCost(),this.registerGenerateTCFromHelpDesk();}});
//# sourceMappingURL=Edit.min.js.map
