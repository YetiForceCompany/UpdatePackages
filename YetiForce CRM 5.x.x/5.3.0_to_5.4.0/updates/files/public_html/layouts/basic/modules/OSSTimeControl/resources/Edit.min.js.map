{"version":3,"file":"Edit.min.js","sources":["Edit.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\nVtiger_Edit_Js(\n\t'OSSTimeControl_Edit_Js',\n\t{},\n\t{\n\t\tregisterGenerateTCFieldTimeAndCost: function () {\n\t\t\tvar thisInstance = this;\n\t\t\t$('input[name=\"sum_time\"]').attr('readonly', 'readonly').css('width', '80px');\n\t\t\tvar form = thisInstance.getForm();\n\t\t\tvar sumeTime = thisInstance.differenceDays(form);\n\t\t\tvar hours = (Math.ceil((sumeTime / 3600000) * 100) / 100).toFixed(2);\n\n\t\t\tjQuery('input[name=\"sum_time\"]').val(hours);\n\t\t\tjQuery('.dateField').on('change', function () {\n\t\t\t\tsumeTime = thisInstance.differenceDays(form);\n\t\t\t\tif (sumeTime == 'Error') {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\thours = (Math.ceil((sumeTime / 3600000) * 100) / 100).toFixed(2);\n\t\t\t\tjQuery('input[name=\"sum_time\"]').val(hours);\n\t\t\t});\n\t\t\tjQuery('.clockPicker').on('change', function () {\n\t\t\t\tsumeTime = thisInstance.differenceDays(form);\n\t\t\t\tif (sumeTime == 'Error') {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\thours = (Math.round((sumeTime / 3600000) * 100) / 100).toFixed(2);\n\t\t\t\tjQuery('input[name=\"sum_time\"]').val(hours);\n\t\t\t});\n\t\t},\n\n\t\tdifferenceDays: function (container) {\n\t\t\tvar firstDate = container.find('input[name=\"date_start\"]');\n\t\t\tvar firstDateFormat = firstDate.data('date-format');\n\t\t\tvar firstDateValue = firstDate.val();\n\t\t\tvar secondDate = container.find('input[name=\"due_date\"]');\n\t\t\tvar secondDateFormat = secondDate.data('date-format');\n\t\t\tvar secondDateValue = secondDate.val();\n\t\t\tvar firstTime = container.find('input[name=\"time_start\"]');\n\t\t\tvar secondTime = container.find('input[name=\"time_end\"]');\n\t\t\tvar firstTimeValue = firstTime.val();\n\t\t\tvar secondTimeValue = secondTime.val();\n\t\t\tvar firstDateTimeValue = firstDateValue + ' ' + firstTimeValue;\n\t\t\tvar secondDateTimeValue = secondDateValue + ' ' + secondTimeValue;\n\t\t\ttry {\n\t\t\t\tvar firstDateInstance = Vtiger_Helper_Js.getDateInstance(\n\t\t\t\t\tfirstDateTimeValue,\n\t\t\t\t\tfirstDateFormat\n\t\t\t\t);\n\t\t\t\tvar secondDateInstance = Vtiger_Helper_Js.getDateInstance(\n\t\t\t\t\tsecondDateTimeValue,\n\t\t\t\t\tsecondDateFormat\n\t\t\t\t);\n\t\t\t\tvar timeBetweenDates = secondDateInstance - firstDateInstance;\n\t\t\t\tif (timeBetweenDates >= 0) {\n\t\t\t\t\treturn timeBetweenDates;\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\treturn 'Error';\n\t\t\t}\n\t\t\treturn 'Error';\n\t\t},\n\n\t\t/**\n\t\t * Function to register recordpresave event\n\t\t */\n\t\tregisterRecordPreSaveEvent: function (container) {\n\t\t\tvar thisInstance = this;\n\t\t\tvar form = $('.recordEditView[name=\"QuickCreate\"]');\n\t\t\tif (form.length == 0) {\n\t\t\t\tform = this.getForm();\n\t\t\t}\n\t\t\tform.on(Vtiger_Edit_Js.recordPreSave, function (e, data) {\n\t\t\t\tvar sumeTime2 = thisInstance.differenceDays(form);\n\t\t\t\tif (sumeTime2 == 'Error') {\n\t\t\t\t\tvar parametres = {\n\t\t\t\t\t\ttext: app.vtranslate('JS_DATE_SHOULD_BE_GREATER_THAN'),\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t};\n\t\t\t\t\tVtiger_Helper_Js.showPnotify(parametres);\n\t\t\t\t\treturn false;\n\t\t\t\t} else {\n\t\t\t\t\tif (app.getMainParams('disallowLongerThan24Hours')) {\n\t\t\t\t\t\tsumeTime2 = sumeTime2 / 1000 / 60 / 60;\n\t\t\t\t\t\tif (sumeTime2 > 24) {\n\t\t\t\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\t\t\t\ttext: app.vtranslate('JS_DATE_NOT_SHOULD_BE_GREATER_THAN_24H'),\n\t\t\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tform.submit();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tregisterGenerateTCFromHelpDesk: function () {\n\t\t\tvar thisInstance = this;\n\t\t\tvar sourceDesk = jQuery('input[name=\"sourceRecord\"]').val();\n\t\t\tvar moduleName = jQuery('input[name=\"sourceModule\"]').val();\n\t\t\tif (typeof sourceDesk !== 'undefined') {\n\t\t\t\tvar params = {};\n\t\t\t\tparams.data = {\n\t\t\t\t\tmodule: 'OSSTimeControl',\n\t\t\t\t\taction: 'GetTCInfo',\n\t\t\t\t\tid: sourceDesk,\n\t\t\t\t\tsourceModule: moduleName\n\t\t\t\t};\n\t\t\t\tparams.async = false;\n\t\t\t\tparams.dataType = 'json';\n\t\t\t\tAppConnector.request(params)\n\t\t\t\t\t.done(function (data) {\n\t\t\t\t\t\tvar response = data['result'];\n\t\t\t\t\t\tif (response['success']) {\n\t\t\t\t\t\t\tvar sourceD = response.sourceData;\n\n\t\t\t\t\t\t\tif (moduleName == 'HelpDesk') {\n\t\t\t\t\t\t\t\tif ('contact_id' in sourceD) {\n\t\t\t\t\t\t\t\t\tjQuery('[name=\"contactid\"]').val(sourceD.contact_id);\n\t\t\t\t\t\t\t\t\tjQuery('[name=\"contactid_display\"]')\n\t\t\t\t\t\t\t\t\t\t.val(thisInstance.replaceAll(sourceD.contact_label, '&oacute;', 'ó'))\n\t\t\t\t\t\t\t\t\t\t.prop('readonly', true);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif ('parent_id' in sourceD) {\n\t\t\t\t\t\t\t\t\tjQuery('[name=\"accountid\"]').val(sourceD.parent_id);\n\t\t\t\t\t\t\t\t\tjQuery('[name=\"accountid_display\"]')\n\t\t\t\t\t\t\t\t\t\t.val(thisInstance.replaceAll(sourceD.account_label, '&oacute;', 'ó'))\n\t\t\t\t\t\t\t\t\t\t.prop('readonly', true);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else if (moduleName == 'Project') {\n\t\t\t\t\t\t\t\tif ('contact_label' in sourceD) {\n\t\t\t\t\t\t\t\t\tjQuery('[name=\"contactid\"]').val(sourceD.contact_id);\n\t\t\t\t\t\t\t\t\tjQuery('[name=\"contactid_display\"]')\n\t\t\t\t\t\t\t\t\t\t.val(thisInstance.replaceAll(sourceD.contact_label, '&oacute;', 'ó'))\n\t\t\t\t\t\t\t\t\t\t.prop('readonly', true);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif ('account_label' in sourceD) {\n\t\t\t\t\t\t\t\t\tjQuery('[name=\"accountid\"]').val(sourceD.linktoaccountscontacts);\n\t\t\t\t\t\t\t\t\tjQuery('[name=\"accountid_display\"]')\n\t\t\t\t\t\t\t\t\t\t.val(thisInstance.replaceAll(sourceD.account_label, '&oacute;', 'ó'))\n\t\t\t\t\t\t\t\t\t\t.prop('readonly', true);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvar params = {\n\t\t\t\t\t\t\t\ttext: app.vtranslate('message'),\n\t\t\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tVtiger_Helper_Js.showPnotify(params);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.fail(function () {\n\t\t\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\t\t\ttext: app.vtranslate('JS_ERROR_CONNECTING'),\n\t\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\tescapeRegExp: function (string) {\n\t\t\treturn string.replace(/([.*+?^=!:${}()|\\[\\]\\/\\\\])/g, '\\\\$1');\n\t\t},\n\n\t\treplaceAll: function (string, find, replace) {\n\t\t\tvar thisInstance = this;\n\t\t\tstring = string.replace(new RegExp(thisInstance.escapeRegExp('&Oacute;'), 'g'), 'Ó');\n\t\t\treturn string.replace(new RegExp(thisInstance.escapeRegExp(find), 'g'), replace);\n\t\t},\n\t\tregisterBasicEvents: function (container) {\n\t\t\tthis._super(container);\n\t\t\tthis.registerRecordPreSaveEvent(container);\n\t\t},\n\t\tregisterEvents: function () {\n\t\t\tthis._super();\n\t\t\tthis.registerGenerateTCFieldTimeAndCost();\n\t\t\tthis.registerGenerateTCFromHelpDesk();\n\t\t}\n\t}\n);\n"],"names":["Vtiger_Edit_Js","registerGenerateTCFieldTimeAndCost","$","attr","css","thisInstance","getForm","sumeTime","differenceDays","form","hours","Math","ceil","toFixed","jQuery","val","on","round","container","find","firstDateFormat","firstDate","data","firstDateValue","secondDate","secondDateFormat","secondDateValue","firstTime","secondTime","firstTimeValue","secondTimeValue","Vtiger_Helper_Js","getDateInstance","secondDateInstance","timeBetweenDates","firstDateInstance","err","registerRecordPreSaveEvent","length","recordPreSave","text","app","vtranslate","type","showPnotify","parametres","getMainParams","sumeTime2","submit","registerGenerateTCFromHelpDesk","sourceDesk","moduleName","params","module","action","id","sourceModule","async","dataType","AppConnector","request","done","response","sourceData","sourceD","contact_id","replaceAll","contact_label","prop","parent_id","account_label","linktoaccountscontacts","fail","escapeRegExp","string","replace","registerBasicEvents","_super","registerEvents"],"mappings":"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"}