'use strict';

/*+**********************************************************************************
 * The contents of this file are subject to the vtiger CRM Public License Version 1.0
 * ("License"); You may not use this file except in compliance with the License
 * The Original Code is:  vtiger CRM Open Source
 * The Initial Developer of the Original Code is vtiger.
 * Portions created by vtiger are Copyright (C) vtiger.
 * All Rights Reserved.
 * Contributor(s): YetiForce.com
 ************************************************************************************/jQuery.Class('Install_Index_Js',{fieldsCached:['db_server','db_username','db_name','currency_name','firstname','lastname','admin_email','dateformat','default_timezone'],checkUsername:function checkUsername(field){var fieldValue=field.val(),negativeRegex=/^[a-zA-Z0-9_.@-]{3,64}$/,result=negativeRegex.test(fieldValue);if(!result)return app.vtranslate('JS_CONTAINS_ILLEGAL_CHARACTERS');var logins=JSON.parse($('#not_allowed_logins').val());if(-1!==$.inArray(fieldValue,logins))return app.vtranslate('LBL_INVALID_USERNAME_ERROR')},checkDbUsername:function checkDbUsername(field){var fieldValue=field.val(),negativeRegex=/^[_a-zA-Z0-9.,:-]+$/,result=negativeRegex.test(fieldValue);if(!result)return app.vtranslate('JS_CONTAINS_ILLEGAL_CHARACTERS')},checkDbName:function checkDbName(field){var fieldValue=field.val(),negativeRegex=/^[^\\/?%*:|\\\"<>.\s]{1,64}$/,result=negativeRegex.test(fieldValue);if(!result)return app.vtranslate('JS_CONTAINS_ILLEGAL_CHARACTERS')}},{registerEventForStep1:function registerEventForStep1(){jQuery('.bt_install').on('click',function(){jQuery('input[name="mode"]').val('step2'),jQuery('form[name="step1"]').submit();}),jQuery('.bt_migrate').on('click',function(){jQuery('input[name="mode"]').val('mStep0'),jQuery('form[name="step1"]').submit();});},registerEventForStep2:function registerEventForStep2(){var modalContainer=$('.js-license-modal');modalContainer.on('shown.bs.modal',function(){app.registerDataTables(modalContainer.find('.js-data-table'),{lengthMenu:[[10,25,50,-1],[10,25,50,app.vtranslate('JS_ALL')]],retrieve:!0});});},showBuyModal:function showBuyModal(event){$.get('Install.php?mode=showBuyModal&product='+$(event.currentTarget).data('product')).done(function(data){app.showModalWindow(data,'',function(modalContainer){new window.Settings_YetiForce_Shop_Js().registerBuyModalEvents(modalContainer);});});},registerEventForStepChooseHost:function registerEventForStepChooseHost(){var _this=this;$('.js-buy-modal').on('click',this.showBuyModal),$('.js-product-modal').on('click',function(e){$.get('Install.php?mode=showProductModal&product='+$(e.currentTarget).data('product')).done(function(data){app.showModalWindow(data,'',function(modalContainer){modalContainer.find('.js-modal__save').on('click',function(){app.hideModalWindow(),_this.showBuyModal(e);});});});});},registerEventForStep3:function registerEventForStep3(){$('#recheck').on('click',function(){window.location.reload();});var elements=jQuery('.js-wrong-status');$('.js-confirm').on('submit',function(e){0<elements.length&&(e.preventDefault(),app.showConfirmModal(app.vtranslate('LBL_SETTINGS_WARNING')).done(function(data){if(data)return elements=!1,void $('form[name="step3"]').submit()}));});},checkPwdEvent:function checkPwdEvent(){var thisInstance=this;jQuery('input[name="password"]').on('blur',function(){thisInstance.checkPwd(jQuery(this).val());});},checkPwd:function checkPwd(pass){var error=!1;return 8>pass.length?(jQuery('#passwordError').html(app.vtranslate('LBL_PASS_TO_SHORT')),error=!0):32<pass.length?(jQuery('#passwordError').html(app.vtranslate('LBL_PASS_TO_LONG')),error=!0):-1==pass.search(/\d/)?(jQuery('#passwordError').html(app.vtranslate('LBL_PASS_NO_NUM')),error=!0):-1==pass.search(/[A-Z]/)?(jQuery('#passwordError').html(app.vtranslate('LBL_PASS_LACK_OF_CAPITAL_LETTERS')),error=!0):-1==pass.search(/[a-z]/)&&(jQuery('#passwordError').html(app.vtranslate('LBL_PASS_LACK_OF_LOWERCASE_LETTERS')),error=!0),error},registerEventForStep4:function registerEventForStep4(){function clearPasswordError(){jQuery('#passwordError').html('');}function setPasswordError(){jQuery('#passwordError').html(app.vtranslate('LBL_PASS_REENTER_ERROR'));}var _this2=this,config=JSON.parse(localStorage.getItem('yetiforce_install'));Install_Index_Js.fieldsCached.forEach(function(field){if(config&&'undefined'!=typeof config[field]){var formField=jQuery('[name="'+field+'"]');'SELECT'==jQuery(formField).prop('tagName')?(jQuery(formField).val(config[field]),jQuery(formField).select2('destroy'),App.Fields.Picklist.showSelect2ElementView(jQuery(formField))):'INPUT'==jQuery(formField).prop('tagName')&&'checkbox'==jQuery(formField).attr('type')?!0==config[field]&&(jQuery(formField).prop('checked',!0),jQuery('.config-table tr.d-none').removeClass('d-none')):jQuery(formField).val(config[field]);}}),jQuery('input[name="retype_password"]').on('blur',function(e){var element=jQuery(e.currentTarget),password=jQuery('input[name="password"]').val();password!==element.val()&&setPasswordError();}),jQuery('input[name="password"]').on('blur',function(e){var retypePassword=jQuery('input[name="retype_password"]');''!=retypePassword.val()&&retypePassword.val()!==jQuery(e.currentTarget).val()?jQuery('#passwordError').html(app.vtranslate('LBL_PASS_REENTER_ERROR')):clearPasswordError();}),jQuery('input[name="retype_password"]').on('keypress',function(){clearPasswordError();}),$('form[name="step4"]').on('submit',function(e){_this2.checkForm()?e.preventDefault():($('form[name="step4"]').off('submit'),_this2.submitForm());}),this.checkPwdEvent();},registerEventForStep5:function registerEventForStep5(){jQuery('input[name="step6"]').on('click',function(){var error=jQuery('#errorMessage');return error.length?(app.showAlert(app.vtranslate('LBL_RESOLVE_ERROR')),!1):void(jQuery('#progressIndicator').removeClass('d-none'),jQuery('form[name="step5"]').submit().hide())});},registerEventForStep6:function registerEventForStep6(){var form=$('form[name="step6"]');form.on('submit',function(){form.validationEngine('validate')?(form.submit(),$('.js-submit').attr('disabled',!0)):app.formAlignmentAfterValidation(form);});},registerEventForMigration:function registerEventForMigration(){var step=jQuery('input[name="mode"]').val();'mStep3'==step&&jQuery('form').on('submit',function(){jQuery('#progressIndicator').show(),jQuery('#mainContainer').hide();});},checkForm:function checkForm(){var error=!1;return jQuery('#passwordError').html().trim()&&(error=!0),this.checkPwd(jQuery('input[name="password"]').val())&&(error=!0),error},submitForm:function submitForm(){window.localStorage.setItem('yetiforce_install',JSON.stringify({db_server:document.step4.db_server.value,db_username:document.step4.db_username.value,db_name:document.step4.db_name.value,currency_name:document.step4.currency_name.value,firstname:document.step4.firstname.value,lastname:document.step4.lastname.value,admin_email:document.step4.admin_email.value,dateformat:document.step4.dateformat.value,default_timezone:document.step4.default_timezone.value}));},changeLanguage:function changeLanguage(){jQuery('input[name="mode"]').val('step1'),jQuery('form[name="step1"]').submit();},registerEvents:function registerEvents(){var form=$('form');jQuery('input[name="back"]').on('click',function(){window.history.back();}),form.validationEngine(app.validationEngineOptions),this.registerEventForStep1(),this.registerEventForStep2(),this.registerEventForStep3(),this.registerEventForStep4(),this.registerEventForStep5(),this.registerEventForStep6(),this.registerEventForMigration(),'step-stepChooseHost'===form.attr('name')&&this.registerEventForStepChooseHost(),$('select[name="lang"]').on('change',this.changeLanguage);}}),jQuery(document).ready(function(){var install=new Install_Index_Js;install.registerEvents();});
//# sourceMappingURL=Index.min.js.map
