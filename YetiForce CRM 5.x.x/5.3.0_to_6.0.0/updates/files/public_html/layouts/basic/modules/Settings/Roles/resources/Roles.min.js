'use strict';

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) {
  return typeof obj;
} : function (obj) {
  return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;
};

var Settings_Roles_Js={newPriviliges:!1,initDeleteView:function initDeleteView(){jQuery('#roleDeleteForm').validationEngine(app.validationEngineOptions),jQuery('[data-action="popup"]').on('click',function(e){e.preventDefault();var target=$(e.currentTarget),field=target.data('field'),popupInstance=Vtiger_Popup_Js.getInstance();popupInstance.show(target.data('url')),popupInstance.retrieveSelectedRecords(function(data){try{data=JSON.parse(data);}catch(e){}'object'==('undefined'==typeof data?'undefined':_typeof(data))&&(jQuery('[name="'+field+'_display"]').val(data.label),data=data.value),jQuery('[name="'+field+'"]').val(data);});}),jQuery('#clearRole').on('click',function(){jQuery('[name="transfer_record_display"]').val(''),jQuery('[name="transfer_record"]').val('');});},initPopupView:function initPopupView(){jQuery('.roleEle').on('click',function(e){var target=$(e.currentTarget);// jquery_windowmsg plugin expects second parameter to be string.
jQuery.triggerParentEvent('postSelection',JSON.stringify({value:target.closest('li').data('roleid'),label:target.text()})),self.close();});},initEditView:function initEditView(){function applyMoveChanges(roleid,parent_roleid){AppConnector.request({module:'Roles',action:'MoveAjax',parent:'Settings',record:roleid,parent_roleid:parent_roleid}).done(function(res){res.success||(app.showAlert(app.vtranslate('JS_FAILED_TO_SAVE')),window.location.reload());});}jQuery('[rel="tooltip"]').tooltip(),jQuery('[data-action="modal"]').on('click',function(event){var target=$(event.currentTarget);app.showModalWindow(null,target.data('url'),function(){Settings_Roles_Js.initDeleteView();});}),jQuery('.toolbar').hide(),jQuery('.toolbar-handle').on('mouseover',function(e){var target=$(e.currentTarget);jQuery('.toolbar',target).css({display:'inline'});}),jQuery('.toolbar-handle').on('mouseout',function(e){var target=$(e.currentTarget);jQuery('.toolbar',target).hide();}),jQuery('.draggable').draggable({containment:'.treeView',start:function start(event,ui){var container=jQuery(ui.helper),referenceid=container.data('refid'),sourceGroup=jQuery('[data-grouprefid="'+referenceid+'"]'),sourceRoleId=sourceGroup.data('roleid');if('H5'==sourceRoleId||'H2'==sourceRoleId){var params={};params.title=app.vtranslate('JS_PERMISSION_DENIED'),params.text=app.vtranslate('JS_NO_PERMISSIONS_TO_MOVE'),params.type='error',Settings_Vtiger_Index_Js.showMessage(params);}},helper:function helper(event){var target=$(event.currentTarget),targetGroup=target.closest('li'),timestamp=+new Date,container=$('<div/>');return container.data('refid',timestamp),container.html(targetGroup.clone()),targetGroup.attr('data-grouprefid',timestamp),container}}),jQuery('.droppable').droppable({hoverClass:'btn-primary',tolerance:'pointer',drop:function drop(event,ui){var container=$(ui.helper),referenceid=container.data('refid'),sourceGroup=$('[data-grouprefid="'+referenceid+'"]'),thisWrapper=$(this).closest('div'),targetRole=thisWrapper.closest('li').data('role'),targetRoleId=thisWrapper.closest('li').data('roleid'),sourceRole=sourceGroup.data('role'),sourceRoleId=sourceGroup.data('roleid');// Attempt to push parent-into-its own child hierarchy?
0==targetRole.indexOf(sourceRole+'::')||'H5'==sourceRoleId||'H2'==sourceRoleId||(sourceGroup.appendTo(thisWrapper.next('ul')),applyMoveChanges(sourceRoleId,targetRoleId));//Attempt to move the roles CEO and Sales Person
}});},registerSubmitEvent:function registerSubmitEvent(){var thisInstance=this,form=jQuery('#EditView');form.on('submit',function(e){if('true'==form.data('submit')&&'true'==form.data('performCheck'))return !0;var selectElement=jQuery('#profilesList'),select2Element=app.getSelect2ElementFromSelect(selectElement),result=Vtiger_MultiSelect_Validator_Js.invokeValidation(selectElement);if(!0!=result)return select2Element.validationEngine('showPrompt',result,'error','bottomLeft',!0),void e.preventDefault();if(select2Element.validationEngine('hide'),0>=form.data('jqv').InvalidFields.length){var formData=form.serializeFormData();thisInstance.checkDuplicateName({rolename:formData.rolename,record:formData.record}).done(function(){form.data('submit','true'),form.data('performCheck','true'),form.submit(),jQuery.progressIndicator({blockInfo:{enabled:!0}});}).fail(function(data){var params={};return params.text=data.message,params.type='error',Settings_Vtiger_Index_Js.showMessage(params),!1});}else//If validation fails, form should submit again
form.removeData('submit'),app.formAlignmentAfterValidation(form);e.preventDefault();});},/*
	 * Function to check Duplication of Role Names
	 * returns boolean true or false
	 */checkDuplicateName:function checkDuplicateName(details){var aDeferred=jQuery.Deferred(),params={module:app.getModuleName(),parent:app.getParentModuleName(),action:'EditAjax',mode:'checkDuplicate',rolename:details.rolename,record:details.record};return AppConnector.request(params).done(function(data){var response=data.result,result=response.success;!0==result?aDeferred.reject(response):aDeferred.resolve(response);}).fail(function(error,err){aDeferred.reject(error,err);}),aDeferred.promise()},/**
	 * Register button to open modal logo upload form
	 */registerModalUploadButton:function registerModalUploadButton(){var thisInstance=this;$('.js-upload-logo').on('click',function(){app.showModalWindow(null,$(this).data('url'),function(data){thisInstance.registerUploadButton(data.find('form'));});});},/**
	 * Register button send form
	 * @param {jQuery} form
	 */registerUploadButton:function registerUploadButton(form){form.on('submit',function(e){if(e.preventDefault(),!0===form.validationEngine('validate')){app.removeEmptyFilesInput(form[0]);var formData=new FormData(form[0]),progressIndicatorElement=jQuery.progressIndicator({blockInfo:{enabled:!0}}),notifyType='';AppConnector.request({url:'index.php',type:'POST',data:formData,processData:!1,contentType:!1}).done(function(data){progressIndicatorElement.progressIndicator({mode:'hide'}),notifyType=!0===data.result.success?'success':'error',app.showNotify({title:app.vtranslate('JS_MESSAGE'),text:app.vtranslate(data.result.message),type:notifyType}),app.hideModalWindow();});}});},registerEvents:function registerEvents(){Settings_Roles_Js.registerModalUploadButton(),Settings_Roles_Js.initEditView(),Settings_Roles_Js.registerSubmitEvent();}};jQuery(document).ready(function(){Settings_Roles_Js.registerEvents();});
//# sourceMappingURL=Roles.min.js.map
