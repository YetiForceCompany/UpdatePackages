{"version":3,"file":"checkmails.min.js","sources":["checkmails.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 6.5 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\njQuery(function () {\n\tif ($('.js-header__btn--mail').data('numberunreademails') != undefined) {\n\t\twindow.stopScanMails = false;\n\t\tif (getUrlVars()['view'] != 'Popup') {\n\t\t\tstartCheckMails();\n\t\t}\n\t}\n\tif ($('.js-header__btn--mail select').length > 0) {\n\t\tregisterUserList();\n\t}\n});\n\nfunction registerUserList() {\n\tvar selectUsers = $('.js-header__btn--mail select');\n\tif (selectUsers.data('select2')) {\n\t\tselectUsers.select2('destroy');\n\t} else {\n\t\tselectUsers.on('change', handleChangeUserEvent);\n\t}\n\tApp.Fields.Picklist.showSelect2ElementView(selectUsers, {\n\t\ttemplateResult: function (data) {\n\t\t\tconst main = document.createElement('span');\n\t\t\tif (data.id) {\n\t\t\t\tconst element = $(data.element),\n\t\t\t\t\tmail = document.createElement('span');\n\t\t\t\tmail.innerText = data.text;\n\t\t\t\tmain.appendChild(mail);\n\t\t\t\tif (element.data('nomail')) {\n\t\t\t\t\tconst badge = document.createElement('span');\n\t\t\t\t\tbadge.className = 'badge badge-danger ml-1';\n\t\t\t\t\tbadge.innerText = element.data('nomail');\n\t\t\t\t\tmain.appendChild(badge);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tmain.innerText = data.text;\n\t\t\t}\n\t\t\treturn main;\n\t\t},\n\t\ttemplateSelection: function (data) {\n\t\t\tconst element = $(data.element),\n\t\t\t\tmain = document.createElement('span'),\n\t\t\t\tmail = document.createElement('span');\n\t\t\tmail.innerText = data.text;\n\t\t\tmain.appendChild(mail);\n\t\t\tif (element.data('nomail')) {\n\t\t\t\tconst badge = document.createElement('span');\n\t\t\t\tbadge.className = 'badge badge-danger ml-1';\n\t\t\t\tbadge.innerText = element.data('nomail');\n\t\t\t\tmain.appendChild(badge);\n\t\t\t}\n\t\t\treturn main;\n\t\t},\n\t\tcloseOnSelect: true\n\t});\n\tconst select2Instance = selectUsers.data('select2');\n\tselect2Instance.$dropdown.on('mouseup', 'li', function (e) {\n\t\tif (jQuery(e.currentTarget).attr('aria-selected') == 'true') {\n\t\t\tselectUsers.trigger('change');\n\t\t}\n\t});\n\tselect2Instance.$container.find('.select2-selection__rendered').on('mousedown', function (e) {\n\t\te.stopPropagation();\n\t\tselectUsers.trigger('change');\n\t});\n\t$('.js-mail-list').on('click', '.js-mail-link', handleChangeUserEvent);\n}\n\nfunction handleChangeUserEvent() {\n\tAppConnector.request({\n\t\tmodule: 'OSSMail',\n\t\taction: 'SetUser',\n\t\tuser: $(this).val()\n\t}).done(function (_) {\n\t\tif (app.getModuleName() == 'OSSMail') {\n\t\t\twindow.location.href = window.location.href;\n\t\t} else {\n\t\t\twindow.location.href = 'index.php?module=OSSMail&view=Index';\n\t\t}\n\t});\n}\n\nfunction startCheckMails() {\n\tlet users = [];\n\tlet timeCheckingMails = $('.js-header__btn--mail').data('interval');\n\t$('.js-header__btn--mail .noMails').each(function (_) {\n\t\tusers.push($(this).data('id'));\n\t});\n\tif (users.length > 0) {\n\t\tcheckMails(users, true);\n\t\tlet refreshIntervalId = setInterval(function () {\n\t\t\tif (window.stopScanMails == false) {\n\t\t\t\tcheckMails(users);\n\t\t\t} else {\n\t\t\t\tclearInterval(refreshIntervalId);\n\t\t\t}\n\t\t}, timeCheckingMails * 1000);\n\t}\n}\n\nfunction checkMails(users, initial = false) {\n\tlet reloadSelect = false;\n\tAppConnector.request({\n\t\tmodule: 'OSSMail',\n\t\taction: 'CheckMails',\n\t\tusers: users\n\t})\n\t\t.done(function (response) {\n\t\t\tif (response.success && response.success.error != true && response.result.error != true) {\n\t\t\t\tlet result = response.result;\n\t\t\t\t$('.js-header__btn--mail .noMails').each(function (_) {\n\t\t\t\t\tlet element = jQuery(this);\n\t\t\t\t\tlet id = element.data('id');\n\t\t\t\t\tif (jQuery.inArray(id, result)) {\n\t\t\t\t\t\tlet num = result[id];\n\t\t\t\t\t\tif (element.is('option')) {\n\t\t\t\t\t\t\telement.data('nomail', num);\n\t\t\t\t\t\t\treloadSelect = true;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tlet prevVal = element.data('nomail');\n\t\t\t\t\t\t\telement.data('nomail', num);\n\t\t\t\t\t\t\tlet text = '';\n\t\t\t\t\t\t\tif (num > 0) {\n\t\t\t\t\t\t\t\ttext = ' <span class=\"badge badge-danger mr-1\">' + num + '</span>';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telement.html(text);\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\tinitial === false &&\n\t\t\t\t\t\t\t\t(this.tagName === 'SPAN' || this.selected) &&\n\t\t\t\t\t\t\t\t((prevVal < num && prevVal >= 0) || (!prevVal && num > 0))\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\telement.parent().effect('pulsate', 1500);\n\t\t\t\t\t\t\t\tapp.playSound('MAILS');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (reloadSelect) {\n\t\t\t\t\tregisterUserList();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\twindow.stopScanMails = true;\n\t\t\t}\n\t\t})\n\t\t.fail(function () {\n\t\t\twindow.stopScanMails = true;\n\t\t});\n}\n\nfunction getUrlVars() {\n\tlet vars = {};\n\twindow.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (m, key, value) {\n\t\tvars[key] = value;\n\t});\n\treturn vars;\n}\n"],"names":["jQuery","$","data","window","stopScanMails","getUrlVars","view","startCheckMails","length","registerUserList","selectUsers","select2","on","handleChangeUserEvent","App","Fields","Picklist","showSelect2ElementView","templateResult","main","document","createElement","id","element","mail","innerText","text","appendChild","badge","className","templateSelection","closeOnSelect","select2Instance","$dropdown","e","currentTarget","attr","trigger","$container","find","stopPropagation","AppConnector","request","module","action","user","val","done","location","href","app","getModuleName","users","timeCheckingMails","each","push","checkMails","refreshIntervalId","setInterval","clearInterval","initial","arguments","reloadSelect","response","success","error","result","inArray","num","is","prevVal","html","tagName","selected","parent","effect","playSound","fail","vars","replace","m","key","value"],"mappings":"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"}