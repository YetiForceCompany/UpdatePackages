{"version":3,"file":"Kanban.min.js","sources":["Kanban.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 6.5 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\n$.Class(\n\t'Vtiger_Kanban_Js',\n\t{},\n\t{\n\t\t/**\n\t\t * Get params\n\t\t */\n\t\tgetParams: function () {\n\t\t\tconst params = [];\n\t\t\tthis.page.find('.js-params').each(function () {\n\t\t\t\tlet element = $(this);\n\t\t\t\tparams[element.attr('name')] = element.val();\n\t\t\t});\n\t\t\treturn $.extend(\n\t\t\t\t{\n\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\tview: 'Kanban',\n\t\t\t\t\tboard: this.page.find('.js-board-tab.active').data('id')\n\t\t\t\t},\n\t\t\t\tparams\n\t\t\t);\n\t\t},\n\t\tloadKanban: function () {\n\t\t\tconst params = this.getParams(),\n\t\t\t\turlParams = Object.assign({}, params);\n\t\t\tdelete urlParams.orderBy;\n\t\t\tapp.changeUrl(urlParams);\n\t\t\tconst progress = $.progressIndicator({ blockInfo: { enabled: true, elementToBlock: this.container } });\n\t\t\tAppConnector.request(params)\n\t\t\t\t.done((responseData) => {\n\t\t\t\t\tthis.container.html(responseData);\n\t\t\t\t\tthis.registerSortable();\n\t\t\t\t\tprogress.progressIndicator({ mode: 'hide' });\n\t\t\t\t})\n\t\t\t\t.fail(() => {\n\t\t\t\t\tprogress.progressIndicator({ mode: 'hide' });\n\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\ttitle: app.vtranslate('JS_ERROR'),\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t},\n\t\tregisterSortable: function () {\n\t\t\tconst boards = this.container.find('.js-kanban-records');\n\t\t\tboards.sortable({\n\t\t\t\tcontainment: this.container,\n\t\t\t\titems: boards.find('.js-kanban-record'),\n\t\t\t\tcancel: '.js-kanban-disabled',\n\t\t\t\tconnectWith: boards,\n\t\t\t\tplaceholder: 'c-kanban__highlight',\n\t\t\t\trevert: true,\n\t\t\t\ttolerance: 'pointer',\n\t\t\t\tcursor: 'move',\n\t\t\t\tupdate: (e, ui) => {\n\t\t\t\t\tif (ui.sender == null) {\n\t\t\t\t\t\tconst records = ui.item.closest('.js-kanban-records');\n\t\t\t\t\t\tVtiger_Edit_Js.saveAjax({\n\t\t\t\t\t\t\trecord: ui.item.data('id'),\n\t\t\t\t\t\t\tfield: records.data('field'),\n\t\t\t\t\t\t\tvalue: records.data('value')\n\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.done(() => {\n\t\t\t\t\t\t\t\tthis.loadKanban();\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.fail(function (error, err) {\n\t\t\t\t\t\t\t\tapp.errorLog(error, err);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tstart: (e, ui) => {\n\t\t\t\t\tui.placeholder.height(ui.helper.outerHeight());\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Registers mobile devices.\n\t\t */\n\t\tregisterMobileDevices: function () {\n\t\t\tif (app.isTouchDevice()) {\n\t\t\t\tthis.container.find('.js-kanban-record').each(function () {\n\t\t\t\t\tlet element = $(this);\n\t\t\t\t\telement.find('.js-popover-tooltip--record').removeClass('js-popover-tooltip--record');\n\t\t\t\t\tlet btns = element.find('.btns');\n\t\t\t\t\tlet btnQuickEditModal = btns.find('.js-quick-edit-modal');\n\t\t\t\t\telement.addClass('js-quick-edit-modal');\n\t\t\t\t\telement.attr('href', btnQuickEditModal.attr('href'));\n\t\t\t\t\telement.attr('data-record', btnQuickEditModal.data('record'));\n\t\t\t\t\telement.attr('data-module', btnQuickEditModal.data('module'));\n\t\t\t\t\tbtns.remove();\n\t\t\t\t\telement.find('a').on('click', function (e) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Registers Kanban view events.\n\t\t */\n\t\tregisterEvents: function () {\n\t\t\tthis.page = $('#centerPanel');\n\t\t\tthis.container = $('.js-kanban-container');\n\t\t\tthis.registerSortable();\n\t\t\tapp.showNewScrollbarTopBottom(this.container);\n\t\t\tthis.page.on('click', '.js-board-tab', (e) => {\n\t\t\t\tthis.page.find('.js-board-tab.active').removeClass('active');\n\t\t\t\t$(e.currentTarget).addClass('active');\n\t\t\t\tthis.loadKanban();\n\t\t\t});\n\t\t\tthis.page.on('change', '.js-params', () => {\n\t\t\t\tthis.loadKanban();\n\t\t\t});\n\t\t\tthis.page.on('click', '.js-list-reload', (e, data) => {\n\t\t\t\tthis.page.find('#orderBy').val(JSON.stringify(data.orderby)).trigger('change');\n\t\t\t});\n\t\t\tthis.registerMobileDevices();\n\t\t}\n\t}\n);\n"],"names":["$","Class","getParams","params","page","find","each","element","attr","val","extend","module","app","getModuleName","view","board","data","loadKanban","_this","urlParams","Object","assign","orderBy","changeUrl","progress","progressIndicator","blockInfo","enabled","elementToBlock","container","AppConnector","request","done","responseData","html","registerSortable","mode","fail","showNotify","title","vtranslate","type","_this2","boards","sortable","containment","items","cancel","connectWith","placeholder","revert","tolerance","cursor","update","e","ui","sender","records","item","closest","Vtiger_Edit_Js","saveAjax","record","field","value","error","err","errorLog","start","height","helper","outerHeight","registerMobileDevices","isTouchDevice","removeClass","btns","btnQuickEditModal","addClass","remove","on","stopPropagation","registerEvents","_this3","showNewScrollbarTopBottom","currentTarget","JSON","stringify","orderby","trigger"],"mappings":"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"}