{"version":3,"file":"RecordConverter.min.js","sources":["RecordConverter.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 6.5 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n$.Class(\n\t'Base_RecordConverter_JS',\n\t{},\n\t{\n\t\tcontainer: false,\n\t\t/**\n\t\t * Function get values for request query\n\t\t * @returns {{module: string, view: string, fieldMerge: string, onlyBody: boolean, destinyModule: string, sourceView: string}}\n\t\t */\n\t\tgetParams: function () {\n\t\t\tlet params = {\n\t\t\t\tmodule: this.container.data('module'),\n\t\t\t\tview: this.container.data('view'),\n\t\t\t\tconvertId: this.container.find('.js-convert-type option:selected').val(),\n\t\t\t\tsourceView: this.container.find('[name=\"sourceView\"]').val()\n\t\t\t};\n\t\t\tif (app.getViewName() === 'List') {\n\t\t\t\tlet listInstance = Vtiger_List_Js.getInstance();\n\t\t\t\tparams.selected_ids = listInstance.readSelectedIds(true);\n\t\t\t\tparams.excluded_ids = listInstance.readExcludedIds(true);\n\t\t\t\tparams.cvId = listInstance.getCurrentCvId();\n\t\t\t\tif (listInstance.getListSearchInstance()) {\n\t\t\t\t\tlet searchValue = listInstance.getListSearchInstance().getAlphabetSearchValue();\n\t\t\t\t\tparams.search_params = JSON.stringify(listInstance.getListSearchInstance().getListSearchParams());\n\t\t\t\t\tif (typeof searchValue != 'undefined' && searchValue.length > 0) {\n\t\t\t\t\t\tparams.search_key = listInstance.getListSearchInstance().getAlphabetSearchField();\n\t\t\t\t\t\tparams.search_value = searchValue;\n\t\t\t\t\t\tparams.operator = 's';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tparams.selected_ids = app.getRecordId();\n\t\t\t}\n\t\t\treturn params;\n\t\t},\n\t\t/**\n\t\t * Function load modal window\n\t\t * @returns {object}\n\t\t */\n\t\tloadModalWindow: function () {\n\t\t\tconst body = this.container.find('.js-modal-body');\n\t\t\tconst aDeferred = $.Deferred();\n\t\t\tconst progressIndicatorElement = $.progressIndicator({\n\t\t\t\tblockInfo: {\n\t\t\t\t\tenabled: true\n\t\t\t\t}\n\t\t\t});\n\t\t\tapp.hideModalWindow(body.closest('.js-modal-container').attr('id'));\n\t\t\tapp.showModalWindow({\n\t\t\t\turl: app.convertObjectToUrl(this.getParams()),\n\t\t\t\tcb: function (_) {\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn aDeferred.promise();\n\t\t},\n\t\t/**\n\t\t * Function listener to change convert type\n\t\t */\n\t\tregisterChangeConvertType: function () {\n\t\t\tthis.container.on('change', '.js-convert-type', (e) => {\n\t\t\t\tthis.loadModalWindow();\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Function listener to send a form\n\t\t * * @returns {object}\n\t\t */\n\t\tregisterSubmitForm: function () {\n\t\t\tlet self = this;\n\t\t\tself.container.on('click', \"[name='saveButton']\", (e) => {\n\t\t\t\tlet formMapping = self.container.find('form.js-form-converter');\n\t\t\t\tif (formMapping.validationEngine('validate')) {\n\t\t\t\t\tlet formData = formMapping.serializeFormData();\n\t\t\t\t\tlet postData = {};\n\t\t\t\t\tif (app.getViewName() === 'List') {\n\t\t\t\t\t\tlet listInstance = Vtiger_List_Js.getInstance();\n\t\t\t\t\t\tpostData = listInstance.getDefaultParams();\n\t\t\t\t\t\tpostData.selected_ids = listInstance.readSelectedIds(true);\n\t\t\t\t\t\tpostData.excluded_ids = listInstance.readExcludedIds(true);\n\t\t\t\t\t\tpostData.cvid = listInstance.getCurrentCvId();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpostData = {\n\t\t\t\t\t\t\tselected_ids: app.getRecordId()\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\tpostData.viewInfo = app.getViewName();\n\t\t\t\t\tconst aDeferred = $.Deferred();\n\t\t\t\t\tconst progressIndicatorElement = $.progressIndicator({\n\t\t\t\t\t\tblockInfo: {\n\t\t\t\t\t\t\tenabled: true,\n\t\t\t\t\t\t\telementToBlock: self.container.find('.modal-body')\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tAppConnector.request($.extend(formData, postData)).done(\n\t\t\t\t\t\tfunction (responseData) {\n\t\t\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\t\tresponseData = JSON.parse(responseData);\n\t\t\t\t\t\t\tif (responseData.result.redirect) {\n\t\t\t\t\t\t\t\twindow.location.href = responseData.result.redirect;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (responseData.result.createdRecords) {\n\t\t\t\t\t\t\t\t\tVtiger_Helper_Js.showMessage({\n\t\t\t\t\t\t\t\t\t\ttext: app.vtranslate(responseData.result.createdRecords),\n\t\t\t\t\t\t\t\t\t\ttype: 'success'\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (responseData.result.error) {\n\t\t\t\t\t\t\t\t\tVtiger_Helper_Js.showMessage({\n\t\t\t\t\t\t\t\t\t\ttext: app.vtranslate(responseData.result.error),\n\t\t\t\t\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tapp.hideModalWindow();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\taDeferred.resolve(responseData);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfunction (textStatus, errorThrown) {\n\t\t\t\t\t\t\taDeferred.reject(textStatus, errorThrown);\n\t\t\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\treturn aDeferred.promise();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Register events function\n\t\t * @param modalContainer\n\t\t */\n\t\tregisterEvents: function (modalContainer) {\n\t\t\tthis.container = modalContainer;\n\t\t\tthis.registerChangeConvertType();\n\t\t\tthis.registerSubmitForm();\n\t\t\tthis.container.find('form.js-form-converter').validationEngine(app.validationEngineOptions);\n\t\t}\n\t}\n);\n"],"names":["$","Class","container","getParams","params","module","data","view","convertId","find","val","sourceView","app","getViewName","listInstance","Vtiger_List_Js","getInstance","selected_ids","readSelectedIds","excluded_ids","readExcludedIds","cvId","getCurrentCvId","getListSearchInstance","searchValue","getAlphabetSearchValue","search_params","JSON","stringify","getListSearchParams","length","search_key","getAlphabetSearchField","search_value","operator","getRecordId","loadModalWindow","body","aDeferred","Deferred","progressIndicatorElement","progressIndicator","blockInfo","enabled","hideModalWindow","closest","attr","showModalWindow","url","convertObjectToUrl","cb","mode","promise","registerChangeConvertType","_this","on","registerSubmitForm","self","formMapping","validationEngine","formData","serializeFormData","postData","getDefaultParams","cvid","viewInfo","elementToBlock","AppConnector","request","extend","done","responseData","parse","result","redirect","window","location","href","createdRecords","Vtiger_Helper_Js","showMessage","text","vtranslate","type","error","resolve","textStatus","errorThrown","reject","registerEvents","modalContainer","validationEngineOptions"],"mappings":"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"}