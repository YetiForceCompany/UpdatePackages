{"version":3,"file":"TreeCategoryModal.min.js","sources":["TreeCategoryModal.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 6.5 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\njQuery.Class(\n\t'Vtiger_TreeCategory_Js',\n\t{},\n\t{\n\t\tmodalContainer: false,\n\t\ttreeInstance: false,\n\t\ttreeData: false,\n\t\twindowParent: app.getWindowParent(),\n\t\tgetModalContainer: function () {\n\t\t\tif (this.modalContainer == false) {\n\t\t\t\tthis.modalContainer = jQuery('#modalTreeCategoryModal');\n\t\t\t}\n\t\t\treturn this.modalContainer;\n\t\t},\n\t\tgetRecords: function (container) {\n\t\t\tif (this.treeData == false && container !== 'undefined') {\n\t\t\t\tlet treeValues = container.find('#treePopupValues').val();\n\t\t\t\tthis.treeData = JSON.parse(treeValues);\n\t\t\t}\n\t\t\treturn this.treeData;\n\t\t},\n\t\tgenerateTree: function (container) {\n\t\t\tlet thisInstance = this;\n\t\t\tif (thisInstance.treeInstance == false) {\n\t\t\t\tthisInstance.treeInstance = container.find('#treePopupContents');\n\t\t\t\tlet plugins = ['search', 'category'];\n\t\t\t\tif (thisInstance.getRelationType() == '2') {\n\t\t\t\t\tplugins.push('checkbox');\n\t\t\t\t}\n\t\t\t\tif (thisInstance.getRelationType() == '1') {\n\t\t\t\t\tplugins.push('edit');\n\t\t\t\t}\n\t\t\t\tthisInstance.treeInstance.jstree(\n\t\t\t\t\t$.extend(\n\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcore: {\n\t\t\t\t\t\t\t\tdata: thisInstance.getRecords(),\n\t\t\t\t\t\t\t\tthemes: {\n\t\t\t\t\t\t\t\t\tname: 'proton',\n\t\t\t\t\t\t\t\t\tresponsive: true\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcheckbox: {\n\t\t\t\t\t\t\t\tthree_state: false\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tplugins: plugins\n\t\t\t\t\t\t},\n\t\t\t\t\t\tthisInstance.treeInstance.data('params')\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\tgetRelationType: function () {\n\t\t\treturn this.getModalContainer().find('#relationType').val();\n\t\t},\n\t\tsearching: function (text) {\n\t\t\tthis.treeInstance.jstree(true).search(text);\n\t\t},\n\t\tregisterSearchEvent: function () {\n\t\t\tlet thisInstance = this;\n\t\t\tlet valueSearch = $('#valueSearchTree');\n\t\t\tlet btnSearch = $('#btnSearchTree');\n\t\t\tvalueSearch.on('keypress', function (e) {\n\t\t\t\tif (e.which == 13) {\n\t\t\t\t\tthisInstance.searching(valueSearch.val());\n\t\t\t\t}\n\t\t\t});\n\t\t\tbtnSearch.on('click', function () {\n\t\t\t\tthisInstance.searching(valueSearch.val());\n\t\t\t});\n\t\t},\n\t\tregisterSaveRecords: function (container) {\n\t\t\tconst thisInstance = this;\n\t\t\tlet ord = [],\n\t\t\t\tocd = [];\n\t\t\t$.each(thisInstance.getRecords(), function (index, value) {\n\t\t\t\tif (value.state && value.state.selected && value.attr === 'record') {\n\t\t\t\t\tord.push(value.record_id);\n\t\t\t\t}\n\t\t\t\tif (value.category && value.category.checked && value.attr !== 'record') {\n\t\t\t\t\tocd.push(value.record_id);\n\t\t\t\t}\n\t\t\t});\n\t\t\tcontainer.find('[name=\"saveButton\"]').on('click', function (e) {\n\t\t\t\tlet recordsToAdd = [],\n\t\t\t\t\tcategoryToAdd = [],\n\t\t\t\t\trecordsToRemove = Object.assign([], ord),\n\t\t\t\t\tcategoryToRemove = Object.assign([], ocd);\n\t\t\t\tlet saveButton = $(this);\n\t\t\t\tsaveButton.attr('disabled', 'disabled');\n\t\t\t\tlet cSelected = thisInstance.treeInstance.jstree('getCategory', true);\n\t\t\t\t$.each(cSelected, function (index, treeElement) {\n\t\t\t\t\tlet value = treeElement.record_id;\n\t\t\t\t\tif (treeElement.attr === 'record') {\n\t\t\t\t\t\tif (jQuery.inArray(value, recordsToRemove) == -1) {\n\t\t\t\t\t\t\trecordsToAdd.push(value);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trecordsToRemove.splice(recordsToRemove.indexOf(value), 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (treeElement.attr !== 'record') {\n\t\t\t\t\t\tif (jQuery.inArray(value, categoryToRemove) == -1) {\n\t\t\t\t\t\t\tcategoryToAdd.push(value);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcategoryToRemove.splice(categoryToRemove.indexOf(value), 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tlet params = {\n\t\t\t\t\tmodule: thisInstance.windowParent.app.getModuleName(),\n\t\t\t\t\taction: 'RelationAjax',\n\t\t\t\t\tmode: 'updateRelation',\n\t\t\t\t\trecordsToAdd: recordsToAdd,\n\t\t\t\t\trecordsToRemove: recordsToRemove,\n\t\t\t\t\tcategoryToAdd: categoryToAdd,\n\t\t\t\t\tcategoryToRemove: categoryToRemove,\n\t\t\t\t\tsrc_record: thisInstance.windowParent.app.getRecordId(),\n\t\t\t\t\trelated_module: container.find('#relatedModule').val()\n\t\t\t\t};\n\t\t\t\tif (recordsToAdd.length > 4) {\n\t\t\t\t\tapp.showConfirmModal({\n\t\t\t\t\t\ttitle: app.vtranslate('JS_INFORMATION'),\n\t\t\t\t\t\ttext: app.vtranslate('JS_SAVE_SELECTED_ITEMS_ALERT').replace('__LENGTH__', recordsToAdd.length),\n\t\t\t\t\t\tconfirmedCallback: () => {\n\t\t\t\t\t\t\tthisInstance.saveRecordsEvent(params);\n\t\t\t\t\t\t},\n\t\t\t\t\t\trejectedCallback: () => {\n\t\t\t\t\t\t\tsaveButton.removeAttr('disabled');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tthisInstance.saveRecordsEvent(params);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tsaveRecordsEvent: function (params) {\n\t\t\tconst self = this;\n\t\t\tAppConnector.request(params).done(function (res) {\n\t\t\t\tself.windowParent.Vtiger_Detail_Js.getInstance().reloadTabContent();\n\t\t\t\tapp.hideModalWindow();\n\t\t\t});\n\t\t},\n\t\tregisterCounterSelected: function () {\n\t\t\tlet thisInstance = this;\n\t\t\tthis.treeInstance.on('changed.jstree', function (e, data) {\n\t\t\t\tlet counterSelected = 0;\n\t\t\t\tlet html = '';\n\t\t\t\t$.each(thisInstance.treeInstance.jstree('get_selected', true), function (index, value) {\n\t\t\t\t\tlet id = value.original.record_id.toString();\n\t\t\t\t\tif (id.indexOf('T')) {\n\t\t\t\t\t\tcounterSelected++;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\thtml = app.vtranslate('JS_SELECTED_ELEMENTS') + ': ' + counterSelected;\n\t\t\t\t$('.counterSelected').text(html);\n\t\t\t});\n\t\t},\n\t\tregisterEvents: function () {\n\t\t\tlet container = this.getModalContainer();\n\t\t\tthis.getRecords(container);\n\t\t\tthis.generateTree(container);\n\t\t\tthis.registerSaveRecords(container);\n\t\t\tthis.registerSearchEvent();\n\t\t\tthis.registerCounterSelected();\n\t\t}\n\t}\n);\njQuery(function () {\n\tlet instance = new Vtiger_TreeCategory_Js();\n\tinstance.registerEvents();\n});\n"],"names":["jQuery","Class","modalContainer","treeInstance","treeData","windowParent","app","getWindowParent","getModalContainer","getRecords","container","treeValues","find","val","JSON","parse","generateTree","thisInstance","plugins","getRelationType","push","jstree","$","extend","core","data","themes","name","responsive","checkbox","three_state","searching","text","search","registerSearchEvent","valueSearch","btnSearch","on","e","which","registerSaveRecords","ord","ocd","each","index","value","state","selected","attr","record_id","category","checked","recordsToAdd","categoryToAdd","recordsToRemove","Object","assign","categoryToRemove","saveButton","cSelected","treeElement","inArray","splice","indexOf","params","module","getModuleName","action","mode","src_record","getRecordId","related_module","length","showConfirmModal","title","vtranslate","replace","confirmedCallback","saveRecordsEvent","rejectedCallback","removeAttr","self","AppConnector","request","done","Vtiger_Detail_Js","getInstance","reloadTabContent","hideModalWindow","registerCounterSelected","counterSelected","html","id","original","toString","registerEvents","instance","Vtiger_TreeCategory_Js"],"mappings":"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"}