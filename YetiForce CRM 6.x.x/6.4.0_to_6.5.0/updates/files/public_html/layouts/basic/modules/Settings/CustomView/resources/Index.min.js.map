{"version":3,"file":"Index.min.js","sources":["Index.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 6.5 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\njQuery.Class(\n\t'Settings_CustomView_Index_Js',\n\t{},\n\t{\n\t\tcontainer: false,\n\t\tcontents: false,\n\t\t/**\n\t\t * Register events\n\t\t * @param {jQuery} container\n\t\t */\n\t\tinitEvents: function (container) {\n\t\t\tcontainer.on('click', '.js-delete-filter', (e) => {\n\t\t\t\tthis.deleteFilter(e);\n\t\t\t});\n\t\t\tcontainer.on('change', '.js-update-field', (e) => {\n\t\t\t\tthis.updateField(e);\n\t\t\t});\n\t\t\tcontainer.on('click', '.js-update,.js-create-filter', (e) => {\n\t\t\t\tthis.update(e);\n\t\t\t});\n\t\t\tcontainer.on('change', '.js-module-filter', (e) => {\n\t\t\t\tthis.registerFilterChange(e);\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Load form to edit filter\n\t\t * @param {jQuery.Event} e\n\t\t */\n\t\tupdate: function (e) {\n\t\t\tvar target = $(e.currentTarget);\n\t\t\tvar editUrl = target.data('editurl');\n\t\t\tnew CustomView(editUrl);\n\t\t},\n\t\t/**\n\t\t * Update parameter\n\t\t * @param {jQuery.Event} e\n\t\t */\n\t\tupdateField: function (e) {\n\t\t\tconst thisInstance = this,\n\t\t\t\ttarget = $(e.currentTarget),\n\t\t\t\tclosestTrElement = target.closest('.js-filter-row');\n\t\t\t$.progressIndicator({\n\t\t\t\tmessage: app.vtranslate('JS_SAVE_LOADER_INFO'),\n\t\t\t\tblockInfo: {\n\t\t\t\t\tenabled: true\n\t\t\t\t}\n\t\t\t});\n\t\t\tconst params = {\n\t\t\t\tcvid: closestTrElement.data('cvid'),\n\t\t\t\tmod: closestTrElement.data('mod'),\n\t\t\t\tname: target.attr('name'),\n\t\t\t\tvalue: target.val()\n\t\t\t};\n\t\t\tapp.saveAjax('updateField', {}, params).done(function (data) {\n\t\t\t\tthisInstance.getContainer().find('.js-module-filter').trigger('change');\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Delete filter\n\t\t * @param {jQuery.Event} e\n\t\t */\n\t\tdeleteFilter: function (e) {\n\t\t\tvar thisInstance = this;\n\t\t\tvar target = $(e.currentTarget);\n\t\t\tvar closestTrElement = target.closest('.js-filter-row');\n\t\t\t$.progressIndicator({\n\t\t\t\tmessage: app.vtranslate('JS_SAVE_LOADER_INFO'),\n\t\t\t\tblockInfo: {\n\t\t\t\t\tenabled: true\n\t\t\t\t}\n\t\t\t});\n\t\t\tapp\n\t\t\t\t.saveAjax(\n\t\t\t\t\t'delete',\n\t\t\t\t\t{},\n\t\t\t\t\t{\n\t\t\t\t\t\tcvid: closestTrElement.data('cvid')\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t\t.done(function () {\n\t\t\t\t\tthisInstance.getContainer().find('.js-module-filter').trigger('change');\n\t\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Function to regiser the event to make the filters sortable\n\t\t */\n\t\tmakeFilterListSortable: function (container) {\n\t\t\tvar thisInstance = this;\n\t\t\tvar tbody = container.find('tbody');\n\n\t\t\tif (tbody.children().length > 1) {\n\t\t\t\ttbody.each(function () {\n\t\t\t\t\tjQuery(this).sortable({\n\t\t\t\t\t\tcontainment: 'tbody',\n\t\t\t\t\t\trevert: true,\n\t\t\t\t\t\ttolerance: 'pointer',\n\t\t\t\t\t\tcursor: 'move',\n\t\t\t\t\t\thelper: function (e, ui) {\n\t\t\t\t\t\t\t//while dragging helper elements td element will take width as contents width\n\t\t\t\t\t\t\t//so we are explicitly saying that it has to be same width so that element will not\n\t\t\t\t\t\t\t//look like disturbed\n\t\t\t\t\t\t\tui.children().each(function (index, element) {\n\t\t\t\t\t\t\t\telement = jQuery(element);\n\t\t\t\t\t\t\t\telement.width(element.width());\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\treturn ui;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tupdate: function (e, ui) {\n\t\t\t\t\t\t\tthisInstance.updateSequence();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Update sequences\n\t\t */\n\t\tupdateSequence: function () {\n\t\t\tvar sequences = [];\n\t\t\tthis.getContents()\n\t\t\t\t.find('.js-filter-row')\n\t\t\t\t.each(function (n, row) {\n\t\t\t\t\tvar cvId = $(row).data('cvid');\n\t\t\t\t\tsequences.push(cvId);\n\t\t\t\t});\n\t\t\tapp.saveAjax('upadteSequences', sequences).done(function (data) {\n\t\t\t\tif (data.success) {\n\t\t\t\t\tapp.showNotify({ text: data.result.message, type: 'success' });\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Load list of filter for module\n\t\t * @param {jQuery.Event} e\n\t\t */\n\t\tregisterFilterChange: function (e) {\n\t\t\tvar thisInstance = this;\n\t\t\tvar aDeferred = $.Deferred();\n\t\t\tvar progress = $.progressIndicator({\n\t\t\t\tmessage: app.vtranslate('JS_LOADING_PLEASE_WAIT'),\n\t\t\t\tblockInfo: {\n\t\t\t\t\tenabled: true\n\t\t\t\t}\n\t\t\t});\n\t\t\tvar params = {\n\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\tview: app.getViewName(),\n\t\t\t\tparent: app.getParentModuleName(),\n\t\t\t\tsourceModule: $(e.currentTarget).val()\n\t\t\t};\n\t\t\tAppConnector.requestPjax(params)\n\t\t\t\t.done(function (data) {\n\t\t\t\t\tvar contents = thisInstance.getContents().html(data);\n\t\t\t\t\tthisInstance.makeFilterListSortable(contents);\n\t\t\t\t\tthisInstance\n\t\t\t\t\t\t.getContainer()\n\t\t\t\t\t\t.find('.js-create-filter')\n\t\t\t\t\t\t.data('editurl', contents.find('#js-add-filter-url').val());\n\t\t\t\t\tprogress.progressIndicator({ mode: 'hide' });\n\t\t\t\t\taDeferred.resolve(data);\n\t\t\t\t})\n\t\t\t\t.fail(function (error) {\n\t\t\t\t\taDeferred.reject();\n\t\t\t\t});\n\t\t\treturn aDeferred.promise();\n\t\t},\n\t\tgetContainer: function () {\n\t\t\tif (this.container == false) {\n\t\t\t\tthis.container = jQuery('div.contentsDiv');\n\t\t\t}\n\t\t\treturn this.container;\n\t\t},\n\t\tgetContents: function () {\n\t\t\tif (this.contents == false) {\n\t\t\t\tthis.contents = this.getContainer().find('.indexContents');\n\t\t\t}\n\t\t\treturn this.contents;\n\t\t},\n\t\t/**\n\t\t * Main function\n\t\t */\n\t\tregisterEvents: function () {\n\t\t\tvar container = this.getContainer();\n\t\t\tthis.initEvents(container);\n\t\t\tthis.makeFilterListSortable(container);\n\t\t}\n\t}\n);\n"],"names":["jQuery","Class","container","contents","initEvents","_this","on","e","deleteFilter","updateField","update","registerFilterChange","target","$","currentTarget","editUrl","data","CustomView","thisInstance","closestTrElement","closest","progressIndicator","message","app","vtranslate","blockInfo","enabled","params","cvid","mod","name","attr","value","val","saveAjax","done","getContainer","find","trigger","makeFilterListSortable","tbody","children","length","each","sortable","containment","revert","tolerance","cursor","helper","ui","index","element","width","updateSequence","sequences","getContents","n","row","cvId","push","success","showNotify","text","result","type","aDeferred","Deferred","progress","module","getModuleName","view","getViewName","parent","getParentModuleName","sourceModule","AppConnector","requestPjax","html","mode","resolve","fail","reject","promise","registerEvents"],"mappings":"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"}