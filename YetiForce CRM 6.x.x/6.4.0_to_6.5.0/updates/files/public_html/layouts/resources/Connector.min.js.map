{"version":3,"file":"Connector.min.js","sources":["Connector.js"],"sourcesContent":["/*+***********************************************************************************\n * The contents of this file are subject to the vtiger CRM Public License Version 1.0\n * (\"License\"); You may not use this file except in compliance with the License\n * The Original Code is:  vtiger CRM Open Source\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n *************************************************************************************/\n'use strict';\n\nwindow.AppConnector = {\n\t/**\n\t * Sends a pjax request (push state +ajax)\n\t * The function is deferred. it will be resolved on success and error on failure\n\t *  Success - if request is success it will send you data that it recieved\n\t *  error - it will send two parameters first gives string regarding error\n\t *                   Second gives you error object if exists\n\t *\n\t *  @return - deferred promise\n\t */\n\trequestPjax: function (params) {\n\t\treturn AppConnector._request(params, true);\n\t},\n\n\t/**\n\t *  Sends ajax request to the specified url.\n\t *  The function is deferred. it will be resolved on success and error on failure\n\t *  Success - if request is success it will send you data that it recieved\n\t *  error - it will send two parameters first gives string regarding error\n\t *                   Second gives you error object if exists\n\t *\n\t *  @return - deferred promise\n\t */\n\trequest: function (params, rawData) {\n\t\treturn AppConnector._request(params, false, rawData);\n\t},\n\n\t_request: function (params, pjaxMode, rawData) {\n\t\tconst aDeferred = jQuery.Deferred();\n\t\tif (typeof rawData === 'undefined') {\n\t\t\trawData = false;\n\t\t}\n\t\tif (typeof pjaxMode === 'undefined') {\n\t\t\tpjaxMode = false;\n\t\t}\n\t\tif (typeof params === 'undefined') {\n\t\t\tparams = {};\n\t\t}\n\t\tlet fullUrl = '',\n\t\t\tindex,\n\t\t\tcallerParams;\n\t\t//caller has send only data\n\t\tif (typeof params.data === 'undefined' || rawData) {\n\t\t\tif (typeof params === 'string') {\n\t\t\t\tcallerParams = fullUrl = params;\n\t\t\t\tindex = callerParams.indexOf('?');\n\t\t\t\tif (index !== -1) {\n\t\t\t\t\tlet subStr = callerParams.substr(0, index + 1); //need to replace only \"index.php?\" or \"?\"\n\t\t\t\t\tcallerParams = callerParams.replace(subStr, '');\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tcallerParams = $.extend({}, params);\n\t\t\t}\n\t\t\tparams = {};\n\t\t\tparams.data = callerParams;\n\t\t}\n\t\t//Make the request as post by default\n\t\tif (typeof params.type === 'undefined' || rawData) params.type = 'POST';\n\t\tif (typeof params.jsonp === 'undefined' || rawData) params.jsonp = false;\n\n\t\t//By default we expect json from the server\n\t\tif (typeof params.dataType === 'undefined' || rawData) {\n\t\t\tlet data = params.data;\n\t\t\t//view will return html\n\t\t\tparams.dataType = 'json';\n\t\t\tif (data.hasOwnProperty('view')) {\n\t\t\t\tparams.dataType = 'html';\n\t\t\t} else if (typeof data === 'string' && data.indexOf('&view=') !== -1) {\n\t\t\t\tparams.dataType = 'html';\n\t\t\t}\n\t\t\tif (typeof params.url !== 'undefined' && params.url.indexOf('&view=') !== -1) {\n\t\t\t\tparams.dataType = 'html';\n\t\t\t}\n\t\t}\n\t\t//If url contains params then seperate them and make them as data\n\t\tif (typeof params.url !== 'undefined' && params.url.indexOf('?') !== -1) {\n\t\t\tfullUrl = params.url;\n\t\t\tlet urlSplit = params.url.split('?'),\n\t\t\t\tqueryString = urlSplit[1];\n\t\t\tparams.url = urlSplit[0];\n\t\t\tlet queryParameters = queryString.split('&');\n\t\t\tfor (index = 0; index < queryParameters.length; index++) {\n\t\t\t\tlet queryParam = queryParameters[index],\n\t\t\t\t\tqueryParamComponents = queryParam.split('=');\n\t\t\t\tparams.data[queryParamComponents[0]] = queryParamComponents[1];\n\t\t\t}\n\t\t}\n\t\tif (typeof params.url === 'undefined' || params.url.length <= 0) {\n\t\t\tparams.url = 'index.php';\n\t\t}\n\t\tparams.success = function (data, status, jqXHR) {\n\t\t\tif (data !== null && typeof data === 'object' && data.error) {\n\t\t\t\tapp.errorLog(data.error);\n\t\t\t\tif (data.error.message) {\n\t\t\t\t\tVtiger_Helper_Js.showMessage({\n\t\t\t\t\t\ttext: data.error.message,\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\taDeferred.resolve(data);\n\t\t};\n\t\tparams.error = function (jqXHR, textStatus, errorThrown) {\n\t\t\tlet action = jqXHR.getResponseHeader('yf-action');\n\t\t\tif (action === 'logout') {\n\t\t\t\twindow.location.href = 'index.php';\n\t\t\t}\n\t\t\tif (CONFIG.debug) {\n\t\t\t\tif (jqXHR.status === 406) {\n\t\t\t\t\tlet sep = '-'.repeat(150);\n\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t'%cYetiForce debug mode!!!',\n\t\t\t\t\t\t'color: red; font-family: sans-serif; font-size: 1.5em; font-weight: bolder; text-shadow: #000 1px 1px;'\n\t\t\t\t\t);\n\t\t\t\t\tconsole.error(\n\t\t\t\t\t\t'Error: ' + errorThrown,\n\t\t\t\t\t\t'\\n' + sep + '\\nTrace:\\n' + sep + '\\n' + (jqXHR.responseJSON ? jqXHR.responseJSON.error.trace : ''),\n\t\t\t\t\t\t'\\n' + sep + '\\nParams:\\n' + sep + '\\n' + JSON.stringify(params, null, '\\t')\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tapp.errorLog(jqXHR, textStatus, errorThrown);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (textStatus == 'error' && jqXHR.responseJSON) {\n\t\t\t\ttextStatus = jqXHR.responseJSON.error.message;\n\t\t\t}\n\t\t\taDeferred.reject(textStatus, errorThrown, jqXHR);\n\t\t};\n\t\tif (params.data === '') {\n\t\t\tapp.showNotify({ type: 'error', title: app.vtranslate('JS_ERROR') });\n\t\t\treturn aDeferred.reject();\n\t\t}\n\t\tjQuery.ajax(params);\n\t\tif (pjaxMode) {\n\t\t\tapp.changeUrl(params);\n\t\t}\n\t\treturn aDeferred.promise();\n\t},\n\t/**\n\t * Send form data\n\t * @param {string} url\n\t * @param {object} postData\n\t * @param {object} formAttr\n\t */\n\trequestForm: function (url, postData = {}, formAttr = {}) {\n\t\t$.extend(formAttr, {\n\t\t\tmethod: 'post',\n\t\t\taction: url,\n\t\t\tstyle: 'display:none;'\n\t\t});\n\t\tlet form = $('<form></form>', formAttr);\n\t\tif (typeof csrfMagicName !== 'undefined') {\n\t\t\tpostData[csrfMagicName] = csrfMagicToken;\n\t\t}\n\t\t$.each(postData, (index, value) => {\n\t\t\tlet isMultiple = typeof value === 'object' && value.length && index.slice(-2) === '[]';\n\t\t\tconst item = document.createElement(isMultiple ? 'select' : 'input');\n\n\t\t\titem.setAttribute('type', 'hidden');\n\t\t\titem.setAttribute('name', index);\n\n\t\t\tif (isMultiple) {\n\t\t\t\titem.setAttribute('multiple', 'multiple');\n\t\t\t\tfor (let i in value) {\n\t\t\t\t\tlet option = document.createElement('option');\n\t\t\t\t\toption.setAttribute('value', value[i]);\n\t\t\t\t\toption.setAttribute('selected', true);\n\t\t\t\t\titem.appendChild(option);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\titem.setAttribute('value', value);\n\t\t\t}\n\t\t\tform.append(item);\n\t\t});\n\t\t$('body').append(form);\n\t\tform.trigger('submit');\n\t\tform.remove();\n\t}\n};\n"],"names":["_typeof","o","Symbol","iterator","constructor","prototype","window","AppConnector","requestPjax","params","_request","request","rawData","pjaxMode","aDeferred","jQuery","Deferred","index","callerParams","fullUrl","data","$","extend","indexOf","subStr","substr","replace","type","jsonp","dataType","hasOwnProperty","url","urlSplit","split","queryString","queryParameters","length","queryParam","queryParamComponents","success","error","app","errorLog","message","Vtiger_Helper_Js","showMessage","text","resolve","jqXHR","textStatus","errorThrown","action","getResponseHeader","location","href","CONFIG","debug","status","repeat","console","warn","responseJSON","trace","JSON","stringify","reject","showNotify","title","vtranslate","ajax","changeUrl","promise","requestForm","postData","arguments","formAttr","method","style","form","csrfMagicName","csrfMagicToken","each","value","isMultiple","slice","item","document","createElement","setAttribute","i","option","appendChild","append","trigger","remove"],"mappings":"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"}