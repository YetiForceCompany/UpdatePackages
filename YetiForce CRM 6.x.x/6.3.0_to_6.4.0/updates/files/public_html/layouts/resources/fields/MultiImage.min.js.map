{"version":3,"file":"MultiImage.min.js","sources":["MultiImage.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 5.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\nclass MultiImage {\n\t/**\n\t * Create class instance\n\t *\n\t * @param {HTMLElement|jQuery} inputElement - input type file element inside component\n\t */\n\tconstructor(element) {\n\t\tconst thisInstance = this;\n\t\tthis.elements = {};\n\t\tthis.options = {\n\t\t\tshowCarousel: true\n\t\t};\n\t\tthis.detailView = false;\n\t\tthis.elements.fileInput = element.find('.js-multi-image__file').eq(0);\n\t\tif (this.elements.fileInput.length === 0) {\n\t\t\tthis.detailView = true;\n\t\t}\n\t\tthis.elements.component = element.eq(0);\n\t\tthis.elements.form = element.closest('form').eq(0);\n\t\t$(this.elements.form).on('submit', this.onFormSubmit);\n\t\tthis.elements.addButton = this.elements.component.find('.js-multi-image__file-btn').eq(0);\n\t\tthis.elements.values = this.elements.component.find('.js-multi-image__values').eq(0);\n\t\tthis.elements.progressBar = this.elements.component.find('.js-multi-image__progress-bar').eq(0);\n\t\tthis.elements.progress = this.elements.component.find('.js-multi-image__progress').eq(0);\n\t\tthis.elements.result = this.elements.component.find('.js-multi-image__result').eq(0);\n\t\tthis.fieldInfo = this.elements.values.data('fieldinfo');\n\t\tthis.options.formats = this.fieldInfo.formats;\n\t\tthis.options.limit = this.fieldInfo.limit;\n\t\tthis.options.maxFileSize = this.fieldInfo.maxFileSize || CONFIG.maxUploadLimit;\n\t\tthis.options.maxFileSizeDisplay = this.fieldInfo.maxFileSizeDisplay || '';\n\t\tif (!this.detailView) {\n\t\t\tthis.files = JSON.parse(this.elements.values.val());\n\t\t} else {\n\t\t\tthis.files = this.elements.values.data('value');\n\t\t}\n\t\tif (!this.detailView) {\n\t\t\tthis.elements.fileInput.detach();\n\t\t\tthis.elements.addButton.click(this.addButtonClick.bind(this));\n\t\t\tthis.elements.fileInput.fileupload({\n\t\t\t\tdataType: 'json',\n\t\t\t\treplaceFileInput: false,\n\t\t\t\tfileInput: this.fileInput,\n\t\t\t\tautoUpload: false,\n\t\t\t\tsubmit: this.submit.bind(this),\n\t\t\t\tadd: this.add.bind(this),\n\t\t\t\tprogressall: this.progressAll.bind(this),\n\t\t\t\tchange: this.change.bind(this),\n\t\t\t\tdrop: this.change.bind(this),\n\t\t\t\tdragover: this.dragOver.bind(this),\n\t\t\t\tfail: this.uploadError.bind(this),\n\t\t\t\tdone: this.uploadSuccess.bind(this)\n\t\t\t});\n\t\t\tthis.elements.component.on('dragleave', this.dragLeave.bind(this));\n\t\t\tthis.elements.component.on('dragend', this.dragLeave.bind(this));\n\t\t\tthis.elements.fileInput.fileupload('option', 'dropZone', $(this.elements.component));\n\t\t\tthis.enableDragNDrop();\n\t\t}\n\t\tthis.elements.component.on('click', '.js-multi-image__popover-img', function () {\n\t\t\tthisInstance.zoomPreview($(this).data('hash'));\n\t\t});\n\t\tthis.elements.component.on('click', '.js-multi-image__popover-btn-zoom', function (e) {\n\t\t\te.preventDefault();\n\t\t\tthisInstance.zoomPreview($(this).data('hash'));\n\t\t});\n\t\tthis.elements.component.on('click', '.js-multi-image__popover-btn-download', function (e) {\n\t\t\te.preventDefault();\n\t\t\tthisInstance.download($(this).data('hash'));\n\t\t});\n\t\tif (!this.detailView) {\n\t\t\tthis.elements.component.on('click', '.js-multi-image__popover-btn-delete', function (e) {\n\t\t\t\te.preventDefault();\n\t\t\t\tthisInstance.deleteFile($(this).data('hash'));\n\t\t\t});\n\t\t}\n\t\tthis.loadExistingFiles();\n\t}\n\n\t/**\n\t * Prevent form submission before file upload end\n\t * @param e\n\t */\n\tonFormSubmit(e) {\n\t\tif (App.Fields.MultiImage.currentFileUploads) {\n\t\t\te.preventDefault();\n\t\t\te.stopPropagation();\n\t\t\te.stopImmediatePropagation();\n\t\t\tapp.showAlert(app.vtranslate('JS_WAIT_FOR_FILE_UPLOAD'));\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\t/**\n\t * Prevent form submission\n\t *\n\t * @param {Event} e\n\t */\n\taddButtonClick(e) {\n\t\te.preventDefault();\n\t\tthis.elements.fileInput.trigger('click');\n\t}\n\n\t/**\n\t * Submit event handler from jQuery-file-upload\n\t *\n\t * @param {Event} e\n\t * @param {Object} data\n\t */\n\tsubmit(_e, data) {\n\t\tdata.formData = {\n\t\t\thash: data.files[0].hash\n\t\t};\n\t\tApp.Fields.MultiImage.currentFileUploads++;\n\t\tthis.progressInstance = $.progressIndicator({\n\t\t\tposition: 'replace',\n\t\t\tblockInfo: {\n\t\t\t\tenabled: true,\n\t\t\t\telementToBlock: this.elements.component\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Get file information\n\t *\n\t * @param {String} hash - file id\n\t * @returns {Object}\n\t */\n\tgetFileInfo(hash) {\n\t\tfor (let i = 0, len = this.files.length; i < len; i++) {\n\t\t\tconst file = this.files[i];\n\t\t\tif (file.hash === hash) {\n\t\t\t\treturn file;\n\t\t\t}\n\t\t}\n\t\tapp.errorLog(`File '${hash}' not found.`);\n\t\tapp.showNotify({\n\t\t\ttext: app.vtranslate('JS_INVALID_FILE_HASH') + ` [${hash}]`,\n\t\t\ttype: 'error'\n\t\t});\n\t}\n\n\t/**\n\t * Add property to file info object\n\t *\n\t * @param {String} hash - file id\n\t * @param {String} propertyName\n\t * @param {any} value\n\t * @returns {Object}\n\t */\n\taddFileInfoProperty(hash, propertyName, value) {\n\t\tconst fileInfo = this.getFileInfo(hash);\n\t\tfileInfo[propertyName] = value;\n\t\treturn fileInfo;\n\t}\n\n\t/**\n\t * Error event handler from file upload request\n\t *\n\t * @param {Event} e\n\t * @param {Object} data\n\t */\n\tuploadError(_e, data) {\n\t\tthis.progressInstance.progressIndicator({ mode: 'hide' });\n\t\tapp.errorLog('File upload error.');\n\t\tconst { jqXHR, files } = data;\n\t\tconst response = jqXHR.responseJSON;\n\t\t// first try to show error for concrete file\n\t\tif (\n\t\t\tresponse !== null &&\n\t\t\ttypeof response !== 'undefined' &&\n\t\t\ttypeof response.result !== 'undefined' &&\n\t\t\ttypeof response.result.attach !== 'undefined' &&\n\t\t\tArray.isArray(response.result.attach)\n\t\t) {\n\t\t\tresponse.result.attach.forEach((fileAttach) => {\n\t\t\t\tApp.Fields.MultiImage.currentFileUploads--;\n\t\t\t\tthis.deleteFile(fileAttach.hash, false);\n\t\t\t\tif (typeof fileAttach.error === 'string') {\n\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\ttextTrusted: false,\n\t\t\t\t\t\ttext: fileAttach.error,\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\ttextTrusted: false,\n\t\t\t\t\t\ttitle: app.vtranslate('JS_FILE_UPLOAD_ERROR'),\n\t\t\t\t\t\ttext: fileAttach.name,\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.updateFormValues();\n\t\t\treturn;\n\t\t}\n\t\t// else show default upload error\n\t\tfiles.forEach((file) => {\n\t\t\tApp.Fields.MultiImage.currentFileUploads--;\n\t\t\tthis.deleteFile(file.hash, false);\n\t\t\tapp.showNotify({\n\t\t\t\ttextTrusted: false,\n\t\t\t\ttitle: app.vtranslate('JS_FILE_UPLOAD_ERROR'),\n\t\t\t\ttext: file.name,\n\t\t\t\ttype: 'error'\n\t\t\t});\n\t\t});\n\t\tthis.updateFormValues();\n\t}\n\n\t/**\n\t * Success event handler from file upload request\n\t *\n\t * @param {Event} e\n\t * @param {Object} data\n\t */\n\tuploadSuccess(e, data) {\n\t\tthis.progressInstance.progressIndicator({ mode: 'hide' });\n\t\tconst { result } = data;\n\t\tconst attach = result.result.attach;\n\t\tattach.forEach((fileAttach) => {\n\t\t\tconst hash = fileAttach.hash;\n\t\t\tif (!hash) {\n\t\t\t\treturn app.errorLog(new Error(app.vtranslate('JS_INVALID_FILE_HASH')));\n\t\t\t}\n\t\t\tif (typeof fileAttach.key === 'undefined') {\n\t\t\t\treturn this.uploadError(e, data);\n\t\t\t}\n\t\t\tif (typeof fileAttach.info !== 'undefined' && fileAttach.info) {\n\t\t\t\tapp.showNotify({\n\t\t\t\t\ttextTrusted: false,\n\t\t\t\t\ttype: 'notice',\n\t\t\t\t\ttitle: fileAttach.info,\n\t\t\t\t\ttext: fileAttach.name\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst fileInfo = this.getFileInfo(hash);\n\t\t\tthis.addFileInfoProperty(hash, 'key', fileAttach.key);\n\t\t\tthis.addFileInfoProperty(hash, 'size', fileAttach.size);\n\t\t\tthis.addFileInfoProperty(hash, 'sizeDisplay', fileAttach.sizeDisplay || fileAttach.size);\n\t\t\tthis.addFileInfoProperty(hash, 'name', fileAttach.name);\n\t\t\tthis.addFileInfoProperty(hash, 'type', fileAttach.type || '');\n\t\t\tthis.generatePreviewFromFile(fileInfo.file, (template, imageSrc) => {\n\t\t\t\tthis.addFileInfoProperty(hash, 'previewElement', this.addPreviewPopover(fileInfo, template, imageSrc));\n\t\t\t\tthis.redraw();\n\t\t\t});\n\t\t\tApp.Fields.MultiImage.currentFileUploads--;\n\t\t});\n\t\tthis.updateFormValues();\n\t}\n\n\t/**\n\t * Update form input values\n\t */\n\tupdateFormValues() {\n\t\tthis.elements.fileInput.val(null);\n\t\tconst formValues = this.files.map((file) => {\n\t\t\treturn { key: file.key, name: file.name, size: file.size, type: file.type || '' };\n\t\t});\n\t\tthis.elements.values.val(JSON.stringify(formValues));\n\t}\n\n\t/**\n\t * Validate file\n\t *\n\t * @param {Object} file\n\t * @returns {boolean}\n\t */\n\tvalidateFormat(file) {\n\t\tlet valid = false;\n\t\tthis.options.formats.forEach((format) => {\n\t\t\tif (file.type === 'image/' + format) {\n\t\t\t\tvalid = true;\n\t\t\t}\n\t\t});\n\t\tif (!valid) {\n\t\t\tapp.showNotify({\n\t\t\t\ttitle: `${app.vtranslate('JS_INVALID_FILE_TYPE')}`,\n\t\t\t\ttext: `${app.vtranslate('JS_AVAILABLE_FILE_TYPES')}: ${this.options.formats.join(', ')}`,\n\t\t\t\ttype: 'error'\n\t\t\t});\n\t\t}\n\t\treturn valid;\n\t}\n\n\t/**\n\t * Validate maximum file size\n\t * @param {Object} file\n\t * @returns {Boolean}\n\t */\n\tvalidateSize(file) {\n\t\tlet result = typeof file.size === 'number' && file.size < this.options.maxFileSize;\n\t\tif (!result) {\n\t\t\tapp.showNotify({\n\t\t\t\ttext: `${app.vtranslate('JS_UPLOADED_FILE_SIZE_EXCEEDS')} <br> [${this.options.maxFileSizeDisplay}]`,\n\t\t\t\ttype: 'error'\n\t\t\t});\n\t\t}\n\t\treturn result;\n\t}\n\n\t/**\n\t * Show limit error\n\t */\n\tshowLimitError() {\n\t\tthis.elements.fileInput.val('');\n\t\tapp.showNotify({\n\t\t\ttext: `${app.vtranslate('JS_FILE_LIMIT')} [${this.options.limit}]`,\n\t\t\ttype: 'error'\n\t\t});\n\t}\n\n\t/**\n\t * Get only valid files from list\n\t *\n\t * @param {Array} files\n\t * @returns {Array}\n\t */\n\tfilterValidFiles(files) {\n\t\tif (files.length + this.files.length > this.options.limit) {\n\t\t\tthis.showLimitError();\n\t\t\treturn [];\n\t\t}\n\t\treturn files.filter((file) => {\n\t\t\treturn this.validateFormat(file) && this.validateSize(file);\n\t\t});\n\t}\n\n\t/**\n\t * Set files hash\n\t * @param {Array} files\n\t * @returns {Array}\n\t */\n\tsetFilesHash(files) {\n\t\tconst addedFiles = [];\n\t\tfor (let i = 0, len = files.length; i < len; i++) {\n\t\t\tconst file = files[i];\n\t\t\tif (typeof file.hash === 'undefined') {\n\t\t\t\tif (this.files.length < this.options.limit) {\n\t\t\t\t\tfile.hash = App.Fields.Text.generateRandomHash(CONFIG.userId);\n\t\t\t\t\tthis.files.push({ hash: file.hash, imageSrc: file.imageSrc, name: file.name, file });\n\t\t\t\t\taddedFiles.push(file);\n\t\t\t\t} else {\n\t\t\t\t\tthis.showLimitError();\n\t\t\t\t\treturn addedFiles;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn addedFiles;\n\t}\n\n\t/**\n\t * Add event handler from jQuery-file-upload\n\t *\n\t * @param {Event} e\n\t * @param {object} data\n\t */\n\tadd(_e, data) {\n\t\tif (data.files.length > 0) {\n\t\t\tdata.submit();\n\t\t}\n\t}\n\n\t/**\n\t * Progressall event handler from jQuery-file-upload\n\t *\n\t * @param {Event} e\n\t * @param {Object} data\n\t */\n\tprogressAll(_e, data) {\n\t\tconst progress = parseInt((data.loaded / data.total) * 100, 10);\n\t\tthis.elements.progressBar.css({ width: progress + '%' });\n\t\tif (progress === 100) {\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.elements.progress.addClass('d-none');\n\t\t\t\tthis.elements.progressBar.css({ width: '0%' });\n\t\t\t}, 1000);\n\t\t} else {\n\t\t\tthis.elements.progress.removeClass('d-none');\n\t\t}\n\t}\n\n\t/**\n\t * Dragover event handler from jQuery-file-upload\n\t *\n\t * @param {Event} e\n\t */\n\tdragOver(_e) {\n\t\tthis.elements.component.addClass('c-multi-image__drop-effect');\n\t}\n\n\t/**\n\t * Dragleave event handler\n\t * @param {Event} e\n\t */\n\tdragLeave(_e) {\n\t\tthis.elements.component.removeClass('c-multi-image__drop-effect');\n\t}\n\n\t/**\n\t * Download file according to source type (base64/file from server)\n\t *\n\t * @param {String} hash\n\t */\n\tdownload(hash) {\n\t\tconst fileInfo = this.getFileInfo(hash);\n\t\tif (fileInfo.imageSrc.substr(0, 8).toLowerCase() === 'file.php') {\n\t\t\treturn this.downloadFile(hash);\n\t\t} else {\n\t\t\treturn this.downloadBase64(hash);\n\t\t}\n\t}\n\n\t/**\n\t * Download file that exists on the server already\n\t * @param {String} hash\n\t */\n\tdownloadFile(hash) {\n\t\tconst fileInfo = this.getFileInfo(hash);\n\t\tconst link = document.createElement('a');\n\t\t$(link).css('display', 'none');\n\t\tif (typeof link.download === 'string') {\n\t\t\tdocument.body.appendChild(link); // Firefox requires the link to be in the body\n\t\t\tlink.download = fileInfo.name;\n\t\t\tlink.href = fileInfo.imageSrc;\n\t\t\tlink.click();\n\t\t\tdocument.body.removeChild(link); // remove the link when done\n\t\t} else {\n\t\t\tlocation.replace(fileInfo.imageSrc);\n\t\t}\n\t}\n\n\t/**\n\t * Download file from base64 image\n\t *\n\t * @param {String} hash\n\t */\n\tdownloadBase64(hash) {\n\t\tconst fileInfo = this.getFileInfo(hash);\n\t\tconst imageUrl =\n\t\t\t`data:application/octet-stream;filename=${fileInfo.name};base64,` + fileInfo.imageSrc.split(',')[1];\n\t\tconst link = document.createElement('a');\n\t\t$(link).css('display', 'none');\n\t\tif (typeof link.download === 'string') {\n\t\t\tdocument.body.appendChild(link); // Firefox requires the link to be in the body\n\t\t\tlink.download = fileInfo.name;\n\t\t\tlink.href = imageUrl;\n\t\t\tlink.click();\n\t\t\tdocument.body.removeChild(link); // remove the link when done\n\t\t} else {\n\t\t\tlocation.replace(imageUrl);\n\t\t}\n\t}\n\n\t/**\n\t * Display modal window with large preview\n\t *\n\t * @param {string} hash\n\t */\n\tzoomPreview(hash) {\n\t\tconst self = this;\n\t\tlet fileInfo = this.getFileInfo(hash);\n\t\tconst titleTemplate = () => {\n\t\t\tconst titleObject = document.createElement('span');\n\t\t\tconst icon = document.createElement('i');\n\t\t\ticon.setAttribute('class', `fa fa-image`);\n\t\t\ttitleObject.appendChild(icon);\n\t\t\ttitleObject.appendChild(document.createTextNode(` ${fileInfo.name}`));\n\t\t\treturn titleObject.innerHTML;\n\t\t};\n\n\t\tlet buttons = [];\n\t\tif (!self.detailView) {\n\t\t\tbuttons.push({\n\t\t\t\ttext: app.vtranslate('JS_DELETE'),\n\t\t\t\ticon: 'fa fa-trash-alt',\n\t\t\t\tclass: 'float-left btn btn-danger js-delete'\n\t\t\t});\n\t\t}\n\t\tbuttons.push(\n\t\t\t{\n\t\t\t\ttext: app.vtranslate('JS_DOWNLOAD'),\n\t\t\t\ticon: 'fa fa-download',\n\t\t\t\tclass: 'float-left btn btn-success js-success'\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: app.vtranslate('JS_CLOSE'),\n\t\t\t\ticon: 'fa fa-times',\n\t\t\t\tclass: 'btn btn-warning',\n\t\t\t\tdata: { dismiss: 'modal' }\n\t\t\t}\n\t\t);\n\t\tapp.showModalHtml({\n\t\t\tclass: 'modal-lg',\n\t\t\theader: titleTemplate(),\n\t\t\tfooterButtons: buttons,\n\t\t\tbody: self.options.showCarousel\n\t\t\t\t? self.generateCarousel(hash)\n\t\t\t\t: `<img src=\"${fileInfo.imageSrc}\" class=\"w-100\" />`,\n\t\t\tcb: (modal) => {\n\t\t\t\tmodal.on('click', '.js-delete', function () {\n\t\t\t\t\tself.deleteFile(fileInfo.hash);\n\t\t\t\t\tapp.hideModalWindow();\n\t\t\t\t});\n\t\t\t\tmodal.on('click', '.js-success', function () {\n\t\t\t\t\tself.download(fileInfo.hash);\n\t\t\t\t\tapp.hideModalWindow();\n\t\t\t\t});\n\t\t\t\tif (self.options.showCarousel) {\n\t\t\t\t\tmodal.find(`#carousel-${hash}`).on('slid.bs.carousel', (e) => {\n\t\t\t\t\t\tfileInfo = self.getFileInfo($(e.relatedTarget).data('hash'));\n\t\t\t\t\t\tmodal.find('.js-modal-title').html(titleTemplate());\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Remove file from preview and from file list\n\t *\n\t * @param {String} hash\n\t */\n\tdeleteFileCallback(hash) {\n\t\tconst fileInfo = this.getFileInfo(hash);\n\t\tif (fileInfo.previewElement) {\n\t\t\tfileInfo.previewElement.popover('dispose').remove();\n\t\t}\n\t\tthis.files = this.files.filter((file) => file.hash !== fileInfo.hash);\n\t\tthis.updateFormValues();\n\t}\n\n\t/**\n\t * Delete image from input field\n\t * Should be called with this pointing on button element with data-hash attribute\n\t *\n\t * @param {string} hash\n\t * @param {boolean} showConfirmation - dialog?\n\t */\n\tdeleteFile(hash, showConfirmation = true) {\n\t\tif (showConfirmation) {\n\t\t\tconst fileInfo = this.getFileInfo(hash);\n\t\t\tapp.showConfirmModal({\n\t\t\t\ttitle: fileInfo.name,\n\t\t\t\ttext: app.vtranslate('JS_DELETE_FILE_CONFIRMATION'),\n\t\t\t\ttitleTrusted: false,\n\t\t\t\ticon: 'fa fa-trash-alt',\n\t\t\t\tconfirmedCallback: () => {\n\t\t\t\t\tthis.deleteFileCallback(hash);\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tthis.deleteFileCallback(hash);\n\t\t}\n\t}\n\n\t/**\n\t * File change event handler from jQuery-file-upload\n\t *\n\t * @param {Event} e\n\t * @param {object} data\n\t */\n\tchange(e, data) {\n\t\tdata.files = this.filterValidFiles(data.files);\n\t\tdata.files = this.setFilesHash(data.files);\n\t\tthis.dragLeave(e);\n\t}\n\n\t/**\n\t * Generate and apply popover to preview\n\t *\n\t * @param {File} file\n\t * @param {string} template\n\t * @param {string} imageSrc\n\t * @returns {jQuery}\n\t */\n\taddPreviewPopover(file, template, imageSrc) {\n\t\tconst thisInstance = this;\n\t\tlet fileSize = '';\n\t\tconst fileInfo = this.getFileInfo(file.hash);\n\t\tlet size = fileInfo.sizeDisplay || fileInfo.size;\n\t\tif (size) {\n\t\t\tfileSize = `<div class=\"p-1 bg-white border rounded small position-absolute\">${size}</div>`;\n\t\t}\n\t\tlet deleteBtn = '';\n\t\tif (!this.detailView) {\n\t\t\tdeleteBtn = `<button class=\"btn btn-sm btn-danger c-btn-collapsible js-multi-image__popover-btn-delete\" type=\"button\" data-hash=\"${\n\t\t\t\tfile.hash\n\t\t\t}\" data-js=\"click\"><i class=\"fa fa-trash-alt\"></i> <span class=\"c-btn-collapsible__text\">${app.vtranslate(\n\t\t\t\t'JS_DELETE'\n\t\t\t)}</span></button>`;\n\t\t}\n\n\t\tconst titleObject = document.createElement('span');\n\t\ttitleObject.appendChild(document.createTextNode(fileInfo.name));\n\n\t\treturn $(template).popover({\n\t\t\tcontainer: thisInstance.elements.component,\n\t\t\ttitle: `<div class=\"u-text-ellipsis\"><i class=\"fa fa-image\"></i> ` + titleObject.innerHTML + `</div>`,\n\t\t\thtml: true,\n\t\t\tsanitize: false,\n\t\t\ttrigger: 'focus',\n\t\t\tplacement: 'top',\n\t\t\tcontent: `<img src=\"${imageSrc}\" class=\"w-100 js-multi-image__popover-img c-multi-image__popover-img\" data-hash=\"${file.hash}\" data-js=\"click\"/>`,\n\t\t\ttemplate: `<div class=\"popover\" role=\"tooltip\">\n\t\t\t\t<div class=\"arrow\"></div>\n\t\t\t\t<h3 class=\"popover-header\"></h3>\n\t\t\t\t<div class=\"popover-body\"></div>\n\t\t\t\t<div class=\"text-right popover-footer js-multi-image__popover-actions\">\n\t\t\t\t\t${fileSize}\n\t\t\t\t\t${deleteBtn}\n\t\t\t\t\t<button class=\"btn btn-sm btn-success c-btn-collapsible js-multi-image__popover-btn-download\" type=\"button\" data-hash=\"${\n\t\t\t\t\t\tfile.hash\n\t\t\t\t\t}\" data-js=\"click\"><i class=\"fa fa-download\"></i> <span class=\"c-btn-collapsible__text\">${app.vtranslate(\n\t\t\t\t'JS_DOWNLOAD'\n\t\t\t)}</span></button>\n\t\t\t\t\t<button class=\"btn btn-sm btn-primary c-btn-collapsible js-multi-image__popover-btn-zoom\" type=\"button\" data-hash=\"${\n\t\t\t\t\t\tfile.hash\n\t\t\t\t\t}\" data-js=\"click\"><i class=\"fa fa-search-plus\"></i> <span class=\"c-btn-collapsible__text\">${app.vtranslate(\n\t\t\t\t'JS_ZOOM_IN'\n\t\t\t)}</span></button>\n\t\t\t\t</div>\n\t\t\t</div>`\n\t\t});\n\t}\n\n\t/**\n\t * Remove preview popover\n\t *\n\t * @param {String} hash\n\t */\n\tremovePreviewPopover(hash) {\n\t\tconst fileInfo = this.getFileInfo(hash);\n\t\tif (typeof fileInfo.previewElement !== 'undefined') {\n\t\t\tfileInfo.previewElement.popover('dispose');\n\t\t}\n\t}\n\n\t/**\n\t * Hide popovers when user starts moving file preview\n\t *\n\t * @param {Event} e\n\t * @param {Object} ui\n\t */\n\tsortOver(_e, _ui) {\n\t\tthis.elements.result.find('.js-multi-image__preview').popover('hide');\n\t}\n\n\t/**\n\t * Update file position according to elements order\n\t *\n\t * @param {Event} e\n\t * @param {Object} ui\n\t */\n\tsortStop(_e, _ui) {\n\t\tconst actualElements = this.elements.result.find('.js-multi-image__preview').toArray();\n\t\tthis.files = actualElements.map((element) => {\n\t\t\tfor (let i = 0, len = this.files.length; i < len; i++) {\n\t\t\t\tconst elementHash = $(element).data('hash');\n\t\t\t\tif (this.files[i].hash === elementHash) {\n\t\t\t\t\treturn this.files[i];\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.redraw();\n\t}\n\n\t/**\n\t * Redraw view according to in-memory positions\n\t */\n\tredraw() {\n\t\tthis.files.forEach((file) => {\n\t\t\tthis.elements.result.append(file.previewElement);\n\t\t});\n\t\tthis.updateFormValues();\n\t}\n\n\t/**\n\t * Enable drag and drop files repositioning\n\t */\n\tenableDragNDrop() {\n\t\tthis.elements.result\n\t\t\t.sortable({\n\t\t\t\thandle: '.js-multi-image__preview-img',\n\t\t\t\titems: '.js-multi-image__preview',\n\t\t\t\tover: this.sortOver.bind(this),\n\t\t\t\tstop: this.sortStop.bind(this)\n\t\t\t})\n\t\t\t.disableSelection()\n\t\t\t.on('mousedown', '.js-multi-image__preview-img', function () {\n\t\t\t\tthis.focus(); // focus to show popover\n\t\t\t});\n\t}\n\n\t/**\n\t * Generate preview of images and append to multi image results view\n\t *\n\t * @param {Array} files - array of Files\n\t * @param {function} callback\n\t */\n\tgeneratePreviewElements(files, callback) {\n\t\tlet preview = (file, template, imageSrc) => {\n\t\t\tfile.preview = this.addPreviewPopover(file, template, imageSrc);\n\t\t\tthis.addFileInfoProperty(file.hash, 'previewElement', file.preview);\n\t\t\tcallback(file.preview);\n\t\t};\n\t\tfiles.forEach((file) => {\n\t\t\tif (file instanceof File) {\n\t\t\t\tthis.generatePreviewFromFile(file, (template, imageSrc) => {\n\t\t\t\t\tpreview(file, template, imageSrc);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.generatePreviewFromValue(file, (template, imageSrc) => {\n\t\t\t\t\tpreview(file, template, imageSrc);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Generate preview of image as html string\n\t *\n\t * @param {File} file\n\t * @param {function} callback\n\t */\n\tgeneratePreviewFromFile(file, callback) {\n\t\tconst fr = new FileReader();\n\t\tfr.onload = () => {\n\t\t\tfile.imageSrc = fr.result;\n\t\t\tthis.addFileInfoProperty(file.hash, 'imageSrc', file.imageSrc);\n\t\t\tcallback(this.createPreview(file), fr.result);\n\t\t};\n\t\tfr.readAsDataURL(file);\n\t}\n\n\t/**\n\t * Generate preview of image as html string from existing values\n\t *\n\t * @param {File} file\n\t * @param {function} callback\n\t */\n\tgeneratePreviewFromValue(file, callback) {\n\t\tcallback(this.createPreview(file), file.imageSrc);\n\t}\n\t/**\n\t * Create Preview element\n\t * @param {Object} file\n\t * @returns {String}\n\t */\n\tcreatePreview(file) {\n\t\tconst container = document.createElement('div');\n\t\tconst item = document.createElement('div');\n\t\titem.setAttribute('class', 'd-inline-block mr-1 js-multi-image__preview');\n\t\titem.setAttribute('id', `js-multi-image__preview-hash-${file.hash}`);\n\t\titem.setAttribute('data-hash', file.hash);\n\n\t\tconst subElement = document.createElement('div');\n\t\tsubElement.setAttribute('class', 'img-thumbnail js-multi-image__preview-img c-multi-image__preview-img');\n\t\tsubElement.setAttribute('data-hash', file.hash);\n\t\tsubElement.setAttribute('style', `background-image:url(${file.imageSrc})`);\n\t\tsubElement.setAttribute('tabindex', '0');\n\t\tsubElement.setAttribute('title', file.name);\n\t\titem.appendChild(subElement);\n\t\tcontainer.appendChild(item);\n\n\t\treturn container.innerHTML;\n\t}\n\n\t/**\n\t * Load files that were in valueInput as json string\n\t */\n\tloadExistingFiles() {\n\t\tthis.files = this.files\n\t\t\t.map((file) => {\n\t\t\t\tfile.hash = App.Fields.Text.generateRandomHash(CONFIG.userId);\n\t\t\t\treturn file;\n\t\t\t})\n\t\t\t.slice(0, this.options.limit);\n\t\tthis.generatePreviewElements(this.files, (element) => {\n\t\t\tthis.elements.result.append(element);\n\t\t});\n\t\tthis.updateFormValues();\n\t}\n\n\t/**\n\t * Generate carousel for all files in large preview\n\t *\n\t * @param {String} hash\n\t */\n\tgenerateCarousel(hash) {\n\t\tif (this.files.length <= 1) {\n\t\t\tconst fileInfo = this.getFileInfo(hash);\n\t\t\treturn `<img class=\"d-block w-100\" src=\"${fileInfo.imageSrc}\">`;\n\t\t}\n\t\tlet template = `<div id=\"carousel-${hash}\" class=\"carousel slide c-carousel\" data-ride=\"carousel\" data-js=\"container\">\n\t\t  <div class=\"carousel-inner\">`;\n\t\tthis.files.forEach((file) => {\n\t\t\ttemplate += `<div class=\"carousel-item c-carousel__item`;\n\t\t\tif (file.hash === hash) {\n\t\t\t\ttemplate += ` active`;\n\t\t\t}\n\t\t\ttemplate += `\" data-hash=\"${file.hash}\">\n\t\t      <img class=\"d-block w-100 c-carousel__image\" src=\"${file.imageSrc}\">\n\t\t    </div>`;\n\t\t});\n\t\ttemplate += `<a class=\"carousel-control-prev c-carousel__prevnext-btn c-carousel__prev-btn\" href=\"#carousel-${hash}\" role=\"button\" data-slide=\"prev\" data-js=\"click\">\n\t\t    <span class=\"fas fa-caret-left fa-2x c-carousel__prev-icon mr-1\" aria-hidden=\"true\"></span>\n\t\t  </a>\n\t\t  <a class=\"carousel-control-next c-carousel__prevnext-btn c-carousel__next-btn\" href=\"#carousel-${hash}\" role=\"button\" data-slide=\"next\" data-js=\"click\">\n\t\t    <span class=\"fas fa-caret-right fa-2x c-carousel__next-icon ml-1\" aria-hidden=\"true\"></span>\n\t\t  </a>\n\t\t</div>`;\n\t\treturn template;\n\t}\n}\n"],"names":["MultiImage","element","elements","options","showCarousel","detailView","fileInput","find","eq","length","component","form","closest","$","on","onFormSubmit","addButton","values","progressBar","progress","result","fieldInfo","data","formats","limit","maxFileSize","CONFIG","maxUploadLimit","maxFileSizeDisplay","files","JSON","parse","val","detach","click","addButtonClick","bind","fileupload","dataType","replaceFileInput","autoUpload","submit","add","progressall","progressAll","change","drop","dragover","dragOver","fail","uploadError","done","uploadSuccess","dragLeave","enableDragNDrop","thisInstance","zoomPreview","e","preventDefault","download","deleteFile","loadExistingFiles","App","Fields","currentFileUploads","stopPropagation","stopImmediatePropagation","app","showAlert","vtranslate","trigger","_e","formData","hash","progressInstance","progressIndicator","position","blockInfo","enabled","elementToBlock","i","len","file","errorLog","showNotify","text","type","propertyName","value","fileInfo","getFileInfo","mode","jqXHR","response","responseJSON","attach","Array","isArray","forEach","fileAttach","error","textTrusted","title","name","updateFormValues","key","info","addFileInfoProperty","size","sizeDisplay","generatePreviewFromFile","template","imageSrc","addPreviewPopover","redraw","map","stringify","formValues","format","valid","join","showLimitError","filter","validateFormat","validateSize","addedFiles","Text","generateRandomHash","userId","push","parseInt","loaded","total","css","width","setTimeout","addClass","removeClass","substr","toLowerCase","downloadFile","downloadBase64","link","document","createElement","body","appendChild","href","removeChild","location","replace","imageUrl","split","titleTemplate","icon","setAttribute","titleObject","createTextNode","innerHTML","buttons","self","class","dismiss","showModalHtml","header","footerButtons","generateCarousel","cb","modal","hideModalWindow","relatedTarget","html","previewElement","popover","remove","showConfirmation","showConfirmModal","titleTrusted","confirmedCallback","deleteFileCallback","filterValidFiles","setFilesHash","fileSize","deleteBtn","container","sanitize","placement","content","actualElements","toArray","elementHash","append","sortable","handle","items","over","sortOver","stop","sortStop","disableSelection","focus","callback","preview","generatePreviewFromValue","fr","onload","createPreview","readAsDataURL","item","subElement","slice","generatePreviewElements"],"mappings":";;AAAA,kKACA,YAAA,UAEMA,eAAAA,CAAAA,QAAAA,CAAAA,WAAAA,CAAAA,CAAAA,GAAAA,EAAAA,QAAAA,YAAAA,WAAAA,CAAAA,CAAAA,MAAAA,IAAAA,SAAAA,CAAAA,mCAAAA,CAAAA,CAAAA,SAAAA,iBAAAA,CAAAA,MAAAA,CAAAA,KAAAA,CAAAA,CAAAA,IAAAA,IAAAA,UAAAA,CAAAA,CAAAA,CAAAA,CAAAA,CAAAA,CAAAA,CAAAA,KAAAA,CAAAA,MAAAA,CAAAA,CAAAA,EAAAA,CAAAA,UAAAA,CAAAA,KAAAA,CAAAA,CAAAA,CAAAA,CAAAA,UAAAA,CAAAA,UAAAA,CAAAA,UAAAA,CAAAA,UAAAA,EAAAA,CAAAA,CAAAA,CAAAA,UAAAA,CAAAA,YAAAA,CAAAA,CAAAA,CAAAA,CAAAA,OAAAA,GAAAA,UAAAA,GAAAA,UAAAA,CAAAA,QAAAA,CAAAA,CAAAA,CAAAA,CAAAA,CAAAA,MAAAA,CAAAA,cAAAA,CAAAA,MAAAA,CAAAA,UAAAA,CAAAA,GAAAA,CAAAA,UAAAA,EAAAA,CAAAA,SAAAA,YAAAA,CAAAA,WAAAA,CAAAA,UAAAA,CAAAA,WAAAA,CAAAA,CAAAA,OAAAA,UAAAA,EAAAA,iBAAAA,CAAAA,WAAAA,CAAAA,SAAAA,CAAAA,UAAAA,CAAAA,CAAAA,WAAAA,EAAAA,iBAAAA,CAAAA,WAAAA,CAAAA,WAAAA,CAAAA,CAAAA,MAAAA,CAAAA,cAAAA,CAAAA,WAAAA,CAAAA,WAAAA,CAAAA,CAAAA,QAAAA,CAAAA,CAAAA,CAAAA,CAAAA,CAAAA,CAAAA,WAAAA,CAAAA,IAAAA,wBACL,UAAA;AACD;AACA;AACA;AACA,IACC,SAAYC,UAAAA,CAAAA,OAAZ,CAAqB,CAAA,eAAA,CAAA,IAAA,CAAA,UAAA,CAAA,CACpB,IAAkB,YAAA,CAAG,IAArB,CACA,KAAKC,QAAL,CAAgB,EAFI,CAGpB,KAAKC,OAAL,CAAe,CACdC,YAAY,GADE,CAHK,CAMpB,IAAKC,CAAAA,UAAL,GANoB,CAOpB,IAAA,CAAKH,QAAL,CAAcI,SAAd,CAA0BL,OAAO,CAACM,IAAR,CAAa,uBAAb,CAAA,CAAsCC,EAAtC,CAAyC,CAAzC,CAPN,CAQmB,CAAnC,QAAKN,QAAL,CAAcI,SAAd,CAAwBG,MARR,GASnB,IAAA,CAAKJ,UAAL,CAAA,CAAA,CATmB,EAWpB,IAAKH,CAAAA,QAAL,CAAcQ,SAAd,CAA0BT,OAAO,CAACO,EAAR,CAAW,CAAX,CAXN,CAYpB,IAAKN,CAAAA,QAAL,CAAcS,IAAd,CAAqBV,OAAO,CAACW,OAAR,CAAgB,MAAhB,CAAwBJ,CAAAA,EAAxB,CAA2B,CAA3B,CAZD,CAapBK,CAAC,CAAC,IAAA,CAAKX,QAAL,CAAcS,IAAf,CAAD,CAAsBG,EAAtB,CAAyB,QAAzB,CAAmC,IAAA,CAAKC,YAAxC,CAboB,CAcpB,IAAKb,CAAAA,QAAL,CAAcc,SAAd,CAA0B,IAAKd,CAAAA,QAAL,CAAcQ,SAAd,CAAwBH,IAAxB,CAA6B,2BAA7B,CAAA,CAA0DC,EAA1D,CAA6D,CAA7D,CAdN,CAepB,IAAKN,CAAAA,QAAL,CAAce,MAAd,CAAuB,IAAKf,CAAAA,QAAL,CAAcQ,SAAd,CAAwBH,IAAxB,CAA6B,yBAA7B,CAAA,CAAwDC,EAAxD,CAA2D,CAA3D,CAfH,CAgBpB,KAAKN,QAAL,CAAcgB,WAAd,CAA4B,KAAKhB,QAAL,CAAcQ,SAAd,CAAwBH,IAAxB,CAA6B,+BAA7B,CAA8DC,CAAAA,EAA9D,CAAiE,CAAjE,CAhBR,CAiBpB,IAAA,CAAKN,QAAL,CAAciB,QAAd,CAAyB,KAAKjB,QAAL,CAAcQ,SAAd,CAAwBH,IAAxB,CAA6B,2BAA7B,CAA0DC,CAAAA,EAA1D,CAA6D,CAA7D,CAjBL,CAkBpB,IAAA,CAAKN,QAAL,CAAckB,MAAd,CAAuB,IAAA,CAAKlB,QAAL,CAAcQ,SAAd,CAAwBH,IAAxB,CAA6B,yBAA7B,CAAA,CAAwDC,EAAxD,CAA2D,CAA3D,CAlBH,CAmBpB,IAAKa,CAAAA,SAAL,CAAiB,IAAA,CAAKnB,QAAL,CAAce,MAAd,CAAqBK,IAArB,CAA0B,WAA1B,CAnBG,CAoBpB,IAAA,CAAKnB,OAAL,CAAaoB,OAAb,CAAuB,IAAA,CAAKF,SAAL,CAAeE,OApBlB,CAqBpB,IAAA,CAAKpB,OAAL,CAAaqB,KAAb,CAAqB,IAAA,CAAKH,SAAL,CAAeG,KArBhB,CAsBpB,IAAA,CAAKrB,OAAL,CAAasB,WAAb,CAA2B,IAAA,CAAKJ,SAAL,CAAeI,WAAf,EAA8BC,MAAM,CAACC,cAtB5C,CAuBpB,IAAA,CAAKxB,OAAL,CAAayB,kBAAb,CAAkC,IAAA,CAAKP,SAAL,CAAeO,kBAAf,EAAqC,EAvBnD,CA2BnB,IAAA,CAAKC,KA3Bc,CAwBf,IAAA,CAAKxB,UAxBU,CA2BN,KAAKH,QAAL,CAAce,MAAd,CAAqBK,IAArB,CAA0B,OAA1B,CA3BM,CAyBNQ,IAAI,CAACC,KAAL,CAAW,IAAA,CAAK7B,QAAL,CAAce,MAAd,CAAqBe,GAArB,EAAX,CAzBM,CA6Bf,IAAA,CAAK3B,UA7BU,GA8BnB,IAAA,CAAKH,QAAL,CAAcI,SAAd,CAAwB2B,MAAxB,EA9BmB,CA+BnB,KAAK/B,QAAL,CAAcc,SAAd,CAAwBkB,KAAxB,CAA8B,IAAA,CAAKC,cAAL,CAAoBC,IAApB,CAAyB,IAAzB,CAA9B,CA/BmB,CAgCnB,IAAKlC,CAAAA,QAAL,CAAcI,SAAd,CAAwB+B,UAAxB,CAAmC,CAClCC,QAAQ,CAAE,MADwB,CAElCC,gBAAgB,GAFkB,CAGlCjC,SAAS,CAAE,IAAA,CAAKA,SAHkB,CAIlCkC,UAAU,CAJwB,CAAA,CAAA,CAKlCC,MAAM,CAAE,IAAA,CAAKA,MAAL,CAAYL,IAAZ,CAAiB,IAAjB,CAL0B,CAMlCM,GAAG,CAAE,IAAA,CAAKA,GAAL,CAASN,IAAT,CAAc,IAAd,CAN6B,CAOlCO,WAAW,CAAE,IAAKC,CAAAA,WAAL,CAAiBR,IAAjB,CAAsB,IAAtB,CAPqB,CAQlCS,MAAM,CAAE,IAAKA,CAAAA,MAAL,CAAYT,IAAZ,CAAiB,IAAjB,CAR0B,CASlCU,IAAI,CAAE,IAAKD,CAAAA,MAAL,CAAYT,IAAZ,CAAiB,IAAjB,CAT4B,CAUlCW,QAAQ,CAAE,IAAKC,CAAAA,QAAL,CAAcZ,IAAd,CAAmB,IAAnB,CAVwB,CAWlCa,IAAI,CAAE,IAAA,CAAKC,WAAL,CAAiBd,IAAjB,CAAsB,IAAtB,CAX4B,CAYlCe,IAAI,CAAE,IAAA,CAAKC,aAAL,CAAmBhB,IAAnB,CAAwB,IAAxB,CAZ4B,CAAnC,CAhCmB,CA8CnB,IAAA,CAAKlC,QAAL,CAAcQ,SAAd,CAAwBI,EAAxB,CAA2B,WAA3B,CAAwC,IAAKuC,CAAAA,SAAL,CAAejB,IAAf,CAAoB,IAApB,CAAxC,CA9CmB,CA+CnB,IAAKlC,CAAAA,QAAL,CAAcQ,SAAd,CAAwBI,EAAxB,CAA2B,SAA3B,CAAsC,IAAA,CAAKuC,SAAL,CAAejB,IAAf,CAAoB,IAApB,CAAtC,CA/CmB,CAgDnB,IAAKlC,CAAAA,QAAL,CAAcI,SAAd,CAAwB+B,UAAxB,CAAmC,QAAnC,CAA6C,UAA7C,CAAyDxB,CAAC,CAAC,IAAA,CAAKX,QAAL,CAAcQ,SAAf,CAA1D,CAhDmB,CAiDnB,IAAA,CAAK4C,eAAL,EAjDmB,EAmDpB,IAAKpD,CAAAA,QAAL,CAAcQ,SAAd,CAAwBI,EAAxB,CAA2B,OAA3B,CAAoC,8BAApC,CAAoE,UAAY,CAC/EyC,YAAY,CAACC,WAAb,CAAyB3C,CAAC,CAAC,IAAD,CAAD,CAAQS,IAAR,CAAa,MAAb,CAAzB,EACA,CAFD,CAnDoB,CAsDpB,IAAKpB,CAAAA,QAAL,CAAcQ,SAAd,CAAwBI,EAAxB,CAA2B,OAA3B,CAAoC,mCAApC,CAAyE,SAAU2C,CAAV,CAAa,CACrFA,CAAC,CAACC,cAAF,EADqF,CAErFH,YAAY,CAACC,WAAb,CAAyB3C,CAAC,CAAC,IAAD,CAAD,CAAQS,IAAR,CAAa,MAAb,CAAzB,EACA,CAHD,CAtDoB,CA0DpB,IAAA,CAAKpB,QAAL,CAAcQ,SAAd,CAAwBI,EAAxB,CAA2B,OAA3B,CAAoC,uCAApC,CAA6E,SAAU2C,CAAV,CAAa,CACzFA,CAAC,CAACC,cAAF,EADyF,CAEzFH,YAAY,CAACI,QAAb,CAAsB9C,CAAC,CAAC,IAAD,CAAD,CAAQS,IAAR,CAAa,MAAb,CAAtB,EACA,CAHD,CA1DoB,CA8Df,IAAA,CAAKjB,UA9DU,EA+DnB,KAAKH,QAAL,CAAcQ,SAAd,CAAwBI,EAAxB,CAA2B,OAA3B,CAAoC,qCAApC,CAA2E,SAAU2C,CAAV,CAAa,CACvFA,CAAC,CAACC,cAAF,EADuF,CAEvFH,YAAY,CAACK,UAAb,CAAwB/C,CAAC,CAAC,IAAD,CAAD,CAAQS,IAAR,CAAa,MAAb,CAAxB,EACA,CAHD,CA/DmB,CAoEpB,IAAKuC,CAAAA,iBAAL,GACA,CAED;AACD;AACA;AACA,8DACC,SAAaJ,YAAAA,CAAAA,CAAb,CAAgB,CACXK,OAAAA,CAAAA,GAAG,CAACC,MAAJ,CAAW/D,UAAX,CAAsBgE,kBADX,GAEdP,CAAC,CAACC,cAAF,EAFc,CAGdD,CAAC,CAACQ,eAAF,EAHc,CAIdR,CAAC,CAACS,wBAAF,EAJc,CAKdC,GAAG,CAACC,SAAJ,CAAcD,GAAG,CAACE,UAAJ,CAAe,yBAAf,CAAd,CALc,IASf,CAED;AACD;AACA;AACA;AACA,kCACC,SAAeZ,cAAAA,CAAAA,CAAf,CAAkB,CACjBA,CAAC,CAACC,cAAF,EADiB,CAEjB,IAAKxD,CAAAA,QAAL,CAAcI,SAAd,CAAwBgE,OAAxB,CAAgC,OAAhC,EACA,CAED;AACD;AACA;AACA;AACA;AACA,0BACC,SAAOC,MAAAA,CAAAA,EAAP,CAAWjD,IAAX,CAAiB,CAChBA,IAAI,CAACkD,QAAL,CAAgB,CACfC,IAAI,CAAEnD,IAAI,CAACO,KAAL,CAAW,CAAX,CAAc4C,CAAAA,IADL,CADA,CAIhBX,GAAG,CAACC,MAAJ,CAAW/D,UAAX,CAAsBgE,kBAAtB,EAJgB,CAKhB,IAAA,CAAKU,gBAAL,CAAwB7D,CAAC,CAAC8D,iBAAF,CAAoB,CAC3CC,QAAQ,CAAE,SADiC,CAE3CC,SAAS,CAAE,CACVC,OAAO,CAAA,CAAA,CADG,CAEVC,cAAc,CAAE,IAAA,CAAK7E,QAAL,CAAcQ,SAFpB,CAFgC,CAApB,EAOxB,CAED;AACD;AACA;AACA;AACA;AACA,KACC,CAAA,CAAA,GAAA,CAAA,aAAA,CAAA,KAAA,CAAA,SAAA,WAAA,CAAY+D,IAAZ,CAAkB,CACjB,IAAK,IAAA,IAAA,CAAIO,CAAC,CAAG,CAAR,CAAWC,GAAG,CAAG,IAAKpD,CAAAA,KAAL,CAAWpB,MAAjC,CAAyCuE,CAAC,CAAGC,GAA7C,CAAkDD,CAAC,EAAnD,CAEC,GADME,IACN,CADa,IAAA,CAAKrD,KAAL,CAAWmD,CAAX,CACb,CAAIE,IAAI,CAACT,IAAL,GAAcA,IAAlB,CACC,OAAA,IAAA,CAGFN,GAAG,CAACgB,QAAJ,CAAsBV,QAAAA,CAAAA,MAAAA,CAAAA,IAAtB,CAPiB,cAAA,CAAA,CAAA,CAQjBN,GAAG,CAACiB,UAAJ,CAAe,CACdC,IAAI,CAAElB,GAAG,CAACE,UAAJ,CAAe,sBAAf,CAAA,CAAA,IAAA,CAAA,MAAA,CAA8CI,IAA9C,CAAA,GAAA,CADQ,CAEda,IAAI,CAAE,OAFQ,CAAf,EAIA,CAED;AACD;AACA;AACA;AACA;AACA;AACA;AACA,uCACC,SAAoBb,mBAAAA,CAAAA,IAApB,CAA0Bc,YAA1B,CAAwCC,KAAxC,CAA+C,CAC9C,IAAMC,QAAQ,CAAG,IAAA,CAAKC,WAAL,CAAiBjB,IAAjB,CAAjB,CAEA,OADQ,QAAA,CAACc,YAAD,CAAR,CAAyBC,KACzB,CAAOC,QACP,CAED;AACD;AACA;AACA;AACA;AACA,+BACC,SAAYlB,WAAAA,CAAAA,EAAZ,CAAgBjD,IAAhB,CAAsB,gBACrB,IAAKoD,CAAAA,gBAAL,CAAsBC,iBAAtB,CAAwC,CAAEgB,IAAI,CAAE,MAAR,CAAxC,CADqB,CAErBxB,GAAG,CAACgB,QAAJ,CAAa,oBAAb,CAFqB,CAGbS,IAAAA,KAHa,CAGItE,IAHJ,CAGbsE,KAHa,CAGN/D,KAHM,CAGIP,IAHJ,CAGNO,KAHM,CAIfgE,QAAQ,CAAGD,KAAK,CAACE,YAJF,CAKrB;AALqB,OAOP,IAAb,GAAAD,QAAQ,EACY,WAApB,EAAOA,OAAAA,QADP,EAE2B,WAA3B,EAAOA,OAAAA,QAAQ,CAACzE,MAFhB,EAGkC,WAAlC,EAAOyE,OAAAA,QAAQ,CAACzE,MAAT,CAAgB2E,MAHvB,EAIAC,KAAK,CAACC,OAAN,CAAcJ,QAAQ,CAACzE,MAAT,CAAgB2E,MAA9B,CAXoB,EAapBF,QAAQ,CAACzE,MAAT,CAAgB2E,MAAhB,CAAuBG,OAAvB,CAA+B,SAACC,UAAD,CAAgB,CAC9CrC,GAAG,CAACC,MAAJ,CAAW/D,UAAX,CAAsBgE,kBAAtB,EAD8C,CAE9C,KAAI,CAACJ,UAAL,CAAgBuC,UAAU,CAAC1B,IAA3B,CAF8C,CAAA,CAAA,CAAA,CAGd,QAA5B,EAAA,OAAiB,UAAA,CAAC2B,KAHwB,CAI7CjC,GAAG,CAACiB,UAAJ,CAAe,CACdiB,WAAW,CADG,CAAA,CAAA,CAEdhB,IAAI,CAAEc,UAAU,CAACC,KAFH,CAGdd,IAAI,CAAE,OAHQ,CAAf,CAJ6C,CAU7CnB,GAAG,CAACiB,UAAJ,CAAe,CACdiB,WAAW,CADG,CAAA,CAAA,CAEdC,KAAK,CAAEnC,GAAG,CAACE,UAAJ,CAAe,sBAAf,CAFO,CAGdgB,IAAI,CAAEc,UAAU,CAACI,IAHH,CAIdjB,IAAI,CAAE,OAJQ,CAAf,EAOD,CAjBD,CAboB,CA+BpB,KAAA,IAAA,CAAKkB,gBAAL,EA/BoB,EAkCrB;AACA3E,KAAK,CAACqE,OAAN,CAAc,SAAChB,IAAD,CAAU,CACvBpB,GAAG,CAACC,MAAJ,CAAW/D,UAAX,CAAsBgE,kBAAtB,EADuB,CAEvB,KAAI,CAACJ,UAAL,CAAgBsB,IAAI,CAACT,IAArB,CAAA,CAAA,CAAA,CAFuB,CAGvBN,GAAG,CAACiB,UAAJ,CAAe,CACdiB,WAAW,CAAA,CAAA,CADG,CAEdC,KAAK,CAAEnC,GAAG,CAACE,UAAJ,CAAe,sBAAf,CAFO,CAGdgB,IAAI,CAAEH,IAAI,CAACqB,IAHG,CAIdjB,IAAI,CAAE,OAJQ,CAAf,EAMA,CATD,CAnCqB,CA6CrB,IAAKkB,CAAAA,gBAAL,EA7CqB,CA8CrB,CAED;AACD;AACA;AACA;AACA;AACA,KACC,CAAA,CAAA,GAAA,CAAA,eAAA,CAAA,KAAA,CAAA,SAAA,aAAA,CAAc/C,CAAd,CAAiBnC,IAAjB,CAAuB,CACtB,IAAA,MAAA,CAAA,IAAA,CAAA,IAAA,CAAKoD,gBAAL,CAAsBC,iBAAtB,CAAwC,CAAEgB,IAAI,CAAE,MAAR,CAAxC,CADsB,CAEdvE,IAAAA,MAFc,CAEHE,IAFG,CAEdF,MAFc,CAGhB2E,MAAM,CAAG3E,MAAM,CAACA,MAAP,CAAc2E,MAHP,CAItBA,MAAM,CAACG,OAAP,CAAe,SAACC,UAAD,CAAgB,CAC9B,IAAU,IAAA,CAAGA,UAAU,CAAC1B,IAAxB,CACA,GAAI,CAACA,IAAL,CACC,OAAON,GAAG,CAACgB,QAAJ,CAAa,IAAA,KAAA,CAAUhB,GAAG,CAACE,UAAJ,CAAe,sBAAf,CAAV,CAAb,CAAP,CAED,GAA8B,WAA1B,EAAO8B,OAAAA,UAAU,CAACM,GAAtB,CACC,OAAW,MAAA,CAACvD,WAAL,CAAiBO,CAAjB,CAAoBnC,IAApB,CAAP,CAE8B,WAA3B,EAAO6E,OAAAA,UAAU,CAACO,IAAlB,EAA0CP,UAAU,CAACO,IAR3B,EAS7BvC,GAAG,CAACiB,UAAJ,CAAe,CACdiB,WAAW,CADG,CAAA,CAAA,CAEdf,IAAI,CAAE,QAFQ,CAGdgB,KAAK,CAAEH,UAAU,CAACO,IAHJ,CAIdrB,IAAI,CAAEc,UAAU,CAACI,IAJH,CAAf,CAT6B,CAgB9B,IAAMd,QAAQ,CAAG,MAAI,CAACC,WAAL,CAAiBjB,IAAjB,CAAjB,CACA,MAAI,CAACkC,mBAAL,CAAyBlC,IAAzB,CAA+B,KAA/B,CAAsC0B,UAAU,CAACM,GAAjD,CAjB8B,CAkB9B,MAAI,CAACE,mBAAL,CAAyBlC,IAAzB,CAA+B,MAA/B,CAAuC0B,UAAU,CAACS,IAAlD,CAlB8B,CAmB9B,MAAI,CAACD,mBAAL,CAAyBlC,IAAzB,CAA+B,aAA/B,CAA8C0B,UAAU,CAACU,WAAX,EAA0BV,UAAU,CAACS,IAAnF,CAnB8B,CAoB9B,MAAI,CAACD,mBAAL,CAAyBlC,IAAzB,CAA+B,MAA/B,CAAuC0B,UAAU,CAACI,IAAlD,CApB8B,CAqB9B,MAAI,CAACI,mBAAL,CAAyBlC,IAAzB,CAA+B,MAA/B,CAAuC0B,UAAU,CAACb,IAAX,EAAmB,EAA1D,CArB8B,CAsB9B,MAAI,CAACwB,uBAAL,CAA6BrB,QAAQ,CAACP,IAAtC,CAA4C,SAAC6B,QAAD,CAAWC,QAAX,CAAwB,CACnE,MAAI,CAACL,mBAAL,CAAyBlC,IAAzB,CAA+B,gBAA/B,CAAiD,MAAI,CAACwC,iBAAL,CAAuBxB,QAAvB,CAAiCsB,QAAjC,CAA2CC,QAA3C,CAAjD,CADmE,CAEnE,MAAI,CAACE,MAAL,GACA,CAHD,CAtB8B,CA0B9BpD,GAAG,CAACC,MAAJ,CAAW/D,UAAX,CAAsBgE,kBAAtB,GACA,CA3BD,CAJsB,CAgCtB,IAAKwC,CAAAA,gBAAL,GACA,CAED;AACD;AACA,KACC,CAAA,CAAA,GAAA,CAAA,kBAAA,CAAA,KAAA,CAAA,SAAA,gBAAA,EAAmB,CAClB,IAAA,CAAKtG,QAAL,CAAcI,SAAd,CAAwB0B,GAAxB,CAA4B,IAA5B,CADkB,CAElB,IAAgB,UAAA,CAAG,IAAKH,CAAAA,KAAL,CAAWsF,GAAX,CAAe,SAACjC,IAAD,CAAU,CAC3C,OAAO,CAAEuB,GAAG,CAAEvB,IAAI,CAACuB,GAAZ,CAAiBF,IAAI,CAAErB,IAAI,CAACqB,IAA5B,CAAkCK,IAAI,CAAE1B,IAAI,CAAC0B,IAA7C,CAAmDtB,IAAI,CAAEJ,IAAI,CAACI,IAAL,EAAa,EAAtE,CACP,CAFkB,CAAnB,CAGA,IAAA,CAAKpF,QAAL,CAAce,MAAd,CAAqBe,GAArB,CAAyBF,IAAI,CAACsF,SAAL,CAAeC,UAAf,CAAzB,EACA,CAED;AACD;AACA;AACA;AACA;AACA,kCACC,SAAenC,cAAAA,CAAAA,IAAf,CAAqB,CACpB,IAAS,KAAA,CAAA,CAAA,CAAT,CAaA,YAZK/E,OAAL,CAAaoB,OAAb,CAAqB2E,OAArB,CAA6B,SAACoB,MAAD,CAAY,CACpCpC,IAAI,CAACI,IAAL,GAAc,SAAWgC,MADW,GAEvCC,KAAK,CAAA,CAAA,CAFkC,EAIxC,CAJD,CAYA,CAPKA,KAOL,EANCpD,GAAG,CAACiB,UAAJ,CAAe,CACdkB,KAAK,CAAKnC,EAAAA,CAAAA,MAAAA,CAAAA,GAAG,CAACE,UAAJ,CAAe,sBAAf,CAAL,CADS,CAEdgB,IAAI,CAAKlB,EAAAA,CAAAA,MAAAA,CAAAA,GAAG,CAACE,UAAJ,CAAe,yBAAf,CAAL,CAAmD,IAAA,CAAA,CAAA,MAAA,CAAA,IAAA,CAAKlE,OAAL,CAAaoB,OAAb,CAAqBiG,IAArB,CAA0B,IAA1B,CAAnD,CAFU,CAGdlC,IAAI,CAAE,OAHQ,CAAf,CAMD,CAAOiC,KACP,CAED;AACD;AACA;AACA;AACA,gCACC,SAAarC,YAAAA,CAAAA,IAAb,CAAmB,CAClB,IAAU,MAAA,CAAwB,QAArB,EAAA,OAAW,IAAA,CAAC0B,IAAZ,EAAiC1B,IAAI,CAAC0B,IAAL,CAAY,IAAA,CAAKzG,OAAL,CAAasB,WAAvE,CAOA,OAAA,MAAA,EALC0C,GAAG,CAACiB,UAAJ,CAAe,CACdC,IAAI,CAAA,EAAA,CAAA,MAAA,CAAKlB,GAAG,CAACE,UAAJ,CAAe,+BAAf,CAAL,CAAA,SAAA,CAAA,CAAA,MAAA,CAA8D,KAAKlE,OAAL,CAAayB,kBAA3E,CAAA,GAAA,CADU,CAEd0D,IAAI,CAAE,OAFQ,CAAf,CAKD,CAAOlE,MACP,CAED;AACD;AACA,kCACC,SAAiB,cAAA,EAAA,CAChB,IAAKlB,CAAAA,QAAL,CAAcI,SAAd,CAAwB0B,GAAxB,CAA4B,EAA5B,CADgB,CAEhBmC,GAAG,CAACiB,UAAJ,CAAe,CACdC,IAAI,CAAKlB,EAAAA,CAAAA,MAAAA,CAAAA,GAAG,CAACE,UAAJ,CAAe,eAAf,CAAL,cAAyC,IAAKlE,CAAAA,OAAL,CAAaqB,KAAtD,KADU,CAEd8D,IAAI,CAAE,OAFQ,CAAf,EAIA,CAED;AACD;AACA;AACA;AACA;AACA,oCACC,0BAAiBzD,KAAjB,CAAwB,wBACd,KAAA,CAACpB,MAAN,CAAe,IAAKoB,CAAAA,KAAL,CAAWpB,MAA1B,CAAmC,KAAKN,OAAL,CAAaqB,KAD7B,EAEtB,IAAA,CAAKiG,cAAL,EAFsB,CAGf,EAHe,EAKhB5F,KAAK,CAAC6F,MAAN,CAAa,SAACxC,IAAD,CAAU,CAC7B,OAAO,MAAI,CAACyC,cAAL,CAAoBzC,IAApB,CAAA,EAA6B,MAAI,CAAC0C,YAAL,CAAkB1C,IAAlB,CACpC,CAFM,CAGP,CAED;AACD;AACA;AACA;AACA,gCACC,SAAarD,YAAAA,CAAAA,KAAb,CAAoB,CAEnB,IACOqD,IAAAA,IADP,CADM2C,UAAU,CAAG,EACnB,CAAS7C,CAAC,CAAG,CAAb,CAAgBC,GAAG,CAAGpD,KAAK,CAACpB,MAA5B,CAAoCuE,CAAC,CAAGC,GAAxC,CAA6CD,CAAC,EAA9C,CAEC,GADME,IACN,CADarD,KAAK,CAACmD,CAAD,CAClB,CAAyB,WAArB,EAAA,OAAW,IAAA,CAACP,IAAhB,CACC,GAAI,IAAK5C,CAAAA,KAAL,CAAWpB,MAAX,CAAoB,IAAA,CAAKN,OAAL,CAAaqB,KAArC,CACC0D,IAAI,CAACT,IAAL,CAAYX,GAAG,CAACC,MAAJ,CAAW+D,IAAX,CAAgBC,kBAAhB,CAAmCrG,MAAM,CAACsG,MAA1C,CADb,CAEC,IAAKnG,CAAAA,KAAL,CAAWoG,IAAX,CAAgB,CAAExD,IAAI,CAAES,IAAI,CAACT,IAAb,CAAmBuC,QAAQ,CAAE9B,IAAI,CAAC8B,QAAlC,CAA4CT,IAAI,CAAErB,IAAI,CAACqB,IAAvD,CAA6DrB,IAAI,CAAJA,IAA7D,CAAhB,CAFD,CAGC2C,UAAU,CAACI,IAAX,CAAgB/C,IAAhB,CAHD,CAMC,KAAA,OADKuC,IAAAA,CAAAA,cAAL,EACA,CAAOI,UAAP,CAIH,OAAOA,UACP,CAED;AACD;AACA;AACA;AACA;AACA,uBACC,SAAItD,GAAAA,CAAAA,EAAJ,CAAQjD,IAAR,CAAc,CACW,CAApB,CAAAA,IAAI,CAACO,KAAL,CAAWpB,MADF,EAEZa,IAAI,CAACmB,MAAL,GAED,CAED;AACD;AACA;AACA;AACA;AACA,+BACC,SAAY8B,WAAAA,CAAAA,EAAZ,CAAgBjD,IAAhB,CAAsB,iBACfH,QAAQ,CAAG+G,QAAQ,CAA8B,GAA7B,EAAC5G,IAAI,CAAC6G,MAAL,CAAc7G,IAAI,CAAC8G,KAApB,CAAD,CAAmC,EAAnC,CADJ,CAErB,IAAA,CAAKlI,QAAL,CAAcgB,WAAd,CAA0BmH,GAA1B,CAA8B,CAAEC,KAAK,CAAEnH,QAAQ,CAAG,GAApB,CAA9B,CAFqB,CAGJ,GAAb,GAAAA,QAHiB,CAIpBoH,UAAU,CAAC,UAAM,CAChB,MAAI,CAACrI,QAAL,CAAciB,QAAd,CAAuBqH,QAAvB,CAAgC,QAAhC,CADgB,CAEhB,MAAI,CAACtI,QAAL,CAAcgB,WAAd,CAA0BmH,GAA1B,CAA8B,CAAEC,KAAK,CAAE,IAAT,CAA9B,EACA,CAHS,CAGP,GAHO,CAJU,CASpB,IAAKpI,CAAAA,QAAL,CAAciB,QAAd,CAAuBsH,WAAvB,CAAmC,QAAnC,EAED,CAED;AACD;AACA;AACA;AACA,KACC,CAAA,CAAA,GAAA,CAAA,UAAA,CAAA,KAAA,CAAA,SAAA,QAAA,EAAa,CACZ,IAAA,CAAKvI,QAAL,CAAcQ,SAAd,CAAwB8H,QAAxB,CAAiC,4BAAjC,EACA,CAED;AACD;AACA;AACA,KACC,CAAA,CAAA,GAAA,CAAA,WAAA,CAAA,KAAA,CAAA,SAAA,SAAA,EAAc,CACb,IAAA,CAAKtI,QAAL,CAAcQ,SAAd,CAAwB+H,WAAxB,CAAoC,4BAApC,EACA,CAED;AACD;AACA;AACA;AACA,4BACC,SAAShE,QAAAA,CAAAA,IAAT,CAAe,CACd,YAAc,CAAG,IAAA,CAAKiB,WAAL,CAAiBjB,IAAjB,CAAjB,CADc,OAEuC,UAAjD,GAAAgB,QAAQ,CAACuB,QAAT,CAAkB0B,MAAlB,CAAyB,CAAzB,CAA4B,CAA5B,CAA+BC,CAAAA,WAA/B,EAFU,CAGN,IAAA,CAAKC,YAAL,CAAkBnE,IAAlB,CAHM,CAKN,IAAA,CAAKoE,cAAL,CAAoBpE,IAApB,CAER,CAED;AACD;AACA;AACA,gCACC,SAAaA,YAAAA,CAAAA,IAAb,CAAmB,CACZgB,IAAAA,QAAQ,CAAG,IAAKC,CAAAA,WAAL,CAAiBjB,IAAjB,CADC,CAEZqE,IAAI,CAAGC,QAAQ,CAACC,aAAT,CAAuB,GAAvB,CAFK,CAGlBnI,CAAC,CAACiI,IAAD,CAAD,CAAQT,GAAR,CAAY,SAAZ,CAAuB,MAAvB,CAHkB,CAIW,QAAzB,EAAOS,OAAAA,IAAI,CAACnF,QAJE,EAKjBoF,QAAQ,CAACE,IAAT,CAAcC,WAAd,CAA0BJ,IAA1B,CALiB,CAMjBA,IAAI,CAACnF,QAAL,CAAgB8B,QAAQ,CAACc,IANR,CAOjBuC,IAAI,CAACK,IAAL,CAAY1D,QAAQ,CAACuB,QAPJ,CAQjB8B,IAAI,CAAC5G,KAAL,EARiB,CASjB6G,QAAQ,CAACE,IAAT,CAAcG,WAAd,CAA0BN,IAA1B,CATiB,EAWjBO,QAAQ,CAACC,OAAT,CAAiB7D,QAAQ,CAACuB,QAA1B,EAED,CAED;AACD;AACA;AACA;AACA,kCACC,wBAAevC,IAAf,CAAqB,KACN,QAAA,CAAG,IAAKiB,CAAAA,WAAL,CAAiBjB,IAAjB,CADG,CAEd8E,QAAQ,CACb,yCAA0C9D,CAAAA,MAAAA,CAAAA,QAAQ,CAACc,IAAnD,CAAA,UAAA,CAAA,CAAoEd,QAAQ,CAACuB,QAAT,CAAkBwC,KAAlB,CAAwB,GAAxB,EAA6B,CAA7B,CAHjD,CAIdV,IAAI,CAAGC,QAAQ,CAACC,aAAT,CAAuB,GAAvB,CAJO,CAKpBnI,CAAC,CAACiI,IAAD,CAAD,CAAQT,GAAR,CAAY,SAAZ,CAAuB,MAAvB,CALoB,CAMS,QAAzB,SAAW,IAAA,CAAC1E,QANI,EAOnBoF,QAAQ,CAACE,IAAT,CAAcC,WAAd,CAA0BJ,IAA1B,CAPmB,CAQnBA,IAAI,CAACnF,QAAL,CAAgB8B,QAAQ,CAACc,IARN,CASnBuC,IAAI,CAACK,IAAL,CAAYI,QATO,CAUnBT,IAAI,CAAC5G,KAAL,EAVmB,CAWnB6G,QAAQ,CAACE,IAAT,CAAcG,WAAd,CAA0BN,IAA1B,CAXmB,EAanBO,QAAQ,CAACC,OAAT,CAAiBC,QAAjB,EAED,CAED;AACD;AACA;AACA;AACA,KACC,CAAA,CAAA,GAAA,CAAA,aAAA,CAAA,KAAA,CAAA,SAAA,WAAA,CAAY9E,IAAZ,CAAkB,KACP,IAAA,CAAG,IADI,CAEbgB,QAAQ,CAAG,IAAA,CAAKC,WAAL,CAAiBjB,IAAjB,CAFE,CAGXgF,aAAa,CAAG,UAAM,CAAA,IACV,WAAA,CAAGV,QAAQ,CAACC,aAAT,CAAuB,MAAvB,CADO,CAErBU,IAAI,CAAGX,QAAQ,CAACC,aAAT,CAAuB,GAAvB,CAFc,CAM3B,OAHI,IAAA,CAACW,YAAL,CAAkB,OAAlB,CAGA,aAAA,CAAA,CAFAC,WAAW,CAACV,WAAZ,CAAwBQ,IAAxB,CAEA,CADAE,WAAW,CAACV,WAAZ,CAAwBH,QAAQ,CAACc,cAAT,CAAA,GAAA,CAAA,MAAA,CAA4BpE,QAAQ,CAACc,IAArC,CAAxB,CAAA,CACA,CAAOqD,WAAW,CAACE,SACnB,CAVgB,CAYbC,OAAO,CAAG,EAZG,CAaZC,IAAI,CAAC3J,UAbO,EAchB0J,OAAO,CAAC9B,IAAR,CAAa,CACZ5C,IAAI,CAAElB,GAAG,CAACE,UAAJ,CAAe,WAAf,CADM,CAEZqF,IAAI,CAAE,iBAFM,CAGZO,KAAK,CAAE,qCAHK,CAAb,CAdgB,CAoBjBF,OAAO,CAAC9B,IAAR,CACC,CACC5C,IAAI,CAAElB,GAAG,CAACE,UAAJ,CAAe,aAAf,CADP,CAECqF,IAAI,CAAE,gBAFP,CAGCO,KAAK,CAAE,uCAHR,CADD,CAMC,CACC5E,IAAI,CAAElB,GAAG,CAACE,UAAJ,CAAe,UAAf,CADP,CAECqF,IAAI,CAAE,aAFP,CAGCO,KAAK,CAAE,iBAHR,CAIC3I,IAAI,CAAE,CAAE4I,OAAO,CAAE,OAAX,CAJP,CAND,CApBiB,CAiCjB/F,GAAG,CAACgG,aAAJ,CAAkB,CACjBF,KAAK,CAAE,UADU,CAEjBG,MAAM,CAAEX,aAAa,EAFJ,CAGjBY,aAAa,CAAEN,OAHE,CAIjBd,IAAI,CAAEe,IAAI,CAAC7J,OAAL,CAAaC,YAAb,CACH4J,IAAI,CAACM,gBAAL,CAAsB7F,IAAtB,CADG,CAAA,aAAA,CAAA,MAAA,CAEUgB,QAAQ,CAACuB,QAFnB,CAJW,uBAAA,CAAA,CAOjBuD,EAAE,CAAE,SAACC,EAAAA,CAAAA,KAAD,CAAW,CACdA,KAAK,CAAC1J,EAAN,CAAS,OAAT,CAAkB,YAAlB,CAAgC,UAAY,CAC3CkJ,IAAI,CAACpG,UAAL,CAAgB6B,QAAQ,CAAChB,IAAzB,CAD2C,CAE3CN,GAAG,CAACsG,eAAJ,GACA,CAHD,CADc,CAKdD,KAAK,CAAC1J,EAAN,CAAS,OAAT,CAAkB,aAAlB,CAAiC,UAAY,CAC5CkJ,IAAI,CAACrG,QAAL,CAAc8B,QAAQ,CAAChB,IAAvB,CAD4C,CAE5CN,GAAG,CAACsG,eAAJ,GACA,CAHD,CALc,CASVT,IAAI,CAAC7J,OAAL,CAAaC,YATH,EAUboK,KAAK,CAACjK,IAAN,CAAA,YAAA,CAAA,MAAA,CAAwBkE,IAAxB,CAAgC3D,CAAAA,CAAAA,EAAhC,CAAmC,kBAAnC,CAAuD,SAAC2C,CAAD,CAAO,CAC7DgC,QAAQ,CAAGuE,IAAI,CAACtE,WAAL,CAAiB7E,CAAC,CAAC4C,CAAC,CAACiH,aAAH,CAAD,CAAmBpJ,IAAnB,CAAwB,MAAxB,CAAjB,CADkD,CAE7DkJ,KAAK,CAACjK,IAAN,CAAW,iBAAX,EAA8BoK,IAA9B,CAAmClB,aAAa,EAAhD,EACA,CAHD,EAKD,CAtBgB,CAAlB,EAwBA,CAED;AACD;AACA;AACA;AACA,sCACC,SAAmBhF,kBAAAA,CAAAA,IAAnB,CAAyB,CACxB,IAAc,QAAA,CAAG,IAAKiB,CAAAA,WAAL,CAAiBjB,IAAjB,CAAjB,CACIgB,QAAQ,CAACmF,cAFW,EAGvBnF,QAAQ,CAACmF,cAAT,CAAwBC,OAAxB,CAAgC,SAAhC,CAAA,CAA2CC,MAA3C,EAHuB,CAKxB,IAAKjJ,CAAAA,KAAL,CAAa,IAAA,CAAKA,KAAL,CAAW6F,MAAX,CAAkB,SAACxC,IAAD,CAAA,CAAA,WAAc,CAACT,IAAL,GAAcgB,QAAQ,CAAChB,IAAjC,CAAlB,CALW,CAMxB,IAAA,CAAK+B,gBAAL,GACA,CAED;AACD;AACA;AACA;AACA;AACA;AACA,KACC,CAAA,CAAA,GAAA,CAAA,YAAA,CAAA,KAAA,CAAA,SAAA,UAAA,CAAW/B,IAAX,CAA0C,CAAzBsG,IAAAA,MAAAA,CAAAA,IAAAA,CAAAA,gBAAyB,CACzC,EAAA,CAAA,CAAA,SAAA,CAAA,MAAA,EAAA,KAAA,CAAA,GAAA,SAAA,CAAA,CAAA,CAAA,CAAA,EAAA,SAAA,CAAA,CAAA,CAAA,CAAA,GAAIA,gBAAJ,CAAsB,CACrB,YAAc,CAAG,IAAA,CAAKrF,WAAL,CAAiBjB,IAAjB,CAAjB,CACAN,GAAG,CAAC6G,gBAAJ,CAAqB,CACpB1E,KAAK,CAAEb,QAAQ,CAACc,IADI,CAEpBlB,IAAI,CAAElB,GAAG,CAACE,UAAJ,CAAe,6BAAf,CAFc,CAGpB4G,YAAY,CAAA,CAAA,CAHQ,CAIpBvB,IAAI,CAAE,iBAJc,CAKpBwB,iBAAiB,CAAE,SAAM,iBAAA,EAAA,CACxB,MAAI,CAACC,kBAAL,CAAwB1G,IAAxB,EACA,CAPmB,CAArB,EASA,CAXD,KAYM0G,IAAAA,CAAAA,kBAAL,CAAwB1G,IAAxB,EAED,CAED;AACD;AACA;AACA;AACA;AACA,0BACC,SAAOhB,MAAAA,CAAAA,CAAP,CAAUnC,IAAV,CAAgB,CACfA,IAAI,CAACO,KAAL,CAAa,IAAKuJ,CAAAA,gBAAL,CAAsB9J,IAAI,CAACO,KAA3B,CADE,CAEfP,IAAI,CAACO,KAAL,CAAa,IAAKwJ,CAAAA,YAAL,CAAkB/J,IAAI,CAACO,KAAvB,CAFE,CAGf,IAAKwB,CAAAA,SAAL,CAAeI,CAAf,EACA,CAED;AACD;AACA;AACA;AACA;AACA;AACA;AACA,qCACC,SAAkByB,iBAAAA,CAAAA,IAAlB,CAAwB6B,QAAxB,CAAkCC,QAAlC,CAA4C,CACrCzD,IAAAA,YAAY,CAAG,IADsB,CAEvC+H,QAAQ,CAAG,EAF4B,CAGrC7F,QAAQ,CAAG,IAAKC,CAAAA,WAAL,CAAiBR,IAAI,CAACT,IAAtB,CAH0B,CAIvCmC,IAAI,CAAGnB,QAAQ,CAACoB,WAAT,EAAwBpB,QAAQ,CAACmB,IAJD,CAKvCA,IALuC,GAM1C0E,QAAQ,CAAA,qEAAA,CAAA,MAAA,CAAuE1E,IAAvE,CAAA,QAAA,CANkC,EAQ3C,IAAI2E,SAAS,CAAG,EAAhB,CACK,IAAKlL,CAAAA,UATiC,GAU1CkL,SAAS,oIACRrG,IAAI,CAACT,IADG,CAEkFN,iGAAAA,CAAAA,CAAAA,MAAAA,CAAAA,GAAG,CAACE,UAAJ,CAC1F,WAD0F,CAFlF,oBAViC,CAiB3C,CAAA,eAAiB,CAAG0E,QAAQ,CAACC,aAAT,CAAuB,MAAvB,CAApB,CAGA,OAFAY,WAAW,CAACV,WAAZ,CAAwBH,QAAQ,CAACc,cAAT,CAAwBpE,QAAQ,CAACc,IAAjC,CAAxB,CAEA,CAAO1F,CAAC,CAACkG,QAAD,CAAD,CAAY8D,OAAZ,CAAoB,CAC1BW,SAAS,CAAEjI,YAAY,CAACrD,QAAb,CAAsBQ,SADP,CAE1B4F,KAAK,CAAE,+DAAA,CAA8DsD,WAAW,CAACE,SAA1E,SAFmB,CAG1Ba,IAAI,CAHsB,CAAA,CAAA,CAI1Bc,QAAQ,CAJkB,CAAA,CAAA,CAK1BnH,OAAO,CAAE,OALiB,CAM1BoH,SAAS,CAAE,KANe,CAO1BC,OAAO,CAAe3E,aAAAA,CAAAA,MAAAA,CAAAA,QAAf,CAA4G9B,wFAAAA,CAAAA,CAAAA,MAAAA,CAAAA,IAAI,CAACT,IAAjH,CAAA,wBAAA,CAPmB,CAQ1BsC,QAAQ,+QAKJuE,QALI,CAAA,cAAA,CAAA,CAAA,MAAA,CAMJC,SANI,CAQLrG,0IAAAA,CAAAA,CAAAA,MAAAA,CAAAA,IAAI,CAACT,IARA,CAAA,gGAAA,CAAA,CAAA,MAAA,CASoFN,GAAG,CAACE,UAAJ,CAC3F,aAD2F,CATpF,CAaLa,sJAAAA,CAAAA,CAAAA,MAAAA,CAAAA,IAAI,CAACT,IAbA,CAAA,mGAAA,CAAA,CAAA,MAAA,CAcuFN,GAAG,CAACE,UAAJ,CAC9F,YAD8F,CAdvF,CARkB,gDAAA,CAAA,CAApB,CA4BP,CAED;AACD;AACA;AACA;AACA,KACC,CAAA,CAAA,GAAA,CAAA,sBAAA,CAAA,KAAA,CAAA,SAAA,oBAAA,CAAqBI,IAArB,CAA2B,CAC1B,IAAc,QAAA,CAAG,IAAKiB,CAAAA,WAAL,CAAiBjB,IAAjB,CAAjB,CACuC,WAAnC,EAAA,OAAe,QAAA,CAACmG,cAFM,EAGzBnF,QAAQ,CAACmF,cAAT,CAAwBC,OAAxB,CAAgC,SAAhC,EAED,CAED;AACD;AACA;AACA;AACA;AACA,4BACC,SAAkB,QAAA,EAAA,CACjB,IAAK3K,CAAAA,QAAL,CAAckB,MAAd,CAAqBb,IAArB,CAA0B,0BAA1B,CAAsDsK,CAAAA,OAAtD,CAA8D,MAA9D,EACA,CAED;AACD;AACA;AACA;AACA;AACA,4BACC,SAAkB,QAAA,EAAA,CAAA,IAAA,MAAA,CAAA,IAAA,CACXe,cAAc,CAAG,IAAA,CAAK1L,QAAL,CAAckB,MAAd,CAAqBb,IAArB,CAA0B,0BAA1B,CAAA,CAAsDsL,OAAtD,EADN,CAEjB,KAAKhK,KAAL,CAAa+J,cAAc,CAACzE,GAAf,CAAmB,SAAClH,OAAD,CAAa,CAC5C,IAAK,IACE6L,WADF,CAAI9G,CAAC,CAAG,CAAR,CAAWC,GAAG,CAAG,MAAI,CAACpD,KAAL,CAAWpB,MAAjC,CAAyCuE,CAAC,CAAGC,GAA7C,CAAkDD,CAAC,EAAnD,CAEC,GADM8G,WACN,CADoBjL,CAAC,CAACZ,OAAD,CAAD,CAAWqB,IAAX,CAAgB,MAAhB,CACpB,CAAI,MAAI,CAACO,KAAL,CAAWmD,CAAX,CAAcP,CAAAA,IAAd,GAAuBqH,WAA3B,CACC,OAAW,MAAA,CAACjK,KAAL,CAAWmD,CAAX,CAGT,CAPY,CAFI,CAUjB,IAAKkC,CAAAA,MAAL,GACA,CAED;AACD;AACA,KACC,CAAA,CAAA,GAAA,CAAA,QAAA,CAAA,KAAA,CAAA,SAAA,MAAA,EAAS,CACR,IAAA,MAAA,CAAA,IAAA,CAAA,IAAA,CAAKrF,KAAL,CAAWqE,OAAX,CAAmB,SAAChB,IAAD,CAAU,CAC5B,MAAI,CAAChF,QAAL,CAAckB,MAAd,CAAqB2K,MAArB,CAA4B7G,IAAI,CAAC0F,cAAjC,EACA,CAFD,CADQ,CAIR,IAAKpE,CAAAA,gBAAL,GACA,CAED;AACD;AACA,mCACC,SAAkB,eAAA,EAAA,CACjB,IAAKtG,CAAAA,QAAL,CAAckB,MAAd,CACE4K,QADF,CACW,CACTC,MAAM,CAAE,8BADC,CAETC,KAAK,CAAE,0BAFE,CAGTC,IAAI,CAAE,IAAKC,CAAAA,QAAL,CAAchK,IAAd,CAAmB,IAAnB,CAHG,CAITiK,IAAI,CAAE,IAAA,CAAKC,QAAL,CAAclK,IAAd,CAAmB,IAAnB,CAJG,CADX,CAAA,CAOEmK,gBAPF,EAAA,CAQEzL,EARF,CAQK,WARL,CAQkB,8BARlB,CAQkD,UAAY,CAC5D,IAAA,CAAK0L,KAAL,GACA,CAVF,EAWA,CAED;AACD;AACA;AACA;AACA;AACA,2CACC,SAAwB3K,uBAAAA,CAAAA,KAAxB,CAA+B4K,QAA/B,CAAyC,CACpCC,IAAAA,MAAAA,CAAAA,IAAAA,CAAAA,OAAO,CAAG,SAACxH,IAAD,CAAO6B,QAAP,CAAiBC,QAAjB,CAA8B,CAC3C9B,IAAI,CAACwH,OAAL,CAAe,MAAI,CAACzF,iBAAL,CAAuB/B,IAAvB,CAA6B6B,QAA7B,CAAuCC,QAAvC,CAD4B,CAE3C,MAAI,CAACL,mBAAL,CAAyBzB,IAAI,CAACT,IAA9B,CAAoC,gBAApC,CAAsDS,IAAI,CAACwH,OAA3D,CAF2C,CAG3CD,QAAQ,CAACvH,IAAI,CAACwH,OAAN,EACR,CALuC,CAMxC7K,KAAK,CAACqE,OAAN,CAAc,SAAChB,IAAD,CAAU,CACnBA,IAAI,YADe,IAAA,CAEtB,MAAI,CAAC4B,uBAAL,CAA6B5B,IAA7B,CAAmC,SAAC6B,QAAD,CAAWC,QAAX,CAAwB,CAC1D0F,OAAO,CAACxH,IAAD,CAAO6B,QAAP,CAAiBC,QAAjB,EACP,CAFD,CAFsB,CAMtB,MAAI,CAAC2F,wBAAL,CAA8BzH,IAA9B,CAAoC,SAAC6B,QAAD,CAAWC,QAAX,CAAwB,CAC3D0F,OAAO,CAACxH,IAAD,CAAO6B,QAAP,CAAiBC,QAAjB,EACP,CAFD,EAID,CAVD,EAWA,CAED;AACD;AACA;AACA;AACA;AACA,KACC,CAAA,CAAA,GAAA,CAAA,yBAAA,CAAA,KAAA,CAAA,SAAA,uBAAA,CAAwB9B,IAAxB,CAA8BuH,QAA9B,CAAwC,CACjCG,IAAAA,MAAAA,CAAAA,IAAAA,CAAAA,EAAE,CAAG,IAD4B,UAAA,CAEvCA,EAAE,CAACC,MAAH,CAAY,UAAM,CACjB3H,IAAI,CAAC8B,QAAL,CAAgB4F,EAAE,CAACxL,MADF,CAEjB,MAAI,CAACuF,mBAAL,CAAyBzB,IAAI,CAACT,IAA9B,CAAoC,UAApC,CAAgDS,IAAI,CAAC8B,QAArD,CAFiB,CAGjByF,QAAQ,CAAC,MAAI,CAACK,aAAL,CAAmB5H,IAAnB,CAAD,CAA2B0H,EAAE,CAACxL,MAA9B,EACR,CANsC,CAOvCwL,EAAE,CAACG,aAAH,CAAiB7H,IAAjB,EACA,CAED;AACD;AACA;AACA;AACA;AACA,4CACC,SAAyBA,wBAAAA,CAAAA,IAAzB,CAA+BuH,QAA/B,CAAyC,CACxCA,QAAQ,CAAC,KAAKK,aAAL,CAAmB5H,IAAnB,CAAD,CAA2BA,IAAI,CAAC8B,QAAhC,EACR,CACD;AACD;AACA;AACA;AACA,KACC,CAAA,CAAA,GAAA,CAAA,eAAA,CAAA,KAAA,CAAA,SAAA,aAAA,CAAc9B,IAAd,CAAoB,CACbsG,IAAAA,SAAS,CAAGzC,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CADC,CAEbgE,IAAI,CAAGjE,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAFM,CAGnBgE,IAAI,CAACrD,YAAL,CAAkB,OAAlB,CAA2B,6CAA3B,CAHmB,CAInBqD,IAAI,CAACrD,YAAL,CAAkB,IAAlB,CAAA,+BAAA,CAAA,MAAA,CAAwDzE,IAAI,CAACT,IAA7D,CAAA,CAJmB,CAKnBuI,IAAI,CAACrD,YAAL,CAAkB,WAAlB,CAA+BzE,IAAI,CAACT,IAApC,CALmB,CAOnB,IAAgB,UAAA,CAAGsE,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAnB,CASA,OARAiE,UAAU,CAACtD,YAAX,CAAwB,OAAxB,CAAiC,sEAAjC,CAQA,CAPAsD,UAAU,CAACtD,YAAX,CAAwB,WAAxB,CAAqCzE,IAAI,CAACT,IAA1C,CAOA,CANAwI,UAAU,CAACtD,YAAX,CAAwB,OAAxB,CAAA,uBAAA,CAAA,MAAA,CAAyDzE,IAAI,CAAC8B,QAA9D,CAAA,GAAA,CAAA,CAMA,CALAiG,UAAU,CAACtD,YAAX,CAAwB,UAAxB,CAAoC,GAApC,CAKA,CAJAsD,UAAU,CAACtD,YAAX,CAAwB,OAAxB,CAAiCzE,IAAI,CAACqB,IAAtC,CAIA,CAHAyG,IAAI,CAAC9D,WAAL,CAAiB+D,UAAjB,CAGA,CAFAzB,SAAS,CAACtC,WAAV,CAAsB8D,IAAtB,CAEA,CAAOxB,SAAS,CAAC1B,SACjB,CAED;AACD;AACA,KACC,CAAA,CAAA,GAAA,CAAA,mBAAA,CAAA,KAAA,CAAA,SAAA,iBAAA,EAAoB,CACnB,IAAA,OAAA,CAAA,IAAA,CAAA,IAAA,CAAKjI,KAAL,CAAa,IAAA,CAAKA,KAAL,CACXsF,GADW,CACP,SAACjC,IAAD,CAAU,CAEd,OADAA,IAAI,CAACT,IAAL,CAAYX,GAAG,CAACC,MAAJ,CAAW+D,IAAX,CAAgBC,kBAAhB,CAAmCrG,MAAM,CAACsG,MAA1C,CACZ,CAAO9C,IACP,CAJW,CAAA,CAKXgI,KALW,CAKL,CALK,CAKF,IAAK/M,CAAAA,OAAL,CAAaqB,KALX,CADM,CAOnB,IAAA,CAAK2L,uBAAL,CAA6B,IAAA,CAAKtL,KAAlC,CAAyC,SAAC5B,OAAD,CAAa,CACrD,OAAI,CAACC,QAAL,CAAckB,MAAd,CAAqB2K,MAArB,CAA4B9L,OAA5B,EACA,CAFD,CAPmB,CAUnB,IAAKuG,CAAAA,gBAAL,GACA,CAED;AACD;AACA;AACA;AACA,oCACC,SAAiB/B,gBAAAA,CAAAA,IAAjB,CAAuB,CACtB,GAAyB,CAArB,EAAA,IAAA,CAAK5C,KAAL,CAAWpB,MAAf,CAA4B,CAC3B,IAAMgF,QAAQ,CAAG,IAAKC,CAAAA,WAAL,CAAiBjB,IAAjB,CAAjB,CACA,OAAA,qCAAA,CAAA,MAAA,CAA0CgB,QAAQ,CAACuB,QAAnD,CACA,KAAA,CAAA,CACD,IAAID,QAAQ,8BAAwBtC,IAAxB,CAAA,4HAAA,CAAZ,CAkBA,YAhBK5C,KAAL,CAAWqE,OAAX,CAAmB,SAAChB,IAAD,CAAU,CAC5B6B,QAAQ,+CADoB,CAExB7B,IAAI,CAACT,IAAL,GAAcA,IAFU,GAG3BsC,QAAQ,EAAA,SAHmB,EAK5BA,QAAQ,EAAA,iBAAA,CAAA,MAAA,CAAoB7B,IAAI,CAACT,IAAzB,CACiDS,sEAAAA,CAAAA,CAAAA,MAAAA,CAAAA,IAAI,CAAC8B,QADtD,wBAGR,CARD,CAgBA,CAPAD,QAAQ,8GAAsGtC,IAAtG,CAAA,0RAAA,CAAA,CAAA,MAAA,CAG2FA,IAH3F,CAOR,6LAAA,CAAA,CAAOsC,QACP;;"}