{"version":3,"file":"RecordConverter.min.js","sources":["RecordConverter.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 5.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n$.Class(\n\t'Base_RecordConverter_JS',\n\t{},\n\t{\n\t\tcontainer: false,\n\t\t/**\n\t\t * Function get values for request query\n\t\t * @returns {{module: string, view: string, fieldMerge: string, onlyBody: boolean, destinyModule: string, sourceView: string}}\n\t\t */\n\t\tgetParams: function () {\n\t\t\tlet params = {\n\t\t\t\tmodule: this.container.data('module'),\n\t\t\t\tview: this.container.data('view'),\n\t\t\t\tconvertId: this.container.find('.js-convert-type option:selected').val(),\n\t\t\t\tsourceView: this.container.find('[name=\"sourceView\"]').val()\n\t\t\t};\n\t\t\tif (app.getViewName() === 'List') {\n\t\t\t\tlet listInstance = Vtiger_List_Js.getInstance();\n\t\t\t\tparams.selected_ids = listInstance.readSelectedIds(true);\n\t\t\t\tparams.excluded_ids = listInstance.readExcludedIds(true);\n\t\t\t\tparams.cvId = listInstance.getCurrentCvId();\n\t\t\t\tif (listInstance.getListSearchInstance()) {\n\t\t\t\t\tlet searchValue = listInstance.getListSearchInstance().getAlphabetSearchValue();\n\t\t\t\t\tparams.search_params = JSON.stringify(listInstance.getListSearchInstance().getListSearchParams());\n\t\t\t\t\tif (typeof searchValue != 'undefined' && searchValue.length > 0) {\n\t\t\t\t\t\tparams.search_key = listInstance.getListSearchInstance().getAlphabetSearchField();\n\t\t\t\t\t\tparams.search_value = searchValue;\n\t\t\t\t\t\tparams.operator = 's';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tparams.selected_ids = app.getRecordId();\n\t\t\t}\n\t\t\treturn params;\n\t\t},\n\t\t/**\n\t\t * Function load modal window\n\t\t * @returns {object}\n\t\t */\n\t\tloadModalWindow: function () {\n\t\t\tconst body = this.container.find('.js-modal-body');\n\t\t\tconst aDeferred = $.Deferred();\n\t\t\tconst progressIndicatorElement = $.progressIndicator({\n\t\t\t\tblockInfo: {\n\t\t\t\t\tenabled: true\n\t\t\t\t}\n\t\t\t});\n\t\t\tapp.hideModalWindow(body.closest('.js-modal-container').attr('id'));\n\t\t\tapp.showModalWindow({\n\t\t\t\turl: app.convertObjectToUrl(this.getParams()),\n\t\t\t\tcb: function (_) {\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn aDeferred.promise();\n\t\t},\n\t\t/**\n\t\t * Function listener to change convert type\n\t\t */\n\t\tregisterChangeConvertType: function () {\n\t\t\tthis.container.on('change', '.js-convert-type', (e) => {\n\t\t\t\tthis.loadModalWindow();\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Function listener to send a form\n\t\t * * @returns {object}\n\t\t */\n\t\tregisterSubmitForm: function () {\n\t\t\tlet self = this;\n\t\t\tself.container.on('click', \"[name='saveButton']\", (e) => {\n\t\t\t\tlet formMapping = self.container.find('form.js-form-converter');\n\t\t\t\tif (formMapping.validationEngine('validate')) {\n\t\t\t\t\tlet formData = formMapping.serializeFormData();\n\t\t\t\t\tlet postData = {};\n\t\t\t\t\tif (app.getViewName() === 'List') {\n\t\t\t\t\t\tlet listInstance = Vtiger_List_Js.getInstance();\n\t\t\t\t\t\tpostData = listInstance.getDefaultParams();\n\t\t\t\t\t\tpostData.selected_ids = listInstance.readSelectedIds(true);\n\t\t\t\t\t\tpostData.excluded_ids = listInstance.readExcludedIds(true);\n\t\t\t\t\t\tpostData.cvid = listInstance.getCurrentCvId();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpostData = {\n\t\t\t\t\t\t\tselected_ids: app.getRecordId()\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\tpostData.viewInfo = app.getViewName();\n\t\t\t\t\tconst aDeferred = $.Deferred();\n\t\t\t\t\tconst progressIndicatorElement = $.progressIndicator({\n\t\t\t\t\t\tblockInfo: {\n\t\t\t\t\t\t\tenabled: true,\n\t\t\t\t\t\t\telementToBlock: self.container.find('.modal-body')\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tAppConnector.request($.extend(formData, postData)).done(\n\t\t\t\t\t\tfunction (responseData) {\n\t\t\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\t\tresponseData = JSON.parse(responseData);\n\t\t\t\t\t\t\tif (responseData.result.redirect) {\n\t\t\t\t\t\t\t\twindow.location.href = responseData.result.redirect;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (responseData.result.createdRecords) {\n\t\t\t\t\t\t\t\t\tVtiger_Helper_Js.showMessage({\n\t\t\t\t\t\t\t\t\t\ttext: app.vtranslate(responseData.result.createdRecords),\n\t\t\t\t\t\t\t\t\t\ttype: 'success'\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (responseData.result.error) {\n\t\t\t\t\t\t\t\t\tVtiger_Helper_Js.showMessage({\n\t\t\t\t\t\t\t\t\t\ttext: app.vtranslate(responseData.result.error),\n\t\t\t\t\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tapp.hideModalWindow();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\taDeferred.resolve(responseData);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfunction (textStatus, errorThrown) {\n\t\t\t\t\t\t\taDeferred.reject(textStatus, errorThrown);\n\t\t\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\treturn aDeferred.promise();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Register events function\n\t\t * @param modalContainer\n\t\t */\n\t\tregisterEvents: function (modalContainer) {\n\t\t\tthis.container = modalContainer;\n\t\t\tthis.registerChangeConvertType();\n\t\t\tthis.registerSubmitForm();\n\t\t\tthis.container.find('form.js-form-converter').validationEngine(app.validationEngineOptions);\n\t\t}\n\t}\n);\n"],"names":["$","Class","container","getParams","params","module","data","view","convertId","find","val","sourceView","app","getViewName","Vtiger_List_Js","getInstance","selected_ids","listInstance","readSelectedIds","excluded_ids","readExcludedIds","cvId","getCurrentCvId","getListSearchInstance","getAlphabetSearchValue","search_params","JSON","stringify","getListSearchParams","searchValue","length","search_key","getAlphabetSearchField","search_value","operator","getRecordId","loadModalWindow","aDeferred","Deferred","progressIndicatorElement","progressIndicator","blockInfo","enabled","hideModalWindow","body","closest","attr","showModalWindow","url","convertObjectToUrl","cb","mode","promise","registerChangeConvertType","on","registerSubmitForm","self","formMapping","validationEngine","serializeFormData","postData","getDefaultParams","cvid","viewInfo","elementToBlock","request","extend","formData","done","responseData","parse","result","redirect","window","location","href","createdRecords","Vtiger_Helper_Js","showMessage","text","vtranslate","type","error","resolve","textStatus","errorThrown","reject","registerEvents","modalContainer","validationEngineOptions"],"mappings":"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"}