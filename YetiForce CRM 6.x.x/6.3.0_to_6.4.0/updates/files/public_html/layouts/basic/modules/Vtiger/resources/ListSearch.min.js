'use strict';

/* {[The file is published on the basis of YetiForce Public License 5.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */"use strict";function _typeof(obj){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}jQuery.Class("YetiForce_ListSearch_Js",{getInstance:function getInstance(container,noEvents,reletedInstance,moduleName){"undefined"==typeof moduleName&&(moduleName=app.getModuleName());var instance,moduleClassName=module+"_ListSearch_Js";return instance="undefined"==typeof window[moduleClassName]?new window.YetiForce_ListSearch_Js(container,noEvents,reletedInstance):new window[moduleClassName](container,noEvents,reletedInstance),instance.moduleName=moduleName,instance},registerSearch:function registerSearch(container,callBack){container.on("click",".js-change-order",function(e){var element=$(e.currentTarget);callBack({orderby:_defineProperty({},element.data("columnname"),element.data("nextsortorderval"))});}),container.on("click",".js-listview_header",function(e){var element=$(e.currentTarget);callBack({orderby:element.data("columnname"),sortorder:element.data("nextsortorderval")});}),container.on("click",".js-list-reload",function(e,data){callBack(data);});}},{moduleName:!1,container:!1,reletedInstance:!1,viewName:!1,init:function init(container,noEvents,reletedInstance){"undefined"==typeof container&&(container=jQuery(".bodyContents")),this.setContainer(container),!0!=noEvents&&this.getContainer().find("[data-trigger=\"listSearch\"]").length&&this.initialize(),this.reletedInstance=reletedInstance;},setContainer:function setContainer(container){this.container=container;},getContainer:function getContainer(){return this.container},setViewName:function setViewName(viewName){this.viewName=viewName;},/**
		 * Function  to initialize the advance filter
		 */initialize:function initialize(){this.registerEvents();},getAlphabetSearchField:function getAlphabetSearchField(){return jQuery("#alphabetSearchKey").val()},getAlphabetSearchValue:function getAlphabetSearchValue(){return jQuery("#alphabetValue").val()},registerListSearch:function registerListSearch(){var _this=this,listViewContainer=this.getContainer();listViewContainer.find("[data-trigger=\"listSearch\"]").on("click",function(){_this.reloadList();}),listViewContainer.find("input.listSearchContributor").on("keypress",function(e){13==e.keyCode&&_this.triggerListSearch();}),listViewContainer.find(".removeSearchConditions").on("click",function(){_this.reloadList({search_params:[],search_key:"",search_value:"",operator:"",lockedEmptyFields:[]});}),this.registerListSearchEmptyValue();},/**
		 * Register list search if value empty.
		 * @param {array} params
		 * @returns {array}
		 */parseConditions:function parseConditions(params){var listViewContainer=this.getContainer(),lockedEmptyFields=[],lockedInput=listViewContainer.find(".js-empty-fields").val();return !lockedInput||(lockedEmptyFields=JSON.parse(lockedInput)),listViewContainer.find(".js-empty-value").each(function(){var element=$(this),parentField=element.parents(".searchField").find(".listSearchContributor"),fieldName=parentField.attr("name"),moduleName=parentField.data("module-name"),sourceFieldName=parentField.data("source-field-name");if(void 0!==moduleName&&void 0!==sourceFieldName&&(fieldName=fieldName+":"+moduleName+":"+sourceFieldName),element.is(":checked")){-1==$.inArray(fieldName,lockedEmptyFields)&&lockedEmptyFields.push(fieldName);for(var state=0,i=0;i<params.search_params[0].length;i++)params.search_params[0][i][0]===fieldName&&(params.search_params[0][i]=[fieldName,"y",""],state=1);state||params.search_params[0].push([fieldName,"y",""]);}else for(var _i=0;_i<lockedEmptyFields.length;_i++)lockedEmptyFields[_i]===fieldName&&lockedEmptyFields.splice(_i,1);}),params.lockedEmptyFields=lockedEmptyFields,params},/**
		 * Register list search if value empty.
		 */registerListSearchEmptyValue:function registerListSearchEmptyValue(){var listViewContainer=this.getContainer(),self=this;listViewContainer.find(".js-empty-value").each(function(){var element=$(this);element.on("click",function(){self.reloadList();});});},registerListViewSelect:function registerListViewSelect(){var _this2=this,self=this,listViewContainer=this.getContainer();listViewContainer.find(".listViewEntriesTable .select2noactive").each(function(index,domElement){var select=$(domElement);select.data("select2")||App.Fields.Picklist.showSelect2ElementView(select,{placeholder:app.vtranslate("JS_SELECT_AN_OPTION")});}),"1"==app.getMainParams("autoRefreshListOnChange")&&(listViewContainer.find(".listViewEntriesTable select, .searchInSubcategories").on("change",function(){_this2.triggerListSearch();}),listViewContainer.find(".listViewEntriesTable .picklistSearchField").on("apply.daterangepicker",function(){_this2.triggerListSearch();}),listViewContainer.find(".listViewEntriesTable .dateField").on("DatePicker.onHide",function(){var prevVal=$(this).data("prevVal"),value=$(this).val();prevVal!=value&&self.triggerListSearch();}),app.event.off("Clockpicker.changed"),app.event.on("Clockpicker.changed",function(e,inputEl){listViewContainer.find(inputEl).length&&self.triggerListSearch();}),listViewContainer.find(".listViewEntriesTable .js-tree-container .listSearchContributor").on("change",function(){_this2.triggerListSearch();}));},resetPagination:function resetPagination(){//To unmark the all the selected ids
//To Set the page number as first page
jQuery("#deSelectAllMsg").trigger("click"),jQuery("#recordsCount").val(""),jQuery("#pageNumber").val("1"),jQuery("#pageToJump").val("1"),jQuery("#totalPageCount").text(""),jQuery(".pagination").data("totalCount",0);},triggerListSearch:function triggerListSearch(){var listInstance=this,listViewContainer=listInstance.getContainer();listViewContainer.find("[data-trigger=\"listSearch\"]").trigger("click");},registerDateListSearch:function registerDateListSearch(){App.Fields.Date.registerRange(this.getContainer().find(".dateRangeField"));},registerDateTimeListSearch:function registerDateTimeListSearch(){App.Fields.DateTime.register(this.getContainer());},registerTimeListSearch:function registerTimeListSearch(){app.registerEventForClockPicker();},registerAlphabetClick:function registerAlphabetClick(){var thisInstance=this;this.getContainer().find(".alphabetBtn").on("click",function(){app.showModalWindow($(".alphabetModal").html(),function(data){thisInstance.registerEventForAlphabetSearch(data);});});},getCurrentCvId:function getCurrentCvId(){return jQuery("#customFilter").find("option:selected").data("id")},registerEventForAlphabetSearch:function registerEventForAlphabetSearch(modalContainer){var thisInstance=this;modalContainer.find(".alphabetSearch").on("click",function(e){var alphabet=$(e.currentTarget).find("a").text(),cvId=thisInstance.getCurrentCvId(),AlphabetSearchKey=thisInstance.getAlphabetSearchField();thisInstance.resetPagination(),thisInstance.reloadList({viewname:cvId,search_key:AlphabetSearchKey,search_value:alphabet,operator:"s",page:1}),app.hideModalWindow(!1,modalContainer.parent().attr("id"));}),modalContainer.find(".removeAlfabetCondition").on("click",function(){thisInstance.reloadList({search_key:"",search_value:"",operator:""}),app.hideModalWindow(!1,modalContainer.parent().attr("id"));});},updatePaginationOnAlphabetChange:function updatePaginationOnAlphabetChange(alphabet,AlphabetSearchKey){var thisInstance=this,params={};params.module=thisInstance.moduleName,params.parent=app.getParentModuleName(),params.view="Pagination",params.page=1,params.mode="getPagination",params.search_key=AlphabetSearchKey,params.search_value=alphabet,params.operator="s",AppConnector.request(params).done(function(data){jQuery(".paginationDiv").html(data);var instance=thisInstance.getInstanceView();instance&&jQuery.isFunction(instance.registerPageNavigationEvents)&&instance.registerPageNavigationEvents();});},getListSearchParams:function getListSearchParams(urlSearchParams){var listViewPageDiv=this.getContainer(),listViewTable=listViewPageDiv.find(".listViewEntriesTable"),searchParams=[];if(listViewTable.find(".listSearchContributor").each(function(index,domElement){var searchInfo=[],searchContributorElement=$(domElement),fieldInfo=searchContributorElement.data("fieldinfo"),fieldName=searchContributorElement.attr("name"),searchValue=searchContributorElement.val();if("object"==_typeof(searchValue)?null==searchValue?searchValue="":searchValue=searchValue.join("##"):0<=$.inArray(fieldInfo.type,["tree"])&&(searchValue=searchValue.replace(/,/g,"##")),searchValue=searchValue.trim(),0>=searchValue.length)return !0;var searchOperator="a";fieldInfo.hasOwnProperty("searchOperator")?searchOperator=fieldInfo.searchOperator:0<=$.inArray(fieldInfo.type,["modules","time","userCreator","owner","picklist","tree","boolean","fileLocationType","userRole","multiReferenceValue","inventoryLimit","currencyList"])?searchOperator="e":"date"==fieldInfo.type||"datetime"==fieldInfo.type?searchOperator="bw":-1!=$.inArray(fieldInfo.type,["multipicklist","categoryMultipicklist","multiListFields","mailScannerFields","mailScannerActions"])&&(searchOperator="c");var sourceFieldName=searchContributorElement.data("sourceFieldName");sourceFieldName?searchInfo.push(fieldName+":"+searchContributorElement.data("moduleName")+":"+sourceFieldName):searchInfo.push(fieldName),-1!=$.inArray(fieldInfo.type,["tree","categoryMultipicklist"])&&$(".searchInSubcategories[data-columnname=\""+fieldName+"\"]",listViewTable).prop("checked")&&(searchOperator="ch"),searchInfo.push(searchOperator),searchInfo.push(searchValue),searchParams.push(searchInfo);}),urlSearchParams&&listViewPageDiv.find("#search_params").length){var valueInSearch=null,url=listViewPageDiv.find("#search_params").val();null!=url&&url.length&&(url=JSON.parse(url),$.each(url[0],function(index,value){var exist=!1;if($.each(searchParams,function(index,searchParam){searchParam[0]==value[0]&&(exist=!0);}),-1===value[0].indexOf(":"))valueInSearch=listViewTable.find(".listSearchContributor[name=\""+value[0]+"\"]").val();else {var fieldRelation=value[0].split(":");valueInSearch=listViewTable.find(".listSearchContributor[name=\""+fieldRelation[0]+"\"][data-module-name=\""+fieldRelation[1]+"\"][data-source-field-name=\""+fieldRelation[2]+"\"]").val();}!1==exist&&""!=valueInSearch&&null!==valueInSearch&&searchParams.push(value);}));}return [searchParams]},getInstanceByView:function getInstanceByView(){var viewName=this.viewName?this.viewName:app.getViewName(),instance=!1;return "RecordsList"===viewName?(instance=this.reletedInstance,instance.reloadFunctionName="loadRecordList",instance.execute=["updatePagination"]):this.reletedInstance?(instance=this.reletedInstance,instance.reloadFunctionName="loadRelatedList"):"Detail"===viewName?(instance=Vtiger_Detail_Js.getInstance(),instance.reloadFunctionName="loadRelatedList"):"List"===viewName||"Tiles"===viewName?(instance=new Vtiger_List_Js,instance.reloadFunctionName="getListViewRecords",instance.execute=["updatePagination"]):"ListPreview"===viewName&&(instance=window.pageController,instance.reloadFunctionName="getListViewRecords",instance.execute=["updatePagination"]),instance},reloadList:function reloadList(params){var thisInstance=this;params==null&&(params={page:1,totalCount:0});var instance=this.getInstanceByView();if(instance){var funcName=instance.reloadFunctionName;jQuery.isFunction(instance[funcName])&&instance[funcName](params).done(function(){thisInstance.resetPagination(),thisInstance.executeFunctions(instance);});}},executeFunctions:function executeFunctions(instance){if(instance.execute){var func=instance.execute;for(var i in func){var funcName=func[i];jQuery.isFunction(instance[funcName])&&instance[funcName]();}}},registerBasicEvents:function registerBasicEvents(){this.registerListViewSelect(),this.registerDateListSearch(),this.registerDateTimeListSearch(),this.registerTimeListSearch(),this.registerAlphabetClick(),this.registerListSearch(),this.getContainer().find("select.select2").each(function(i,obj){$(obj).data("select2")||App.Fields.Picklist.showSelect2ElementView($(obj));}),App.Fields.Tree.register(this.container);},/**
		 * Function which will regiter all events for this page
		 */registerEvents:function registerEvents(){this.registerBasicEvents();}});
//# sourceMappingURL=ListSearch.min.js.map
