'use strict';

/**
 * Fields dependency edit view js class
 *
 * @package     Settings.Edit
 *
 * @description Fields dependency edit view scripts
 * @license     YetiForce Public License 5.0
 * @author      Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>
 */"use strict";$.Class("Settings_FieldsDependency_Edit_Js",{},{/**
		 * Register submit event
		 */registerSubmitEvent:function registerSubmitEvent(){var _this=this;this.container.off("submit").on("submit",function(e){return $(e.currentTarget).validationEngine("validate")?(_this.container.find("input[name=\"conditions\"]").val(JSON.stringify(_this.conditionBuilder.getConditions())),!0):(e.preventDefault(),e.stopPropagation(),!1)});},/**
		 * Load condition builder
		 */loadConditionBuilderView:function loadConditionBuilderView(){this.conditionBuilder=new Vtiger_ConditionBuilder_Js(this.container.find(".js-condition-builder"),this.sourceModule),this.conditionBuilder.registerEvents();},/**
		 * Register source module change
		 */registerSourceModuleChange:function registerSourceModuleChange(){var _this2=this,select=this.container.find("#inputSourceModule"),blocks=this.container.find(".js-dynamic-blocks");select.on("change",function(){_this2.sourceModule=select.find("option:selected").data("module"),blocks.html(""),AppConnector.request({module:app.getModuleName(),parent:app.getParentModuleName(),view:"Edit",mode:"dynamic",selectedModule:_this2.sourceModule}).done(function(data){blocks.html(data),App.Fields.Picklist.changeSelectElementView(blocks),_this2.loadConditionBuilderView();});});},registerAddDependField:function registerAddDependField(){var _this3=this;this.container.find(".js-dependence-add-field").on("click",function(){var progress=$.progressIndicator({position:"html",blockInfo:{enabled:!0}});_this3.sourceModule=select.find("option:selected").data("module"),AppConnector.request({module:app.getModuleName(),parent:app.getParentModuleName(),view:"FieldDependence",mode:"dependencyRow",selectedModule:_this3.sourceModule}).done(function(data){progress.progressIndicator({mode:"hide"}),blocks.html(data),App.Fields.Picklist.changeSelectElementView(blocks),_this3.loadConditionBuilderView();});});},/**
		 * Register events
		 */registerEvents:function registerEvents(){this.container=$("#EditView"),this.sourceModule=this.container.find("#inputSourceModule").data("module"),this.record=this.container.find("input[name=\"record\"]").val(),this.registerSourceModuleChange(),this.loadConditionBuilderView(),this.registerSubmitEvent(),this.registerAddDependField(),this.container.validationEngine(app.validationEngineOptions);}});
//# sourceMappingURL=Edit.min.js.map
