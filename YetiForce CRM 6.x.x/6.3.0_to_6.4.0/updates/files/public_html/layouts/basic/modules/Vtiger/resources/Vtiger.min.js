'use strict';

/*+***********************************************************************************
 * The contents of this file are subject to the vtiger CRM Public License Version 1.0
 * ("License"); You may not use this file except in compliance with the License
 * The Original Code is:  vtiger CRM Open Source
 * The Initial Developer of the Original Code is vtiger.
 * Portions created by vtiger are Copyright (C) vtiger.
 * All Rights Reserved.
 * Contributor(s): YetiForce S.A.
 *************************************************************************************/"use strict";var Vtiger_Index_Js={showLocation:function showLocation(element){app.showModalWindow(null,"index.php?module=OpenStreetMap&view=MapModal",function(container){var mapView=new OpenStreetMap_Map_Js;mapView.registerModalView(container),container.find(".searchValue").val($(element).data("location")),container.find(".searchBtn").trigger("click");});},getEmailFromRecord:function getEmailFromRecord(record,module,maxEmails){var aDeferred=$.Deferred(),progress=$.progressIndicator({position:"html",blockInfo:{enabled:!0}});return AppConnector.request({dataType:"html",data:{module:"OSSMail",action:"GetMail",sourceModule:module,sourceRecord:record,maxEmails:maxEmails}}).done(function(data){progress.progressIndicator({mode:"hide"}),"{"==data.substring(0,1)?(data=JSON.parse(data),data=data.result,aDeferred.resolve(data)):app.showModalWindow(data,function(data){data.find(".selectButton").on("click",function(){if(data.find("input:checked").length){var email=data.find("input:checked").val();app.hideModalWindow(),aDeferred.resolve(email);}else app.showNotify({text:app.vtranslate("JS_SELECT_AN_OPTION"),type:"info"});});});}).fail(function(error){progress.progressIndicator({mode:"hide"}),aDeferred.reject(error);}),aDeferred.promise()},registerMailButtons:function registerMailButtons(container){var thisInstance=this;container.find(".sendMailBtn:not(.mailBtnActive)").each(function(){var sendButton=$(this);sendButton.addClass("mailBtnActive"),sendButton.on("click",function(e){e.stopPropagation();var url=sendButton.data("url"),popup=sendButton.data("popup"),toMail=sendButton.data("to");toMail&&(url+="&to="+encodeURIComponent(toMail)),app.getRecordId()&&sendButton.data("record")!==app.getRecordId()&&(url+="&crmModule="+app.getModuleName()+"&crmRecord="+app.getRecordId()),thisInstance.sendMailWindow(url,popup);});});},sendMailWindow:function sendMailWindow(url,popup,postData){if(popup){var width=screen.width-15,height=screen.height-150;if(null==postData)return void window.open(url,"_blank","width="+width+", height="+height+", left="+0+", top="+30+",resizable=yes,scrollbars=yes,toolbar=no,menubar=no,location=no,status=no,menubar=no");var form=$("<form/>",{action:"index.php"});for(var i in url.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(m,key,value){form.append($("<input>",{name:key,value:value}));}),postData)form.append($("<input>",{name:i,value:JSON.stringify(postData[i])}));$("body").append(form),form.trigger("submit");}else window.location.href=url;},/**
	 * Function to change user theme(colour)
	 * @params : colour name
	 */changeSkin:function changeSkin(){$(".themeElement").on("click",function(e){e.stopPropagation();var currentElement=$(e.currentTarget);currentElement.closest("#themeContainer").hide();var progressElement=$("#progressDiv");progressElement.progressIndicator();var params={module:"Users",action:"SaveAjax",record:CONFIG.userId,field:"theme",value:currentElement.data("skinName")};AppConnector.request(params).done(function(data){data.success&&data.result&&(progressElement.progressIndicator({mode:"hide"}),$(".settingIcons").removeClass("open"),window.location.reload());}).fail(function(){});});},markNotifications:function markNotifications(id){var aDeferred=$.Deferred(),thisInstance=this;return AppConnector.request({module:"Notification",action:"Notification",mode:"setMark",record:id}).done(function(data){var row=$(".notificationEntries .noticeRow[data-id=\""+id+"\"]");app.showNotify({title:app.vtranslate("JS_MESSAGE"),text:app.vtranslate("JS_MARKED_AS_READ"),type:"info"}),row.length&&(row.fadeOut(300,function(){var entries=row.closest(".notificationEntries");row.remove(),entries.each(function(){var block=$(this);0==block.find(".noticeRow").length&&block.closest(".panel").hide();});}),thisInstance.getNotificationsForReminder()),aDeferred.resolve(data);}).fail(function(textStatus,errorThrown){app.errorLog(textStatus,errorThrown),aDeferred.reject(textStatus,errorThrown);}),aDeferred.promise()},/**
	 * Function registers event for Reminder popups
	 */registerReminders:function registerReminders(){var activityReminder=1e3*(parseInt(app.getMainParams("activityReminder"))||0);0!=activityReminder&&$(".remindersNotice.autoRefreshing").length&&(Vtiger_Index_Js.requestReminder(),window.reminder=setInterval(function(){Vtiger_Index_Js.requestReminder();},activityReminder));var reminder=1e3*(parseInt(app.getMainParams("intervalForNotificationNumberCheck"))||0);0!=reminder&&$(".notificationsNotice.autoRefreshing").length&&(Vtiger_Index_Js.getNotificationsForReminder(),window.reminderNotifications=setInterval(function(){Vtiger_Index_Js.getNotificationsForReminder();},reminder));},getNotificationsForReminder:function getNotificationsForReminder(){var thisInstance=this,content=$(".remindersNotificationContainer"),element=$(".notificationsNotice");AppConnector.request("index.php?module=Notification&view=Reminders").done(function(data){content.html(data),thisInstance.refreshReminderCount(content,element,"js-count-notifications-reminder"),content.find(".js-set-marked").on("click",function(e){var currentElement=$(e.currentTarget),recordID=currentElement.closest(".js-notification-panel").data("record");thisInstance.markNotifications(recordID).done(function(){currentElement.closest(".js-notification-panel").fadeOut(300,function(){$(this).remove(),thisInstance.refreshReminderCount(content,element,"js-count-notifications-reminder");});});});}).fail(function(){clearInterval(window.reminderNotifications);});},/**
	 * Function request for reminder popups
	 */requestReminder:function requestReminder(){var thisInstance=this,content=$(".remindersNoticeContainer"),element=$(".remindersNotice");AppConnector.request("index.php?module=Calendar&view=Reminders&type_remainder=true").done(function(data){content.html(data),thisInstance.refreshReminderCount(content,element,"countRemindersNotice"),app.registerModal(content),content.find(".reminderPostpone").on("click",function(e){var currentElement=$(e.currentTarget),recordID=currentElement.closest(".js-toggle-panel").data("record"),url="index.php?module=Calendar&action=ActivityReminder&mode=postpone&record="+recordID+"&time="+currentElement.data("time");AppConnector.request(url).done(function(){currentElement.closest(".js-toggle-panel").fadeOut(300,function(){$(this).remove(),thisInstance.refreshReminderCount(content,element,"countRemindersNotice");});});});}).fail(function(){clearInterval(window.reminder);});},refreshReminderCount:function refreshReminderCount(content,element,tag){var badge=element.find(".badge"),count=content.find(".js-toggle-panel").length;badge.text(count),badge.removeClass("d-none"),0<count&&element.hasClass("autoRefreshing")?(element.effect("pulsate",1500),app.cacheGet(tag)!=count&&(app.playSound("REMINDERS"),app.cacheSet(tag,count))):badge.addClass("d-none");},registerResizeEvent:function registerResizeEvent(){$(window).on("resize",function(){this.resizeTO&&clearTimeout(this.resizeTO),this.resizeTO=setTimeout(function(){$(this).trigger("resizeEnd");},600);});},changeWatching:function changeWatching(instance){var value,module,state,user,record;instance!=null&&(instance=$(instance),value=instance.data("value"),module=null==instance.data("module")?app.getModuleName():instance.data("module"),instance.data("user")!=null&&(user=instance.data("user")),instance.data("record")!=null&&(record=instance.data("record"))),app.showConfirmModal({title:app.vtranslate("JS_WATCHING_TITLE"),text:app.vtranslate("JS_WATCHING_MESSAGE"+value),icon:"fas fa-eye",confirmButtonLabel:"LBL_YES",rejectedButtonLabel:"LBL_NO",confirmedCallback:function confirmedCallback(){Vtiger_Index_Js.updateWatching(module,value,user,record).done(function(data){if(instance!=null){var buttonIcon=instance.find(".fas");state=1==data.result?0:1,instance.data("value",state),1==state?(instance.toggleClass(instance.data("off")+" "+instance.data("on")),buttonIcon.removeClass("fas fa-eye"),buttonIcon.addClass("fas fa-eye-slash")):(instance.toggleClass(instance.data("on")+" "+instance.data("off")),buttonIcon.removeClass("fas fa-eye-slash"),buttonIcon.addClass("fas fa-eye"));}});}});},updateWatching:function updateWatching(module,value,user,record){var aDeferred=$.Deferred(),params={module:module,action:"Watchdog",state:value};return null!=user&&(params.user=user),null!=record&&0!=record&&(params.record=record),AppConnector.request(params).done(function(data){aDeferred.resolve(data);}).fail(function(textStatus,errorThrown){aDeferred.reject(textStatus,errorThrown),app.errorLog(textStatus,errorThrown);}),aDeferred.promise()},assignToOwner:function assignToOwner(element,userId){element=$(element),userId==null&&(userId=CONFIG.userId);var params={module:element.data("module"),record:element.data("record"),field:"assigned_user_id",value:userId};app.saveAjax("",null,params).done(function(){if(app.hideModalWindow(),"List"===app.getViewName()){var listinstance=new Vtiger_List_Js;listinstance.getListViewRecords();}else "Detail"===app.getViewName()&&document.location.reload();});},sendNotification:function sendNotification(){App.Components.QuickCreate.createRecord("Notification");},performPhoneCall:function performPhoneCall(phoneNumber,record){AppConnector.request({module:app.getModuleName(),view:"BasicAjax",mode:"performPhoneCall",phoneNumber:phoneNumber,record:record}).done(function(response){response=JSON.parse(response),Vtiger_Helper_Js.showMessage({text:response.result});});},registerEvents:function registerEvents(){Vtiger_Index_Js.registerReminders(),Vtiger_Index_Js.changeSkin(),Vtiger_Index_Js.registerResizeEvent();}};//On Page Load
jQuery(function(){Vtiger_Index_Js.registerEvents();});
//# sourceMappingURL=Vtiger.min.js.map
