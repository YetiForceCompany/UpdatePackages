{"version":3,"file":"ModuleImport.min.js","sources":["ModuleImport.js"],"sourcesContent":["/*+***********************************************************************************\n * The contents of this file are subject to the vtiger CRM Public License Version 1.0\n * (\"License\"); You may not use this file except in compliance with the License\n * The Original Code is:  vtiger CRM Open Source\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n *************************************************************************************/\n'use strict';\n\njQuery.Class(\n\t'Settings_Module_Import_Js',\n\t{},\n\t{\n\t\t/**\n\t\t * Function to get import module step1 params\n\t\t */\n\t\tgetImportModuleStep1Params: function () {\n\t\t\tvar params = {\n\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\tparent: app.getParentModuleName(),\n\t\t\t\tview: 'ModuleImport'\n\t\t\t};\n\t\t\treturn params;\n\t\t},\n\n\t\t/**\n\t\t * Function to get import module with respect to view\n\t\t */\n\t\tgetImportModuleStepView: function (params) {\n\t\t\tvar aDeferred = jQuery.Deferred();\n\t\t\tvar progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t\tposition: 'html',\n\t\t\t\tblockInfo: {\n\t\t\t\t\tenabled: true\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tAppConnector.request(params)\n\t\t\t\t.done(function (data) {\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\taDeferred.resolve(data);\n\t\t\t\t})\n\t\t\t\t.fail(function (error) {\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\taDeferred.reject(error);\n\t\t\t\t});\n\t\t\treturn aDeferred.promise();\n\t\t},\n\n\t\t/**\n\t\t * Function to register event for step1 of import module\n\t\t */\n\t\tregisterEventForStep1: function () {\n\t\t\tlet form = $('.js-validation-engine');\n\t\t\tform.validationEngine();\n\t\t\tthis.validationFileZipPath(form);\n\t\t\tvar detailContentsHolder = jQuery('.contentsDiv');\n\t\t\tapp.showScrollBar(jQuery('.extensionDescription'), {\n\t\t\t\theight: '120px',\n\t\t\t\twidth: '100%',\n\t\t\t\trailVisible: true\n\t\t\t});\n\t\t\tthis.registerEventsForImportModuleStep1(detailContentsHolder);\n\t\t},\n\n\t\t/**\n\t\t * Function to validation file zip\n\t\t */\n\t\tvalidationFileZipPath: function (form) {\n\t\t\tform.on('submit', function (e) {\n\t\t\t\tif (typeof form.data('submit') !== 'undefined') {\n\t\t\t\t\treturn false;\n\t\t\t\t} else {\n\t\t\t\t\tlet filePath = form.find('.js-validation-zip').val();\n\t\t\t\t\tlet fileParts = filePath.toLowerCase().split('.');\n\t\t\t\t\tlet fileType = fileParts[fileParts.length - 1];\n\t\t\t\t\tif (fileType == '') {\n\t\t\t\t\t\tlet errorMessage = app.vtranslate('JS_IMPORT_FILE_CAN_NOT_BE_EMPTY');\n\t\t\t\t\t\tlet params = {\n\t\t\t\t\t\t\ttext: errorMessage,\n\t\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t\t};\n\t\t\t\t\t\tVtiger_Helper_Js.showMessage(params);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tif (fileType != 'zip') {\n\t\t\t\t\t\tlet errorMessage = app.vtranslate('JS_SELECT_FILE_EXTENSION') + '\\n' + '.zip';\n\t\t\t\t\t\tlet params = {\n\t\t\t\t\t\t\ttext: errorMessage,\n\t\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t\t};\n\t\t\t\t\t\tVtiger_Helper_Js.showMessage(params);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Function to register event related to Import extrension Modules in step1\n\t\t */\n\t\tregisterEventsForImportModuleStep1: function (container) {\n\t\t\tvar thisInstance = this;\n\t\t\tjQuery(container)\n\t\t\t\t.find('.installExtension')\n\t\t\t\t.on('click', function (e) {\n\t\t\t\t\tvar element = jQuery(e.currentTarget);\n\t\t\t\t\tvar extensionContainer = element.closest('.extension_container');\n\t\t\t\t\tvar extensionId = extensionContainer.find('[name=\"extensionId\"]').val();\n\t\t\t\t\tvar moduleAction = extensionContainer.find('[name=\"moduleAction\"]').val();\n\t\t\t\t\tvar extensionName = extensionContainer.find('[name=\"extensionName\"]').val();\n\t\t\t\t\tvar params = {\n\t\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\t\tparent: app.getParentModuleName(),\n\t\t\t\t\t\tview: 'ModuleImport',\n\t\t\t\t\t\tmode: 'step2',\n\t\t\t\t\t\textensionId: extensionId,\n\t\t\t\t\t\tmoduleAction: moduleAction,\n\t\t\t\t\t\textensionName: extensionName\n\t\t\t\t\t};\n\n\t\t\t\t\tthisInstance.getImportModuleStepView(params).done(function (data) {\n\t\t\t\t\t\tvar detailContentsHolder = jQuery('.contentsDiv');\n\t\t\t\t\t\tdetailContentsHolder.html(data);\n\t\t\t\t\t\tapp.showScrollBar(jQuery('#extensionLicense'), { height: 'auto' });\n\t\t\t\t\t\tthisInstance.registerEventsForImportModuleStep2(detailContentsHolder);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Function to register event related to Import extrension Modules in step2\n\t\t */\n\t\tregisterEventsForImportModuleStep2: function (container) {\n\t\t\tcontainer = jQuery(container);\n\t\t\tvar thisInstance = this;\n\n\t\t\tcontainer.find('#installExtension').on('click', function () {\n\t\t\t\tvar extensionId = jQuery('[name=\"extensionId\"]').val();\n\t\t\t\tvar targetModule = jQuery('[name=\"targetModule\"]').val();\n\t\t\t\tvar moduleType = jQuery('[name=\"moduleType\"]').val();\n\t\t\t\tvar moduleAction = jQuery('[name=\"moduleAction\"]').val();\n\t\t\t\tvar fileName = jQuery('[name=\"fileName\"]').val();\n\n\t\t\t\tvar params = {\n\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\tparent: app.getParentModuleName(),\n\t\t\t\t\tview: 'ModuleImport',\n\t\t\t\t\tmode: 'step3',\n\t\t\t\t\textensionId: extensionId,\n\t\t\t\t\tmoduleAction: moduleAction,\n\t\t\t\t\ttargetModule: targetModule,\n\t\t\t\t\tmoduleType: moduleType,\n\t\t\t\t\tfileName: fileName\n\t\t\t\t};\n\n\t\t\t\tthisInstance.getImportModuleStepView(params).done(function (step3Data) {\n\t\t\t\t\tvar callBackFunction = function (data) {\n\t\t\t\t\t\tvar installationStatus = jQuery(data).find('[name=\"installationStatus\"]').val();\n\t\t\t\t\t\tif (installationStatus == 'success') {\n\t\t\t\t\t\t\tjQuery('#installExtension').remove();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tapp.showScrollBar(jQuery('#installationLog'), { height: '150px' });\n\t\t\t\t\t\tjQuery(data)\n\t\t\t\t\t\t\t.find('#importCompleted')\n\t\t\t\t\t\t\t.on('click', function (e) {\n\t\t\t\t\t\t\t\tcontainer.find('#declineExtension').trigger('click');\n\t\t\t\t\t\t\t});\n\t\t\t\t\t};\n\t\t\t\t\tvar modalData = {\n\t\t\t\t\t\tdata: step3Data,\n\t\t\t\t\t\tunblockcb: function () {\n\t\t\t\t\t\t\tcontainer.find('#declineExtension').trigger('click');\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcss: { width: '60%', height: '40%' },\n\t\t\t\t\t\tcb: callBackFunction\n\t\t\t\t\t};\n\t\t\t\t\tapp.showModalWindow(modalData);\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tcontainer.find('#declineExtension').on('click', function () {\n\t\t\t\tvar params = thisInstance.getImportModuleStep1Params();\n\t\t\t\tthisInstance.getImportModuleStepView(params).done(function (data) {\n\t\t\t\t\tvar detailContentsHolder = jQuery('.contentsDiv');\n\t\t\t\t\tdetailContentsHolder.html(data);\n\t\t\t\t\tthisInstance.registerEventForStep1();\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\n\t\tregisterEvents: function () {\n\t\t\tthis.registerEventForStep1();\n\t\t\t$('.js-form-import-module').on('submit', function () {\n\t\t\t\t$('.js-save-button').attr('disabled', true);\n\t\t\t});\n\t\t}\n\t}\n);\n\njQuery(document).ready(function () {\n\tvar settingModuleImportInstance = new Settings_Module_Import_Js();\n\tsettingModuleImportInstance.registerEvents();\n});\n"],"names":["jQuery","Class","getImportModuleStep1Params","params","module","app","getModuleName","parent","getParentModuleName","view","getImportModuleStepView","aDeferred","Deferred","progressIndicatorElement","progressIndicator","position","blockInfo","enabled","AppConnector","request","done","data","mode","resolve","fail","error","reject","promise","registerEventForStep1","form","$","validationEngine","validationFileZipPath","showScrollBar","height","width","railVisible","registerEventsForImportModuleStep1","detailContentsHolder","on","find","val","fileParts","filePath","toLowerCase","split","fileType","length","vtranslate","showMessage","text","errorMessage","type","container","thisInstance","e","currentTarget","extensionContainer","element","closest","extensionId","moduleAction","extensionName","html","registerEventsForImportModuleStep2","targetModule","moduleType","fileName","step3Data","showModalWindow","unblockcb","trigger","css","cb","installationStatus","remove","registerEvents","attr","document","ready","settingModuleImportInstance"],"mappings":"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"}