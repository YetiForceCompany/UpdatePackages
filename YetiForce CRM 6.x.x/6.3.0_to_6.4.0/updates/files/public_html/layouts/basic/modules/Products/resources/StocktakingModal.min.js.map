{"version":3,"file":"StocktakingModal.min.js","sources":["StocktakingModal.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 5.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\nwindow.Products_StocktakingModal_JS = class {\n\t/**\n\t * Show step by name.\n\t * @param {string} name\n\t */\n\tshowStep(name) {\n\t\tthis.container.find('.js-step').addClass('d-none');\n\t\tthis.container.find(`.js-step[data-step=\"${name}\"]`).removeClass('d-none');\n\t}\n\t/**\n\t * Register analyze file events.\n\t */\n\tregisterAnalyzeFile() {\n\t\tlet form = this.container.find('form');\n\t\tform.validationEngine(app.validationEngineOptions);\n\t\tthis.container.find('.js-send-file').on('click', () => {\n\t\t\tif (!form.validationEngine('validate')) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet formData = new FormData(form[0]);\n\t\t\tformData.append('module', 'Products');\n\t\t\tformData.append('action', 'StocktakingModal');\n\t\t\tformData.append('mode', 'analyzeFile');\n\t\t\tlet progress = $.progressIndicator({ position: 'html', blockInfo: { enabled: true } });\n\t\t\tAppConnector.request({\n\t\t\t\turl: 'index.php',\n\t\t\t\ttype: 'POST',\n\t\t\t\tdata: formData,\n\t\t\t\tprocessData: false,\n\t\t\t\tcontentType: false\n\t\t\t})\n\t\t\t\t.done((response) => {\n\t\t\t\t\tthis.showStep('selectColumn');\n\t\t\t\t\tthis.container.find('.js-encoding').val(response.result.encoding);\n\t\t\t\t\tthis.container.find('.js-count').val(response.result.count);\n\t\t\t\t\tthis.container.find('.js-randomKey').val(response.result.randomKey);\n\t\t\t\t\tlet eanField = this.container.find('#skuColumnSeq');\n\t\t\t\t\tlet qtyField = this.container.find('#qtyColumnSeq');\n\t\t\t\t\t$.each(response.result.column, function (index, value) {\n\t\t\t\t\t\teanField.append(`<option value=\"${index}\">${value}</option>`);\n\t\t\t\t\t\tqtyField.append(`<option value=\"${index}\">${value}</option>`);\n\t\t\t\t\t});\n\t\t\t\t\tqtyField.val(1);\n\t\t\t\t\tApp.Fields.Picklist.showSelect2ElementView(qtyField);\n\t\t\t\t\tApp.Fields.Picklist.showSelect2ElementView(eanField);\n\t\t\t\t\tprogress.progressIndicator({ mode: 'hide' });\n\t\t\t\t})\n\t\t\t\t.fail(() => {\n\t\t\t\t\tprogress.progressIndicator({ mode: 'hide' });\n\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\ttext: app.vtranslate('JS_ERROR'),\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t});\n\t}\n\t/**\n\t * Register compare stock levels.\n\t */\n\tregisterCompare() {\n\t\tlet form = this.container.find('form');\n\t\tthis.container.find('.js-compare').on('click', () => {\n\t\t\tlet formData = form.serializeFormData();\n\t\t\tformData['module'] = 'Products';\n\t\t\tformData['action'] = 'StocktakingModal';\n\t\t\tformData['mode'] = 'compare';\n\t\t\tlet progress = $.progressIndicator({ position: 'html', blockInfo: { enabled: true } });\n\t\t\tAppConnector.request(formData)\n\t\t\t\t.done((response) => {\n\t\t\t\t\tthis.showStep('showCompare');\n\t\t\t\t\tthis.container.find('.js-entries-update').val(response.result.update);\n\t\t\t\t\tthis.container.find('.js-entries-no-update').val(response.result.same);\n\t\t\t\t\tthis.container.find('.js-entries-not-found').val(response.result.counterNotFound);\n\t\t\t\t\tthis.container.find('.js-list-entries-not-found').val(response.result.notFound);\n\t\t\t\t\tthis.toUpdate = response.result.toUpdate;\n\t\t\t\t\tif (response.result.update === 0) {\n\t\t\t\t\t\tthis.container.find('.js-import').addClass('d-none');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (formData['storage'] != 0) {\n\t\t\t\t\t\t\tthis.container.find('.js-record-name').removeClass('d-none');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tprogress.progressIndicator({ mode: 'hide' });\n\t\t\t\t})\n\t\t\t\t.fail(() => {\n\t\t\t\t\tprogress.progressIndicator({ mode: 'hide' });\n\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\ttext: app.vtranslate('JS_ERROR'),\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t});\n\t}\n\t/**\n\t * Register importing stock differences.\n\t */\n\tregisterImport() {\n\t\tlet form = this.container.find('form');\n\t\tthis.container.find('.js-import').on('click', () => {\n\t\t\tlet formData = form.serializeFormData();\n\t\t\tif (formData['storage'] != 0 && !form.validationEngine('validate')) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tformData['module'] = 'Products';\n\t\t\tformData['action'] = 'StocktakingModal';\n\t\t\tformData['mode'] = 'import';\n\t\t\tformData['records'] = this.toUpdate;\n\t\t\tlet progress = $.progressIndicator({ position: 'html', blockInfo: { enabled: true } });\n\t\t\tAppConnector.request(formData)\n\t\t\t\t.done((response) => {\n\t\t\t\t\tthis.showStep('showSummary');\n\t\t\t\t\tif (response.result.product) {\n\t\t\t\t\t\tthis.container.find('.js-imported').removeClass('d-none');\n\t\t\t\t\t\tthis.container.find('.js-imported-counter').val(response.result.product);\n\t\t\t\t\t}\n\t\t\t\t\tif (response.result.igin) {\n\t\t\t\t\t\tthis.container\n\t\t\t\t\t\t\t.find('.js-btn-igin')\n\t\t\t\t\t\t\t.removeClass('d-none')\n\t\t\t\t\t\t\t.attr('href', 'index.php?module=IGIN&view=Detail&record=' + response.result.igin);\n\t\t\t\t\t}\n\t\t\t\t\tif (response.result.iidn) {\n\t\t\t\t\t\tthis.container\n\t\t\t\t\t\t\t.find('.js-btn-iidn')\n\t\t\t\t\t\t\t.removeClass('d-none')\n\t\t\t\t\t\t\t.attr('href', 'index.php?module=IIDN&view=Detail&record=' + response.result.iidn);\n\t\t\t\t\t}\n\t\t\t\t\tif (response.result.igin || response.result.iidn) {\n\t\t\t\t\t\tthis.container.find('.js-alert').removeClass('d-none');\n\t\t\t\t\t}\n\t\t\t\t\tprogress.progressIndicator({ mode: 'hide' });\n\t\t\t\t})\n\t\t\t\t.fail(() => {\n\t\t\t\t\tprogress.progressIndicator({ mode: 'hide' });\n\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\ttext: app.vtranslate('JS_ERROR'),\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t});\n\t}\n\t/**\n\t * Register modal events.\n\t * @param {jQuery} modalContainer\n\t */\n\tregisterEvents(modalContainer) {\n\t\tthis.container = modalContainer;\n\t\tthis.registerAnalyzeFile();\n\t\tthis.registerCompare();\n\t\tthis.registerImport();\n\t}\n};\n"],"names":["window","Products_StocktakingModal_JS","name","container","find","addClass","removeClass","form","validationEngine","app","validationEngineOptions","on","formData","append","$","progressIndicator","position","blockInfo","enabled","AppConnector","request","url","type","data","processData","contentType","done","response","showStep","val","result","encoding","count","randomKey","qtyField","each","column","index","value","eanField","App","Fields","Picklist","showSelect2ElementView","progress","mode","fail","showNotify","text","vtranslate","serializeFormData","update","same","counterNotFound","notFound","toUpdate","product","igin","attr","iidn","modalContainer","registerAnalyzeFile","registerCompare","registerImport"],"mappings":"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"}