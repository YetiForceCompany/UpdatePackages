{"version":3,"file":"QuickCreate.min.js","sources":["QuickCreate.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 5.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\n/**\n *  Class representing a modal calendar.\n * @extends Vtiger_Calendar_Js\n */\nwindow.Reservations_CalendarModal_Js = class Reservations_CalendarModal_Js extends Vtiger_Calendar_Js {\n\tconstructor(container, readonly) {\n\t\tsuper(container, readonly);\n\t\tthis.isSwitchAllDays = false;\n\t\tthis.sidebarName = 'add'; //available: add, status, edit\n\t\tthis.eventCreate = false;\n\t\tthis.module = container.find('[name=\"module\"]').val();\n\t\tthis.renderCalendar();\n\t\tthis.registerEvents();\n\t}\n\t/**\n\t * Function sets calendar module's options\n\t * @returns {{eventClick: function, headerToolbar: object, selectable: boolean}}\n\t */\n\tsetCalendarModuleOptions() {\n\t\tlet options = super.setCalendarModuleOptions();\n\t\toptions.selectable = true;\n\t\toptions.eventClick = function (info) {\n\t\t\tinfo.jsEvent.preventDefault();\n\t\t};\n\t\tlet date = this.container.find('.js-selected-date').val();\n\t\tif (date) {\n\t\t\toptions.initialDate = date;\n\t\t}\n\t\treturn options;\n\t}\n\t/**\n\t * Function registers calendar events\n\t */\n\tregisterEvents() {\n\t\tconst calendarView = this.getCalendarView();\n\t\tthis.switchContainer = $(`<div class=\"js-calendar-switch-container\"></div>`).insertAfter(\n\t\t\tcalendarView.find('.fc-center')\n\t\t);\n\t\tthis.registerSwitchEvents();\n\t\tthis.registerUsersChange();\n\t}\n\t/**\n\t * Function registers calendar switch event\n\t */\n\tregisterSwitchEvents() {\n\t\tif (app.getMainParams('hiddenDays', true) !== false) {\n\t\t\tthis.switchContainer.html(this.createSwitch());\n\t\t\tthis.switchContainer.find('input').on('change', (e) => {\n\t\t\t\tconst currentTarget = $(e.currentTarget);\n\t\t\t\tlet hiddenDays = [];\n\t\t\t\tif (typeof currentTarget.data('on-text') !== 'undefined') {\n\t\t\t\t\thiddenDays = app.getMainParams('hiddenDays', true);\n\t\t\t\t\tthis.isSwitchAllDays = false;\n\t\t\t\t} else {\n\t\t\t\t\tthis.isSwitchAllDays = true;\n\t\t\t\t}\n\t\t\t\tthis.fullCalendar.setOption('hiddenDays', hiddenDays);\n\t\t\t\tthis.registerSwitchEvents();\n\t\t\t});\n\t\t}\n\t}\n\t/**\n\t * Generate filter buttons\n\t * @returns {string}\n\t */\n\tcreateSwitch() {\n\t\tlet on = app.vtranslate('JS_WORK_DAYS'),\n\t\t\toff = app.vtranslate('JS_ALL'),\n\t\t\tstate = this.isSwitchAllDays;\n\t\treturn `<div class=\"btn-group btn-group-toggle js-switch c-calendar-switch\" data-toggle=\"buttons\">\n\t\t\t\t\t<label class=\"btn btn-outline-primary c-calendar-switch__button js-switch--label-on ${state ? '' : 'active'}\">\n\t\t\t\t\t\t<input type=\"radio\" name=\"options\" data-on-text=\"${on}\" autocomplete=\"off\" ${state ? '' : 'checked'}>${on}\n\t\t\t\t\t</label>\n\t\t\t\t\t<label class=\"btn btn-outline-primary c-calendar-switch__button ${state ? 'active' : ''}\">\n\t\t\t\t\t\t<input type=\"radio\" name=\"options\" data-off-text=\"${off}\" autocomplete=\"off\" ${state ? 'checked' : ''}>${off}\n\t\t\t\t\t</label>\n\t\t\t\t</div>`;\n\t}\n\t/**\n\t * Function registers select's user change event\n\t */\n\tregisterUsersChange() {\n\t\tthis.container.find('.assigned_user_id').on('change', () => {\n\t\t\tthis.reloadCalendarData();\n\t\t});\n\t}\n\t/**\n\t * Get selected users\n\t * @returns {{ selectedIds: array, excludedIds: array }}\n\t */\n\tgetSelectedUsersCalendar() {\n\t\treturn { selectedIds: [this.container.find('.assigned_user_id').val()], excludedIds: [] };\n\t}\n\t/**\n\t * Function invokes by FullCalendar, sets selected days in form\n\t * @param {Object} info\n\t */\n\tselectDays(info) {\n\t\tif (this.sidebarName === 'status') {\n\t\t\tthis.sidebarName = 'add';\n\t\t\tthis.getCalendarCreateView().done(() => {\n\t\t\t\tthis.selectDays(info);\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\t\tlet startDate = info.start,\n\t\t\tendDate = info.end;\n\t\tif (info['allDay']) {\n\t\t\tendDate.setDate(endDate.getDate() - 1);\n\t\t\tconst d = new Date();\n\t\t\tstartDate.setHours(d.getHours(), d.getMinutes());\n\t\t\tendDate.setHours(d.getHours(), d.getMinutes() + 30);\n\t\t}\n\t\tthis.container.find('[name=\"date_start\"]').val(App.Fields.Date.dateToUserFormat(startDate));\n\t\tthis.container.find('[name=\"due_date\"]').val(App.Fields.Date.dateToUserFormat(endDate));\n\t\tthis.container.find('[name=\"time_start\"]').val(App.Fields.Time.dateToUserFormat(startDate));\n\t\tthis.container.find('[name=\"time_end\"]').val(App.Fields.Time.dateToUserFormat(endDate));\n\t}\n};\n\n$.Class(\n\t'Reservations_QuickCreate_Js',\n\t{},\n\t{\n\t\tregisterEvents: function (container) {\n\t\t\tlet className = container.find('[name=\"module\"]').val() + '_CalendarModal_Js';\n\t\t\tthis.calendarView = new window[className](container.closest('.js-modal-container'), true);\n\t\t}\n\t}\n);\n"],"names":["window","Reservations_CalendarModal_Js","container","readonly","isSwitchAllDays","sidebarName","eventCreate","module","find","val","renderCalendar","registerEvents","options","selectable","eventClick","info","jsEvent","preventDefault","date","initialDate","getCalendarView","switchContainer","$","insertAfter","calendarView","registerSwitchEvents","registerUsersChange","app","getMainParams","html","createSwitch","on","e","currentTarget","hiddenDays","data","fullCalendar","setOption","vtranslate","off","state","reloadCalendarData","selectedIds","excludedIds","getCalendarCreateView","done","selectDays","startDate","start","endDate","end","setDate","getDate","setHours","d","getHours","getMinutes","App","Fields","Date","dateToUserFormat","Time","Vtiger_Calendar_Js","Class","className","closest"],"mappings":"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"}