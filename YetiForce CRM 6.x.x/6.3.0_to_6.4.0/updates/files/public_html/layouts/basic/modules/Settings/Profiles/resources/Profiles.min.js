'use strict';

/*+*******************************************************************************
 * The contents of this file are subject to the vtiger CRM Public License Version 1.0
 * ("License"); You may not use this file except in compliance with the License
 * The Original Code is:  vtiger CRM Open Source
 * The Initial Developer of the Original Code is vtiger.
 * Portions created by vtiger are Copyright (C) vtiger.
 * All Rights Reserved.
 ********************************************************************************/"use strict";var Settings_Profiles_Js={initEditView:function initEditView(){function handleChangeOfPermissionRange(e,ui){var target=jQuery(ui.handle);target.hasClass("mini-slider-control")||(target=target.closest(".mini-slider-control"));var input=jQuery("[data-range-input=\""+target.data("range")+"\"]");input.val(ui.value),target.attr("data-value",ui.value);}jQuery("[data-module-state]").on("change",function(e){var target=jQuery(e.currentTarget),tabid=target.data("value"),parent=target.closest("tr");target.prop("checked")?(jQuery("[data-action-state]",parent).prop("checked",!0),jQuery("[data-handlerfor]",parent).removeAttr("disabled")):(jQuery("[data-action-state]",parent).prop("checked",!1),jQuery("[data-handlerfor]",parent).attr("disabled","disabled"),jQuery("[data-togglecontent=\""+tabid+"-fields\"]").hide(),jQuery("[data-togglecontent=\""+tabid+"-tools\"]").hide());}),jQuery("[data-action-state]").on("change",function(e){var target=jQuery(e.currentTarget),parent=target.closest("tr"),checked=!!target.prop("checked"),action=target.data("action-state");"EditView"===action||"Delete"===action||"CreateView"===action?checked&&(jQuery("[data-action-state=\"DetailView\"]",parent).prop("checked",!0),jQuery("[data-module-state]",parent).prop("checked",!0),jQuery("[data-handlerfor]",parent).removeAttr("disabled")):"DetailView"===action&&(checked?(jQuery("[data-module-state]",parent).prop("checked",!0),jQuery("[data-handlerfor]",parent).removeAttr("disabled")):(jQuery("[data-action-state]",parent).prop("checked",!1),jQuery("[data-module-state]",parent).prop("checked",!1).trigger("change")));}),jQuery("#mainAction1CheckBox,#mainAction2CheckBox, #mainAction7CheckBox").on("change",function(e){var target=jQuery(e.currentTarget),checked=!!target.prop("checked");checked&&(jQuery("#mainAction4CheckBox").prop("checked",!0),jQuery("#mainModulesCheckBox").prop("checked",!0),jQuery(".modulesCheckBox").prop("checked",!0),jQuery(".action4CheckBox").prop("checked",!0),jQuery("[data-handlerfor]").removeAttr("disabled"));}),jQuery("[data-togglehandler]").on("click",function(e){var target=jQuery(e.currentTarget),container=jQuery("[data-togglecontent=\""+target.data("togglehandler")+"\"]"),closestTrElement=container.closest("tr");target.find(".fas").hasClass("fa-chevron-down")?(closestTrElement.removeClass("d-none"),container.slideDown("slow"),target.find(".fas").removeClass("fa-chevron-down").addClass("fa-chevron-up")):(container.slideUp("slow",function(){closestTrElement.addClass("d-none");}),target.find(".fa-chevron-up").removeClass("fa-chevron-up").addClass("fa-chevron-down"));}),jQuery("[data-range]").each(function(index,item){item=jQuery(item);var value=item.data("value");item.slider({min:0,max:2,value:value,disabled:item.data("locked"),slide:handleChangeOfPermissionRange});}),jQuery("[data-range]").find("a").css("filter","");},registerSelectAllModulesEvent:function registerSelectAllModulesEvent(){var moduleCheckBoxes=jQuery(".modulesCheckBox"),viewAction=jQuery("#mainAction4CheckBox"),editAction=jQuery("#mainAction1CheckBox"),deleteAction=jQuery("#mainAction2CheckBox"),createAction=jQuery("#mainAction7CheckBox"),mainModulesCheckBox=jQuery("#mainModulesCheckBox");mainModulesCheckBox.on("change",function(e){var mainCheckBox=jQuery(e.currentTarget);mainCheckBox.is(":checked")?(moduleCheckBoxes.prop("checked",!0),viewAction.prop("checked",!0),editAction.show().prop("checked",!0),deleteAction.show().prop("checked",!0),createAction.show().prop("checked",!0),moduleCheckBoxes.trigger("change")):(moduleCheckBoxes.prop("checked",!1),moduleCheckBoxes.trigger("change"),viewAction.prop("checked",!1),editAction.prop("checked",!1),deleteAction.prop("checked",!1),createAction.prop("checked",!1));}),moduleCheckBoxes.on("change",function(){Settings_Profiles_Js.checkSelectAll(moduleCheckBoxes,mainModulesCheckBox),Settings_Profiles_Js.checkSelectAll(jQuery(".action4CheckBox"),viewAction),Settings_Profiles_Js.checkSelectAll(jQuery(".action1CheckBox"),editAction),Settings_Profiles_Js.checkSelectAll(jQuery(".action2CheckBox"),deleteAction),Settings_Profiles_Js.checkSelectAll(jQuery(".action7CheckBox"),createAction);});},registerSelectAllViewActionsEvent:function registerSelectAllViewActionsEvent(){var viewActionCheckBoxes=jQuery(".action4CheckBox"),mainViewActionCheckBox=jQuery("#mainAction4CheckBox"),modulesMainCheckBox=jQuery("#mainModulesCheckBox");mainViewActionCheckBox.on("change",function(e){var mainCheckBox=jQuery(e.currentTarget);mainCheckBox.is(":checked")?(modulesMainCheckBox.prop("checked",!0),modulesMainCheckBox.trigger("change")):(modulesMainCheckBox.prop("checked",!1),modulesMainCheckBox.trigger("change"));}),viewActionCheckBoxes.on("change",function(){Settings_Profiles_Js.checkSelectAll(jQuery(".modulesCheckBox"),modulesMainCheckBox),Settings_Profiles_Js.checkSelectAll(viewActionCheckBoxes,mainViewActionCheckBox);});},registerSelectAllEditActionsEvent:function registerSelectAllEditActionsEvent(){var modulesMainCheckBox=jQuery("#mainModulesCheckBox"),mainViewActionCheckBox=jQuery("#mainAction4CheckBox"),editActionCheckBoxes=jQuery(".action1CheckBox"),mainEditActionCheckBox=jQuery("#mainAction1CheckBox");mainEditActionCheckBox.on("change",function(e){var mainCheckBox=jQuery(e.currentTarget);mainCheckBox.is(":checked")?editActionCheckBoxes.prop("checked",!0):editActionCheckBoxes.prop("checked",!1);}),editActionCheckBoxes.on("change",function(){Settings_Profiles_Js.checkSelectAll(jQuery(".modulesCheckBox"),modulesMainCheckBox),Settings_Profiles_Js.checkSelectAll(jQuery(".action4CheckBox"),mainViewActionCheckBox),Settings_Profiles_Js.checkSelectAll(editActionCheckBoxes,mainEditActionCheckBox);});},registerSelectAllDeleteActionsEvent:function registerSelectAllDeleteActionsEvent(){var modulesMainCheckBox=jQuery("#mainModulesCheckBox"),mainViewActionCheckBox=jQuery("#mainAction4CheckBox"),deleteActionCheckBoxes=jQuery(".action2CheckBox"),mainDeleteActionCheckBox=jQuery("#mainAction2CheckBox");mainDeleteActionCheckBox.on("change",function(e){var mainCheckBox=jQuery(e.currentTarget);mainCheckBox.is(":checked")?deleteActionCheckBoxes.prop("checked",!0):deleteActionCheckBoxes.prop("checked",!1);}),deleteActionCheckBoxes.on("change",function(){Settings_Profiles_Js.checkSelectAll(jQuery(".modulesCheckBox"),modulesMainCheckBox),Settings_Profiles_Js.checkSelectAll(jQuery(".action4CheckBox"),mainViewActionCheckBox),Settings_Profiles_Js.checkSelectAll(deleteActionCheckBoxes,mainDeleteActionCheckBox);});},registerSelectAllCreateActionsEvent:function registerSelectAllCreateActionsEvent(){var modulesMainCheckBox=jQuery("#mainModulesCheckBox"),mainViewActionCheckBox=jQuery("#mainAction4CheckBox"),createActionCheckBoxes=jQuery(".action7CheckBox"),mainCreateActionCheckBox=jQuery("#mainAction7CheckBox");mainCreateActionCheckBox.on("change",function(e){var mainCheckBox=jQuery(e.currentTarget);mainCheckBox.is(":checked")?createActionCheckBoxes.prop("checked",!0):createActionCheckBoxes.prop("checked",!1);}),createActionCheckBoxes.on("change",function(){Settings_Profiles_Js.checkSelectAll(jQuery(".modulesCheckBox"),modulesMainCheckBox),Settings_Profiles_Js.checkSelectAll(jQuery(".action4CheckBox"),mainViewActionCheckBox),Settings_Profiles_Js.checkSelectAll(createActionCheckBoxes,mainCreateActionCheckBox);});},checkSelectAll:function checkSelectAll(checkBoxElement,mainCheckBoxElement){var state=!0;return "undefined"!=typeof checkBoxElement&&"undefined"!=typeof mainCheckBoxElement&&void(checkBoxElement.each(function(index,element){return jQuery(element).is(":checked")?void(state=!0):(state=!1,!1)}),!0==state?mainCheckBoxElement.prop("checked",!0):mainCheckBoxElement.prop("checked",!1))},performSelectAllActionsOnLoad:function performSelectAllActionsOnLoad(){0<jQuery("[data-module-unchecked]").length&&jQuery("#mainModulesCheckBox").prop("checked",!1),0>=jQuery("[data-action4-unchecked]").length&&jQuery("#mainAction4CheckBox").prop("checked",!0),0>=jQuery("[data-action7-unchecked]").length&&jQuery("#mainAction7CheckBox").prop("checked",!0),0>=jQuery("[data-action1-unchecked]").length&&jQuery("#mainAction1CheckBox").prop("checked",!0),0<jQuery("[data-action2-unchecked]").length&&jQuery("#mainAction2CheckBox").prop("checked",!1);},registerSubmitEvent:function registerSubmitEvent(){var thisInstance=this,form=jQuery("[name=\"EditProfile\"]");form.on("submit",function(e){var button=form.find("button[type=\"submit\"]"),progressIndicatorInstance=jQuery.progressIndicator({position:"html",blockInfo:{enabled:!0}});if(button.attr("disabled",!0),"true"===form.data("submit")&&"true"===form.data("performCheck"))return !0;if(0>=form.data("jqv").InvalidFields.length){var formData=form.serializeFormData();thisInstance.checkDuplicateName({profileName:formData.profilename,profileId:formData.record}).done(function(){form.data("submit","true"),form.data("performCheck","true"),form.submit();}).fail(function(data){progressIndicatorInstance.progressIndicator({mode:"hide"}),button.attr("disabled",!1);var params={};return params.text=data.message,params.type="error",Settings_Vtiger_Index_Js.showMessage(params),!1});}else//If validation fails, form should submit again
progressIndicatorInstance.progressIndicator({mode:"hide"}),button.attr("disabled",!1),form.removeData("submit"),app.formAlignmentAfterValidation(form);e.preventDefault();});},/*
	 * Function to check Duplication of Profile Name
	 * returns boolean true or false
	 */checkDuplicateName:function checkDuplicateName(details){var profileName=details.profileName,recordId=details.profileId,aDeferred=jQuery.Deferred(),params={module:app.getModuleName(),parent:app.getParentModuleName(),action:"EditAjax",mode:"checkDuplicate",profilename:profileName,record:recordId};return AppConnector.request(params).done(function(data){var response=data.result,result=response.success;!0==result?aDeferred.reject(response):aDeferred.resolve(response);}).fail(function(error,err){aDeferred.reject(error,err);}),aDeferred.promise()},registerGlobalPermissionActionsEvent:function registerGlobalPermissionActionsEvent(){var editAllAction=jQuery("[name=\"editall\"]").filter(":checkbox"),viewAllAction=jQuery("[name=\"viewall\"]").filter(":checkbox");editAllAction.is(":checked")&&viewAllAction.attr("readonly","readonly"),viewAllAction.on("change",function(e){var currentTarget=jQuery(e.currentTarget);if("readonly"==currentTarget.attr("readonly")){var status=jQuery(e.currentTarget).is(":checked");status?jQuery(e.currentTarget).prop("checked",!1):jQuery(e.currentTarget).prop("checked",!0),e.preventDefault();}}),editAllAction.on("change",function(e){var currentTarget=jQuery(e.currentTarget);currentTarget.is(":checked")?(viewAllAction.prop("checked","checked"),viewAllAction.attr("readonly","readonly")):viewAllAction.removeAttr("readonly");});},registerEvents:function registerEvents(){Settings_Profiles_Js.initEditView(),Settings_Profiles_Js.registerSelectAllModulesEvent(),Settings_Profiles_Js.registerSelectAllViewActionsEvent(),Settings_Profiles_Js.registerSelectAllCreateActionsEvent(),Settings_Profiles_Js.registerSelectAllEditActionsEvent(),Settings_Profiles_Js.registerSelectAllDeleteActionsEvent(),Settings_Profiles_Js.performSelectAllActionsOnLoad(),Settings_Profiles_Js.registerSubmitEvent(),Settings_Profiles_Js.registerGlobalPermissionActionsEvent();}};jQuery(document).ready(function(){Settings_Profiles_Js.registerEvents();});
//# sourceMappingURL=Profiles.min.js.map
