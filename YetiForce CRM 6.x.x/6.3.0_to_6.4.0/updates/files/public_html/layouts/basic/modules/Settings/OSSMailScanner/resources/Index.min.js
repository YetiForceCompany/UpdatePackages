'use strict';

/* {[The file is published on the basis of YetiForce Public License 5.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */"use strict";function _createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function(){};return {s:F,n:function n(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return {s:function s(){it=it.call(o);},n:function n(){var step=it.next();return normalCompletion=step.done,step},e:function e(_e2){didErr=!0,err=_e2;},f:function f(){try{normalCompletion||null==it.return||it.return();}finally{if(didErr)throw err}}}}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return "Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}jQuery.Class("Settings_OSSMailScanner_Index_Js",{},{registerColorField:function registerColorField(field){var params={};params.tags=!0,params.templateSelection=function(object){var selectedId=object.id,tabValue=selectedId.split("@"),state=object.text;return tabValue[0]||(state=$("<span class=\"domain\">"+object.text+"</span>")),state},App.Fields.Picklist.showSelect2ElementView(field,params);},registerEditFolders:function registerEditFolders(container){var self=this;container.find(".js-edit-folders").on("click",function(e){var element=$(e.currentTarget),userContainer=element.closest("td"),url="index.php?module=OSSMailScanner&parent=Settings&view=Folders&record="+element.data("user"),progressIndicatorElement=jQuery.progressIndicator({message:app.vtranslate("LBL_LOADING_LIST_OF_FOLDERS"),position:"html",blockInfo:{enabled:!0}});app.showModalWindow("",url,function(data){progressIndicatorElement.progressIndicator({mode:"hide"});var recurrenceTree=new App.Components.Tree.Basic;data.find("[name=\"saveButton\"]").on("click",function(){var selectedFolders=self.getSelectedFolders(recurrenceTree.treeInstance);AppConnector.request({module:"OSSMailScanner",parent:"Settings",action:"SaveAjax",mode:"updateFolders",user:data.find(".modal-body").data("user"),folders:selectedFolders}).done(function(data){var response=data.result,emptyFoldersAlert=userContainer.find(".js-empty-folders-alert"),messageType="info";response.success||(messageType="error"),app.showNotify({text:response.message,type:messageType}),Object.keys(selectedFolders).length?emptyFoldersAlert.addClass("d-none"):emptyFoldersAlert.removeClass("d-none"),app.hideModalWindow();});});});});},getSelectedFolders:function getSelectedFolders(treeInstance){var _step,folders={},_iterator=_createForOfIteratorHelper(treeInstance.jstree("get_selected",!0));try{for(_iterator.s();!(_step=_iterator.n()).done;){var value=_step.value;Array.isArray(folders[value.original.db_type])||(folders[value.original.db_type]=[]),value.original.db_id!==void 0&&folders[value.original.db_type].push(value.original.db_id);}}catch(err){_iterator.e(err);}finally{_iterator.f();}return folders},registerEvents:function registerEvents(){var thisIstance=this,container=jQuery(".contentsDiv");thisIstance.registerColorField($("#exceptions select")),thisIstance.registerEditFolders(container),$("#exceptions select").on("select2:select",function(e){var value=e.params.data.id;!thisIstance.domainValidateToExceptions(value)&&!thisIstance.email_validate(value)?(jQuery(this).find("option[value='"+value+"']").remove(),jQuery(this).trigger("change"),app.showNotify({text:app.vtranslate("JS_mail_error"),type:"error"})):(thisIstance.saveWidgetConfig(jQuery(this).attr("name"),jQuery(this).val().join(),"exceptions"),thisIstance.registerColorField(jQuery(this)));}).on("select2:unselect",function(){thisIstance.saveWidgetConfig(jQuery(this).attr("name"),jQuery(this).val(),"exceptions");}),$("#status").on("change",function(){$("#confirm").attr("disabled",!this.checked);}),jQuery(".conftabChangeTicketStatus").on("click",function(){return "1"!=$(this).data("active")&&void($(".conftabChangeTicketStatus").data("active",0),$(this).data("active",1),AppConnector.request({async:!0,data:{module:"OSSMailScanner",action:"SaveRcConfig",ct:"emailsearch",type:"changeTicketStatus",vale:$(this).val()}}).done(function(data){data.success&&app.showNotify({text:data.result.data,type:"info"});},function(){}))}),container.find(".js-delate-account").on("click",function(){if(window.confirm(app.vtranslate("whether_remove_an_identity"))){var userId=jQuery(this).data("user-id");AppConnector.request({data:{module:"OSSMailScanner",action:"AccountRemove",id:userId},async:!0}).done(function(data){app.showNotify({text:data.result.data,type:"info"}),jQuery("#row_account_"+userId).hide();});}}),container.find(".js-edit-status").on("click",function(){AppConnector.request({module:"OSSMailScanner",action:"SaveCRMuser",mode:"status",userid:$(this).data("user"),status:$(this).data("status")}).done(function(){window.location.reload();});}),container.find(".identities_del").on("click",function(){var button=this;window.confirm(app.vtranslate("whether_remove_an_identity"))&&AppConnector.request({data:{module:"OSSMailScanner",action:"IdentitiesDel",id:jQuery(this).data("id")},async:!0}).done(function(){app.showNotify({text:app.vtranslate("removed_identity"),type:"info"}),jQuery(button).parent().parent().remove();},function(){});}),container.find(".expand-hide").on("click",function(){var userId=jQuery(this).data("user-id"),tr=jQuery("tr[data-user-id=\""+userId+"\"]");"none"==tr.css("display")?tr.show():tr.hide();}),$(".alert").alert(),jQuery("select[id^='function_list_']").on("change",function(){thisIstance.saveActions(jQuery(this).data("user-id"),jQuery(this).val());}),jQuery("select[id^='user_list_']").on("change",function(){thisIstance.saveCRMuser(jQuery(this).data("user"),jQuery(this).val());}),jQuery("#email_search").on("change",function(){thisIstance.saveEmailSearchList(jQuery("#email_search").val());}),jQuery("#tab_email_view_widget_limit").on("blur",function(){thisIstance.saveWidgetConfig("widget_limit",jQuery(this).val(),"email_list");}),jQuery("#tab_email_view_open_window").on("change",function(){thisIstance.saveWidgetConfig("target",jQuery(this).val(),"email_list");}),jQuery("[name=\"email_to_notify\"]").on("blur",function(){var value=jQuery(this).val();!thisIstance.email_validate(value)?app.showNotify({text:app.vtranslate("JS_mail_error"),type:"error"}):thisIstance.saveWidgetConfig("email",value,"cron");}),jQuery("[name=\"time_to_notify\"]").on("blur",function(){var value=jQuery(this).val();!thisIstance.number_validate(value)?app.showNotify({text:app.vtranslate("JS_time_error"),type:"error"}):thisIstance.saveWidgetConfig("time",jQuery(this).val(),"cron");}),container.find(".js-page-num").on("change",function(){thisIstance.reloadLogTable($(this).val()-1);}),container.find(".js-run-cron").on("click",function(){var buttonInstance=$(this);app.showNotify({text:app.vtranslate("start_cron"),type:"info",animation:"show"}),buttonInstance.attr("disabled",!0);var ajaxParams={};ajaxParams.data={module:"OSSMailScanner",action:"Cron"},ajaxParams.async=!0,AppConnector.request(ajaxParams).done(function(data){var params={};params=data.success&&"ok"===data.result?{text:app.vtranslate("end_cron_ok"),type:"info",animation:"show"}:{title:app.vtranslate("end_cron_error"),text:data.result,type:"error",animation:"show"},app.showNotify(params),buttonInstance.attr("disabled",!1),thisIstance.reloadLogTable(container.find(".js-page-num").val()-1);});}),container.on("click",".js-stop-cron",function(e){var ajaxParams={},scanId=$(e.currentTarget).data("scan-id");ajaxParams.data={module:"OSSMailScanner",action:"RestartCron",scanId:scanId},ajaxParams.async=!0,AppConnector.request(ajaxParams).done(function(data){data.success&&(app.showNotify({text:data.result.data,type:"info",animation:"show"}),container.find(".js-run-cron").attr("disabled",!1));}),thisIstance.reloadLogTable(container.find(".js-page-num").val()-1);});},saveActions:function saveActions(userid,vale){AppConnector.request({module:"OSSMailScanner",action:"SaveActions",userid:userid,vale:vale}).done(function(data){var response=data.result;response.success?app.showNotify({text:response.data,type:"info"}):app.showNotify({text:response.data,type:"error"});});},saveCRMuser:function saveCRMuser(userid,value){AppConnector.request({module:"OSSMailScanner",action:"SaveCRMuser",mode:"user",userid:userid,value:value}).done(function(data){var response=data.result;response.success?app.showNotify({text:response.data,type:"info"}):app.showNotify({text:response.data,type:"error"});});},isEmpty:function isEmpty(val){return !val&&0!==val?"":val},saveEmailSearchList:function saveEmailSearchList(vale){AppConnector.request({module:"OSSMailScanner",action:"SaveEmailSearchList",vale:vale}).done(function(data){var response=data.result;response.success?app.showNotify({text:response.data,type:"info"}):app.showNotify({text:response.data,type:"error"});});},domainValidateToExceptions:function domainValidateToExceptions(src){return /^@([a-zA-Z0-9.-]+\.)+[a-zA-Z0-9.-]{2,63}$/.test(src)},email_validate:function email_validate(src){return /^[a-zA-Z0-9._-]+@([a-zA-Z0-9.-]+\.)+[a-zA-Z0-9.-]{2,63}$/.test(src)},number_validate:function number_validate(value){var valid=!/^\s*$/.test(value)&&!isNaN(value);return valid},saveWidgetConfig:function saveWidgetConfig(name,value,type){AppConnector.request({module:"OSSMailScanner",action:"SaveWidgetConfig",conf_type:type,name:name,value:value}).done(function(data){var response=data.result;response.success?app.showNotify({text:response.data,type:"info"}):app.showNotify({text:response.data,type:"error"});});},/**
		 * Function to reload table with given data from request
		 * @param {int} page
		 */reloadLogTable:function reloadLogTable(page){var self=this,container=$(".contentsDiv");AppConnector.request({module:"OSSMailScanner",action:"GetLog",start_number:page*30}).done(function(data){if(data.success){var tab=container.find("table.js-log-list");tab.find("tbody tr").remove();for(var html,i=0;i<data.result.length;i++)html="<tr><td class=\"p-1\">"+self.isEmpty(data.result[i].id)+"</td><td class=\"p-1\">"+self.isEmpty(data.result[i].start_time)+"</td><td class=\"p-1\">"+self.isEmpty(data.result[i].end_time)+"</td><td class=\"p-1\">"+self.isEmpty(app.vtranslate(data.result[i].status))+"</td><td class=\"p-1\">"+self.isEmpty(data.result[i].user)+"</td><td class=\"p-1\">"+self.isEmpty(data.result[i].count)+"</td><td class=\"p-1\">"+self.isEmpty(data.result[i].stop_user)+"</td><td class=\"p-1\">"+self.isEmpty(data.result[i].action)+"</td><td class=\"p-1\">"+self.isEmpty(data.result[i].info)+"</td><td>","In progress"===data.result[i].status&&(html+="<button type=\"button\" class=\"btn btn-danger js-stop-cron\" data-scan-id=\""+data.result[i].id+"\"",container.find(".js-run-cron").data("button-status")&&(html+=" disabled"),html+=">"+app.vtranslate("JS_StopCron")+"</button>"),html+="</td></tr>",tab.append(html);}});}});
//# sourceMappingURL=Index.min.js.map
