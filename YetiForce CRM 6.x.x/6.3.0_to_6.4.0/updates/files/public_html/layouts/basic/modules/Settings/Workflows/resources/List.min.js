'use strict';

/*+***********************************************************************************
 * The contents of this file are subject to the vtiger CRM Public License Version 1.0
 * ("License"); You may not use this file except in compliance with the License
 * The Original Code is:  vtiger CRM Open Source
 * The Initial Developer of the Original Code is vtiger.
 * Portions created by vtiger are Copyright (C) vtiger.
 * All Rights Reserved.
 * Contributor(s): YetiForce S.A.
 *************************************************************************************/"use strict";Settings_Vtiger_List_Js("Settings_Workflows_List_Js",{triggerCreate:function triggerCreate(url){var selectedModule=jQuery("#moduleFilter").val();0<selectedModule.length&&(url+="&source_module="+selectedModule),window.location.href=url;},setChangeStatusTasks:function setChangeStatusTasks(e,recordId,status){var changeButtonType=jQuery(e),container=jQuery(e).closest("tr");app.showConfirmModal({title:app.vtranslate("LBL_STATUS_CONFIRMATION"),confirmedCallback:function confirmedCallback(){var module=app.getModuleName(),postData={module:module,action:"TaskAjax",mode:"changeStatusAllTasks",record:recordId,status:status,parent:app.getParentModuleName()},deleteMessage=app.vtranslate("JS_TASKS_STATUS_GETTING_CHANGED"),progressIndicatorElement=jQuery.progressIndicator({message:deleteMessage,position:"html",blockInfo:{enabled:!0}});AppConnector.request(postData).done(function(data){if(progressIndicatorElement.progressIndicator({mode:"hide"}),data.success){var count=data.result.count,element=container.find("[data-name=\"active_tasks\"]");changeButtonType.hide(),status?(element.html("&nbsp;"+count),changeButtonType.closest("td").find(".deactiveTasks").show()):(element.html("&nbsp;0"),changeButtonType.closest("td").find(".activeTasks").show());}else {var params={text:app.vtranslate(data.error.message),title:app.vtranslate("JS_LBL_PERMISSION"),type:"error"};app.showNotify(params);}});}});}},{registerFilterChangeEvent:function registerFilterChangeEvent(){var _this=this,thisInstance=this;this.topMenuContainer.find(".js-workflow-module-filter").on("change",function(e){_this.topMenuContainer.find(".js-workflow-sort-button").removeClass("d-none"),jQuery("#pageNumber").val("1"),jQuery("#pageToJump").val("1"),jQuery("#orderBy").val(""),jQuery("#sortOrder").val("");var params={module:app.getModuleName(),parent:app.getParentModuleName(),sourceModule:jQuery(e.currentTarget).val(),orderby:"sequence"};//Make the select all count as empty
//Make total number of pages as empty
jQuery("#recordsCount").val(""),jQuery("#totalPageCount").text(""),thisInstance.getListViewRecords(params).done(function(){thisInstance.updatePagination();});});},/*
		 * Function to register the list view row click event
		 */registerRowClickEvent:function registerRowClickEvent(){this.getListViewContentContainer().on("click",".listViewEntries",function(e){var editUrl=$(e.currentTarget).find(".js-edit").attr("href");editUrl&&(window.location.href=editUrl);});},getDefaultParams:function getDefaultParams(){var pageNumber=jQuery("#pageNumber").val(),module=app.getModuleName(),parent=app.getParentModuleName(),params={module:module,parent:parent,page:pageNumber,view:"List",sourceModule:jQuery("#moduleFilter").val()};return params},registerImportTemplate:function registerImportTemplate(){jQuery("#importButton").on("click",function(){window.location.href=jQuery(this).data("url");});},/**
		 * Register show sort actions modal
		 */registerShowSortActionsModal:function registerShowSortActionsModal(){var _this2=this;$(".js-workflow-sort-button").on("click",function(){var sourceModule=_this2.topMenuContainer.find(".js-workflow-module-filter option:selected").val();app.showModalWindow(null,"index.php?module=Workflows&parent=Settings&view=SortActionsModal&sourceModule="+sourceModule,function(modalContainer){modalContainer.find(".js-modal__save").on("click",function(e){e.preventDefault();var progressIndicatorElement=$.progressIndicator({position:"html",blockInfo:{enabled:!0}});AppConnector.request({module:_this2.container.find("[name=\"module\"]").length?_this2.container.find("[name=\"module\"]").val():app.getModuleName(),parent:app.getParentModuleName(),sourceModule:sourceModule,action:"SaveAjax",mode:"sequenceActions",workflowForSort:modalContainer.find(".js-workflow-for-sort").val(),workflowBefore:modalContainer.find(".js-workflow-before").val()}).done(function(data){if(data.result.message){app.hideModalWindow(),progressIndicatorElement.progressIndicator({mode:"hide"});var params=_this2.getDefaultParams();params.orderby="sequence",_this2.getListViewRecords(params),app.showNotify({text:data.result.message});}}).fail(function(error,err){app.errorLog(error,err);});});});});},registerEvents:function registerEvents(){this.container=this.getListViewContentContainer(),this._super(),this.topMenuContainer=this.getListViewTopMenuContainer(),this.registerFilterChangeEvent(),this.registerImportTemplate(),this.registerShowSortActionsModal();}});
//# sourceMappingURL=List.min.js.map
