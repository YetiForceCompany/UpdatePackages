{"version":3,"file":"checkmails.min.js","sources":["checkmails.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 5.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\njQuery(function () {\n\tif ($('.js-header__btn--mail').data('numberunreademails') != undefined) {\n\t\twindow.stopScanMails = false;\n\t\tif (getUrlVars()['view'] != 'Popup') {\n\t\t\tstartCheckMails();\n\t\t}\n\t}\n\tif ($('.js-header__btn--mail select').length > 0) {\n\t\tregisterUserList();\n\t}\n});\n\nfunction registerUserList() {\n\tvar selectUsers = $('.js-header__btn--mail select');\n\tif (selectUsers.data('select2')) {\n\t\tselectUsers.select2('destroy');\n\t} else {\n\t\tselectUsers.on('change', handleChangeUserEvent);\n\t}\n\tApp.Fields.Picklist.showSelect2ElementView(selectUsers, {\n\t\ttemplateResult: function (state) {\n\t\t\tif (!state.id) {\n\t\t\t\treturn state.text;\n\t\t\t}\n\t\t\tvar element = jQuery(state.element);\n\t\t\tvar text = element.data('nomail') ? ' (' + element.data('nomail') + ')' : '';\n\t\t\tvar $state = $('<span>' + state.text + '<span class\"text-left\"><span>' + text + '</span>');\n\t\t\treturn $state;\n\t\t},\n\t\ttemplateSelection: function (data) {\n\t\t\tvar element = jQuery(data.element);\n\t\t\tvar text = element.data('nomail') ? ' (' + element.data('nomail') + ')' : '';\n\t\t\tvar resultContainer = jQuery('<span></span>');\n\t\t\tresultContainer.append(data.text + text);\n\t\t\treturn resultContainer;\n\t\t},\n\t\tcloseOnSelect: true\n\t});\n\tvar select2Instance = selectUsers.data('select2');\n\tselect2Instance.$dropdown.on('mouseup', 'li', function (e) {\n\t\tif (jQuery(e.currentTarget).attr('aria-selected') == 'true') {\n\t\t\tselectUsers.trigger('change');\n\t\t}\n\t});\n\tselect2Instance.$container.find('.select2-selection__rendered').on('mousedown', function (e) {\n\t\te.stopPropagation();\n\t\tselectUsers.trigger('change');\n\t});\n\t$('.js-mail-list').on('click', '.js-mail-link', handleChangeUserEvent);\n}\n\nfunction handleChangeUserEvent() {\n\tvar params = {\n\t\tmodule: 'OSSMail',\n\t\taction: 'SetUser',\n\t\tuser: $(this).val()\n\t};\n\tAppConnector.request(params).done(function (_) {\n\t\tif (app.getModuleName() == 'OSSMail') {\n\t\t\twindow.location.href = window.location.href;\n\t\t} else {\n\t\t\twindow.location.href = 'index.php?module=OSSMail&view=Index';\n\t\t}\n\t});\n}\n\nfunction startCheckMails() {\n\tvar users = [];\n\tvar timeCheckingMails = $('.js-header__btn--mail').data('interval');\n\t$('.js-header__btn--mail .noMails').each(function (_) {\n\t\tusers.push($(this).data('id'));\n\t});\n\tif (users.length > 0) {\n\t\tcheckMails(users, true);\n\t\tvar refreshIntervalId = setInterval(function () {\n\t\t\tif (window.stopScanMails == false) {\n\t\t\t\tcheckMails(users);\n\t\t\t} else {\n\t\t\t\tclearInterval(refreshIntervalId);\n\t\t\t}\n\t\t}, timeCheckingMails * 1000);\n\t}\n}\n\nfunction checkMails(users, initial = false) {\n\tlet reloadSelect = false;\n\tAppConnector.request({\n\t\tmodule: 'OSSMail',\n\t\taction: 'CheckMails',\n\t\tusers: users\n\t})\n\t\t.done(function (response) {\n\t\t\tif (response.success && response.success.error != true && response.result.error != true) {\n\t\t\t\tlet result = response.result;\n\t\t\t\t$('.js-header__btn--mail .noMails').each(function (_) {\n\t\t\t\t\tlet element = jQuery(this);\n\t\t\t\t\tlet id = element.data('id');\n\t\t\t\t\tif (jQuery.inArray(id, result)) {\n\t\t\t\t\t\tlet num = result[id];\n\t\t\t\t\t\tif (element.is('option')) {\n\t\t\t\t\t\t\telement.data('nomail', num);\n\t\t\t\t\t\t\treloadSelect = true;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tlet prevVal = element.data('nomail');\n\t\t\t\t\t\t\telement.data('nomail', num);\n\t\t\t\t\t\t\tlet text = '';\n\t\t\t\t\t\t\tif (num > 0) {\n\t\t\t\t\t\t\t\ttext = ' <span class=\"badge badge-danger mr-1\">' + num + '</span>';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telement.html(text);\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\tinitial === false &&\n\t\t\t\t\t\t\t\t(this.tagName === 'SPAN' || this.selected) &&\n\t\t\t\t\t\t\t\t((prevVal < num && prevVal >= 0) || (!prevVal && num > 0))\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\telement.parent().effect('pulsate', 1500);\n\t\t\t\t\t\t\t\tapp.playSound('MAILS');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (reloadSelect) {\n\t\t\t\t\tregisterUserList();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\twindow.stopScanMails = true;\n\t\t\t}\n\t\t})\n\t\t.fail(function () {\n\t\t\twindow.stopScanMails = true;\n\t\t});\n}\n\nfunction getUrlVars() {\n\tvar vars = {};\n\twindow.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (m, key, value) {\n\t\tvars[key] = value;\n\t});\n\treturn vars;\n}\n"],"names":["jQuery","$","data","window","stopScanMails","getUrlVars","startCheckMails","length","registerUserList","selectUsers","select2","on","handleChangeUserEvent","App","Fields","Picklist","showSelect2ElementView","templateResult","state","id","text","element","$state","templateSelection","resultContainer","append","closeOnSelect","select2Instance","$dropdown","e","currentTarget","attr","trigger","$container","find","stopPropagation","params","module","action","user","val","AppConnector","request","done","location","href","app","getModuleName","timeCheckingMails","each","users","push","checkMails","setInterval","clearInterval","refreshIntervalId","reloadSelect","response","success","error","result","inArray","is","num","html","initial","tagName","selected","prevVal","parent","effect","playSound","fail","vars","replace","m","key","value"],"mappings":"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"}