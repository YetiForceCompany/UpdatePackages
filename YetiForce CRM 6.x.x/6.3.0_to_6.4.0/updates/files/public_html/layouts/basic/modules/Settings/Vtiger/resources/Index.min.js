'use strict';

/*+***********************************************************************************
 * The contents of this file are subject to the vtiger CRM Public License Version 1.0
 * ("License"); You may not use this file except in compliance with the License
 * The Original Code is:  vtiger CRM Open Source
 * The Initial Developer of the Original Code is vtiger.
 * Portions created by vtiger are Copyright (C) vtiger.
 * All Rights Reserved.
 * Contributor(s): YetiForce S.A.
 *************************************************************************************/"use strict";function _createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function(){};return {s:F,n:function n(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return {s:function s(){it=it.call(o);},n:function n(){var step=it.next();return normalCompletion=step.done,step},e:function e(_e2){didErr=!0,err=_e2;},f:function f(){try{normalCompletion||null==it.return||it.return();}finally{if(didErr)throw err}}}}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return "Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}$.Class("Settings_Vtiger_Index_Js",{showMessage:function showMessage(customParams){var params={type:"success",title:app.vtranslate("JS_MESSAGE")};"undefined"!=typeof customParams&&(params=$.extend(params,customParams)),app.showNotify(params);},selectIcon:function selectIcon(){var _this=this,params=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},aDeferred=$.Deferred();return app.showModalWindow({id:"iconsModal",url:"index.php?module=Vtiger&view=IconsModal&parent=Settings",cb:function cb(container){_this.registerIconsSelect(container,params),container.find("[name=\"saveButton\"]").on("click",function(){aDeferred.resolve({type:container.find("#iconType").val(),name:container.find("#iconName").val()}),app.hideModalWindow(container,"iconsModal");});}}),aDeferred.promise()},registerIconsSelect:function registerIconsSelect(container,params){AppConnector.request($.extend({module:app.getModuleName(),parent:app.getParentModuleName(),action:"Icons"},params)).done(function(_ref){var result=_ref.result,id=0,data=Object.keys(result).map(function(){var resultData=result[id];return {id:id++,text:resultData.name,type:resultData.type,url:resultData.path}});App.Fields.Picklist.showLazySelect(container.find("#iconsList"),{lazyElements:50,data:data,selectParams:{templateSelection:function templateSelection(data){return data.id?(container.find(".iconName").text(data.text),container.find("#iconName").val(data.text),container.find("#iconType").val(data.type),"icon"===data.type)?(container.find(".iconExample").html("<span class=\"".concat(data.text,"\" aria-hidden=\"true\"></span>")),$("<span class=\"".concat(data.text,"\" aria-hidden=\"true\"></span><span> - ").concat(data.text,"</span>"))):("image"===data.type&&(container.find(".iconName").text(data.text),container.find("#iconName").val(data.text),container.find(".iconExample").html("<img width=\"24px\" src=\"".concat(data.url,"\"/>"))),data.text):data.text},templateResult:function templateResult(data){if(data.loading)return data.text;var option;return "icon"===data.type?option=$("<span class=\"".concat(data.text,"\" aria-hidden=\"true\"></span><span> - ").concat(data.text,"</span>")):"image"===data.type&&(option=$("<img width=\"24px\" src=\"".concat(data.url,"\" title=\"").concat(data.text,"\" /><span> - ").concat(data.text,"</span>"))),option},closeOnSelect:!0}});});},showWarnings:function showWarnings(){$("li[data-mode=\"systemWarnings\"] a").click();},showSecurity:function showSecurity(){app.openUrl("index.php?module=Log&parent="+app.getParentModuleName()+"&view=Index&type=access_for_admin");}},{registerDeleteShortCutEvent:function registerDeleteShortCutEvent(){var _this2=this,shortcutsContainer=0<arguments.length&&arguments[0]!==void 0?arguments[0]:$(".js-shortcuts");shortcutsContainer.on("click",".unpin",function(e){e.preventDefault();var actionEle=$(e.currentTarget),closestBlock=actionEle.closest(".js-shortcut"),fieldId=actionEle.data("id"),shortcutBlockActionUrl=closestBlock.data("actionurl"),progressIndicatorElement=$.progressIndicator({blockInfo:{enabled:!0}});AppConnector.request(shortcutBlockActionUrl+"&pin=false").done(function(data){if("OK"==data.result.SUCCESS){closestBlock.remove();var shortCutActionEle=$("#"+fieldId+"_menuItem"),imagePath=shortCutActionEle.data("pinimageurl");shortCutActionEle.attr("src",imagePath).data("action","pin"),_this2.updateShortcutsStorage(shortcutsContainer),progressIndicatorElement.progressIndicator({mode:"hide"});var params={title:app.vtranslate("JS_MESSAGE"),text:app.vtranslate("JS_SUCCESSFULLY_UNPINNED"),type:"info"};app.showNotify(params);}});});},registerPinShortCutEvent:function registerPinShortCutEvent(element){var _this3=this,id=element.data("id"),progressIndicatorElement=$.progressIndicator({blockInfo:{enabled:!0}});AppConnector.request("index.php?module=Vtiger&parent=Settings&action=Basic&mode=updateFieldPinnedStatus&pin=true&fieldid="+id).done(function(data){"OK"==data.result.SUCCESS&&AppConnector.request({fieldid:id,mode:"getSettingsShortCutBlock",module:"Vtiger",parent:"Settings",view:"IndexAjax"}).done(function(data){var shortcutsContainer=$(".js-shortcuts");$(data).appendTo(shortcutsContainer),_this3.updateShortcutsStorage(shortcutsContainer),progressIndicatorElement.progressIndicator({mode:"hide"}),Settings_Vtiger_Index_Js.showMessage({text:app.vtranslate("JS_SUCCESSFULLY_PINNED")});});});},registerWidgetsEvents:function registerWidgetsEvents(){var widgets=$("div.widgetContainer");widgets.on("shown.bs.collapse",function(e){var widgetContainer=$(e.currentTarget),quickWidgetHeader=widgetContainer.closest(".quickWidget").find(".quickWidgetHeader"),imageEle=quickWidgetHeader.find(".imageElement"),imagePath=imageEle.data("downimage");imageEle.attr("src",imagePath);}),widgets.on("hidden.bs.collapse",function(e){var widgetContainer=$(e.currentTarget),quickWidgetHeader=widgetContainer.closest(".quickWidget").find(".quickWidgetHeader"),imageEle=quickWidgetHeader.find(".imageElement"),imagePath=imageEle.data("rightimage");imageEle.attr("src",imagePath);});},registerAddShortcutDragDropEvent:function registerAddShortcutDragDropEvent(){var elements=$(".js-menu__item .js-menu__link--draggable"),self=this;elements.draggable({containment:"#page",appendTo:"body",helper:"clone",start:function start(e,ui){$(ui.helper).addClass("ui-draggable-menuShortcut bg-warning");},zIndex:99999});var shortcutsContainer=$(".js-shortcuts");shortcutsContainer.droppable({activeClass:"ui-state-default",hoverClass:"ui-state-hover",accept:".js-menu__item .js-menu__link--draggable",drop:function drop(event,ui){var url=ui.draggable.attr("href"),isExist=!1;if($(".js-shortcuts [id^=\"shortcut\"]").each(function(){var shortCutUrl=$(this).data("url");if(shortCutUrl==url)return void(isExist=!0)}),isExist){var params={title:app.vtranslate("JS_MESSAGE"),text:app.vtranslate("JS_SHORTCUT_ALREADY_ADDED"),type:"info"};app.showNotify(params);}else self.registerPinShortCutEvent(ui.draggable.parent());}}),shortcutsContainer.sortable({handle:".js-drag-handler",stop:function stop(){self.updateShortcutsStorage(shortcutsContainer);}}),Quasar.plugins.LocalStorage.has("yf-settings-shortcuts")&&this.alignShortcuts(shortcutsContainer);},alignShortcuts:function alignShortcuts(container){var _step,_iterator=_createForOfIteratorHelper(Quasar.plugins.LocalStorage.getItem("yf-settings-shortcuts"));try{for(_iterator.s();!(_step=_iterator.n()).done;){var item=_step.value;container.append(container.find("#"+item));}}catch(err){_iterator.e(err);}finally{_iterator.f();}},updateShortcutsStorage:function updateShortcutsStorage(container){Quasar.plugins.LocalStorage.set("yf-settings-shortcuts",container.sortable("toArray"));},registerCollapsiblePanels:function registerCollapsiblePanels(){var _this4=this,panels=this.container.find(".js-collapse");Quasar.plugins.LocalStorage.has("yf-settings-panels")?this.setPanels(panels):(panels.collapse("show"),Quasar.plugins.LocalStorage.set("yf-settings-panels",{"marketplace-collapse":"shown","system-monitoring-collapse":"shown","my-shortcuts-collapse":"shown"})),panels.on("hidden.bs.collapse shown.bs.collapse",function(e){_this4.updatePanelsStorage(e.target.id,e.type);});},updatePanelsStorage:function updatePanelsStorage(id,type){var panelsStorage=Quasar.plugins.LocalStorage.getItem("yf-settings-panels");panelsStorage[id]=type,Quasar.plugins.LocalStorage.set("yf-settings-panels",panelsStorage);},setPanels:function setPanels(panels){var panelsStorage=Quasar.plugins.LocalStorage.getItem("yf-settings-panels");panels.each(function(i,item){"shown"===panelsStorage[item.id]&&$(item).collapse("show");});},loadEditorElement:function loadEditorElement(){App.Fields.Text.Editor.register($(".js-editor"),{});},registerWarningsAlert:function registerWarningsAlert(){var alertsContainer=$("#systemWarningAletrs");alertsContainer.length&&app.showModalWindow(alertsContainer,function(){alertsContainer.find(".warning").first().removeClass("d-none"),alertsContainer.find(".warning .btn").on("click",function(){var params,btn=$(this),save=!0;if(btn.hasClass("ajaxBtn")){if(btn.data("params")===void 0){var form=btn.closest("form");form.hasClass("validateForm")&&!form.validationEngine("validate")&&(save=!1),params=btn.closest("form").serializeArray().reduce(function(obj,item){return obj[item.name]=item.value,obj},{});}else params=btn.data("params");save&&AppConnector.request({module:app.getModuleName(),parent:app.getParentModuleName(),action:"SystemWarnings",mode:"update",id:btn.closest(".warning").data("id"),params:params}).done(function(data){data.result.result?Vtiger_Helper_Js.showMessage({text:data.result.message,type:"success"}):Vtiger_Helper_Js.showMessage({text:data.result.message,type:"error"});});}btn.hasClass("cancel")&&AppConnector.request({module:app.getModuleName(),parent:app.getParentModuleName(),action:"SystemWarnings",mode:"cancel"}),save&&(alertsContainer.find(".warning").first().remove(),alertsContainer.find(".warning").length?alertsContainer.find(".warning").first().removeClass("d-none"):app.hideModalWindow(alertsContainer));}),alertsContainer.find(".input-group-append input[type=\"checkbox\"]").on("click",function(){var btn=$(this),group=btn.closest(".input-group");this.checked?group.find("input[type=\"text\"]").attr("disabled",!1):group.find("input[type=\"text\"]").attr("disabled",!0);});});},registerEvents:function registerEvents(){this.container=$(".js-dashboard-container"),this.registerWarningsAlert(),this.registerDeleteShortCutEvent(),this.registerAddShortcutDragDropEvent(),this.registerCollapsiblePanels(),new window.Settings_YetiForce_Shop_Js().registerEvents();}});
//# sourceMappingURL=Index.min.js.map
