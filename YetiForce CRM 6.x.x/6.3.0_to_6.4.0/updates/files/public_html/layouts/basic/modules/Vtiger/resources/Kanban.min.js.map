{"version":3,"file":"Kanban.min.js","sources":["Kanban.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 5.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\n$.Class(\n\t'Vtiger_Kanban_Js',\n\t{},\n\t{\n\t\t/**\n\t\t * Get params\n\t\t */\n\t\tgetParams: function () {\n\t\t\tconst params = [];\n\t\t\tthis.page.find('.js-params').each(function () {\n\t\t\t\tlet element = $(this);\n\t\t\t\tparams[element.attr('name')] = element.val();\n\t\t\t});\n\t\t\treturn $.extend(\n\t\t\t\t{\n\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\tview: 'Kanban',\n\t\t\t\t\tboard: this.page.find('.js-board-tab.active').data('id')\n\t\t\t\t},\n\t\t\t\tparams\n\t\t\t);\n\t\t},\n\t\tloadKanban: function () {\n\t\t\tconst params = this.getParams(),\n\t\t\t\turlParams = Object.assign({}, params);\n\t\t\tdelete urlParams.orderBy;\n\t\t\tapp.changeUrl(urlParams);\n\t\t\tconst progress = $.progressIndicator({ blockInfo: { enabled: true, elementToBlock: this.container } });\n\t\t\tAppConnector.request(params)\n\t\t\t\t.done((responseData) => {\n\t\t\t\t\tthis.container.html(responseData);\n\t\t\t\t\tthis.registerSortable();\n\t\t\t\t\tprogress.progressIndicator({ mode: 'hide' });\n\t\t\t\t})\n\t\t\t\t.fail(() => {\n\t\t\t\t\tprogress.progressIndicator({ mode: 'hide' });\n\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\ttitle: app.vtranslate('JS_ERROR'),\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t},\n\t\tregisterSortable: function () {\n\t\t\tconst boards = this.container.find('.js-kanban-records');\n\t\t\tboards.sortable({\n\t\t\t\tcontainment: this.container,\n\t\t\t\titems: boards.find('.js-kanban-record'),\n\t\t\t\tcancel: '.js-kanban-disabled',\n\t\t\t\tconnectWith: boards,\n\t\t\t\tplaceholder: 'c-kanban__highlight',\n\t\t\t\trevert: true,\n\t\t\t\ttolerance: 'pointer',\n\t\t\t\tcursor: 'move',\n\t\t\t\tupdate: (e, ui) => {\n\t\t\t\t\tif (ui.sender == null) {\n\t\t\t\t\t\tconst records = ui.item.closest('.js-kanban-records');\n\t\t\t\t\t\tVtiger_Edit_Js.saveAjax({\n\t\t\t\t\t\t\trecord: ui.item.data('id'),\n\t\t\t\t\t\t\tfield: records.data('field'),\n\t\t\t\t\t\t\tvalue: records.data('value')\n\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.done(() => {\n\t\t\t\t\t\t\t\tthis.loadKanban();\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.fail(function (error, err) {\n\t\t\t\t\t\t\t\tapp.errorLog(error, err);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tstart: (e, ui) => {\n\t\t\t\t\tui.placeholder.height(ui.helper.outerHeight());\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Registers mobile devices.\n\t\t */\n\t\tregisterMobileDevices: function () {\n\t\t\tif (app.isTouchDevice()) {\n\t\t\t\tthis.container.find('.js-kanban-record').each(function () {\n\t\t\t\t\tlet element = $(this);\n\t\t\t\t\telement.find('.js-popover-tooltip--record').removeClass('js-popover-tooltip--record');\n\t\t\t\t\tlet btns = element.find('.btns');\n\t\t\t\t\tlet btnQuickEditModal = btns.find('.js-quick-edit-modal');\n\t\t\t\t\telement.addClass('js-quick-edit-modal');\n\t\t\t\t\telement.attr('href', btnQuickEditModal.attr('href'));\n\t\t\t\t\telement.attr('data-record', btnQuickEditModal.data('record'));\n\t\t\t\t\telement.attr('data-module', btnQuickEditModal.data('module'));\n\t\t\t\t\tbtns.remove();\n\t\t\t\t\telement.find('a').on('click', function (e) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Registers Kanban view events.\n\t\t */\n\t\tregisterEvents: function () {\n\t\t\tthis.page = $('#centerPanel');\n\t\t\tthis.container = $('.js-kanban-container');\n\t\t\tthis.registerSortable();\n\t\t\tapp.showNewScrollbarTopBottom(this.container);\n\t\t\tthis.page.on('click', '.js-board-tab', (e) => {\n\t\t\t\tthis.page.find('.js-board-tab.active').removeClass('active');\n\t\t\t\t$(e.currentTarget).addClass('active');\n\t\t\t\tthis.loadKanban();\n\t\t\t});\n\t\t\tthis.page.on('change', '.js-params', () => {\n\t\t\t\tthis.loadKanban();\n\t\t\t});\n\t\t\tthis.page.on('click', '.js-list-reload', (e, data) => {\n\t\t\t\tthis.page.find('#orderBy').val(JSON.stringify(data.orderby)).trigger('change');\n\t\t\t});\n\t\t\tthis.registerMobileDevices();\n\t\t}\n\t}\n);\n"],"names":["$","Class","getParams","page","find","each","params","element","attr","val","extend","module","app","getModuleName","view","board","data","loadKanban","urlParams","Object","assign","orderBy","changeUrl","progress","progressIndicator","blockInfo","enabled","elementToBlock","container","AppConnector","request","done","responseData","html","registerSortable","mode","fail","showNotify","title","vtranslate","type","boards","sortable","containment","items","cancel","connectWith","placeholder","revert","tolerance","cursor","update","e","ui","sender","item","closest","Vtiger_Edit_Js","saveAjax","record","field","records","value","error","err","errorLog","start","height","helper","outerHeight","registerMobileDevices","isTouchDevice","removeClass","btns","btnQuickEditModal","addClass","remove","on","stopPropagation","registerEvents","showNewScrollbarTopBottom","currentTarget","JSON","stringify","orderby","trigger"],"mappings":"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"}