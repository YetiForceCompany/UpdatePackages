{"version":3,"file":"ChangesJsonModal.min.js","sources":["ChangesJsonModal.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 5.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n$.Class(\n\t'Base_ChangesJsonModal_JS',\n\t{},\n\t{\n\t\t/**\n\t\t * Register select field\n\t\t */\n\t\tregisterSelectField: function () {\n\t\t\tlet editInstance = Vtiger_Edit_Js.getInstance(this.module);\n\t\t\tlet form = this.container.find('form');\n\t\t\tthis.container.find('.js-changesjson-select').on('change', (e) => {\n\t\t\t\tlet element = $(e.currentTarget);\n\t\t\t\tlet blockElement = element.closest('.js-form-row-container').find('.fieldValue');\n\t\t\t\tlet fieldElement = blockElement.find('[data-validation-engine],[data-invalid-validation-engine]');\n\t\t\t\tlet fieldInfo = fieldElement.data('fieldinfo');\n\t\t\t\tif (element.prop('checked')) {\n\t\t\t\t\tthis.activeFieldValidation(fieldElement);\n\t\t\t\t} else {\n\t\t\t\t\tthis.inactiveFieldValidation(fieldElement);\n\t\t\t\t}\n\t\t\t\tif (fieldInfo !== undefined && fieldInfo.type === 'reference') {\n\t\t\t\t\tlet mapFields = editInstance.getMappingRelatedField(\n\t\t\t\t\t\tfieldInfo.name,\n\t\t\t\t\t\teditInstance.getReferencedModuleName(blockElement),\n\t\t\t\t\t\tform\n\t\t\t\t\t);\n\t\t\t\t\t$.each(mapFields, function (key, _) {\n\t\t\t\t\t\tlet checkboxElement = form.find('[id=\"selectRow' + key + '\"]');\n\t\t\t\t\t\tif (checkboxElement.length && checkboxElement.prop('disabled')) {\n\t\t\t\t\t\t\tcheckboxElement.prop('disabled', false);\n\t\t\t\t\t\t\tcheckboxElement.trigger('click');\n\t\t\t\t\t\t\tcheckboxElement.prop('disabled', true);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Deactivate field validation\n\t\t * @param {jQuery}\n\t\t */\n\t\tinactiveFieldValidation: function (field) {\n\t\t\tfield.validationEngine('hide');\n\t\t\tlet form = field.closest('form');\n\t\t\tlet invalidFields = form.data('jqv').InvalidFields;\n\t\t\tlet fields = [field.get(0)];\n\t\t\tfield.attr('data-invalid-validation-engine', field.attr('data-validation-engine'));\n\t\t\tfield.removeAttr('data-validation-engine');\n\n\t\t\tif (field.is('select') && field.hasClass('select2')) {\n\t\t\t\tlet selectElement = app.getSelect2ElementFromSelect(field);\n\t\t\t\tselectElement.validationEngine('hide');\n\t\t\t\tfields.push(selectElement.get(0));\n\t\t\t}\n\t\t\tfor (let i in fields) {\n\t\t\t\tlet response = jQuery.inArray(fields[i], invalidFields);\n\t\t\t\tif (response != '-1') {\n\t\t\t\t\tinvalidFields.splice(response, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Activate field validation\n\t\t * @param {jQuery}\n\t\t */\n\t\tactiveFieldValidation: function (field) {\n\t\t\tlet validationVal = field.attr('data-invalid-validation-engine');\n\t\t\tif (typeof validationVal === 'undefined') return;\n\t\t\tfield.attr('data-validation-engine', validationVal);\n\t\t\tfield.removeAttr('data-invalid-validation-engine');\n\t\t},\n\t\t/**\n\t\t * Function to inactive field for validation in a form\n\t\t * this will remove data-validation-engine attr of all the elements\n\t\t */\n\t\tinactiveFieldsValidation: function () {\n\t\t\tlet editFieldList = this.container.find('.js-edit-field-list').data('value');\n\t\t\tlet form = this.container.find('form');\n\t\t\tfor (let fieldName in editFieldList) {\n\t\t\t\tlet fieldInfo = editFieldList[fieldName];\n\n\t\t\t\tlet fieldElement = form.find('[name=\"' + fieldInfo.name + '\"]');\n\t\t\t\tif (fieldInfo.type == 'reference') {\n\t\t\t\t\tfieldElement = form.find('[name=\"' + fieldInfo.name + '_display\"]');\n\t\t\t\t} else if (fieldInfo.type == 'multipicklist' || fieldInfo.type == 'sharedOwner') {\n\t\t\t\t\tfieldElement = form.find('[name=\"' + fieldInfo.name + '[]\"]');\n\t\t\t\t}\n\t\t\t\tif (\n\t\t\t\t\tfieldElement.length == 0 ||\n\t\t\t\t\tfieldElement.closest('.js-form-row-container').find('.js-changesjson-select').prop('checked')\n\t\t\t\t) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tlet elemData = fieldElement.data();\n\t\t\t\tlet validationVal = 'validate[]';\n\t\t\t\tif ('validationEngine' in elemData) {\n\t\t\t\t\tvalidationVal = elemData.validationEngine;\n\t\t\t\t\tdelete elemData.validationEngine;\n\t\t\t\t}\n\t\t\t\tfieldElement.attr('data-invalid-validation-engine', validationVal);\n\t\t\t\tfieldElement.removeAttr('data-validation-engine');\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Register change tab\n\t\t */\n\t\tregisterEventForTabClick: function () {\n\t\t\tlet form = this.container.find('form');\n\t\t\tthis.container.on('click', 'a[data-toggle=\"tab\"]', function (e) {\n\t\t\t\tform.validationEngine('validate');\n\t\t\t\tlet invalidFields = form.data('jqv').InvalidFields;\n\t\t\t\tif (invalidFields.length > 0) {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Register events\n\t\t * @param {jQuery} container\n\t\t */\n\t\tregisterEvents(container) {\n\t\t\tthis.container = container;\n\t\t\tthis.module = container.find('[name=\"module\"]').val();\n\t\t\tthis.container.find('form').validationEngine(app.validationEngineOptions);\n\t\t\tthis.inactiveFieldsValidation();\n\t\t\tthis.registerEventForTabClick();\n\t\t\tthis.registerSelectField();\n\t\t\tVtiger_Edit_Js.getInstance(this.module).registerBasicEvents(container);\n\t\t}\n\t}\n);\n"],"names":["$","Class","registerSelectField","editInstance","Vtiger_Edit_Js","getInstance","module","form","container","find","on","e","element","currentTarget","blockElement","closest","fieldElement","fieldInfo","data","prop","activeFieldValidation","inactiveFieldValidation","type","getMappingRelatedField","name","getReferencedModuleName","each","mapFields","key","checkboxElement","length","trigger","field","validationEngine","invalidFields","InvalidFields","fields","get","attr","removeAttr","is","hasClass","selectElement","app","getSelect2ElementFromSelect","push","i","jQuery","inArray","response","splice","validationVal","inactiveFieldsValidation","editFieldList","fieldName","elemData","registerEventForTabClick","stopPropagation","registerEvents","val","validationEngineOptions","registerBasicEvents"],"mappings":"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"}