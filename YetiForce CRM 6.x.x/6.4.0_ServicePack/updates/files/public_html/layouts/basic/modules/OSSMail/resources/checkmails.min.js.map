{"version":3,"file":"checkmails.min.js","sources":["checkmails.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 5.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\njQuery(function () {\n\tif ($('.js-header__btn--mail').data('numberunreademails') != undefined) {\n\t\twindow.stopScanMails = false;\n\t\tif (getUrlVars()['view'] != 'Popup') {\n\t\t\tstartCheckMails();\n\t\t}\n\t}\n\tif ($('.js-header__btn--mail select').length > 0) {\n\t\tregisterUserList();\n\t}\n});\n\nfunction registerUserList() {\n\tvar selectUsers = $('.js-header__btn--mail select');\n\tif (selectUsers.data('select2')) {\n\t\tselectUsers.select2('destroy');\n\t} else {\n\t\tselectUsers.on('change', handleChangeUserEvent);\n\t}\n\tApp.Fields.Picklist.showSelect2ElementView(selectUsers, {\n\t\ttemplateResult: function (data) {\n\t\t\tconst main = document.createElement('span');\n\t\t\tif (data.id) {\n\t\t\t\tconst element = $(data.element),\n\t\t\t\t\tmail = document.createElement('span');\n\t\t\t\tmail.innerText = data.text;\n\t\t\t\tmain.appendChild(mail);\n\t\t\t\tif (element.data('nomail')) {\n\t\t\t\t\tconst badge = document.createElement('span');\n\t\t\t\t\tbadge.className = 'badge badge-danger ml-1';\n\t\t\t\t\tbadge.innerText = element.data('nomail');\n\t\t\t\t\tmain.appendChild(badge);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tmain.innerText = data.text;\n\t\t\t}\n\t\t\treturn main;\n\t\t},\n\t\ttemplateSelection: function (data) {\n\t\t\tconst element = $(data.element),\n\t\t\t\tmain = document.createElement('span'),\n\t\t\t\tmail = document.createElement('span');\n\t\t\tmail.innerText = data.text;\n\t\t\tmain.appendChild(mail);\n\t\t\tif (element.data('nomail')) {\n\t\t\t\tconst badge = document.createElement('span');\n\t\t\t\tbadge.className = 'badge badge-danger ml-1';\n\t\t\t\tbadge.innerText = element.data('nomail');\n\t\t\t\tmain.appendChild(badge);\n\t\t\t}\n\t\t\treturn main;\n\t\t},\n\t\tcloseOnSelect: true\n\t});\n\tconst select2Instance = selectUsers.data('select2');\n\tselect2Instance.$dropdown.on('mouseup', 'li', function (e) {\n\t\tif (jQuery(e.currentTarget).attr('aria-selected') == 'true') {\n\t\t\tselectUsers.trigger('change');\n\t\t}\n\t});\n\tselect2Instance.$container.find('.select2-selection__rendered').on('mousedown', function (e) {\n\t\te.stopPropagation();\n\t\tselectUsers.trigger('change');\n\t});\n\t$('.js-mail-list').on('click', '.js-mail-link', handleChangeUserEvent);\n}\n\nfunction handleChangeUserEvent() {\n\tAppConnector.request({\n\t\tmodule: 'OSSMail',\n\t\taction: 'SetUser',\n\t\tuser: $(this).val()\n\t}).done(function (_) {\n\t\tif (app.getModuleName() == 'OSSMail') {\n\t\t\twindow.location.href = window.location.href;\n\t\t} else {\n\t\t\twindow.location.href = 'index.php?module=OSSMail&view=Index';\n\t\t}\n\t});\n}\n\nfunction startCheckMails() {\n\tlet users = [];\n\tlet timeCheckingMails = $('.js-header__btn--mail').data('interval');\n\t$('.js-header__btn--mail .noMails').each(function (_) {\n\t\tusers.push($(this).data('id'));\n\t});\n\tif (users.length > 0) {\n\t\tcheckMails(users, true);\n\t\tlet refreshIntervalId = setInterval(function () {\n\t\t\tif (window.stopScanMails == false) {\n\t\t\t\tcheckMails(users);\n\t\t\t} else {\n\t\t\t\tclearInterval(refreshIntervalId);\n\t\t\t}\n\t\t}, timeCheckingMails * 1000);\n\t}\n}\n\nfunction checkMails(users, initial = false) {\n\tlet reloadSelect = false;\n\tAppConnector.request({\n\t\tmodule: 'OSSMail',\n\t\taction: 'CheckMails',\n\t\tusers: users\n\t})\n\t\t.done(function (response) {\n\t\t\tif (response.success && response.success.error != true && response.result.error != true) {\n\t\t\t\tlet result = response.result;\n\t\t\t\t$('.js-header__btn--mail .noMails').each(function (_) {\n\t\t\t\t\tlet element = jQuery(this);\n\t\t\t\t\tlet id = element.data('id');\n\t\t\t\t\tif (jQuery.inArray(id, result)) {\n\t\t\t\t\t\tlet num = result[id];\n\t\t\t\t\t\tif (element.is('option')) {\n\t\t\t\t\t\t\telement.data('nomail', num);\n\t\t\t\t\t\t\treloadSelect = true;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tlet prevVal = element.data('nomail');\n\t\t\t\t\t\t\telement.data('nomail', num);\n\t\t\t\t\t\t\tlet text = '';\n\t\t\t\t\t\t\tif (num > 0) {\n\t\t\t\t\t\t\t\ttext = ' <span class=\"badge badge-danger mr-1\">' + num + '</span>';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telement.html(text);\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\tinitial === false &&\n\t\t\t\t\t\t\t\t(this.tagName === 'SPAN' || this.selected) &&\n\t\t\t\t\t\t\t\t((prevVal < num && prevVal >= 0) || (!prevVal && num > 0))\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\telement.parent().effect('pulsate', 1500);\n\t\t\t\t\t\t\t\tapp.playSound('MAILS');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (reloadSelect) {\n\t\t\t\t\tregisterUserList();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\twindow.stopScanMails = true;\n\t\t\t}\n\t\t})\n\t\t.fail(function () {\n\t\t\twindow.stopScanMails = true;\n\t\t});\n}\n\nfunction getUrlVars() {\n\tlet vars = {};\n\twindow.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (m, key, value) {\n\t\tvars[key] = value;\n\t});\n\treturn vars;\n}\n"],"names":["jQuery","$","data","window","stopScanMails","getUrlVars","startCheckMails","length","registerUserList","selectUsers","select2","on","handleChangeUserEvent","App","Fields","Picklist","showSelect2ElementView","templateResult","main","document","createElement","id","element","mail","innerText","text","appendChild","badge","className","templateSelection","closeOnSelect","select2Instance","$dropdown","e","currentTarget","attr","trigger","$container","find","stopPropagation","AppConnector","request","module","action","user","val","done","location","href","app","getModuleName","timeCheckingMails","each","users","push","checkMails","refreshIntervalId","setInterval","clearInterval","initial","reloadSelect","response","success","error","result","inArray","is","num","html","tagName","selected","prevVal","parent","effect","playSound","fail","vars","replace","m","key","value"],"mappings":"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"}