{"version":3,"file":"ActivityStateModal.min.js","sources":["ActivityStateModal.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 5.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\njQuery.Class(\n\t'Calendar_ActivityStateModal_Js',\n\t{},\n\t{\n\t\tregisterActivityState() {\n\t\t\tconst self = this;\n\t\t\t$('.js-activity-buttons button:not(.close)').on('click', function (e) {\n\t\t\t\tlet currentTarget = $(e.currentTarget),\n\t\t\t\t\tviewName = app.getViewName();\n\t\t\t\tapp.hideModalWindow();\n\t\t\t\tif (1 === currentTarget.data('type')) {\n\t\t\t\t\tself.updateActivityState(currentTarget);\n\t\t\t\t} else {\n\t\t\t\t\tlet isReminder = currentTarget.closest('#calendar-reminder-modal').length;\n\t\t\t\t\tif (currentTarget.hasClass('showQuickCreate') || isReminder) {\n\t\t\t\t\t\tlet progressIndicatorElement = $.progressIndicator({\n\t\t\t\t\t\t\t\tposition: 'html',\n\t\t\t\t\t\t\t\tblockInfo: {\n\t\t\t\t\t\t\t\t\tenabled: true\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\turl =\n\t\t\t\t\t\t\t\t'index.php?module=Calendar&view=QuickCreateAjax&addRelation=true&sourceModule=Calendar&sourceRecord=' +\n\t\t\t\t\t\t\t\tcurrentTarget.data('id') +\n\t\t\t\t\t\t\t\t'&fillFields=all',\n\t\t\t\t\t\t\tparams = {};\n\t\t\t\t\t\tparams.noCache = true;\n\t\t\t\t\t\tApp.Components.QuickCreate.getForm(url, 'Calendar', params).done(function (data) {\n\t\t\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\t\tApp.Components.QuickCreate.showModal(data, {\n\t\t\t\t\t\t\t\tcallbackFunction: function (data) {\n\t\t\t\t\t\t\t\t\tif (data && data.success && data.result.followup.value == currentTarget.data('id')) {\n\t\t\t\t\t\t\t\t\t\tself.updateActivityState(currentTarget);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tupdateActivityState: function (currentTarget) {\n\t\t\tlet params = {\n\t\t\t\tmodule: 'Calendar',\n\t\t\t\taction: 'ActivityStateAjax',\n\t\t\t\trecord: currentTarget.data('id'),\n\t\t\t\tstate: currentTarget.data('state')\n\t\t\t};\n\t\t\tapp.hideModalWindow();\n\t\t\tlet progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t\tposition: 'html',\n\t\t\t\tblockInfo: {\n\t\t\t\t\tenabled: true\n\t\t\t\t}\n\t\t\t});\n\t\t\tAppConnector.request(params).done(function (data) {\n\t\t\t\tif (data.success) {\n\t\t\t\t\tlet viewName = app.getViewName();\n\t\t\t\t\tif (viewName === 'Detail') {\n\t\t\t\t\t\tconst thisInstance = Vtiger_Detail_Js.getInstance();\n\t\t\t\t\t\tlet widget = $('.activityWidgetContainer .widgetContentBlock');\n\t\t\t\t\t\tif (widget.length) {\n\t\t\t\t\t\t\tthisInstance.loadWidget(widget);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tlet recentActivitiesTab = thisInstance.getTabByLabel(thisInstance.detailViewRecentActivitiesTabLabel);\n\t\t\t\t\t\t\tif (recentActivitiesTab) {\n\t\t\t\t\t\t\t\trecentActivitiesTab.trigger('click');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (app.getModuleName() === 'Calendar') {\n\t\t\t\t\t\t\t\trecentActivitiesTab =\n\t\t\t\t\t\t\t\t\t!thisInstance.getSelectedTab().length ||\n\t\t\t\t\t\t\t\t\tthisInstance.getSelectedTab().data('linkKey') == thisInstance.detailViewDetailsTabLabel\n\t\t\t\t\t\t\t\t\t\t? thisInstance\n\t\t\t\t\t\t\t\t\t\t\t\t.getTabContainer()\n\t\t\t\t\t\t\t\t\t\t\t\t.find('[data-link-key=\"' + thisInstance.detailViewDetailsTabLabel + '\"]:not(.d-none)')\n\t\t\t\t\t\t\t\t\t\t: $('<div></div>');\n\t\t\t\t\t\t\t\t$('.showModal.closeCalendarRekord').addClass('d-none');\n\t\t\t\t\t\t\t\trecentActivitiesTab.trigger('click');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (viewName === 'List') {\n\t\t\t\t\t\tlet listinstance = new Vtiger_List_Js();\n\t\t\t\t\t\tlistinstance.getListViewRecords();\n\t\t\t\t\t}\n\t\t\t\t\tif (viewName === 'DashBoard') {\n\t\t\t\t\t\tnew Vtiger_DashBoard_Js().getContainer().find('.js-widget-refresh').trigger('click');\n\t\t\t\t\t}\n\t\t\t\t\tif (app.getModuleName() === 'Calendar' && viewName === 'Calendar') {\n\t\t\t\t\t\tapp.pageController.loadCalendarData();\n\t\t\t\t\t\tapp.pageController.getCalendarCreateView();\n\t\t\t\t\t}\n\t\t\t\t\t//updates the Calendar Reminder popup's status\n\t\t\t\t\tVtiger_Index_Js.requestReminder();\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t} else {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tregisterEvents: function () {\n\t\t\tthis.registerActivityState();\n\t\t}\n\t}\n);\n\njQuery(document).ready(function (e) {\n\tvar instance = new Calendar_ActivityStateModal_Js();\n\tinstance.registerEvents();\n});\n"],"names":["jQuery","Class","registerActivityState","$","on","e","currentTarget","viewName","app","getViewName","hideModalWindow","data","self","updateActivityState","isReminder","closest","length","hasClass","progressIndicatorElement","progressIndicator","position","blockInfo","enabled","url","params","noCache","App","Components","QuickCreate","getForm","done","mode","showModal","callbackFunction","success","result","followup","value","module","action","record","state","AppConnector","request","thisInstance","Vtiger_Detail_Js","getInstance","widget","loadWidget","recentActivitiesTab","getTabByLabel","detailViewRecentActivitiesTabLabel","trigger","getModuleName","getSelectedTab","detailViewDetailsTabLabel","getTabContainer","find","addClass","Vtiger_List_Js","listinstance","getListViewRecords","getContainer","pageController","loadCalendarData","getCalendarCreateView","Vtiger_Index_Js","requestReminder","registerEvents","document","ready","instance"],"mappings":"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"}