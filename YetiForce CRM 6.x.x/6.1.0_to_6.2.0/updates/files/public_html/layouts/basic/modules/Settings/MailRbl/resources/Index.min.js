'use strict';

jQuery.Class('Settings_MailRbl_Index_Js',{},{dataTable:!1,dataTableMap:{forVerification:{order:[[0,'desc']],columns:[{data:'datetime'},{orderable:!1,data:'sender'},{orderable:!1,data:'recipient'},{orderable:!1,data:'ip'},{data:'type'},{data:'user'},{orderable:!1,data:function data(row){var action='';return action+='<div class="o-tab__container--action">',1!==row.statusId&&(action+='<button type="button" class="btn btn-success btn-xs js-update" data-id="'+row.id+'" data-status="1" title="'+app.vtranslate('BTN_STATUS_ACTION_ACCEPT')+'" data-js="click"><span class="fas fa-check"></span></button>'),2!==row.statusId&&(action+='<button type="button" class="btn btn-warning btn-xs ml-2 js-update" data-id="'+row.id+'" data-status="2" title="'+app.vtranslate('BTN_STATUS_ACTION_REJECT')+'" data-js="click"><span class="fas fa-times"></span></button>'),action+='<button type="button" class="btn btn-secondary btn-xs ml-2 js-details" data-id="'+row.id+'" title="'+app.vtranslate('BTN_SHOW_DETAILS')+'" data-js="click"><span class="fas fa-search-plus"></span></button>',action+='<button type="button" class="btn btn-danger btn-xs ml-2 js-trash" data-id="'+row.id+'" title="'+app.vtranslate('BTN_DELETE')+'" data-js="click"><span class="fas fa-trash"></span></button>',action+='</dv>',action},defaultContent:''}]},toSend:{order:[[0,'desc']],columns:[{data:'datetime'},{orderable:!1,data:'sender'},{orderable:!1,data:'recipient'},{orderable:!1,data:'ip'},{data:'type'},{data:'user'},{orderable:!1,data:function data(row){var action='';return action+='<div class="o-tab__container--action">',action+='<button type="button" class="btn btn-primary btn-xs js-send-request-id" data-type="quick" data-id="'+row.id+'" title="'+app.vtranslate('BTN_STATUS_ACTION_QUICK_SEND_REQUEST')+'" data-js="click"><span class="fas fa-fighter-jet"></span></button>',action+='<button type="button" class="btn btn-info btn-xs ml-2 js-send-request-id" data-type="manual" data-id="'+row.id+'" title="'+app.vtranslate('BTN_STATUS_ACTION_SEND_REQUEST')+'" data-js="click"><span class="fas fa-paper-plane"></span></button>',action+='<button type="button" class="btn btn-secondary btn-xs ml-2 js-details" data-id="'+row.id+'" title="'+app.vtranslate('BTN_SHOW_DETAILS')+'" data-js="click"><span class="fas fa-search-plus"></span></button>',action+='<button type="button" class="btn btn-danger btn-xs ml-2 js-trash" data-id="'+row.id+'" title="'+app.vtranslate('BTN_DELETE')+'" data-js="click"><span class="fas fa-trash"></span></button>',action+='</dv>',action},defaultContent:''}]},request:{order:[[0,'desc']],columns:[{data:'datetime'},{orderable:!1,data:'sender'},{orderable:!1,data:'recipient'},{orderable:!1,data:'ip'},{data:'type'},{data:'status'},{data:'user'},{orderable:!1,data:function data(row){var action='';return action+='<div class="o-tab__container--action">',action+='<button type="button" class="btn btn-secondary btn-xs js-details" data-id="'+row.id+'" title="'+app.vtranslate('BTN_SHOW_DETAILS')+'" data-js="click"><span class="fas fa-search-plus"></span></button>',action+='<button type="button" class="btn btn-primary btn-xs ml-2 js-send-request-id" data-type="quick" data-id="'+row.id+'" title="'+app.vtranslate('BTN_STATUS_ACTION_QUICK_SEND_REQUEST')+'" data-js="click"><span class="fas fa-fighter-jet"></span></button>',action+='<button type="button" class="btn btn-info btn-xs ml-2 js-send-request-id" data-type="manual" data-id="'+row.id+'" title="'+app.vtranslate('BTN_STATUS_ACTION_SEND_REQUEST')+'" data-js="click"><span class="fas fa-paper-plane"></span></button>',1!==row.statusId&&(action+='<button type="button" class="btn btn-success btn-xs ml-2 js-update" data-id="'+row.id+'" data-status="1" title="'+app.vtranslate('BTN_STATUS_ACTION_ACCEPT')+'" data-js="click"><span class="fas fa-check"></span></button>'),2!==row.statusId&&(action+='<button type="button" class="btn btn-warning btn-xs ml-2 js-update" data-id="'+row.id+'" data-status="2" title="'+app.vtranslate('BTN_STATUS_ACTION_REJECT')+'" data-js="click"><span class="fas fa-times"></span></button>'),action+='<button type="button" class="btn btn-danger btn-xs ml-2 js-trash" data-id="'+row.id+'" title="'+app.vtranslate('BTN_DELETE')+'" data-js="click"><span class="fas fa-trash"></span></button>',action+='</dv>',action},defaultContent:''}]},blackList:{columns:[{data:'ip'},{data:'status'},{orderable:!1,data:function data(row){var action='';return 0!=row.request&&(action+='<button type="button" class="btn btn-secondary btn-sm js-details" data-id="'+row.request+'" title="'+app.vtranslate('BTN_SHOW_DETAILS')+'" data-js="click"><span class="fas fa-search-plus"></span></button>'),action},defaultContent:''},{orderable:!1,data:function data(row){var action='';return 0!==row.statusId&&(action+='<button type="button" class="btn btn-success btn-sm js-update" data-id="'+row.id+'" data-status="0" title="'+app.vtranslate('BTN_STATUS_ACTION_ACCEPT')+'" data-js="click"><span class="fas fa-check"></span></button>'),1!==row.statusId&&(action+='<button type="button" class="btn btn-warning btn-sm ml-2 js-update" data-id="'+row.id+'" data-status="1" title="'+app.vtranslate('BTN_UNLOCK_STATUS_ACTION_REJECT')+'" data-js="click"><span class="fas fa-times"></span></button>'),action+='<button type="button" class="btn btn-danger btn-sm ml-2 js-trash" data-id="'+row.id+'" title="'+app.vtranslate('BTN_DELETE')+'" data-js="click"><span class="fas fa-trash"></span></button>',action},defaultContent:''}]},whiteList:{columns:[{data:'ip'},{data:'status'},{orderable:!1,data:function data(row){var action='';return 0!=row.request&&(action+='<button type="button" class="btn btn-secondary btn-sm js-details" data-id="'+row.request+'" title="'+app.vtranslate('BTN_SHOW_DETAILS')+'" data-js="click"><span class="fas fa-search-plus"></span></button>'),action},defaultContent:''},{orderable:!1,data:function data(row){var action='';return 0!==row.statusId&&(action+='<button type="button" class="btn btn-success btn-sm js-update" data-id="'+row.id+'" data-status="0" title="'+app.vtranslate('BTN_STATUS_ACTION_ACCEPT')+'" data-js="click"><span class="fas fa-check"></span></button>'),1!==row.statusId&&(action+='<button type="button" class="btn btn-warning btn-sm ml-2 js-update" data-id="'+row.id+'" data-status="1" title="'+app.vtranslate('BTN_UNLOCK_STATUS_ACTION_REJECT')+'" data-js="click"><span class="fas fa-times"></span></button>'),action+='<button type="button" class="btn btn-danger btn-sm ml-2 js-trash" data-id="'+row.id+'" title="'+app.vtranslate('BTN_DELETE')+'" data-js="click"><span class="fas fa-trash"></span></button>',action},defaultContent:''}]},publicRbl:{columns:[{data:'ip'},{data:'type'},{data:'status'},{orderable:!1,defaultContent:''}]}},/**
		 * Register DataTable
		 */registerDataTable:function registerDataTable(container){var self=this,form=container.find('.js-filter-form');App.Fields.Date.registerRange(form);var table=container.find('.js-data-table'),mode=container.attr('id');return table.hasClass('dataTable')&&table.DataTable().clear().destroy(),self.dataTable=app.registerDataTables(table,Object.assign({processing:!0,serverSide:!0,paging:!0,searching:!1,lengthChange:!1,pageLength:20,ajax:{url:'index.php?parent=Settings&module=MailRbl&action=GetData&mode='+mode,type:'POST',data:function data(_data){_data=$.extend(_data,form.serializeFormData());}},order:[]},self.dataTableMap[mode])),container.find('input,select').on('change',function(){self.dataTable.ajax.reload();}),table},/**
		 * Register tab events
		 * @param {jQuery} contentContainer
		 */registerTabEvents:function registerTabEvents(){var contentContainer=0<arguments.length&&arguments[0]!==void 0?arguments[0]:$('.js-tab.active'),self=this,mode=contentContainer.attr('id'),table=this.registerDataTable(contentContainer);table.off('click','.js-details').on('click','.js-details',function(){var progressIndicatorElement=jQuery.progressIndicator();app.showModalWindow(null,'index.php?module=AppComponents&view=MailMessageAnalysisModal&record='+this.dataset.id,function(container){progressIndicatorElement.progressIndicator({mode:'hide'}),container.find('iframe').each(function(){var iframe=$(this);iframe.on('load',function(){var content=iframe.contents();iframe.height(300),content.find('head').append('<style>body{margin: 0;}p{margin: 0.5em 0;}</style>');});});});}),table.off('click','.js-trash').on('click','.js-trash',function(){AppConnector.request({module:app.getModuleName(),parent:app.getParentModuleName(),mode:mode,action:'DeleteAjax',record:this.dataset.id}).done(function(){self.dataTable.ajax.reload(),self.refreshCounters();});}),table.off('click','.js-update').on('click','.js-update',function(){AppConnector.request({module:app.getModuleName(),parent:app.getParentModuleName(),action:'SaveAjax',mode:'update',type:mode,record:this.dataset.id,status:this.dataset.status}).done(function(response){self.dataTable.ajax.reload(),self.refreshCounters(),app.showNotify($.extend(response.result.notify,{stack:new PNotify.Stack({firstpos1:25,spacing1:5,spacing2:5,maxOpen:10,modal:!1})}));});}),table.off('click','.js-send-request-id').on('click','.js-send-request-id',function(){'manual'===this.dataset.type?self.sendRequest(this.dataset.id):AppConnector.request({module:app.getModuleName(),parent:app.getParentModuleName(),action:'SendReport',id:this.dataset.id}).done(function(response){self.dataTable.ajax.reload(),self.refreshCounters(),app.showNotify($.extend(response.result.notify,{stack:new PNotify.Stack({firstpos1:25,spacing1:5,spacing2:5,maxOpen:10,modal:!1})}));});});},sendRequest:function sendRequest(id){var self=this;app.showModalWindow(null,'index.php?parent=Settings&module=MailRbl&view=ReportModal&id='+id,function(container){var form=container.find('form');container.find('.js-modal__save').on('click',function(){form.submit(),self.dataTable.ajax.reload(),self.refreshCounters();});});},/**
		 * Refresh the counters
		 */refreshCounters:function refreshCounters(){var tabs=$('#tabs li a');AppConnector.request({module:app.getModuleName(),parent:app.getParentModuleName(),action:'GetData',mode:'counters'}).done(function(response){tabs.each(function(){response.result[this.dataset.name]!==void 0&&$(this).find('.js-badge').text(response.result[this.dataset.name]);});});},registerSwitchEvents:function registerSwitchEvents(){$('.js-base-container .js-switch').on('change',function(){AppConnector.request({module:app.getModuleName(),parent:app.getParentModuleName(),action:'SaveAjax',mode:'config',name:this.name,value:this.value}).done(function(response){app.showNotify($.extend(response.result.notify,{stack:new PNotify.Stack({firstpos1:25,spacing1:5,spacing2:5,maxOpen:10,modal:!1})}));});});},/**
		 * Register events
		 */registerEvents:function registerEvents(){var _this=this;this.registerTabEvents(),this.registerSwitchEvents(),this.refreshCounters(),$('#tabs a[data-toggle="tab"]').on('shown.bs.tab',function(){_this.registerTabEvents();});}});
//# sourceMappingURL=Index.min.js.map
