'use strict';

Settings_MappedFields_Edit_Js('Settings_MappedFields_Edit2_Js',{},{step2Container:!1,advanceFilterInstance:!1,restictName:['_csrf','mode','module','parent','record','view'],init:function init(){this.initialize();},/**
		 * Function to get the container which holds all the reports step1 elements
		 * @return jQuery object
		 */getContainer:function getContainer(){return this.step2Container},/**
		 * Function to set the reports step1 container
		 * @params : element - which represents the reports step1 container
		 * @return : current instance
		 */setContainer:function setContainer(element){return this.step2Container=element,this},/**
		 * Function  to intialize the reports step1
		 */initialize:function initialize(container){'undefined'==typeof container&&(container=jQuery('#mf_step2')),container.is('#mf_step2')?this.setContainer(container):this.setContainer(jQuery('#mf_step2'));},submit:function submit(){var aDeferred=jQuery.Deferred(),form=this.getContainer(),formData=form.serializeFormData(),saveData=this.getData(formData);return saveData.record=formData.record,this.validationMappingFields().done(function(data){if(data){var progressIndicatorElement=jQuery.progressIndicator({position:'html',blockInfo:{enabled:!0}});app.saveAjax('step2',saveData).done(function(data){if(!0==data.success){Settings_Vtiger_Index_Js.showMessage({text:app.vtranslate('JS_MF_SAVED_SUCCESSFULLY')});var mfRecordElement=jQuery('[name="record"]',form);''===mfRecordElement.val()&&(mfRecordElement.val(data.result.id),formData.record=data.result.id),formData.record=data.result.id,AppConnector.request(formData).done(function(data){form.hide(),progressIndicatorElement.progressIndicator({mode:'hide'}),aDeferred.resolve(data);}).fail(function(error,err){app.errorLog(error,err);});}});}else aDeferred.resolve(!1);}),aDeferred.promise()},getData:function getData(data){var mappingData=[],mappingConditions=[];for(var i in data){var name=i.split('][');2==name.length?'default]'!=name[1]&&0!=data[i]?mappingData[i]=data[i]:'default]'==name[1]&&(mappingData[i]=jQuery.isArray(data[i])?data[i].join(','):data[i].trim()):2!=name.length&&-1==jQuery.inArray(i,this.restictName)&&(mappingConditions[i]=data[i]);}return mappingData=jQuery.extend({},mappingData),mappingConditions=jQuery.extend({},mappingConditions),{mapping:mappingData,otherConditions:JSON.stringify(mappingConditions)}},registerCancelStepClickEvent:function registerCancelStepClickEvent(form){jQuery('button.cancelLink',form).on('click',function(){window.history.back();});},registerEvents:function registerEvents(){var container=this.getContainer(),opts=app.validationEngineOptions;// to prevent the page reload after the validation has completed
opts.onValidationComplete=function(form,valid){//returns the valid status
return valid},opts.promptPosition='bottomRight',container.validationEngine(opts),App.Fields.Picklist.showSelect2ElementView(container.find('.select2')),this.registerCancelStepClickEvent(container),this.registerEventsForEditView();},/**
		 * Function to register event for adding new convert to field mapping
		 */registerEventForAddingNewMapping:function registerEventForAddingNewMapping(){var thisInstance=this;jQuery('#addMapping').on('click',function(){var mappingToGenerateTable=jQuery('#mappingToGenerate'),lastSequenceNumber=mappingToGenerateTable.find('tr:not(.d-none)[sequence-number]').last(),newSequenceNumber=thisInstance.getSequenceNumber(lastSequenceNumber)+1,newMapping=jQuery('.newMapping').clone(!0,!0);newMapping.attr('sequence-number',newSequenceNumber),newMapping.find('select.sourceFields.newSelect').attr('name','mapping['+newSequenceNumber+'][source]'),newMapping.find('select.targetFields.newSelect').attr('name','mapping['+newSequenceNumber+'][target]'),newMapping.find('input.mappingType').attr('name','mapping['+newSequenceNumber+'][type]'),newMapping.removeClass('d-none newMapping'),newMapping.appendTo(mappingToGenerateTable),newMapping.find('.newSelect').removeClass('newSelect').addClass('select2');var select2Elements=newMapping.find('.select2');App.Fields.Picklist.showSelect2ElementView(select2Elements),jQuery('select.targetFields',newMapping).trigger('change',!1),thisInstance.loadDefaultValueWidgetForMappedFields(newMapping.find('.select2'));});},getSequenceNumber:function getSequenceNumber(element){var sequenceNumber;return sequenceNumber=element.length?element.attr('sequence-number'):0,parseInt(sequenceNumber)},/**
		 * Function to register on change event for select2 element
		 */registerOnChangeEventForSourceModule:function registerOnChangeEventForSourceModule(){var form=this.getContainer();form.on('change','.sourceFields',function(e){var element=jQuery(e.currentTarget),container=jQuery(element.closest('tr')),selectedValue=element.val(),selectedOption=element.find('option[value="'+selectedValue+'"]'),selectedDataType=selectedOption.data('type'),mappingType=selectedOption.data('mappingtype'),fieldsSelectElement=container.find('select.targetFields.select2'),fieldsBasedOnType=form.find('.newMapping').find('.targetFields').children().clone(!0,!0),options=jQuery('<div></div>');container.find('.mappingType').val(mappingType),fieldsBasedOnType.each(function(i,e){var element=jQuery(e);element.is('option')&&(element.data('type')==selectedDataType||'none'==element.data('type'))?options.append(element):element.is('optgroup')&&0<element.find('[data-type="'+selectedDataType+'"]').length&&(element.children().each(function(q,k){var option=jQuery(k);option.data('type')!==selectedDataType&&option.remove();}),options.append(element));}),container.find('.selectedFieldDataType').html(selectedOption.data('type-name')?selectedOption.data('type-name'):''),fieldsSelectElement.html(options.children()),fieldsSelectElement.trigger('change',!1);});},/**
		 * Function to register event to delete mapping
		 */registerEventToDeleteMapping:function registerEventToDeleteMapping(){var form=this.getContainer();form.on('click','.deleteMapping',function(e){var element=jQuery(e.currentTarget),trContainer=element.closest('tr');trContainer.remove();});},loadDefaultValueWidget:function loadDefaultValueWidget(element){var thisInstance=this,id=element.val()+'_defaultvalue',affectedRow=jQuery('#defaultValuesElementsContainer').find('#'+id),dafeultTd=element.closest('td').next(),defaultValueElement=dafeultTd.find('input.default'),defaultValue='';defaultValueElement.length&&(defaultValue=defaultValueElement.val()),dafeultTd.children().remove();var exist=jQuery('#mappingToGenerate').find('#'+id);if(0!==affectedRow.length&&element.val()&&!(0<exist.length)){var seqNumber=thisInstance.getSequenceNumber(element.closest('tr')),copyOfDefaultValue=affectedRow.clone(!0,!0);copyOfDefaultValue.prop('disabled',!1).attr('name','mapping['+seqNumber+'][default]'),copyOfDefaultValue.is(':checkbox')&&defaultValue?copyOfDefaultValue.prop('checked',!0):defaultValue&&(defaultValue='undefined'==typeof copyOfDefaultValue.attr('multiple')?defaultValue:defaultValue.split(','),copyOfDefaultValue.val(defaultValue)),copyOfDefaultValue.appendTo(dafeultTd),App.Fields.Picklist.showSelect2ElementView(dafeultTd.find('select'));}},loadDefaultValueWidgetForMappedFields:function loadDefaultValueWidgetForMappedFields(fieldsList){var thisInstance=this;fieldsList.each(function(){thisInstance.loadDefaultValueWidget(jQuery(this));}),fieldsList.on('change',function(e){var element=jQuery(e.currentTarget);thisInstance.loadDefaultValueWidget(element);});},/**
		 * Function to register events for edit view of fields mapping
		 */registerEventsForEditView:function registerEventsForEditView(){this.registerEventForAddingNewMapping(),this.registerOnChangeEventForSourceModule(),this.registerEventToDeleteMapping(),this.loadDefaultValueWidgetForMappedFields(jQuery('select.targetFields:not(.newSelect)'));},/*
		 * Function to register on chnage event of target module
		 */validationMappingFields:function validationMappingFields(){var aDeferred=jQuery.Deferred(),mappingTable=jQuery('#mappingToGenerate tr:not(.d-none)');return mappingTable.each(function(){var moduleName,breakSave=!1,targetField=jQuery(this).find('.targetFields :selected');if(1<mappingTable.find('.targetFields option[value="'+targetField.val()+'"]:selected').length&&(moduleName=jQuery('.targetModuleName').text(),breakSave=moduleName+': '+targetField.text()),breakSave){var warningMessage=breakSave+' <br />'+app.vtranslate('JS_IS_ALREADY_BEEN_MAPPED');return Settings_Vtiger_Index_Js.showMessage({text:warningMessage,type:'error'}),aDeferred.resolve(!1),!1}}),aDeferred.resolve(!0),aDeferred.promise()}});
//# sourceMappingURL=Edit2.min.js.map
