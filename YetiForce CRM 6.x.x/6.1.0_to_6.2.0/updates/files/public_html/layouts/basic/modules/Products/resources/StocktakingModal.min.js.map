{"version":3,"file":"StocktakingModal.min.js","sources":["StocktakingModal.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 4.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\nwindow.Products_StocktakingModal_JS = class {\n\t/**\n\t * Show step by name.\n\t * @param {string} name\n\t */\n\tshowStep(name) {\n\t\tthis.container.find('.js-step').addClass('d-none');\n\t\tthis.container.find(`.js-step[data-step=\"${name}\"]`).removeClass('d-none');\n\t}\n\t/**\n\t * Register analyze file events.\n\t */\n\tregisterAnalyzeFile() {\n\t\tlet form = this.container.find('form');\n\t\tform.validationEngine(app.validationEngineOptions);\n\t\tthis.container.find('.js-send-file').on('click', () => {\n\t\t\tif (!form.validationEngine('validate')) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet formData = new FormData(form[0]);\n\t\t\tformData.append('module', 'Products');\n\t\t\tformData.append('action', 'StocktakingModal');\n\t\t\tformData.append('mode', 'analyzeFile');\n\t\t\tlet progress = $.progressIndicator({ position: 'html', blockInfo: { enabled: true } });\n\t\t\tAppConnector.request({\n\t\t\t\turl: 'index.php',\n\t\t\t\ttype: 'POST',\n\t\t\t\tdata: formData,\n\t\t\t\tprocessData: false,\n\t\t\t\tcontentType: false\n\t\t\t})\n\t\t\t\t.done((response) => {\n\t\t\t\t\tthis.showStep('selectColumn');\n\t\t\t\t\tthis.container.find('.js-encoding').val(response.result.encoding);\n\t\t\t\t\tthis.container.find('.js-count').val(response.result.count);\n\t\t\t\t\tthis.container.find('.js-randomKey').val(response.result.randomKey);\n\t\t\t\t\tlet eanField = this.container.find('#skuColumnSeq');\n\t\t\t\t\tlet qtyField = this.container.find('#qtyColumnSeq');\n\t\t\t\t\t$.each(response.result.column, function (index, value) {\n\t\t\t\t\t\teanField.append(`<option value=\"${index}\">${value}</option>`);\n\t\t\t\t\t\tqtyField.append(`<option value=\"${index}\">${value}</option>`);\n\t\t\t\t\t});\n\t\t\t\t\tqtyField.val(1);\n\t\t\t\t\tApp.Fields.Picklist.showSelect2ElementView(qtyField);\n\t\t\t\t\tApp.Fields.Picklist.showSelect2ElementView(eanField);\n\t\t\t\t\tprogress.progressIndicator({ mode: 'hide' });\n\t\t\t\t})\n\t\t\t\t.fail((error, title) => {\n\t\t\t\t\tprogress.progressIndicator({ mode: 'hide' });\n\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\ttitle: title,\n\t\t\t\t\t\ttext: error,\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t});\n\t}\n\t/**\n\t * Register compare stock levels.\n\t */\n\tregisterCompare() {\n\t\tlet form = this.container.find('form');\n\t\tthis.container.find('.js-compare').on('click', () => {\n\t\t\tlet formData = form.serializeFormData();\n\t\t\tformData['module'] = 'Products';\n\t\t\tformData['action'] = 'StocktakingModal';\n\t\t\tformData['mode'] = 'compare';\n\t\t\tlet progress = $.progressIndicator({ position: 'html', blockInfo: { enabled: true } });\n\t\t\tAppConnector.request(formData)\n\t\t\t\t.done((response) => {\n\t\t\t\t\tthis.showStep('showCompare');\n\t\t\t\t\tthis.container.find('.js-entries-update').val(response.result.update);\n\t\t\t\t\tthis.container.find('.js-entries-no-update').val(response.result.same);\n\t\t\t\t\tthis.container.find('.js-entries-not-found').val(response.result.counterNotFound);\n\t\t\t\t\tthis.container.find('.js-list-entries-not-found').val(response.result.notFound);\n\t\t\t\t\tthis.toUpdate = response.result.toUpdate;\n\t\t\t\t\tif (response.result.update === 0) {\n\t\t\t\t\t\tthis.container.find('.js-import').addClass('d-none');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (formData['storage'] != 0) {\n\t\t\t\t\t\t\tthis.container.find('.js-record-name').removeClass('d-none');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tprogress.progressIndicator({ mode: 'hide' });\n\t\t\t\t})\n\t\t\t\t.fail((error, title) => {\n\t\t\t\t\tprogress.progressIndicator({ mode: 'hide' });\n\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\ttitle: title,\n\t\t\t\t\t\ttext: error,\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t});\n\t}\n\t/**\n\t * Register importing stock differences.\n\t */\n\tregisterImport() {\n\t\tlet form = this.container.find('form');\n\t\tthis.container.find('.js-import').on('click', () => {\n\t\t\tlet formData = form.serializeFormData();\n\t\t\tif (formData['storage'] != 0 && !form.validationEngine('validate')) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tformData['module'] = 'Products';\n\t\t\tformData['action'] = 'StocktakingModal';\n\t\t\tformData['mode'] = 'import';\n\t\t\tformData['records'] = this.toUpdate;\n\t\t\tlet progress = $.progressIndicator({ position: 'html', blockInfo: { enabled: true } });\n\t\t\tAppConnector.request(formData)\n\t\t\t\t.done((response) => {\n\t\t\t\t\tthis.showStep('showSummary');\n\t\t\t\t\tif (response.result.product) {\n\t\t\t\t\t\tthis.container.find('.js-imported').removeClass('d-none');\n\t\t\t\t\t\tthis.container.find('.js-imported-counter').val(response.result.product);\n\t\t\t\t\t}\n\t\t\t\t\tif (response.result.igin) {\n\t\t\t\t\t\tthis.container\n\t\t\t\t\t\t\t.find('.js-btn-igin')\n\t\t\t\t\t\t\t.removeClass('d-none')\n\t\t\t\t\t\t\t.attr('href', 'index.php?module=IGIN&view=Detail&record=' + response.result.igin);\n\t\t\t\t\t}\n\t\t\t\t\tif (response.result.iidn) {\n\t\t\t\t\t\tthis.container\n\t\t\t\t\t\t\t.find('.js-btn-iidn')\n\t\t\t\t\t\t\t.removeClass('d-none')\n\t\t\t\t\t\t\t.attr('href', 'index.php?module=IIDN&view=Detail&record=' + response.result.iidn);\n\t\t\t\t\t}\n\t\t\t\t\tif (response.result.igin || response.result.iidn) {\n\t\t\t\t\t\tthis.container.find('.js-alert').removeClass('d-none');\n\t\t\t\t\t}\n\t\t\t\t\tprogress.progressIndicator({ mode: 'hide' });\n\t\t\t\t})\n\t\t\t\t.fail((error, title) => {\n\t\t\t\t\tprogress.progressIndicator({ mode: 'hide' });\n\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\ttitle: title,\n\t\t\t\t\t\ttext: error,\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t});\n\t}\n\t/**\n\t * Register modal events.\n\t * @param {jQuery} modalContainer\n\t */\n\tregisterEvents(modalContainer) {\n\t\tthis.container = modalContainer;\n\t\tthis.registerAnalyzeFile();\n\t\tthis.registerCompare();\n\t\tthis.registerImport();\n\t}\n};\n"],"names":["window","Products_StocktakingModal_JS","name","container","find","addClass","removeClass","form","validationEngine","app","validationEngineOptions","on","formData","append","$","progressIndicator","position","blockInfo","enabled","AppConnector","request","url","type","data","processData","contentType","done","response","showStep","val","result","encoding","count","randomKey","qtyField","each","column","index","value","eanField","App","Fields","Picklist","showSelect2ElementView","progress","mode","fail","error","title","showNotify","text","serializeFormData","update","same","counterNotFound","notFound","toUpdate","product","igin","attr","iidn","modalContainer","registerAnalyzeFile","registerCompare","registerImport"],"mappings":"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"}