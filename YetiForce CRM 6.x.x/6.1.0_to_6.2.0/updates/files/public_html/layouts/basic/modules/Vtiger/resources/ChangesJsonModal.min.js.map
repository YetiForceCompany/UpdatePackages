{"version":3,"file":"ChangesJsonModal.min.js","sources":["ChangesJsonModal.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 4.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n$.Class(\n\t'Base_ChangesJsonModal_JS',\n\t{},\n\t{\n\t\t/**\n\t\t * Register select field\n\t\t */\n\t\tregisterSelectField: function () {\n\t\t\tlet editInstance = Vtiger_Edit_Js.getInstance(this.module);\n\t\t\tlet form = this.container.find('form');\n\t\t\tthis.container.find('.js-changesjson-select').on('change', (e) => {\n\t\t\t\tlet element = $(e.currentTarget);\n\t\t\t\tlet blockElement = element.closest('.js-form-row-container').find('.fieldValue');\n\t\t\t\tlet fieldElement = blockElement.find('[data-validation-engine],[data-invalid-validation-engine]');\n\t\t\t\tlet fieldInfo = fieldElement.data('fieldinfo');\n\t\t\t\tif (element.prop('checked')) {\n\t\t\t\t\tthis.activeFieldValidation(fieldElement);\n\t\t\t\t} else {\n\t\t\t\t\tthis.inactiveFieldValidation(fieldElement);\n\t\t\t\t}\n\t\t\t\tif (fieldInfo !== undefined && fieldInfo.type === 'reference') {\n\t\t\t\t\tlet mapFields = editInstance.getMappingRelatedField(\n\t\t\t\t\t\tfieldInfo.name,\n\t\t\t\t\t\teditInstance.getReferencedModuleName(blockElement),\n\t\t\t\t\t\tform\n\t\t\t\t\t);\n\t\t\t\t\t$.each(mapFields, function (key, _) {\n\t\t\t\t\t\tlet checkboxElement = form.find('[id=\"selectRow' + key + '\"]');\n\t\t\t\t\t\tif (checkboxElement.length && checkboxElement.prop('disabled')) {\n\t\t\t\t\t\t\tcheckboxElement.prop('disabled', false);\n\t\t\t\t\t\t\tcheckboxElement.trigger('click');\n\t\t\t\t\t\t\tcheckboxElement.prop('disabled', true);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Deactivate field validation\n\t\t * @param {jQuery}\n\t\t */\n\t\tinactiveFieldValidation: function (field) {\n\t\t\tfield.validationEngine('hide');\n\t\t\tlet form = field.closest('form');\n\t\t\tlet invalidFields = form.data('jqv').InvalidFields;\n\t\t\tlet fields = [field.get(0)];\n\t\t\tfield.attr('data-invalid-validation-engine', field.attr('data-validation-engine'));\n\t\t\tfield.removeAttr('data-validation-engine');\n\n\t\t\tif (field.is('select') && field.hasClass('select2')) {\n\t\t\t\tlet selectElement = app.getSelect2ElementFromSelect(field);\n\t\t\t\tselectElement.validationEngine('hide');\n\t\t\t\tfields.push(selectElement.get(0));\n\t\t\t}\n\t\t\tfor (let i in fields) {\n\t\t\t\tlet response = jQuery.inArray(fields[i], invalidFields);\n\t\t\t\tif (response != '-1') {\n\t\t\t\t\tinvalidFields.splice(response, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Activate field validation\n\t\t * @param {jQuery}\n\t\t */\n\t\tactiveFieldValidation: function (field) {\n\t\t\tlet validationVal = field.attr('data-invalid-validation-engine');\n\t\t\tif (typeof validationVal === 'undefined') return;\n\t\t\tfield.attr('data-validation-engine', validationVal);\n\t\t\tfield.removeAttr('data-invalid-validation-engine');\n\t\t},\n\t\t/**\n\t\t * Function to inactive field for validation in a form\n\t\t * this will remove data-validation-engine attr of all the elements\n\t\t */\n\t\tinactiveFieldsValidation: function () {\n\t\t\tlet editFieldList = this.container.find('.js-edit-field-list').data('value');\n\t\t\tlet form = this.container.find('form');\n\t\t\tfor (let fieldName in editFieldList) {\n\t\t\t\tlet fieldInfo = editFieldList[fieldName];\n\n\t\t\t\tlet fieldElement = form.find('[name=\"' + fieldInfo.name + '\"]');\n\t\t\t\tif (fieldInfo.type == 'reference') {\n\t\t\t\t\tfieldElement = form.find('[name=\"' + fieldInfo.name + '_display\"]');\n\t\t\t\t} else if (fieldInfo.type == 'multipicklist' || fieldInfo.type == 'sharedOwner') {\n\t\t\t\t\tfieldElement = form.find('[name=\"' + fieldInfo.name + '[]\"]');\n\t\t\t\t}\n\t\t\t\tif (\n\t\t\t\t\tfieldElement.length == 0 ||\n\t\t\t\t\tfieldElement.closest('.js-form-row-container').find('.js-changesjson-select').prop('checked')\n\t\t\t\t) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tlet elemData = fieldElement.data();\n\t\t\t\tlet validationVal = 'validate[]';\n\t\t\t\tif ('validationEngine' in elemData) {\n\t\t\t\t\tvalidationVal = elemData.validationEngine;\n\t\t\t\t\tdelete elemData.validationEngine;\n\t\t\t\t}\n\t\t\t\tfieldElement.attr('data-invalid-validation-engine', validationVal);\n\t\t\t\tfieldElement.removeAttr('data-validation-engine');\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Register change tab\n\t\t */\n\t\tregisterEventForTabClick: function () {\n\t\t\tlet form = this.container.find('form');\n\t\t\tthis.container.on('click', 'a[data-toggle=\"tab\"]', function (e) {\n\t\t\t\tform.validationEngine('validate');\n\t\t\t\tlet invalidFields = form.data('jqv').InvalidFields;\n\t\t\t\tif (invalidFields.length > 0) {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Register events\n\t\t * @param {jQuery} container\n\t\t */\n\t\tregisterEvents(container) {\n\t\t\tthis.container = container;\n\t\t\tthis.module = container.find('[name=\"module\"]').val();\n\t\t\tthis.container.find('form').validationEngine(app.validationEngineOptions);\n\t\t\tthis.inactiveFieldsValidation();\n\t\t\tthis.registerEventForTabClick();\n\t\t\tthis.registerSelectField();\n\t\t\tVtiger_Edit_Js.getInstance(this.module).registerBasicEvents(container);\n\t\t}\n\t}\n);\n"],"names":["$","Class","registerSelectField","editInstance","Vtiger_Edit_Js","getInstance","module","form","container","find","on","e","currentTarget","blockElement","element","closest","fieldElement","fieldInfo","data","prop","activeFieldValidation","inactiveFieldValidation","type","getMappingRelatedField","name","getReferencedModuleName","each","mapFields","key","checkboxElement","length","trigger","field","validationEngine","invalidFields","InvalidFields","fields","get","attr","removeAttr","is","hasClass","app","getSelect2ElementFromSelect","selectElement","push","jQuery","inArray","i","splice","response","validationVal","inactiveFieldsValidation","editFieldList","fieldName","elemData","registerEventForTabClick","stopPropagation","registerEvents","val","validationEngineOptions","registerBasicEvents"],"mappings":";;AAEAA,EAAEC,KAAF,CACC,0BADD,CAEC,EAFD,CAGC;;KAICC,oBAAqB,8BAAY,gBAC5BC,aAAeC,eAAeC,WAAf,CAA2B,KAAKC,MAAhC,CADa,CAE5BC,KAAO,KAAKC,SAAL,CAAeC,IAAf,CAAoB,MAApB,CAFqB,CAGhC,KAAKD,SAAL,CAAeC,IAAf,CAAoB,wBAApB,EAA8CC,EAA9C,CAAiD,QAAjD,CAA2D,SAACC,CAAD,CAAO,aACnDX,EAAEW,EAAEC,aAAJ,CADmD,CAE7DC,aAAeC,QAAQC,OAAR,CAAgB,wBAAhB,EAA0CN,IAA1C,CAA+C,aAA/C,CAF8C,CAG7DO,aAAeH,aAAaJ,IAAb,CAAkB,2DAAlB,CAH8C,CAI7DQ,UAAYD,aAAaE,IAAb,CAAkB,WAAlB,CAJiD,CAUjE,GALIJ,QAAQK,IAAR,CAAa,SAAb,CAKJ,CAJC,MAAKC,qBAAL,CAA2BJ,YAA3B,CAID,CAFC,MAAKK,uBAAL,CAA6BL,YAA7B,CAED,CAAI,oBAA8C,WAAnB,aAAUM,IAAzC,CAA+D,CAC9D,cAAgBnB,aAAaoB,sBAAb,CACfN,UAAUO,IADK,CAEfrB,aAAasB,uBAAb,CAAqCZ,YAArC,CAFe,CAGfN,IAHe,CAAhB,CAKAP,EAAE0B,IAAF,CAAOC,SAAP,CAAkB,SAAUC,GAAV,CAAkB,CACnC,oBAAsBrB,KAAKE,IAAL,CAAU,iBAAmBmB,GAAnB,CAAyB,IAAnC,CAAtB,CACIC,gBAAgBC,MAAhB,EAA0BD,gBAAgBV,IAAhB,CAAqB,UAArB,CAFK,GAGlCU,gBAAgBV,IAAhB,CAAqB,UAArB,IAHkC,CAIlCU,gBAAgBE,OAAhB,CAAwB,OAAxB,CAJkC,CAKlCF,gBAAgBV,IAAhB,CAAqB,UAArB,IALkC,EAOnC,CAPD,EAQA,CACD,CAzBD,EA0BA,CAjCF;;;KAsCCE,wBAAyB,iCAAUW,KAAV,CAAiB,CACzCA,MAAMC,gBAAN,CAAuB,MAAvB,CADyC,UAE9BD,MAAMjB,OAAN,CAAc,MAAd,CAF8B,CAGrCmB,cAAgB3B,KAAKW,IAAL,CAAU,KAAV,EAAiBiB,aAHI,CAIrCC,OAAS,CAACJ,MAAMK,GAAN,CAAU,CAAV,CAAD,CAJ4B,CAQzC,GAHAL,MAAMM,IAAN,CAAW,gCAAX,CAA6CN,MAAMM,IAAN,CAAW,wBAAX,CAA7C,CAGA,CAFAN,MAAMO,UAAN,CAAiB,wBAAjB,CAEA,CAAIP,MAAMQ,EAAN,CAAS,QAAT,GAAsBR,MAAMS,QAAN,CAAe,SAAf,CAA1B,CAAqD,CACpD,kBAAoBC,IAAIC,2BAAJ,CAAgCX,KAAhC,CAApB,CACAY,cAAcX,gBAAd,CAA+B,MAA/B,CAFoD,CAGpDG,OAAOS,IAAP,CAAYD,cAAcP,GAAd,CAAkB,CAAlB,CAAZ,EACA,CACD,IAAK,KAAL,UAAA,CAAsB,CACrB,aAAeS,OAAOC,OAAP,CAAeX,OAAOY,CAAP,CAAf,CAA0Bd,aAA1B,CAAf,CACgB,IAAZ,UAFiB,EAGpBA,cAAce,MAAd,CAAqBC,QAArB,CAA+B,CAA/B,EAED,CACD,CAzDF;;;KA8DC9B,sBAAuB,+BAAUY,KAAV,CAAiB,CACvC,kBAAoBA,MAAMM,IAAN,CAAW,gCAAX,CAApB,CAC6B,WAAzB,sBAFmC,GAGvCN,MAAMM,IAAN,CAAW,wBAAX,CAAqCa,aAArC,CAHuC,CAIvCnB,MAAMO,UAAN,CAAiB,gCAAjB,CAJuC,EAKvC,CAnEF;;;KAwECa,yBAA0B,mCAAY,mBACjB,KAAK5C,SAAL,CAAeC,IAAf,CAAoB,qBAApB,EAA2CS,IAA3C,CAAgD,OAAhD,CADiB,CAEjCX,KAAO,KAAKC,SAAL,CAAeC,IAAf,CAAoB,MAApB,CAF0B,CAGrC,IAAK,aAAL,iBAAA,CAAqC,eACpB4C,cAAcC,SAAd,CADoB,CAGhCtC,aAAeT,KAAKE,IAAL,CAAU,UAAYQ,UAAUO,IAAtB,CAA6B,IAAvC,CAHiB,CASpC,GALsB,WAAlB,YAAUF,IAKd,CAJCN,aAAeT,KAAKE,IAAL,CAAU,UAAYQ,UAAUO,IAAtB,CAA6B,YAAvC,CAIhB,EAH6B,eAAlB,YAAUF,IAAV,EAAuD,aAAlB,YAAUA,IAG1D,IAFCN,aAAeT,KAAKE,IAAL,CAAU,UAAYQ,UAAUO,IAAtB,CAA6B,MAAvC,CAEhB,IACwB,CAAvB,eAAaM,MAAb,EACAd,aAAaD,OAAb,CAAqB,wBAArB,EAA+CN,IAA/C,CAAoD,wBAApD,EAA8EU,IAA9E,CAAmF,SAAnF,CAFD,gBAOeH,aAAaE,IAAb,EAPf,CAQIiC,cAAgB,YARpB,CASI,6BATJ,GAUCA,cAAgBI,SAAStB,gBAV1B,CAWC,gBAAgBA,gBAXjB,EAaAjB,aAAasB,IAAb,CAAkB,gCAAlB,CAAoDa,aAApD,CAbA,CAcAnC,aAAauB,UAAb,CAAwB,wBAAxB,EAdA,CAeA,CACD,CApGF;;KAwGCiB,yBAA0B,mCAAY,CACrC,SAAW,KAAKhD,SAAL,CAAeC,IAAf,CAAoB,MAApB,CAAX,CACA,KAAKD,SAAL,CAAeE,EAAf,CAAkB,OAAlB,CAA2B,sBAA3B,CAAmD,SAAUC,CAAV,CAAa,CAC/DJ,KAAK0B,gBAAL,CAAsB,UAAtB,CAD+D,CAE/D,kBAAoB1B,KAAKW,IAAL,CAAU,KAAV,EAAiBiB,aAArC,CAC2B,CAAvB,eAAcL,MAH6C,EAI9DnB,EAAE8C,eAAF,GAED,CAND,EAOA,CAjHF;;;KAsHCC,cAtHD,yBAsHgBlD,SAtHhB,CAsH2B,CACzB,KAAKA,SAAL,CAAiBA,SADQ,CAEzB,KAAKF,MAAL,CAAcE,UAAUC,IAAV,CAAe,iBAAf,EAAkCkD,GAAlC,EAFW,CAGzB,KAAKnD,SAAL,CAAeC,IAAf,CAAoB,MAApB,EAA4BwB,gBAA5B,CAA6CS,IAAIkB,uBAAjD,CAHyB,CAIzB,KAAKR,wBAAL,EAJyB,CAKzB,KAAKI,wBAAL,EALyB,CAMzB,KAAKtD,mBAAL,EANyB,CAOzBE,eAAeC,WAAf,CAA2B,KAAKC,MAAhC,EAAwCuD,mBAAxC,CAA4DrD,SAA5D,EACA,CA9HF,CAHD"}