{"version":3,"file":"RecordConverter.min.js","sources":["RecordConverter.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 4.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n$.Class(\n\t'Base_RecordConverter_JS',\n\t{},\n\t{\n\t\tcontainer: false,\n\t\t/**\n\t\t * Function get values for request query\n\t\t * @returns {{module: string, view: string, fieldMerge: string, onlyBody: boolean, destinyModule: string, sourceView: string}}\n\t\t */\n\t\tgetParams: function () {\n\t\t\tlet params = {\n\t\t\t\tmodule: this.container.data('module'),\n\t\t\t\tview: this.container.data('view'),\n\t\t\t\tconvertId: this.container.find('.js-convert-type option:selected').val(),\n\t\t\t\tsourceView: this.container.find('[name=\"sourceView\"]').val()\n\t\t\t};\n\t\t\tif (app.getViewName() === 'List') {\n\t\t\t\tlet listInstance = Vtiger_List_Js.getInstance();\n\t\t\t\tparams.selected_ids = listInstance.readSelectedIds(true);\n\t\t\t\tparams.excluded_ids = listInstance.readExcludedIds(true);\n\t\t\t\tparams.cvId = listInstance.getCurrentCvId();\n\t\t\t\tif (listInstance.getListSearchInstance()) {\n\t\t\t\t\tlet searchValue = listInstance.getListSearchInstance().getAlphabetSearchValue();\n\t\t\t\t\tparams.search_params = JSON.stringify(listInstance.getListSearchInstance().getListSearchParams());\n\t\t\t\t\tif (typeof searchValue != 'undefined' && searchValue.length > 0) {\n\t\t\t\t\t\tparams.search_key = listInstance.getListSearchInstance().getAlphabetSearchField();\n\t\t\t\t\t\tparams.search_value = searchValue;\n\t\t\t\t\t\tparams.operator = 's';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tparams.selected_ids = app.getRecordId();\n\t\t\t}\n\t\t\treturn params;\n\t\t},\n\t\t/**\n\t\t * Function load modal window\n\t\t * @returns {object}\n\t\t */\n\t\tloadModalWindow: function () {\n\t\t\tconst body = this.container.find('.js-modal-body');\n\t\t\tconst aDeferred = $.Deferred();\n\t\t\tconst progressIndicatorElement = $.progressIndicator({\n\t\t\t\tblockInfo: {\n\t\t\t\t\tenabled: true\n\t\t\t\t}\n\t\t\t});\n\t\t\tapp.hideModalWindow(body.closest('.js-modal-container').attr('id'));\n\t\t\tapp.showModalWindow({\n\t\t\t\turl: app.convertObjectToUrl(this.getParams()),\n\t\t\t\tcb: function (_) {\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn aDeferred.promise();\n\t\t},\n\t\t/**\n\t\t * Function listener to change convert type\n\t\t */\n\t\tregisterChangeConvertType: function () {\n\t\t\tthis.container.on('change', '.js-convert-type', (e) => {\n\t\t\t\tthis.loadModalWindow();\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Function listener to send a form\n\t\t * * @returns {object}\n\t\t */\n\t\tregisterSubmitForm: function () {\n\t\t\tlet self = this;\n\t\t\tself.container.on('click', \"[name='saveButton']\", (e) => {\n\t\t\t\tlet formMapping = self.container.find('form.js-form-converter');\n\t\t\t\tif (formMapping.validationEngine('validate')) {\n\t\t\t\t\tlet formData = formMapping.serializeFormData();\n\t\t\t\t\tlet postData = {};\n\t\t\t\t\tif (app.getViewName() === 'List') {\n\t\t\t\t\t\tlet listInstance = Vtiger_List_Js.getInstance();\n\t\t\t\t\t\tpostData = listInstance.getDefaultParams();\n\t\t\t\t\t\tpostData.selected_ids = listInstance.readSelectedIds(true);\n\t\t\t\t\t\tpostData.excluded_ids = listInstance.readExcludedIds(true);\n\t\t\t\t\t\tpostData.cvid = listInstance.getCurrentCvId();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpostData = {\n\t\t\t\t\t\t\tselected_ids: app.getRecordId()\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\tpostData.viewInfo = app.getViewName();\n\t\t\t\t\tconst aDeferred = $.Deferred();\n\t\t\t\t\tconst progressIndicatorElement = $.progressIndicator({\n\t\t\t\t\t\tblockInfo: {\n\t\t\t\t\t\t\tenabled: true,\n\t\t\t\t\t\t\telementToBlock: self.container.find('.modal-body')\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tAppConnector.request($.extend(formData, postData)).done(\n\t\t\t\t\t\tfunction (responseData) {\n\t\t\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\t\tresponseData = JSON.parse(responseData);\n\t\t\t\t\t\t\tif (responseData.result.redirect) {\n\t\t\t\t\t\t\t\twindow.location.href = responseData.result.redirect;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (responseData.result.createdRecords) {\n\t\t\t\t\t\t\t\t\tVtiger_Helper_Js.showMessage({\n\t\t\t\t\t\t\t\t\t\ttext: app.vtranslate(responseData.result.createdRecords),\n\t\t\t\t\t\t\t\t\t\ttype: 'success'\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (responseData.result.error) {\n\t\t\t\t\t\t\t\t\tVtiger_Helper_Js.showMessage({\n\t\t\t\t\t\t\t\t\t\ttext: app.vtranslate(responseData.result.error),\n\t\t\t\t\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tapp.hideModalWindow();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\taDeferred.resolve(responseData);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfunction (textStatus, errorThrown) {\n\t\t\t\t\t\t\taDeferred.reject(textStatus, errorThrown);\n\t\t\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\treturn aDeferred.promise();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Register events function\n\t\t * @param modalContainer\n\t\t */\n\t\tregisterEvents: function (modalContainer) {\n\t\t\tthis.container = modalContainer;\n\t\t\tthis.registerChangeConvertType();\n\t\t\tthis.registerSubmitForm();\n\t\t\tthis.container.find('form.js-form-converter').validationEngine(app.validationEngineOptions);\n\t\t}\n\t}\n);\n"],"names":["$","Class","container","getParams","module","data","view","convertId","find","val","sourceView","getViewName","Vtiger_List_Js","getInstance","params","selected_ids","listInstance","readSelectedIds","excluded_ids","readExcludedIds","cvId","getCurrentCvId","getListSearchInstance","getAlphabetSearchValue","search_params","JSON","stringify","getListSearchParams","length","search_key","getAlphabetSearchField","search_value","searchValue","operator","app","getRecordId","loadModalWindow","aDeferred","Deferred","progressIndicatorElement","progressIndicator","blockInfo","enabled","hideModalWindow","body","closest","attr","showModalWindow","url","convertObjectToUrl","cb","mode","promise","registerChangeConvertType","on","registerSubmitForm","self","formMapping","validationEngine","serializeFormData","postData","getDefaultParams","cvid","viewInfo","elementToBlock","request","extend","formData","done","responseData","parse","result","redirect","window","location","href","createdRecords","Vtiger_Helper_Js","showMessage","text","vtranslate","type","error","resolve","textStatus","errorThrown","reject","registerEvents","modalContainer","validationEngineOptions"],"mappings":"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"}