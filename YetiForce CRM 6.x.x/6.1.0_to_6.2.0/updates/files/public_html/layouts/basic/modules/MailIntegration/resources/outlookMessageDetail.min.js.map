{"version":3,"file":"outlookMessageDetail.min.js","sources":["outlookMessageDetail.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 4.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\nwindow.MailIntegration_Start = {\n\tiframe: {},\n\t/**\n\t * Set iframe element.\n\t */\n\tsetIframe() {\n\t\tthis.iframe = $('#js-iframe');\n\t},\n\t/**\n\t * Show detail view.\n\t *\n\t * @param   {object}  mailItem  Office mailbox.item\n\t */\n\tshowDetailView(mailItem) {\n\t\tAppConnector.request(\n\t\t\t$.extend(\n\t\t\t\t{\n\t\t\t\t\tmodule: 'MailIntegration',\n\t\t\t\t\tview: 'Iframe',\n\t\t\t\t\tmailFrom: mailItem.from.emailAddress,\n\t\t\t\t\tmailSender: mailItem.sender.emailAddress,\n\t\t\t\t\tmailSubject: mailItem.subject,\n\t\t\t\t\tmailNormalizedSubject: mailItem.normalizedSubject,\n\t\t\t\t\tmailMessageId: mailItem.internetMessageId,\n\t\t\t\t\tmailDateTimeCreated: mailItem.dateTimeCreated.toISOString()\n\t\t\t\t},\n\t\t\t\twindow.PanelParams\n\t\t\t)\n\t\t)\n\t\t\t.done((responseData) => {\n\t\t\t\t$('#page').html(responseData);\n\t\t\t\tthis.registerLogoutEvents();\n\t\t\t})\n\t\t\t.fail((_) => {\n\t\t\t\tOffice.context.mailbox.item.notificationMessages.replaceAsync('error', {\n\t\t\t\t\ttype: 'errorMessage',\n\t\t\t\t\tmessage: app.vtranslate('JS_ERROR')\n\t\t\t\t});\n\t\t\t});\n\t},\n\t/**\n\t * Register logout events\n\t */\n\tregisterLogoutEvents() {\n\t\tthis.setIframe();\n\t\tlet reloadPanelAfterLogout = () => {\n\t\t\tif (!this.isUserLoggedIn()) {\n\t\t\t\twindow.location.reload();\n\t\t\t}\n\t\t};\n\t\tthis.iframe.on('load', reloadPanelAfterLogout);\n\t},\n\t/**\n\t * Register login events.\n\t */\n\tregisterLoginEvents() {\n\t\tlet loader;\n\t\tlet reloadPanelAfterLogin = () => {\n\t\t\tif (this.isUserLoggedIn()) {\n\t\t\t\twindow.location.reload();\n\t\t\t} else {\n\t\t\t\tloader.progressIndicator({ mode: 'hide' });\n\t\t\t}\n\t\t};\n\t\tlet showLoader = () => {\n\t\t\tloader = $.progressIndicator({\n\t\t\t\tblockInfo: { enabled: true },\n\t\t\t\tmessage: false,\n\t\t\t\tblockOverlayCSS: {\n\t\t\t\t\t'background-color': 'white',\n\t\t\t\t\topacity: 1\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\t\tthis.iframe.on('load', reloadPanelAfterLogin);\n\t\t$(this.iframe[0].contentWindow).on('unload', showLoader);\n\t\tlet src = this.iframe[0].getAttribute('src-a');\n\t\tif (src && this.iframe[0].getAttribute('src') == undefined) {\n\t\t\tthis.iframe[0].removeAttribute('src-a');\n\t\t\tthis.iframe[0].setAttribute('src', src);\n\t\t}\n\t},\n\t/**\n\t * Is user logged in.\n\t *\n\t * @return  {boolean}\n\t */\n\tisUserLoggedIn() {\n\t\treturn !(\n\t\t\tthis.iframe[0].contentWindow.document.body.dataset.module == 'Users' &&\n\t\t\tthis.iframe[0].contentWindow.document.body.dataset.view == 'Login'\n\t\t);\n\t},\n\tshowConsole() {\n\t\tlet s = '';\n\t\tlet x = '';\n\t\tfor (var p in navigator) {\n\t\t\ts += p + ' : ' + navigator[p] + '<br>';\n\t\t\tx += p + ' : ' + navigator[p] + '\\n';\n\t\t}\n\t\tconsole.log(x);\n\t\tdocument.body.innerHTML +=\n\t\t\t'<div style=\"position:absolute;width:100%;height:100%;z-index:100;background:#fff;left: 0px; top: 50%;overflow-y: auto;\">' +\n\t\t\ts +\n\t\t\t'</div>';\n\t},\n\t/**\n\t * Register events.\n\t *\n\t * @param   {object}  mailbox  Office mailbox\n\t */\n\tregisterEvents(mailbox) {\n\t\t//this.showConsole();\n\t\tif (!$('.js-exception-error').length) {\n\t\t\tthis.setIframe();\n\t\t\tif (this.iframe.data('view') === 'login') {\n\t\t\t\tthis.registerLoginEvents();\n\t\t\t} else {\n\t\t\t\tthis.showDetailView(mailbox.item);\n\t\t\t}\n\t\t}\n\t},\n\treloadView(data) {\n\t\twindow.MailIntegration_Start.showDetailView(Office.context.mailbox.item);\n\t}\n};\nif (typeof Office === 'undefined') {\n\tapp.showNotify({\n\t\ttitle: app.vtranslate('JS_ERROR'),\n\t\ttype: 'error'\n\t});\n} else {\n\tOffice.onReady((info) => {\n\t\twindow.PanelParams = {\n\t\t\tsource: 'Outlook',\n\t\t\tdevice: Office.context.mailbox.diagnostics.hostName\n\t\t};\n\t\tif (info.host === Office.HostType.Outlook) {\n\t\t\twindow.MailIntegration_Start.registerEvents(Office.context.mailbox);\n\t\t\tOffice.context.mailbox.addHandlerAsync(Office.EventType.ItemChanged, window.MailIntegration_Start.reloadView);\n\t\t}\n\t});\n}\n"],"names":["window","MailIntegration_Start","iframe","setIframe","$","showDetailView","mailItem","AppConnector","request","extend","module","view","mailFrom","from","emailAddress","mailSender","sender","mailSubject","subject","mailNormalizedSubject","normalizedSubject","mailMessageId","internetMessageId","mailDateTimeCreated","dateTimeCreated","toISOString","PanelParams","done","responseData","html","registerLogoutEvents","fail","Office","context","mailbox","item","notificationMessages","replaceAsync","type","message","app","vtranslate","on","isUserLoggedIn","location","reload","registerLoginEvents","loader","reloadPanelAfterLogin","progressIndicator","mode","contentWindow","blockInfo","enabled","blockOverlayCSS","opacity","getAttribute","src","removeAttribute","setAttribute","document","body","dataset","showConsole","x","s","p","navigator","console","log","innerHTML","registerEvents","length","data","reloadView","showNotify","title","onReady","info","source","device","diagnostics","hostName","host","HostType","Outlook","addHandlerAsync","EventType","ItemChanged"],"mappings":"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"}