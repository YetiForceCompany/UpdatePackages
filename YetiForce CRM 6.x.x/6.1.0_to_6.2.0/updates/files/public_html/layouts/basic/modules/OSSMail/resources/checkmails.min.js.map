{"version":3,"file":"checkmails.min.js","sources":["checkmails.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 4.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\njQuery(function () {\n\tif ($('.js-header__btn--mail').data('numberunreademails') != undefined) {\n\t\twindow.stopScanMails = false;\n\t\tif (getUrlVars()['view'] != 'Popup') {\n\t\t\tstartCheckMails();\n\t\t}\n\t}\n\tif ($('.js-header__btn--mail select').length > 0) {\n\t\tregisterUserList();\n\t}\n});\n\nfunction registerUserList() {\n\tvar selectUsers = $('.js-header__btn--mail select');\n\tif (selectUsers.data('select2')) {\n\t\tselectUsers.select2('destroy');\n\t} else {\n\t\tselectUsers.on('change', handleChangeUserEvent);\n\t}\n\tApp.Fields.Picklist.showSelect2ElementView(selectUsers, {\n\t\ttemplateResult: function (state) {\n\t\t\tif (!state.id) {\n\t\t\t\treturn state.text;\n\t\t\t}\n\t\t\tvar element = jQuery(state.element);\n\t\t\tvar text = element.data('nomail') ? ' (' + element.data('nomail') + ')' : '';\n\t\t\tvar $state = $('<span>' + state.text + '<span class\"text-left\"><span>' + text + '</span>');\n\t\t\treturn $state;\n\t\t},\n\t\ttemplateSelection: function (data) {\n\t\t\tvar element = jQuery(data.element);\n\t\t\tvar text = element.data('nomail') ? ' (' + element.data('nomail') + ')' : '';\n\t\t\tvar resultContainer = jQuery('<span></span>');\n\t\t\tresultContainer.append(data.text + text);\n\t\t\treturn resultContainer;\n\t\t},\n\t\tcloseOnSelect: true\n\t});\n\tvar select2Instance = selectUsers.data('select2');\n\tselect2Instance.$dropdown.on('mouseup', 'li', function (e) {\n\t\tif (jQuery(e.currentTarget).attr('aria-selected') == 'true') {\n\t\t\tselectUsers.trigger('change');\n\t\t}\n\t});\n\tselect2Instance.$container.find('.select2-selection__rendered').on('mousedown', function (e) {\n\t\te.stopPropagation();\n\t\tselectUsers.trigger('change');\n\t});\n\t$('.js-mail-list').on('click', '.js-mail-link', handleChangeUserEvent);\n}\n\nfunction handleChangeUserEvent() {\n\tvar params = {\n\t\tmodule: 'OSSMail',\n\t\taction: 'SetUser',\n\t\tuser: $(this).val()\n\t};\n\tAppConnector.request(params).done(function (response) {\n\t\tif (app.getModuleName() == 'OSSMail') {\n\t\t\twindow.location.href = window.location.href;\n\t\t} else {\n\t\t\twindow.location.href = 'index.php?module=OSSMail&view=Index';\n\t\t}\n\t});\n}\n\nfunction startCheckMails() {\n\tvar users = [];\n\tvar timeCheckingMails = $('.js-header__btn--mail').data('interval');\n\t$('.js-header__btn--mail .noMails').each(function (index) {\n\t\tusers.push($(this).data('id'));\n\t});\n\tif (users.length > 0) {\n\t\tcheckMails(users);\n\t\tvar refreshIntervalId = setInterval(function () {\n\t\t\tif (window.stopScanMails == false) {\n\t\t\t\tcheckMails(users);\n\t\t\t} else {\n\t\t\t\tclearInterval(refreshIntervalId);\n\t\t\t}\n\t\t}, timeCheckingMails * 1000);\n\t}\n}\n\nfunction checkMails(users) {\n\tvar params = {\n\t\tmodule: 'OSSMail',\n\t\taction: 'CheckMails',\n\t\tusers: users\n\t};\n\tvar reloadSelect = false;\n\tAppConnector.request(params)\n\t\t.done(function (response) {\n\t\t\tif (response.success && response.success.error != true && response.result.error != true) {\n\t\t\t\tvar result = response.result;\n\t\t\t\t$('.js-header__btn--mail .noMails').each(function (index) {\n\t\t\t\t\tvar element = jQuery(this);\n\t\t\t\t\tvar id = element.data('id');\n\t\t\t\t\tif (jQuery.inArray(id, result)) {\n\t\t\t\t\t\tvar num = result[id];\n\t\t\t\t\t\tif (element.is('option')) {\n\t\t\t\t\t\t\telement.data('nomail', num);\n\t\t\t\t\t\t\treloadSelect = true;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tlet prevVal = element.data('nomail');\n\t\t\t\t\t\t\telement.data('nomail', num);\n\t\t\t\t\t\t\tvar text = '';\n\t\t\t\t\t\t\tif (num > 0) {\n\t\t\t\t\t\t\t\ttext = ' <span class=\"badge badge-danger mr-1\">' + num + '</span>';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telement.html(text);\n\t\t\t\t\t\t\tif ((prevVal < num && prevVal >= 0) || (!prevVal && num > 0)) {\n\t\t\t\t\t\t\t\telement.parent().effect('pulsate', 1500);\n\t\t\t\t\t\t\t\tapp.playSound('MAILS');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (reloadSelect) {\n\t\t\t\t\tregisterUserList();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\twindow.stopScanMails = true;\n\t\t\t}\n\t\t})\n\t\t.fail(function () {\n\t\t\twindow.stopScanMails = true;\n\t\t});\n}\n\nfunction getUrlVars() {\n\tvar vars = {};\n\twindow.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (m, key, value) {\n\t\tvars[key] = value;\n\t});\n\treturn vars;\n}\n"],"names":["jQuery","$","data","window","stopScanMails","startCheckMails","length","registerUserList","selectUsers","select2","on","handleChangeUserEvent","App","Fields","Picklist","showSelect2ElementView","templateResult","state","id","text","element","$state","templateSelection","resultContainer","append","closeOnSelect","select2Instance","$dropdown","e","currentTarget","attr","trigger","$container","find","stopPropagation","module","action","user","val","AppConnector","request","params","done","location","href","getModuleName","timeCheckingMails","each","users","push","checkMails","setInterval","clearInterval","refreshIntervalId","response","success","error","result","inArray","is","num","reloadSelect","html","prevVal","parent","effect","app","playSound","fail","replace","m","key","value","vars"],"mappings":"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"}