{"version":3,"file":"RecordAddsTemplates.min.js","sources":["RecordAddsTemplates.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 4.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n$.Class(\n\t'Base_RecordAddsTemplates_JS',\n\t{},\n\t{\n\t\teditInstance: false,\n\t\t/**\n\t\t * Function listener to send a form\n\t\t * @param {jQuery} container\n\t\t */\n\t\tregisterSubmitForm: function (container) {\n\t\t\tconst aDeferred = $.Deferred();\n\t\t\tlet instanse = this;\n\t\t\tcontainer.on('click', '.js-modal__save', () => {\n\t\t\t\tlet params = {\n\t\t\t\t\taction: 'RecordAddsTemplates',\n\t\t\t\t\trecordAddsType: container.find('.js-modal-body').find(\"[name='recordAddsType']\").val()\n\t\t\t\t};\n\t\t\t\tlet validate = true;\n\t\t\t\tcontainer.find('form.js-record-template').each(function () {\n\t\t\t\t\tlet form = $(this);\n\t\t\t\t\tinstanse.editInstance.registerValidationsFields(form);\n\t\t\t\t\tlet formSerializeData = form.serializeFormData();\n\t\t\t\t\tparams[formSerializeData.module] = formSerializeData;\n\t\t\t\t\tif (!form.validationEngine('validate')) {\n\t\t\t\t\t\tvalidate = false;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (validate) {\n\t\t\t\t\tAppConnector.request(params)\n\t\t\t\t\t\t.done(function (data) {\n\t\t\t\t\t\t\tlet response = data.result;\n\t\t\t\t\t\t\tlet preSave = response.preSave;\n\t\t\t\t\t\t\tif (typeof preSave !== 'undefined' && preSave.length) {\n\t\t\t\t\t\t\t\tfor (let i = 0; i < preSave.length; i++) {\n\t\t\t\t\t\t\t\t\tif (preSave[i] !== null && preSave[i].result !== true) {\n\t\t\t\t\t\t\t\t\t\tapp.showNotify(preSave[i].message ? preSave[i].message : app.vtranslate('JS_ERROR'));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (response.success) {\n\t\t\t\t\t\t\t\t\tapp.hideModalWindow();\n\t\t\t\t\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\t\t\t\t\ttext: response.message ? response.message : app.vtranslate('JS_SAVE_NOTIFY_OK'),\n\t\t\t\t\t\t\t\t\t\ttype: 'success'\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tif (response.url) {\n\t\t\t\t\t\t\t\t\t\twindow.location.href = response.url;\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\twindow.location.reload();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\t\t\t\t\ttext: response.message ? response.message : app.vtranslate('JS_ERROR'),\n\t\t\t\t\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (response.length <= 0) {\n\t\t\t\t\t\t\t\taDeferred.resolve(true);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\taDeferred.resolve(false);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.fail((textStatus, errorThrown) => {\n\t\t\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\t\t\ttext: errorThrown,\n\t\t\t\t\t\t\t\ttype: textStatus\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tapp.errorLog(textStatus, errorThrown);\n\t\t\t\t\t\t\taDeferred.resolve(false);\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Register events function\n\t\t * @param {jQuery} modalContainer\n\t\t */\n\t\tregisterEvents: function (modalContainer) {\n\t\t\tthis.editInstance = Vtiger_Edit_Js.getInstance();\n\t\t\tthis.editInstance.registerBasicEvents(modalContainer);\n\t\t\tthis.registerSubmitForm(modalContainer);\n\t\t}\n\t}\n);\n"],"names":["$","Class","editInstance","registerSubmitForm","container","Deferred","instanse","on","action","recordAddsType","find","val","validate","each","registerValidationsFields","form","serializeFormData","params","formSerializeData","module","validationEngine","AppConnector","request","done","data","result","preSave","response","length","i","app","showNotify","message","vtranslate","success","hideModalWindow","text","type","url","window","location","href","reload","aDeferred","resolve","fail","textStatus","errorThrown","errorLog","registerEvents","modalContainer","Vtiger_Edit_Js","getInstance","registerBasicEvents"],"mappings":";;AAAA,kKACAA,EAAEC,KAAF,CACC,6BADD,CAEC,EAFD,CAGC,CACCC,eADD;;;KAMCC,mBAAoB,4BAAUC,SAAV,CAAqB,eACtBJ,EAAEK,QAAF,EADsB,CAEpCC,SAAW,IAFyB,CAGxCF,UAAUG,EAAV,CAAa,OAAb,CAAsB,iBAAtB,CAAyC,UAAM,YACjC,CACZC,OAAQ,qBADI,CAEZC,eAAgBL,UAAUM,IAAV,CAAe,gBAAf,EAAiCA,IAAjC,CAAsC,2BAAtC,EAAiEC,GAAjE,EAFJ,CADiC,CAK1CC,WAL0C,CAM9CR,UAAUM,IAAV,CAAe,yBAAf,EAA0CG,IAA1C,CAA+C,UAAY,CAC1D,SAAWb,EAAE,IAAF,CAAX,CACAM,SAASJ,YAAT,CAAsBY,yBAAtB,CAAgDC,IAAhD,CAF0D,CAG1D,sBAAwBA,KAAKC,iBAAL,EAAxB,CACAC,OAAOC,kBAAkBC,MAAzB,EAAmCD,iBAJuB,CAKrDH,KAAKK,gBAAL,CAAsB,UAAtB,CALqD,GAMzDR,WANyD,EAQ1D,CARD,CAN8C,CAe1CA,QAf0C,EAgB7CS,aAAaC,OAAb,CAAqBL,MAArB,EACEM,IADF,CACO,SAAUC,IAAV,CAAgB,cACNA,KAAKC,MADC,CAEjBC,QAAUC,SAASD,OAFF,CAGrB,GAAuB,WAAnB,gBAAA,EAAkCA,QAAQE,MAA9C,CACC,IAAK,MAAQ,CAAb,CAAgBC,EAAIH,QAAQE,MAA5B,CAAoCC,GAApC,CACoB,IAAf,WAAQA,CAAR,GAAuB,aAAQA,CAAR,EAAWJ,MADvC,EAEEK,IAAIC,UAAJ,CAAeL,QAAQG,CAAR,EAAWG,OAAX,CAAqBN,QAAQG,CAAR,EAAWG,OAAhC,CAA0CF,IAAIG,UAAJ,CAAe,UAAf,CAAzD,CAFF,CADD,cAOcC,OAPd,EAQEJ,IAAIK,eAAJ,EARF,CASEL,IAAIC,UAAJ,CAAe,CACdK,KAAMT,SAASK,OAAT,CAAmBL,SAASK,OAA5B,CAAsCF,IAAIG,UAAJ,CAAe,mBAAf,CAD9B,CAEdI,KAAM,SAFQ,CAAf,CATF,CAaMV,SAASW,GAbf,CAcGC,OAAOC,QAAP,CAAgBC,IAAhB,CAAuBd,SAASW,GAdnC,CAgBGC,OAAOC,QAAP,CAAgBE,MAAhB,EAhBH,EAmBEZ,IAAIC,UAAJ,CAAe,CACdK,KAAMT,SAASK,OAAT,CAAmBL,SAASK,OAA5B,CAAsCF,IAAIG,UAAJ,CAAe,UAAf,CAD9B,CAEdI,KAAM,OAFQ,CAAf,CAnBF,CAyBuB,CAAnB,WAAST,MA5BQ,CA6BpBe,UAAUC,OAAV,IA7BoB,CA+BpBD,UAAUC,OAAV,KAED,CAlCF,EAmCEC,IAnCF,CAmCO,SAACC,UAAD,CAAaC,WAAb,CAA6B,CAClCjB,IAAIC,UAAJ,CAAe,CACdK,KAAMW,WADQ,CAEdV,KAAMS,UAFQ,CAAf,CADkC,CAKlChB,IAAIkB,QAAJ,CAAaF,UAAb,CAAyBC,WAAzB,CALkC,CAMlCJ,UAAUC,OAAV,KACA,CA1CF,EA4CD,CA5DD,EA6DA,CAtEF;;;KA4ECK,eAAgB,wBAAUC,cAAV,CAA0B,CACzC,KAAKhD,YAAL,CAAoBiD,eAAeC,WAAf,EADqB,CAEzC,KAAKlD,YAAL,CAAkBmD,mBAAlB,CAAsCH,cAAtC,CAFyC,CAGzC,KAAK/C,kBAAL,CAAwB+C,cAAxB,EACA,CAhFF,CAHD"}