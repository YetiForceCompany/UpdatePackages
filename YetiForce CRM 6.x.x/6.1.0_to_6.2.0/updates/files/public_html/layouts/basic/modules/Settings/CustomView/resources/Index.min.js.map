{"version":3,"file":"Index.min.js","sources":["Index.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 4.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\njQuery.Class(\n\t'Settings_CustomView_Index_Js',\n\t{},\n\t{\n\t\tcontainer: false,\n\t\tcontents: false,\n\t\t/**\n\t\t * Register events\n\t\t * @param {jQuery} container\n\t\t */\n\t\tinitEvents: function (container) {\n\t\t\tcontainer.on('click', '.js-delete-filter', (e) => {\n\t\t\t\tthis.deleteFilter(e);\n\t\t\t});\n\t\t\tcontainer.on('change', '.js-update-field', (e) => {\n\t\t\t\tthis.updateField(e);\n\t\t\t});\n\t\t\tcontainer.on('click', '.js-update,.js-create-filter', (e) => {\n\t\t\t\tthis.update(e);\n\t\t\t});\n\t\t\tcontainer.on('change', '.js-module-filter', (e) => {\n\t\t\t\tthis.registerFilterChange(e);\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Load form to edit filter\n\t\t * @param {jQuery.Event} e\n\t\t */\n\t\tupdate: function (e) {\n\t\t\tvar target = $(e.currentTarget);\n\t\t\tvar editUrl = target.data('editurl');\n\t\t\tnew CustomView(editUrl);\n\t\t},\n\t\t/**\n\t\t * Update parameter\n\t\t * @param {jQuery.Event} e\n\t\t */\n\t\tupdateField: function (e) {\n\t\t\tconst thisInstance = this,\n\t\t\t\ttarget = $(e.currentTarget),\n\t\t\t\tclosestTrElement = target.closest('.js-filter-row');\n\t\t\t$.progressIndicator({\n\t\t\t\tmessage: app.vtranslate('JS_SAVE_LOADER_INFO'),\n\t\t\t\tblockInfo: {\n\t\t\t\t\tenabled: true\n\t\t\t\t}\n\t\t\t});\n\t\t\tconst params = {\n\t\t\t\tcvid: closestTrElement.data('cvid'),\n\t\t\t\tmod: closestTrElement.data('mod'),\n\t\t\t\tname: target.attr('name'),\n\t\t\t\tvalue: target.val()\n\t\t\t};\n\t\t\tapp.saveAjax('updateField', {}, params).done(function (data) {\n\t\t\t\tthisInstance.getContainer().find('.js-module-filter').trigger('change');\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Delete filter\n\t\t * @param {jQuery.Event} e\n\t\t */\n\t\tdeleteFilter: function (e) {\n\t\t\tvar thisInstance = this;\n\t\t\tvar target = $(e.currentTarget);\n\t\t\tvar closestTrElement = target.closest('.js-filter-row');\n\t\t\t$.progressIndicator({\n\t\t\t\tmessage: app.vtranslate('JS_SAVE_LOADER_INFO'),\n\t\t\t\tblockInfo: {\n\t\t\t\t\tenabled: true\n\t\t\t\t}\n\t\t\t});\n\t\t\tapp\n\t\t\t\t.saveAjax(\n\t\t\t\t\t'delete',\n\t\t\t\t\t{},\n\t\t\t\t\t{\n\t\t\t\t\t\tcvid: closestTrElement.data('cvid')\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t\t.done(function () {\n\t\t\t\t\tthisInstance.getContainer().find('.js-module-filter').trigger('change');\n\t\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Function to regiser the event to make the filters sortable\n\t\t */\n\t\tmakeFilterListSortable: function (container) {\n\t\t\tvar thisInstance = this;\n\t\t\tvar tbody = container.find('tbody');\n\n\t\t\tif (tbody.children().length > 1) {\n\t\t\t\ttbody.each(function () {\n\t\t\t\t\tjQuery(this).sortable({\n\t\t\t\t\t\tcontainment: 'tbody',\n\t\t\t\t\t\trevert: true,\n\t\t\t\t\t\ttolerance: 'pointer',\n\t\t\t\t\t\tcursor: 'move',\n\t\t\t\t\t\thelper: function (e, ui) {\n\t\t\t\t\t\t\t//while dragging helper elements td element will take width as contents width\n\t\t\t\t\t\t\t//so we are explicitly saying that it has to be same width so that element will not\n\t\t\t\t\t\t\t//look like disturbed\n\t\t\t\t\t\t\tui.children().each(function (index, element) {\n\t\t\t\t\t\t\t\telement = jQuery(element);\n\t\t\t\t\t\t\t\telement.width(element.width());\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\treturn ui;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tupdate: function (e, ui) {\n\t\t\t\t\t\t\tthisInstance.updateSequence();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Update sequences\n\t\t */\n\t\tupdateSequence: function () {\n\t\t\tvar sequences = [];\n\t\t\tthis.getContents()\n\t\t\t\t.find('.js-filter-row')\n\t\t\t\t.each(function (n, row) {\n\t\t\t\t\tvar cvId = $(row).data('cvid');\n\t\t\t\t\tsequences.push(cvId);\n\t\t\t\t});\n\t\t\tapp.saveAjax('upadteSequences', sequences).done(function (data) {\n\t\t\t\tif (data.success) {\n\t\t\t\t\tapp.showNotify({ text: data.result.message, type: 'success' });\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Load list of filter for module\n\t\t * @param {jQuery.Event} e\n\t\t */\n\t\tregisterFilterChange: function (e) {\n\t\t\tvar thisInstance = this;\n\t\t\tvar aDeferred = $.Deferred();\n\t\t\tvar progress = $.progressIndicator({\n\t\t\t\tmessage: app.vtranslate('JS_LOADING_PLEASE_WAIT'),\n\t\t\t\tblockInfo: {\n\t\t\t\t\tenabled: true\n\t\t\t\t}\n\t\t\t});\n\t\t\tvar params = {\n\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\tview: app.getViewName(),\n\t\t\t\tparent: app.getParentModuleName(),\n\t\t\t\tsourceModule: $(e.currentTarget).val()\n\t\t\t};\n\t\t\tAppConnector.requestPjax(params)\n\t\t\t\t.done(function (data) {\n\t\t\t\t\tvar contents = thisInstance.getContents().html(data);\n\t\t\t\t\tthisInstance.makeFilterListSortable(contents);\n\t\t\t\t\tthisInstance\n\t\t\t\t\t\t.getContainer()\n\t\t\t\t\t\t.find('.js-create-filter')\n\t\t\t\t\t\t.data('editurl', contents.find('#js-add-filter-url').val());\n\t\t\t\t\tprogress.progressIndicator({ mode: 'hide' });\n\t\t\t\t\taDeferred.resolve(data);\n\t\t\t\t})\n\t\t\t\t.fail(function (error) {\n\t\t\t\t\taDeferred.reject();\n\t\t\t\t});\n\t\t\treturn aDeferred.promise();\n\t\t},\n\t\tgetContainer: function () {\n\t\t\tif (this.container == false) {\n\t\t\t\tthis.container = jQuery('div.contentsDiv');\n\t\t\t}\n\t\t\treturn this.container;\n\t\t},\n\t\tgetContents: function () {\n\t\t\tif (this.contents == false) {\n\t\t\t\tthis.contents = this.getContainer().find('.indexContents');\n\t\t\t}\n\t\t\treturn this.contents;\n\t\t},\n\t\t/**\n\t\t * Main function\n\t\t */\n\t\tregisterEvents: function () {\n\t\t\tvar container = this.getContainer();\n\t\t\tthis.initEvents(container);\n\t\t\tthis.makeFilterListSortable(container);\n\t\t}\n\t}\n);\n"],"names":["jQuery","Class","container","contents","initEvents","on","e","deleteFilter","updateField","update","registerFilterChange","$","currentTarget","editUrl","target","data","closestTrElement","closest","progressIndicator","message","app","vtranslate","blockInfo","enabled","cvid","mod","name","attr","value","val","saveAjax","params","done","thisInstance","getContainer","find","trigger","makeFilterListSortable","tbody","children","length","each","sortable","containment","revert","tolerance","cursor","helper","ui","index","element","width","updateSequence","getContents","n","row","sequences","push","cvId","success","showNotify","text","result","type","aDeferred","Deferred","progress","module","getModuleName","view","getViewName","parent","getParentModuleName","sourceModule","requestPjax","html","mode","resolve","fail","reject","promise","registerEvents"],"mappings":"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"}