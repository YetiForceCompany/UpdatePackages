{"version":3,"file":"StocktakingModal.min.js","sources":["StocktakingModal.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 4.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\nwindow.Products_StocktakingModal_JS = class {\n\t/**\n\t * Show step by name.\n\t * @param {string} name\n\t */\n\tshowStep(name) {\n\t\tthis.container.find('.js-step').addClass('d-none');\n\t\tthis.container.find(`.js-step[data-step=\"${name}\"]`).removeClass('d-none');\n\t}\n\t/**\n\t * Register analyze file events.\n\t */\n\tregisterAnalyzeFile() {\n\t\tlet form = this.container.find('form');\n\t\tform.validationEngine(app.validationEngineOptions);\n\t\tthis.container.find('.js-send-file').on('click', () => {\n\t\t\tif (!form.validationEngine('validate')) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet formData = new FormData(form[0]);\n\t\t\tformData.append('module', 'Products');\n\t\t\tformData.append('action', 'StocktakingModal');\n\t\t\tformData.append('mode', 'analyzeFile');\n\t\t\tlet progress = $.progressIndicator({ position: 'html', blockInfo: { enabled: true } });\n\t\t\tAppConnector.request({\n\t\t\t\turl: 'index.php',\n\t\t\t\ttype: 'POST',\n\t\t\t\tdata: formData,\n\t\t\t\tprocessData: false,\n\t\t\t\tcontentType: false\n\t\t\t})\n\t\t\t\t.done((response) => {\n\t\t\t\t\tthis.showStep('selectColumn');\n\t\t\t\t\tthis.container.find('.js-encoding').val(response.result.encoding);\n\t\t\t\t\tthis.container.find('.js-count').val(response.result.count);\n\t\t\t\t\tthis.container.find('.js-randomKey').val(response.result.randomKey);\n\t\t\t\t\tlet eanField = this.container.find('#skuColumnSeq');\n\t\t\t\t\tlet qtyField = this.container.find('#qtyColumnSeq');\n\t\t\t\t\t$.each(response.result.column, function (index, value) {\n\t\t\t\t\t\teanField.append(`<option value=\"${index}\">${value}</option>`);\n\t\t\t\t\t\tqtyField.append(`<option value=\"${index}\">${value}</option>`);\n\t\t\t\t\t});\n\t\t\t\t\tqtyField.val(1);\n\t\t\t\t\tApp.Fields.Picklist.showSelect2ElementView(qtyField);\n\t\t\t\t\tApp.Fields.Picklist.showSelect2ElementView(eanField);\n\t\t\t\t\tprogress.progressIndicator({ mode: 'hide' });\n\t\t\t\t})\n\t\t\t\t.fail((error, title) => {\n\t\t\t\t\tprogress.progressIndicator({ mode: 'hide' });\n\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\ttitle: title,\n\t\t\t\t\t\ttext: error,\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t});\n\t}\n\t/**\n\t * Register compare stock levels.\n\t */\n\tregisterCompare() {\n\t\tlet form = this.container.find('form');\n\t\tthis.container.find('.js-compare').on('click', () => {\n\t\t\tlet formData = form.serializeFormData();\n\t\t\tformData['module'] = 'Products';\n\t\t\tformData['action'] = 'StocktakingModal';\n\t\t\tformData['mode'] = 'compare';\n\t\t\tlet progress = $.progressIndicator({ position: 'html', blockInfo: { enabled: true } });\n\t\t\tAppConnector.request(formData)\n\t\t\t\t.done((response) => {\n\t\t\t\t\tthis.showStep('showCompare');\n\t\t\t\t\tthis.container.find('.js-entries-update').val(response.result.update);\n\t\t\t\t\tthis.container.find('.js-entries-no-update').val(response.result.same);\n\t\t\t\t\tthis.container.find('.js-entries-not-found').val(response.result.counterNotFound);\n\t\t\t\t\tthis.container.find('.js-list-entries-not-found').val(response.result.notFound);\n\t\t\t\t\tthis.toUpdate = response.result.toUpdate;\n\t\t\t\t\tif (response.result.update === 0) {\n\t\t\t\t\t\tthis.container.find('.js-import').addClass('d-none');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (formData['storage'] != 0) {\n\t\t\t\t\t\t\tthis.container.find('.js-record-name').removeClass('d-none');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tprogress.progressIndicator({ mode: 'hide' });\n\t\t\t\t})\n\t\t\t\t.fail((error, title) => {\n\t\t\t\t\tprogress.progressIndicator({ mode: 'hide' });\n\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\ttitle: title,\n\t\t\t\t\t\ttext: error,\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t});\n\t}\n\t/**\n\t * Register importing stock differences.\n\t */\n\tregisterImport() {\n\t\tlet form = this.container.find('form');\n\t\tthis.container.find('.js-import').on('click', () => {\n\t\t\tlet formData = form.serializeFormData();\n\t\t\tif (formData['storage'] != 0 && !form.validationEngine('validate')) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tformData['module'] = 'Products';\n\t\t\tformData['action'] = 'StocktakingModal';\n\t\t\tformData['mode'] = 'import';\n\t\t\tformData['records'] = this.toUpdate;\n\t\t\tlet progress = $.progressIndicator({ position: 'html', blockInfo: { enabled: true } });\n\t\t\tAppConnector.request(formData)\n\t\t\t\t.done((response) => {\n\t\t\t\t\tthis.showStep('showSummary');\n\t\t\t\t\tif (response.result.product) {\n\t\t\t\t\t\tthis.container.find('.js-imported').removeClass('d-none');\n\t\t\t\t\t\tthis.container.find('.js-imported-counter').val(response.result.product);\n\t\t\t\t\t}\n\t\t\t\t\tif (response.result.igin) {\n\t\t\t\t\t\tthis.container\n\t\t\t\t\t\t\t.find('.js-btn-igin')\n\t\t\t\t\t\t\t.removeClass('d-none')\n\t\t\t\t\t\t\t.attr('href', 'index.php?module=IGIN&view=Detail&record=' + response.result.igin);\n\t\t\t\t\t}\n\t\t\t\t\tif (response.result.iidn) {\n\t\t\t\t\t\tthis.container\n\t\t\t\t\t\t\t.find('.js-btn-iidn')\n\t\t\t\t\t\t\t.removeClass('d-none')\n\t\t\t\t\t\t\t.attr('href', 'index.php?module=IIDN&view=Detail&record=' + response.result.iidn);\n\t\t\t\t\t}\n\t\t\t\t\tif (response.result.igin || response.result.iidn) {\n\t\t\t\t\t\tthis.container.find('.js-alert').removeClass('d-none');\n\t\t\t\t\t}\n\t\t\t\t\tprogress.progressIndicator({ mode: 'hide' });\n\t\t\t\t})\n\t\t\t\t.fail((error, title) => {\n\t\t\t\t\tprogress.progressIndicator({ mode: 'hide' });\n\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\ttitle: title,\n\t\t\t\t\t\ttext: error,\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t});\n\t}\n\t/**\n\t * Register modal events.\n\t * @param {jQuery} modalContainer\n\t */\n\tregisterEvents(modalContainer) {\n\t\tthis.container = modalContainer;\n\t\tthis.registerAnalyzeFile();\n\t\tthis.registerCompare();\n\t\tthis.registerImport();\n\t}\n};\n"],"names":["window","Products_StocktakingModal_JS","name","container","find","addClass","removeClass","form","validationEngine","app","validationEngineOptions","on","formData","FormData","append","progress","$","progressIndicator","position","blockInfo","enabled","AppConnector","request","url","type","data","processData","contentType","done","response","showStep","val","result","encoding","count","randomKey","eanField","qtyField","each","column","index","value","App","Fields","Picklist","showSelect2ElementView","mode","fail","error","title","showNotify","text","serializeFormData","update","same","counterNotFound","notFound","toUpdate","product","igin","attr","iidn","modalContainer","registerAnalyzeFile","registerCompare","registerImport"],"mappings":"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"}