{"version":3,"file":"Detail.min.js","sources":["Detail.js"],"sourcesContent":["/*+***********************************************************************************\n * The contents of this file are subject to the vtiger CRM Public License Version 1.0\n * (\"License\"); You may not use this file except in compliance with the License\n * The Original Code is:  vtiger CRM Open Source\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n *************************************************************************************/\n'use strict';\n\nVtiger_Detail_Js(\n\t'Contacts_Detail_Js',\n\t{},\n\t{\n\t\thierarchyResponseCache: {},\n\t\t/**\n\t\t * Function to register recordpresave event\n\t\t */\n\t\tregisterRecordPreSaveEvent: function (form) {\n\t\t\tvar primaryEmailField = jQuery('[name=\"email\"]');\n\t\t\tif (typeof form === 'undefined') {\n\t\t\t\tform = this.getForm();\n\t\t\t}\n\n\t\t\tform.on(this.fieldPreSave, '[name=\"portal\"]', function (e, data) {\n\t\t\t\tvar portalField = jQuery(e.currentTarget);\n\n\t\t\t\tvar primaryEmailValue = primaryEmailField.val();\n\t\t\t\tvar isAlertAlreadyShown = jQuery('.ui-pnotify').length;\n\n\t\t\t\tif (portalField.is(':checked')) {\n\t\t\t\t\tif (primaryEmailField.length == 0) {\n\t\t\t\t\t\tif (isAlertAlreadyShown <= 0) {\n\t\t\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\t\t\ttext: app.vtranslate('JS_PRIMARY_EMAIL_FIELD_DOES_NOT_EXISTS'),\n\t\t\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t}\n\t\t\t\t\tif (primaryEmailValue == '') {\n\t\t\t\t\t\tif (isAlertAlreadyShown <= 0) {\n\t\t\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\t\t\ttext: app.vtranslate('JS_PLEASE_ENTER_PRIMARY_EMAIL_VALUE_TO_ENABLE_PORTAL_USER'),\n\t\t\t\t\t\t\t\ttype: 'info'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Function to get response from hierarchy\n\t\t * @param {array} params\n\t\t * @returns {*|jQuery}\n\t\t */\n\t\tgetHierarchyResponseData: function (params) {\n\t\t\tlet thisInstance = this,\n\t\t\t\taDeferred = jQuery.Deferred();\n\n\t\t\tif (!$.isEmptyObject(thisInstance.hierarchyResponseCache)) {\n\t\t\t\taDeferred.resolve(thisInstance.hierarchyResponseCache);\n\t\t\t} else {\n\t\t\t\tAppConnector.request(params).then(function (data) {\n\t\t\t\t\tthisInstance.hierarchyResponseCache = data;\n\t\t\t\t\taDeferred.resolve(thisInstance.hierarchyResponseCache);\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn aDeferred.promise();\n\t\t},\n\t\t/**\n\t\t * function to display the hierarchy response data\n\t\t * @param {array} data\n\t\t */\n\t\tdisplayHierarchyResponseData: function (data) {\n\t\t\tlet callbackFunction = function () {\n\t\t\t\tapp.showScrollBar($('#hierarchyScroll'), {\n\t\t\t\t\theight: '300px',\n\t\t\t\t\trailVisible: true,\n\t\t\t\t\tsize: '6px'\n\t\t\t\t});\n\t\t\t};\n\t\t\tapp.showModalWindow(data, function (modalContainer) {\n\t\t\t\tApp.Components.Scrollbar.xy($('#hierarchyScroll', modalContainer));\n\t\t\t\tif (typeof callbackFunction == 'function' && $('#hierarchyScroll', modalContainer).height() > 300) {\n\t\t\t\t\tcallbackFunction();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Registers read count of hierarchy if it is possoble\n\t\t */\n\t\tregisterHierarchyRecordCount: function () {\n\t\t\tlet hierarchyButton = $('.js-detail-hierarchy'),\n\t\t\t\tparams = {\n\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\taction: 'RelationAjax',\n\t\t\t\t\trecord: app.getRecordId(),\n\t\t\t\t\tmode: 'getHierarchyCount'\n\t\t\t\t};\n\t\t\tif (hierarchyButton.length) {\n\t\t\t\tAppConnector.request(params).then(function (response) {\n\t\t\t\t\tif (response.success) {\n\t\t\t\t\t\t$('.hierarchy .badge').html(response.result);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Shows hierarchy\n\t\t */\n\t\tregisterShowHierarchy: function () {\n\t\t\tlet thisInstance = this,\n\t\t\t\thierarchyButton = $('.detailViewTitle'),\n\t\t\t\tparams = {\n\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\tview: 'Hierarchy',\n\t\t\t\t\trecord: app.getRecordId()\n\t\t\t\t};\n\t\t\thierarchyButton.on('click', '.js-detail-hierarchy', function () {\n\t\t\t\tlet progressIndicatorElement = $.progressIndicator({\n\t\t\t\t\tposition: 'html',\n\t\t\t\t\tblockInfo: {\n\t\t\t\t\t\tenabled: true\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthisInstance.getHierarchyResponseData(params).then(function (data) {\n\t\t\t\t\tthisInstance.displayHierarchyResponseData(data);\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Function which will register all the events\n\t\t */\n\t\tregisterEvents: function () {\n\t\t\tvar form = this.getForm();\n\t\t\tthis._super();\n\t\t\tthis.registerHierarchyRecordCount();\n\t\t\tthis.registerShowHierarchy();\n\t\t\tthis.registerRecordPreSaveEvent(form);\n\t\t}\n\t}\n);\n"],"names":["Vtiger_Detail_Js","hierarchyResponseCache","registerRecordPreSaveEvent","form","primaryEmailField","jQuery","getForm","on","fieldPreSave","e","portalField","currentTarget","primaryEmailValue","val","isAlertAlreadyShown","length","is","app","showNotify","text","vtranslate","type","preventDefault","getHierarchyResponseData","params","thisInstance","aDeferred","Deferred","$","isEmptyObject","AppConnector","request","then","data","resolve","promise","displayHierarchyResponseData","callbackFunction","showScrollBar","height","railVisible","size","showModalWindow","modalContainer","App","Components","Scrollbar","xy","registerHierarchyRecordCount","hierarchyButton","module","getModuleName","action","record","getRecordId","mode","response","success","html","result","registerShowHierarchy","view","progressIndicatorElement","progressIndicator","position","blockInfo","enabled","registerEvents","_super"],"mappings":"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"}