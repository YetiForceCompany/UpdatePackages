{"version":3,"file":"checkmails.min.js","sources":["checkmails.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 4.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\njQuery(function () {\n\tif ($('.js-header__btn--mail').data('numberunreademails') != undefined) {\n\t\twindow.stopScanMails = false;\n\t\tif (getUrlVars()['view'] != 'Popup') {\n\t\t\tstartCheckMails();\n\t\t}\n\t}\n\tif ($('.js-header__btn--mail select').length > 0) {\n\t\tregisterUserList();\n\t}\n});\n\nfunction registerUserList() {\n\tvar selectUsers = $('.js-header__btn--mail select');\n\tif (selectUsers.data('select2')) {\n\t\tselectUsers.select2('destroy');\n\t} else {\n\t\tselectUsers.on('change', handleChangeUserEvent);\n\t}\n\tApp.Fields.Picklist.showSelect2ElementView(selectUsers, {\n\t\ttemplateResult: function (state) {\n\t\t\tif (!state.id) {\n\t\t\t\treturn state.text;\n\t\t\t}\n\t\t\tvar element = jQuery(state.element);\n\t\t\tvar text = element.data('nomail') ? ' (' + element.data('nomail') + ')' : '';\n\t\t\tvar $state = $('<span>' + state.text + '<span class\"text-left\"><span>' + text + '</span>');\n\t\t\treturn $state;\n\t\t},\n\t\ttemplateSelection: function (data) {\n\t\t\tvar element = jQuery(data.element);\n\t\t\tvar text = element.data('nomail') ? ' (' + element.data('nomail') + ')' : '';\n\t\t\tvar resultContainer = jQuery('<span></span>');\n\t\t\tresultContainer.append(data.text + text);\n\t\t\treturn resultContainer;\n\t\t},\n\t\tcloseOnSelect: true\n\t});\n\tvar select2Instance = selectUsers.data('select2');\n\tselect2Instance.$dropdown.on('mouseup', 'li', function (e) {\n\t\tif (jQuery(e.currentTarget).attr('aria-selected') == 'true') {\n\t\t\tselectUsers.trigger('change');\n\t\t}\n\t});\n\tselect2Instance.$container.find('.select2-selection__rendered').on('mousedown', function (e) {\n\t\te.stopPropagation();\n\t\tselectUsers.trigger('change');\n\t});\n\t$('.js-mail-list').on('click', '.js-mail-link', handleChangeUserEvent);\n}\n\nfunction handleChangeUserEvent() {\n\tvar params = {\n\t\tmodule: 'OSSMail',\n\t\taction: 'SetUser',\n\t\tuser: $(this).val()\n\t};\n\tAppConnector.request(params).done(function (response) {\n\t\tif (app.getModuleName() == 'OSSMail') {\n\t\t\twindow.location.href = window.location.href;\n\t\t} else {\n\t\t\twindow.location.href = 'index.php?module=OSSMail&view=Index';\n\t\t}\n\t});\n}\n\nfunction startCheckMails() {\n\tvar users = [];\n\tvar timeCheckingMails = $('.js-header__btn--mail').data('interval');\n\t$('.js-header__btn--mail .noMails').each(function (index) {\n\t\tusers.push($(this).data('id'));\n\t});\n\tif (users.length > 0) {\n\t\tcheckMails(users);\n\t\tvar refreshIntervalId = setInterval(function () {\n\t\t\tif (window.stopScanMails == false) {\n\t\t\t\tcheckMails(users);\n\t\t\t} else {\n\t\t\t\tclearInterval(refreshIntervalId);\n\t\t\t}\n\t\t}, timeCheckingMails * 1000);\n\t}\n}\n\nfunction checkMails(users) {\n\tvar params = {\n\t\tmodule: 'OSSMail',\n\t\taction: 'CheckMails',\n\t\tusers: users\n\t};\n\tvar reloadSelect = false;\n\tAppConnector.request(params)\n\t\t.done(function (response) {\n\t\t\tif (response.success && response.success.error != true && response.result.error != true) {\n\t\t\t\tvar result = response.result;\n\t\t\t\t$('.js-header__btn--mail .noMails').each(function (index) {\n\t\t\t\t\tvar element = jQuery(this);\n\t\t\t\t\tvar id = element.data('id');\n\t\t\t\t\tif (jQuery.inArray(id, result)) {\n\t\t\t\t\t\tvar num = result[id];\n\t\t\t\t\t\tif (element.is('option')) {\n\t\t\t\t\t\t\telement.data('nomail', num);\n\t\t\t\t\t\t\treloadSelect = true;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tlet prevVal = element.data('nomail');\n\t\t\t\t\t\t\telement.data('nomail', num);\n\t\t\t\t\t\t\tvar text = '';\n\t\t\t\t\t\t\tif (num > 0) {\n\t\t\t\t\t\t\t\ttext = ' <span class=\"badge badge-danger mr-1\">' + num + '</span>';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telement.html(text);\n\t\t\t\t\t\t\tif ((prevVal < num && prevVal >= 0) || (!prevVal && num > 0)) {\n\t\t\t\t\t\t\t\telement.parent().effect('pulsate', 1500);\n\t\t\t\t\t\t\t\tapp.playSound('MAILS');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (reloadSelect) {\n\t\t\t\t\tregisterUserList();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\twindow.stopScanMails = true;\n\t\t\t}\n\t\t})\n\t\t.fail(function () {\n\t\t\twindow.stopScanMails = true;\n\t\t});\n}\n\nfunction getUrlVars() {\n\tvar vars = {};\n\twindow.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (m, key, value) {\n\t\tvars[key] = value;\n\t});\n\treturn vars;\n}\n"],"names":["jQuery","$","data","window","stopScanMails","getUrlVars","startCheckMails","length","registerUserList","selectUsers","select2","on","handleChangeUserEvent","App","Fields","Picklist","showSelect2ElementView","templateResult","state","id","text","element","$state","templateSelection","resultContainer","append","closeOnSelect","select2Instance","$dropdown","e","currentTarget","attr","trigger","$container","find","stopPropagation","params","module","action","user","val","AppConnector","request","done","location","href","app","getModuleName","users","timeCheckingMails","each","push","checkMails","refreshIntervalId","setInterval","clearInterval","reloadSelect","response","success","error","result","inArray","num","is","prevVal","html","parent","effect","playSound","fail","vars","replace","m","key","value"],"mappings":"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"}