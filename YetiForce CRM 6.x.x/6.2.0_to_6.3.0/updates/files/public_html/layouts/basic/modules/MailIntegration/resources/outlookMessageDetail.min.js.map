{"version":3,"file":"outlookMessageDetail.min.js","sources":["outlookMessageDetail.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 4.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\nwindow.MailIntegration_Start = {\n\tiframe: {},\n\t/**\n\t * Set iframe element.\n\t */\n\tsetIframe() {\n\t\tthis.iframe = $('#js-iframe');\n\t},\n\t/**\n\t * Show detail view.\n\t *\n\t * @param   {object}  mailItem  Office mailbox.item\n\t */\n\tshowDetailView(mailItem) {\n\t\tAppConnector.request(\n\t\t\t$.extend(\n\t\t\t\t{\n\t\t\t\t\tmodule: 'MailIntegration',\n\t\t\t\t\tview: 'Iframe',\n\t\t\t\t\tmailFrom: mailItem.from.emailAddress,\n\t\t\t\t\tmailSender: mailItem.sender.emailAddress,\n\t\t\t\t\tmailSubject: mailItem.subject,\n\t\t\t\t\tmailNormalizedSubject: mailItem.normalizedSubject,\n\t\t\t\t\tmailMessageId: mailItem.internetMessageId,\n\t\t\t\t\tmailDateTimeCreated: mailItem.dateTimeCreated.toISOString()\n\t\t\t\t},\n\t\t\t\twindow.PanelParams\n\t\t\t)\n\t\t)\n\t\t\t.done((responseData) => {\n\t\t\t\t$('#page').html(responseData);\n\t\t\t\tthis.registerLogoutEvents();\n\t\t\t})\n\t\t\t.fail((_) => {\n\t\t\t\tOffice.context.mailbox.item.notificationMessages.replaceAsync('error', {\n\t\t\t\t\ttype: 'errorMessage',\n\t\t\t\t\tmessage: app.vtranslate('JS_ERROR')\n\t\t\t\t});\n\t\t\t});\n\t},\n\t/**\n\t * Register logout events\n\t */\n\tregisterLogoutEvents() {\n\t\tthis.setIframe();\n\t\tlet reloadPanelAfterLogout = () => {\n\t\t\tif (!this.isUserLoggedIn()) {\n\t\t\t\twindow.location.reload();\n\t\t\t}\n\t\t};\n\t\tthis.iframe.on('load', reloadPanelAfterLogout);\n\t},\n\t/**\n\t * Register login events.\n\t */\n\tregisterLoginEvents() {\n\t\tlet loader;\n\t\tlet reloadPanelAfterLogin = () => {\n\t\t\tif (this.isUserLoggedIn()) {\n\t\t\t\twindow.location.reload();\n\t\t\t} else {\n\t\t\t\tloader.progressIndicator({ mode: 'hide' });\n\t\t\t}\n\t\t};\n\t\tlet showLoader = () => {\n\t\t\tloader = $.progressIndicator({\n\t\t\t\tblockInfo: { enabled: true },\n\t\t\t\tmessage: false,\n\t\t\t\tblockOverlayCSS: {\n\t\t\t\t\t'background-color': 'white',\n\t\t\t\t\topacity: 1\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\t\tthis.iframe.on('load', reloadPanelAfterLogin);\n\t\t$(this.iframe[0].contentWindow).on('unload', showLoader);\n\t\tlet src = this.iframe[0].getAttribute('src-a');\n\t\tif (src && this.iframe[0].getAttribute('src') == undefined) {\n\t\t\tthis.iframe[0].removeAttribute('src-a');\n\t\t\tthis.iframe[0].setAttribute('src', src);\n\t\t}\n\t},\n\t/**\n\t * Is user logged in.\n\t *\n\t * @return  {boolean}\n\t */\n\tisUserLoggedIn() {\n\t\treturn !(\n\t\t\tthis.iframe[0].contentWindow.document.body.dataset.module == 'Users' &&\n\t\t\tthis.iframe[0].contentWindow.document.body.dataset.view == 'Login'\n\t\t);\n\t},\n\tshowConsole() {\n\t\tlet s = '';\n\t\tlet x = '';\n\t\tfor (var p in navigator) {\n\t\t\ts += p + ' : ' + navigator[p] + '<br>';\n\t\t\tx += p + ' : ' + navigator[p] + '\\n';\n\t\t}\n\t\tconsole.log(x);\n\t\tdocument.body.innerHTML +=\n\t\t\t'<div style=\"position:absolute;width:100%;height:100%;z-index:100;background:#fff;left: 0px; top: 50%;overflow-y: auto;\">' +\n\t\t\ts +\n\t\t\t'</div>';\n\t},\n\t/**\n\t * Register events.\n\t *\n\t * @param   {object}  mailbox  Office mailbox\n\t */\n\tregisterEvents(mailbox) {\n\t\t//this.showConsole();\n\t\tif (!$('.js-exception-error').length) {\n\t\t\tthis.setIframe();\n\t\t\tif (this.iframe.data('view') === 'login') {\n\t\t\t\tthis.registerLoginEvents();\n\t\t\t} else {\n\t\t\t\tthis.showDetailView(mailbox.item);\n\t\t\t}\n\t\t}\n\t},\n\treloadView(data) {\n\t\twindow.MailIntegration_Start.showDetailView(Office.context.mailbox.item);\n\t}\n};\nif (typeof Office === 'undefined') {\n\tapp.showNotify({\n\t\ttitle: app.vtranslate('JS_ERROR'),\n\t\ttype: 'error'\n\t});\n} else {\n\tOffice.onReady((info) => {\n\t\twindow.PanelParams = {\n\t\t\tsource: 'Outlook',\n\t\t\tdevice: Office.context.mailbox.diagnostics.hostName\n\t\t};\n\t\tif (info.host === Office.HostType.Outlook) {\n\t\t\twindow.MailIntegration_Start.registerEvents(Office.context.mailbox);\n\t\t\tOffice.context.mailbox.addHandlerAsync(Office.EventType.ItemChanged, window.MailIntegration_Start.reloadView);\n\t\t}\n\t});\n}\n"],"names":["window","MailIntegration_Start","iframe","setIframe","$","showDetailView","mailItem","AppConnector","request","extend","module","view","mailFrom","from","emailAddress","mailSender","sender","mailSubject","subject","mailNormalizedSubject","normalizedSubject","mailMessageId","internetMessageId","mailDateTimeCreated","dateTimeCreated","toISOString","PanelParams","done","responseData","html","registerLogoutEvents","fail","Office","context","mailbox","item","notificationMessages","replaceAsync","type","message","app","vtranslate","on","reloadPanelAfterLogout","isUserLoggedIn","location","reload","registerLoginEvents","loader","reloadPanelAfterLogin","progressIndicator","mode","contentWindow","showLoader","blockInfo","enabled","blockOverlayCSS","opacity","src","getAttribute","removeAttribute","setAttribute","document","body","dataset","showConsole","s","x","p","navigator","console","log","innerHTML","registerEvents","length","data","reloadView","showNotify","title","onReady","info","source","device","diagnostics","hostName","host","HostType","Outlook","addHandlerAsync","EventType","ItemChanged"],"mappings":"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"}