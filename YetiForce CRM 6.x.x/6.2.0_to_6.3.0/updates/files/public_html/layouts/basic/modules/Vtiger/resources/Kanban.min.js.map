{"version":3,"file":"Kanban.min.js","sources":["Kanban.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 4.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\n$.Class(\n\t'Vtiger_Kanban_Js',\n\t{},\n\t{\n\t\t/**\n\t\t * Get params\n\t\t */\n\t\tgetParams: function () {\n\t\t\tconst params = [];\n\t\t\tthis.page.find('.js-params').each(function () {\n\t\t\t\tlet element = $(this);\n\t\t\t\tparams[element.attr('name')] = element.val();\n\t\t\t});\n\t\t\treturn $.extend(\n\t\t\t\t{\n\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\tview: 'Kanban',\n\t\t\t\t\tboard: this.page.find('.js-board-tab.active').data('id')\n\t\t\t\t},\n\t\t\t\tparams\n\t\t\t);\n\t\t},\n\t\tloadKanban: function () {\n\t\t\tconst params = this.getParams(),\n\t\t\t\turlParams = Object.assign({}, params);\n\t\t\tdelete urlParams.orderBy;\n\t\t\tapp.changeUrl(urlParams);\n\t\t\tconst progress = $.progressIndicator({ blockInfo: { enabled: true, elementToBlock: this.container } });\n\t\t\tAppConnector.request(params)\n\t\t\t\t.done((responseData) => {\n\t\t\t\t\tthis.container.html(responseData);\n\t\t\t\t\tthis.registerSortable();\n\t\t\t\t\tprogress.progressIndicator({ mode: 'hide' });\n\t\t\t\t})\n\t\t\t\t.fail((_, errorThrown) => {\n\t\t\t\t\tprogress.progressIndicator({ mode: 'hide' });\n\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\ttitle: app.vtranslate('JS_ERROR'),\n\t\t\t\t\t\ttext: errorThrown,\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t},\n\t\tregisterSortable: function () {\n\t\t\tconst boards = this.container.find('.js-kanban-records');\n\t\t\tboards.sortable({\n\t\t\t\tcontainment: this.container,\n\t\t\t\titems: boards.find('.js-kanban-record'),\n\t\t\t\tcancel: '.js-kanban-disabled',\n\t\t\t\tconnectWith: boards,\n\t\t\t\tplaceholder: 'c-kanban__highlight',\n\t\t\t\trevert: true,\n\t\t\t\ttolerance: 'pointer',\n\t\t\t\tcursor: 'move',\n\t\t\t\tupdate: (e, ui) => {\n\t\t\t\t\tif (ui.sender == null) {\n\t\t\t\t\t\tconst records = ui.item.closest('.js-kanban-records');\n\t\t\t\t\t\tVtiger_Edit_Js.saveAjax({\n\t\t\t\t\t\t\trecord: ui.item.data('id'),\n\t\t\t\t\t\t\tfield: records.data('field'),\n\t\t\t\t\t\t\tvalue: records.data('value')\n\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.done(() => {\n\t\t\t\t\t\t\t\tthis.loadKanban();\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.fail(function (error, err) {\n\t\t\t\t\t\t\t\tapp.errorLog(error, err);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tstart: (e, ui) => {\n\t\t\t\t\tui.placeholder.height(ui.helper.outerHeight());\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Registers mobile devices.\n\t\t */\n\t\tregisterMobileDevices: function () {\n\t\t\tif (app.isTouchDevice()) {\n\t\t\t\tthis.container.find('.js-kanban-record').each(function () {\n\t\t\t\t\tlet element = $(this);\n\t\t\t\t\telement.find('.js-popover-tooltip--record').removeClass('js-popover-tooltip--record');\n\t\t\t\t\tlet btns = element.find('.btns');\n\t\t\t\t\tlet btnQuickEditModal = btns.find('.js-quick-edit-modal');\n\t\t\t\t\telement.addClass('js-quick-edit-modal');\n\t\t\t\t\telement.attr('href', btnQuickEditModal.attr('href'));\n\t\t\t\t\telement.attr('data-record', btnQuickEditModal.data('record'));\n\t\t\t\t\telement.attr('data-module', btnQuickEditModal.data('module'));\n\t\t\t\t\tbtns.remove();\n\t\t\t\t\telement.find('a').on('click', function (e) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Registers Kanban view events.\n\t\t */\n\t\tregisterEvents: function () {\n\t\t\tthis.page = $('#centerPanel');\n\t\t\tthis.container = $('.js-kanban-container');\n\t\t\tthis.registerSortable();\n\t\t\tapp.showNewScrollbarTopBottom(this.container);\n\t\t\tthis.page.on('click', '.js-board-tab', (e) => {\n\t\t\t\tthis.page.find('.js-board-tab.active').removeClass('active');\n\t\t\t\t$(e.currentTarget).addClass('active');\n\t\t\t\tthis.loadKanban();\n\t\t\t});\n\t\t\tthis.page.on('change', '.js-params', () => {\n\t\t\t\tthis.loadKanban();\n\t\t\t});\n\t\t\tthis.page.on('click', '.js-list-reload', (e, data) => {\n\t\t\t\tthis.page.find('#orderBy').val(JSON.stringify(data.orderby)).trigger('change');\n\t\t\t});\n\t\t\tthis.registerMobileDevices();\n\t\t}\n\t}\n);\n"],"names":["$","Class","getParams","params","page","find","each","element","attr","val","extend","module","app","getModuleName","view","board","data","loadKanban","urlParams","Object","assign","orderBy","changeUrl","progress","progressIndicator","blockInfo","enabled","elementToBlock","container","AppConnector","request","done","responseData","html","registerSortable","mode","fail","_","errorThrown","showNotify","title","vtranslate","text","type","boards","sortable","containment","items","cancel","connectWith","placeholder","revert","tolerance","cursor","update","e","ui","sender","records","item","closest","Vtiger_Edit_Js","saveAjax","record","field","value","error","err","errorLog","start","height","helper","outerHeight","registerMobileDevices","isTouchDevice","removeClass","btns","btnQuickEditModal","addClass","remove","on","stopPropagation","registerEvents","showNewScrollbarTopBottom","currentTarget","JSON","stringify","orderby","trigger"],"mappings":"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"}