{"version":3,"file":"QuickCreate.min.js","sources":["QuickCreate.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 4.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\n/**\n *  Class representing a modal calendar.\n * @extends Vtiger_Calendar_Js\n */\nwindow.Reservations_CalendarModal_Js = class Reservations_CalendarModal_Js extends Vtiger_Calendar_Js {\n\tconstructor(container, readonly) {\n\t\tsuper(container, readonly);\n\t\tthis.isSwitchAllDays = false;\n\t\tthis.sidebarName = 'add'; //available: add, status, edit\n\t\tthis.eventCreate = false;\n\t\tthis.module = container.find('[name=\"module\"]').val();\n\t\tthis.renderCalendar();\n\t\tthis.registerEvents();\n\t}\n\n\taddCommonMethodsToYearView() {}\n\t/**\n\t * Function sets calendar module's options\n\t */\n\tsetCalendarModuleOptions() {\n\t\tlet options = super.setCalendarModuleOptions();\n\t\toptions.selectable = true;\n\t\toptions.hiddenDays = app.getMainParams('hiddenDays', true);\n\t\toptions.header = {\n\t\t\tleft: 'month,' + app.getMainParams('weekView') + ',' + app.getMainParams('dayView'),\n\t\t\tcenter: 'prevYear,prev,title,next,nextYear',\n\t\t\tright: 'today'\n\t\t};\n\t\toptions.eventClick = function (calEvent, jsEvent) {\n\t\t\tjsEvent.preventDefault();\n\t\t};\n\t\treturn options;\n\t}\n\n\t/**\n\t * Function registers calendar events\n\t */\n\tregisterEvents() {\n\t\tthis.registerSwitchEvents();\n\t\tthis.registerUsersChange();\n\t}\n\n\t/**\n\t * Function registers calendar switch event\n\t */\n\tregisterSwitchEvents() {\n\t\tif (app.getMainParams('hiddenDays', true) !== false) {\n\t\t\tlet calendarView = this.getCalendarView(),\n\t\t\t\tswitchContainer = $(`<div class=\"js-calendar-switch-container\"></div>`).insertAfter(\n\t\t\t\t\tcalendarView.find('.fc-center')\n\t\t\t\t);\n\t\t\t$(this.switchTpl(app.vtranslate('JS_WORK_DAYS'), app.vtranslate('JS_ALL'), this.isSwitchAllDays))\n\t\t\t\t.prependTo(switchContainer)\n\t\t\t\t.on('change', 'input', (e) => {\n\t\t\t\t\tconst currentTarget = $(e.currentTarget);\n\t\t\t\t\tlet hiddenDays = [];\n\t\t\t\t\tif (typeof currentTarget.data('on-text') !== 'undefined') {\n\t\t\t\t\t\thiddenDays = app.getMainParams('hiddenDays', true);\n\t\t\t\t\t\tthis.isSwitchAllDays = false;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.isSwitchAllDays = true;\n\t\t\t\t\t}\n\t\t\t\t\tthis.getCalendarView().fullCalendar('option', 'hiddenDays', hiddenDays);\n\t\t\t\t\tif (this.getCalendarView().fullCalendar('getView').type === 'year') {\n\t\t\t\t\t\tthis.registerViewRenderEvents(this.getCalendarView().fullCalendar('getView'));\n\t\t\t\t\t}\n\t\t\t\t\tthis.registerSwitchEvents();\n\t\t\t\t});\n\t\t}\n\t}\n\tswitchTpl(on, off, state) {\n\t\treturn `<div class=\"btn-group btn-group-toggle js-switch c-calendar-switch\" data-toggle=\"buttons\">\n\t\t\t\t\t<label class=\"btn btn-outline-primary c-calendar-switch__button js-switch--label-on ${state ? '' : 'active'}\">\n\t\t\t\t\t\t<input type=\"radio\" name=\"options\" data-on-text=\"${on}\" autocomplete=\"off\" ${state ? '' : 'checked'}>\n\t\t\t\t\t\t${on}\n\t\t\t\t\t</label>\n\t\t\t\t\t<label class=\"btn btn-outline-primary c-calendar-switch__button ${state ? 'active' : ''}\">\n\t\t\t\t\t\t<input type=\"radio\" name=\"options\" data-off-text=\"${off}\" autocomplete=\"off\" ${state ? 'checked' : ''}>\n\t\t\t\t\t\t${off}\n\t\t\t\t\t</label>\n\t\t\t\t</div>`;\n\t}\n\t/**\n\t * Function registers select's user change event\n\t */\n\tregisterUsersChange() {\n\t\tthis.container.find('.assigned_user_id').on('change', () => {\n\t\t\tthis.getCalendarView().fullCalendar('getCalendar').view.options.loadView();\n\t\t});\n\t}\n\n\t/**\n\t * Function return user's id\n\t * @returns {int}\n\t */\n\tgetSelectedUsersCalendar() {\n\t\treturn this.container.find('.assigned_user_id').val();\n\t}\n\n\t/**\n\t * Function invokes by fullcalendar, sets selected days in form\n\t * @param startDate\n\t * @param endDate\n\t */\n\tselectDays(startDate, endDate) {\n\t\tif (this.sidebarName === 'status') {\n\t\t\tthis.sidebarName = 'add';\n\t\t\tthis.getCalendarCreateView().done(() => {\n\t\t\t\tthis.selectDays(startDate, endDate);\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\t\tlet startHour = app.getMainParams('startHour'),\n\t\t\tendHour = app.getMainParams('endHour'),\n\t\t\tview = this.getCalendarView().fullCalendar('getView');\n\t\tif (endDate.hasTime() == false) {\n\t\t\tendDate.add(-1, 'days');\n\t\t}\n\t\tstartDate = startDate.format();\n\t\tendDate = endDate.format();\n\t\tif (startHour == '') {\n\t\t\tstartHour = '00';\n\t\t}\n\t\tif (endHour == '') {\n\t\t\tendHour = '00';\n\t\t}\n\t\tif (view.name != 'agendaDay' && view.name != 'agendaWeek') {\n\t\t\tstartDate = startDate + 'T' + startHour + ':00';\n\t\t\tendDate = endDate + 'T' + endHour + ':00';\n\t\t}\n\t\tlet dateFormat = this.container.find('[name=\"date_start\"]').data('dateFormat').toUpperCase(),\n\t\t\ttimeFormat = this.container.find('[name=\"time_start\"]').data('format'),\n\t\t\tdefaultTimeFormat = '';\n\t\tif (timeFormat == 24) {\n\t\t\tdefaultTimeFormat = 'HH:mm';\n\t\t} else {\n\t\t\tdefaultTimeFormat = 'hh:mm A';\n\t\t}\n\t\tthis.container.find('[name=\"date_start\"]').val(moment(startDate).format(dateFormat));\n\t\tthis.container.find('[name=\"due_date\"]').val(moment(endDate).format(dateFormat));\n\t\tif (this.container.find('.js-autofill').prop('checked') === true) {\n\t\t\tlet calendarEditInstance = new Calendar_Edit_Js();\n\t\t\tcalendarEditInstance.getFreeTime(this.container);\n\t\t} else {\n\t\t\tthis.container.find('[name=\"time_start\"]').val(moment(startDate).format(defaultTimeFormat));\n\t\t\tthis.container.find('[name=\"time_end\"]').val(moment(endDate).format(defaultTimeFormat));\n\t\t}\n\t}\n};\n\n$.Class(\n\t'Reservations_QuickCreate_Js',\n\t{},\n\t{\n\t\tcontainer: false,\n\t\tmodule: false,\n\t\tcalendar: false,\n\t\tgetContainer() {\n\t\t\treturn this.container;\n\t\t},\n\t\tsetContainer(container) {\n\t\t\tthis.container = container;\n\t\t},\n\t\tsetModule() {\n\t\t\tthis.module = this.getContainer().find('[name=\"module\"]').val();\n\t\t},\n\t\tinitCalendar() {\n\t\t\tlet className = this.module + '_CalendarModal_Js';\n\t\t\tthis.calendar = new window[className](this.getContainer().closest('.js-modal-container'), true);\n\t\t},\n\t\tregisterEvents: function (container) {\n\t\t\tthis.setContainer(container);\n\t\t\tthis.setModule();\n\t\t\tthis.initCalendar();\n\t\t}\n\t}\n);\n"],"names":["window","Reservations_CalendarModal_Js","container","readonly","isSwitchAllDays","sidebarName","eventCreate","module","find","val","renderCalendar","registerEvents","options","selectable","hiddenDays","app","getMainParams","header","left","center","right","eventClick","calEvent","jsEvent","preventDefault","registerSwitchEvents","registerUsersChange","calendarView","getCalendarView","switchContainer","$","insertAfter","switchTpl","vtranslate","prependTo","on","e","currentTarget","data","fullCalendar","type","registerViewRenderEvents","off","state","view","loadView","startDate","endDate","getCalendarCreateView","done","selectDays","startHour","endHour","hasTime","add","format","name","dateFormat","toUpperCase","timeFormat","defaultTimeFormat","moment","prop","calendarEditInstance","Calendar_Edit_Js","getFreeTime","Vtiger_Calendar_Js","Class","calendar","getContainer","setContainer","setModule","initCalendar","className","closest"],"mappings":"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"}